!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("events")):"function"==typeof define&&define.amd?define(["exports","events"],e):e((t=t||self).alfrid={},t.EventDispatcher)}(this,(function(t,e){"use strict";e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;
/*
	object-assign
	(c) Sindre Sorhus
	@license MIT
	*/
var r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable;function a(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}var s=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},r=0;r<10;r++)e["_"+String.fromCharCode(r)]=r;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(t){n[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var s,o,u=a(t),h=1;h<arguments.length;h++){for(var _ in s=Object(arguments[h]))n.call(s,_)&&(u[_]=s[_]);if(r){o=r(s);for(var c=0;c<o.length;c++)i.call(s,o[c])&&(u[o[c]]=s[o[c]])}}return u},o=1e-6,u="undefined"!=typeof Float32Array?Float32Array:Array,h=Math.random;var _=Math.PI/180;function c(t,e){return Math.abs(t-e)<=o*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var l=Object.freeze({__proto__:null,EPSILON:o,get ARRAY_TYPE(){return u},RANDOM:h,setMatrixArrayType:function(t){u=t},toRadian:function(t){return t*_},equals:c});function E(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=r[0],u=r[1],h=r[2],_=r[3];return t[0]=n*o+a*u,t[1]=i*o+s*u,t[2]=n*h+a*_,t[3]=i*h+s*_,t}function f(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}var T=E,d=f,m=Object.freeze({__proto__:null,create:function(){var t=new u(4);return u!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},clone:function(t){var e=new u(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,e,r,n){var i=new u(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i},set:function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},transpose:function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=r*a-i*n;return s?(s=1/s,t[0]=a*s,t[1]=-n*s,t[2]=-i*s,t[3]=r*s,t):null},adjoint:function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:E,rotate:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=Math.sin(r),u=Math.cos(r);return t[0]=n*u+a*o,t[1]=i*u+s*o,t[2]=n*-o+a*u,t[3]=i*-o+s*u,t},scale:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=r[0],u=r[1];return t[0]=n*o,t[1]=i*o,t[2]=a*u,t[3]=s*u,t},fromRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},str:function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3])},LDU:function(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},subtract:f,exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},equals:function(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],s=e[0],u=e[1],h=e[2],_=e[3];return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-u)<=o*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-h)<=o*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-_)<=o*Math.max(1,Math.abs(a),Math.abs(_))},multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},multiplyScalarAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},mul:T,sub:d});function p(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=r[0],_=r[1],c=r[2],l=r[3],E=r[4],f=r[5];return t[0]=n*h+a*_,t[1]=i*h+s*_,t[2]=n*c+a*l,t[3]=i*c+s*l,t[4]=n*E+a*f+o,t[5]=i*E+s*f+u,t}function M(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}var R=p,A=M,v=Object.freeze({__proto__:null,create:function(){var t=new u(6);return u!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},clone:function(t){var e=new u(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,e,r,n,i,a){var s=new u(6);return s[0]=t,s[1]=e,s[2]=r,s[3]=n,s[4]=i,s[5]=a,s},set:function(t,e,r,n,i,a,s){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=s,t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],u=r*a-n*i;return u?(u=1/u,t[0]=a*u,t[1]=-n*u,t[2]=-i*u,t[3]=r*u,t[4]=(i*o-a*s)*u,t[5]=(n*s-r*o)*u,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:p,rotate:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=Math.sin(r),_=Math.cos(r);return t[0]=n*_+a*h,t[1]=i*_+s*h,t[2]=n*-h+a*_,t[3]=i*-h+s*_,t[4]=o,t[5]=u,t},scale:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=r[0],_=r[1];return t[0]=n*h,t[1]=i*h,t[2]=a*_,t[3]=s*_,t[4]=o,t[5]=u,t},translate:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=r[0],_=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=n*h+a*_+o,t[5]=i*h+s*_+u,t},fromRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},subtract:M,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},multiplyScalarAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},equals:function(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],u=t[5],h=e[0],_=e[1],c=e[2],l=e[3],E=e[4],f=e[5];return Math.abs(r-h)<=o*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(n-_)<=o*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-c)<=o*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-l)<=o*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(s-E)<=o*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-f)<=o*Math.max(1,Math.abs(u),Math.abs(f))},mul:R,sub:A});function I(){var t=new u(9);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function g(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function N(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function S(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],u=e[6],h=e[7],_=e[8],c=_*s-o*h,l=-_*a+o*u,E=h*a-s*u,f=r*c+n*l+i*E;return f?(f=1/f,t[0]=c*f,t[1]=(-_*n+i*h)*f,t[2]=(o*n-i*s)*f,t[3]=l*f,t[4]=(_*r-i*u)*f,t[5]=(-o*r+i*a)*f,t[6]=E*f,t[7]=(-h*r+n*u)*f,t[8]=(s*r-n*a)*f,t):null}function b(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=e[6],_=e[7],c=e[8],l=r[0],E=r[1],f=r[2],T=r[3],d=r[4],m=r[5],p=r[6],M=r[7],R=r[8];return t[0]=l*n+E*s+f*h,t[1]=l*i+E*o+f*_,t[2]=l*a+E*u+f*c,t[3]=T*n+d*s+m*h,t[4]=T*i+d*o+m*_,t[5]=T*a+d*u+m*c,t[6]=p*n+M*s+R*h,t[7]=p*i+M*o+R*_,t[8]=p*a+M*u+R*c,t}function L(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}var x=b,C=L,P=Object.freeze({__proto__:null,create:I,fromMat4:g,clone:function(t){var e=new u(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(t,e,r,n,i,a,s,o,h){var _=new u(9);return _[0]=t,_[1]=e,_[2]=r,_[3]=n,_[4]=i,_[5]=a,_[6]=s,_[7]=o,_[8]=h,_},set:function(t,e,r,n,i,a,s,o,u,h){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=s,t[6]=o,t[7]=u,t[8]=h,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:N,invert:S,adjoint:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],u=e[6],h=e[7],_=e[8];return t[0]=s*_-o*h,t[1]=i*h-n*_,t[2]=n*o-i*s,t[3]=o*u-a*_,t[4]=r*_-i*u,t[5]=i*a-r*o,t[6]=a*h-s*u,t[7]=n*u-r*h,t[8]=r*s-n*a,t},determinant:function(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],s=t[5],o=t[6],u=t[7],h=t[8];return e*(h*a-s*u)+r*(-h*i+s*o)+n*(u*i-a*o)},multiply:b,translate:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=e[6],_=e[7],c=e[8],l=r[0],E=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=o,t[5]=u,t[6]=l*n+E*s+h,t[7]=l*i+E*o+_,t[8]=l*a+E*u+c,t},rotate:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=e[6],_=e[7],c=e[8],l=Math.sin(r),E=Math.cos(r);return t[0]=E*n+l*s,t[1]=E*i+l*o,t[2]=E*a+l*u,t[3]=E*s-l*n,t[4]=E*o-l*i,t[5]=E*u-l*a,t[6]=h,t[7]=_,t[8]=c,t},scale:function(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},fromRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat2d:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},fromQuat:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=r+r,o=n+n,u=i+i,h=r*s,_=n*s,c=n*o,l=i*s,E=i*o,f=i*u,T=a*s,d=a*o,m=a*u;return t[0]=1-c-f,t[3]=_-m,t[6]=l+d,t[1]=_+m,t[4]=1-h-f,t[7]=E-T,t[2]=l-d,t[5]=E+T,t[8]=1-h-c,t},normalFromMat4:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],u=e[6],h=e[7],_=e[8],c=e[9],l=e[10],E=e[11],f=e[12],T=e[13],d=e[14],m=e[15],p=r*o-n*s,M=r*u-i*s,R=r*h-a*s,A=n*u-i*o,v=n*h-a*o,I=i*h-a*u,g=_*T-c*f,N=_*d-l*f,S=_*m-E*f,b=c*d-l*T,L=c*m-E*T,x=l*m-E*d,C=p*x-M*L+R*b+A*S-v*N+I*g;return C?(C=1/C,t[0]=(o*x-u*L+h*b)*C,t[1]=(u*S-s*x-h*N)*C,t[2]=(s*L-o*S+h*g)*C,t[3]=(i*L-n*x-a*b)*C,t[4]=(r*x-i*S+a*N)*C,t[5]=(n*S-r*L-a*g)*C,t[6]=(T*I-d*v+m*A)*C,t[7]=(d*R-f*I-m*M)*C,t[8]=(f*v-T*R+m*p)*C,t):null},projection:function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},subtract:L,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},multiplyScalarAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},equals:function(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],u=t[5],h=t[6],_=t[7],c=t[8],l=e[0],E=e[1],f=e[2],T=e[3],d=e[4],m=e[5],p=e[6],M=e[7],R=e[8];return Math.abs(r-l)<=o*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(n-E)<=o*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(i-f)<=o*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-T)<=o*Math.max(1,Math.abs(a),Math.abs(T))&&Math.abs(s-d)<=o*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(u-m)<=o*Math.max(1,Math.abs(u),Math.abs(m))&&Math.abs(h-p)<=o*Math.max(1,Math.abs(h),Math.abs(p))&&Math.abs(_-M)<=o*Math.max(1,Math.abs(_),Math.abs(M))&&Math.abs(c-R)<=o*Math.max(1,Math.abs(c),Math.abs(R))},mul:x,sub:C});function O(){var t=new u(16);return u!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function U(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function F(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],u=e[6],h=e[7],_=e[8],c=e[9],l=e[10],E=e[11],f=e[12],T=e[13],d=e[14],m=e[15],p=r*o-n*s,M=r*u-i*s,R=r*h-a*s,A=n*u-i*o,v=n*h-a*o,I=i*h-a*u,g=_*T-c*f,N=_*d-l*f,S=_*m-E*f,b=c*d-l*T,L=c*m-E*T,x=l*m-E*d,C=p*x-M*L+R*b+A*S-v*N+I*g;return C?(C=1/C,t[0]=(o*x-u*L+h*b)*C,t[1]=(i*L-n*x-a*b)*C,t[2]=(T*I-d*v+m*A)*C,t[3]=(l*v-c*I-E*A)*C,t[4]=(u*S-s*x-h*N)*C,t[5]=(r*x-i*S+a*N)*C,t[6]=(d*R-f*I-m*M)*C,t[7]=(_*I-l*R+E*M)*C,t[8]=(s*L-o*S+h*g)*C,t[9]=(n*S-r*L-a*g)*C,t[10]=(f*v-T*R+m*p)*C,t[11]=(c*R-_*v-E*p)*C,t[12]=(o*N-s*b-u*g)*C,t[13]=(r*b-n*N+i*g)*C,t[14]=(T*M-f*A-d*p)*C,t[15]=(_*A-c*M+l*p)*C,t):null}function D(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=e[6],_=e[7],c=e[8],l=e[9],E=e[10],f=e[11],T=e[12],d=e[13],m=e[14],p=e[15],M=r[0],R=r[1],A=r[2],v=r[3];return t[0]=M*n+R*o+A*c+v*T,t[1]=M*i+R*u+A*l+v*d,t[2]=M*a+R*h+A*E+v*m,t[3]=M*s+R*_+A*f+v*p,M=r[4],R=r[5],A=r[6],v=r[7],t[4]=M*n+R*o+A*c+v*T,t[5]=M*i+R*u+A*l+v*d,t[6]=M*a+R*h+A*E+v*m,t[7]=M*s+R*_+A*f+v*p,M=r[8],R=r[9],A=r[10],v=r[11],t[8]=M*n+R*o+A*c+v*T,t[9]=M*i+R*u+A*l+v*d,t[10]=M*a+R*h+A*E+v*m,t[11]=M*s+R*_+A*f+v*p,M=r[12],R=r[13],A=r[14],v=r[15],t[12]=M*n+R*o+A*c+v*T,t[13]=M*i+R*u+A*l+v*d,t[14]=M*a+R*h+A*E+v*m,t[15]=M*s+R*_+A*f+v*p,t}function w(t,e,r){var n,i,a,s,o,u,h,_,c,l,E,f,T=r[0],d=r[1],m=r[2];return e===t?(t[12]=e[0]*T+e[4]*d+e[8]*m+e[12],t[13]=e[1]*T+e[5]*d+e[9]*m+e[13],t[14]=e[2]*T+e[6]*d+e[10]*m+e[14],t[15]=e[3]*T+e[7]*d+e[11]*m+e[15]):(n=e[0],i=e[1],a=e[2],s=e[3],o=e[4],u=e[5],h=e[6],_=e[7],c=e[8],l=e[9],E=e[10],f=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=o,t[5]=u,t[6]=h,t[7]=_,t[8]=c,t[9]=l,t[10]=E,t[11]=f,t[12]=n*T+o*d+c*m+e[12],t[13]=i*T+u*d+l*m+e[13],t[14]=a*T+h*d+E*m+e[14],t[15]=s*T+_*d+f*m+e[15]),t}function y(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function G(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],s=e[5],o=e[6],u=e[7],h=e[8],_=e[9],c=e[10],l=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+h*n,t[5]=s*i+_*n,t[6]=o*i+c*n,t[7]=u*i+l*n,t[8]=h*i-a*n,t[9]=_*i-s*n,t[10]=c*i-o*n,t[11]=l*i-u*n,t}function V(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],s=e[1],o=e[2],u=e[3],h=e[8],_=e[9],c=e[10],l=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-h*n,t[1]=s*i-_*n,t[2]=o*i-c*n,t[3]=u*i-l*n,t[8]=a*n+h*i,t[9]=s*n+_*i,t[10]=o*n+c*i,t[11]=u*n+l*i,t}function X(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],s=e[1],o=e[2],u=e[3],h=e[4],_=e[5],c=e[6],l=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+h*n,t[1]=s*i+_*n,t[2]=o*i+c*n,t[3]=u*i+l*n,t[4]=h*i-a*n,t[5]=_*i-s*n,t[6]=c*i-o*n,t[7]=l*i-u*n,t}function H(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=n+n,u=i+i,h=a+a,_=n*o,c=n*u,l=n*h,E=i*u,f=i*h,T=a*h,d=s*o,m=s*u,p=s*h;return t[0]=1-(E+T),t[1]=c+p,t[2]=l-m,t[3]=0,t[4]=c-p,t[5]=1-(_+T),t[6]=f+d,t[7]=0,t[8]=l+m,t[9]=f-d,t[10]=1-(_+E),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function W(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function q(t,e){var r=e[0],n=e[1],i=e[2],a=e[4],s=e[5],o=e[6],u=e[8],h=e[9],_=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(a,s,o),t[2]=Math.hypot(u,h,_),t}function Y(t,e){var r=new u(3);q(r,e);var n=1/r[0],i=1/r[1],a=1/r[2],s=e[0]*n,o=e[1]*i,h=e[2]*a,_=e[4]*n,c=e[5]*i,l=e[6]*a,E=e[8]*n,f=e[9]*i,T=e[10]*a,d=s+c+T,m=0;return d>0?(m=2*Math.sqrt(d+1),t[3]=.25*m,t[0]=(l-f)/m,t[1]=(E-h)/m,t[2]=(o-_)/m):s>c&&s>T?(m=2*Math.sqrt(1+s-c-T),t[3]=(l-f)/m,t[0]=.25*m,t[1]=(o+_)/m,t[2]=(E+h)/m):c>T?(m=2*Math.sqrt(1+c-s-T),t[3]=(E-h)/m,t[0]=(o+_)/m,t[1]=.25*m,t[2]=(l+f)/m):(m=2*Math.sqrt(1+T-s-c),t[3]=(o-_)/m,t[0]=(E+h)/m,t[1]=(l+f)/m,t[2]=.25*m),t}function j(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=r+r,o=n+n,u=i+i,h=r*s,_=n*s,c=n*o,l=i*s,E=i*o,f=i*u,T=a*s,d=a*o,m=a*u;return t[0]=1-c-f,t[1]=_+m,t[2]=l-d,t[3]=0,t[4]=_-m,t[5]=1-h-f,t[6]=E+T,t[7]=0,t[8]=l+d,t[9]=E-T,t[10]=1-h-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function k(t,e,r,n,i){var a,s=1/Math.tan(e/2);return t[0]=s/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(a=1/(n-i),t[10]=(i+n)*a,t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t}function z(t,e,r,n,i,a,s){var o=1/(e-r),u=1/(n-i),h=1/(a-s);return t[0]=-2*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*h,t[11]=0,t[12]=(e+r)*o,t[13]=(i+n)*u,t[14]=(s+a)*h,t[15]=1,t}function K(t,e,r,n){var i,a,s,u,h,_,c,l,E,f,T=e[0],d=e[1],m=e[2],p=n[0],M=n[1],R=n[2],A=r[0],v=r[1],I=r[2];return Math.abs(T-A)<o&&Math.abs(d-v)<o&&Math.abs(m-I)<o?F(t):(c=T-A,l=d-v,E=m-I,i=M*(E*=f=1/Math.hypot(c,l,E))-R*(l*=f),a=R*(c*=f)-p*E,s=p*l-M*c,(f=Math.hypot(i,a,s))?(i*=f=1/f,a*=f,s*=f):(i=0,a=0,s=0),u=l*s-E*a,h=E*i-c*s,_=c*a-l*i,(f=Math.hypot(u,h,_))?(u*=f=1/f,h*=f,_*=f):(u=0,h=0,_=0),t[0]=i,t[1]=u,t[2]=c,t[3]=0,t[4]=a,t[5]=h,t[6]=l,t[7]=0,t[8]=s,t[9]=_,t[10]=E,t[11]=0,t[12]=-(i*T+a*d+s*m),t[13]=-(u*T+h*d+_*m),t[14]=-(c*T+l*d+E*m),t[15]=1,t)}function Z(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}var Q=D,$=Z,J=Object.freeze({__proto__:null,create:O,clone:function(t){var e=new u(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:U,fromValues:function(t,e,r,n,i,a,s,o,h,_,c,l,E,f,T,d){var m=new u(16);return m[0]=t,m[1]=e,m[2]=r,m[3]=n,m[4]=i,m[5]=a,m[6]=s,m[7]=o,m[8]=h,m[9]=_,m[10]=c,m[11]=l,m[12]=E,m[13]=f,m[14]=T,m[15]=d,m},set:function(t,e,r,n,i,a,s,o,u,h,_,c,l,E,f,T,d){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=s,t[6]=o,t[7]=u,t[8]=h,t[9]=_,t[10]=c,t[11]=l,t[12]=E,t[13]=f,t[14]=T,t[15]=d,t},identity:F,transpose:function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],a=e[6],s=e[7],o=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=i,t[13]=s,t[14]=o}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},invert:B,adjoint:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=e[4],o=e[5],u=e[6],h=e[7],_=e[8],c=e[9],l=e[10],E=e[11],f=e[12],T=e[13],d=e[14],m=e[15];return t[0]=o*(l*m-E*d)-c*(u*m-h*d)+T*(u*E-h*l),t[1]=-(n*(l*m-E*d)-c*(i*m-a*d)+T*(i*E-a*l)),t[2]=n*(u*m-h*d)-o*(i*m-a*d)+T*(i*h-a*u),t[3]=-(n*(u*E-h*l)-o*(i*E-a*l)+c*(i*h-a*u)),t[4]=-(s*(l*m-E*d)-_*(u*m-h*d)+f*(u*E-h*l)),t[5]=r*(l*m-E*d)-_*(i*m-a*d)+f*(i*E-a*l),t[6]=-(r*(u*m-h*d)-s*(i*m-a*d)+f*(i*h-a*u)),t[7]=r*(u*E-h*l)-s*(i*E-a*l)+_*(i*h-a*u),t[8]=s*(c*m-E*T)-_*(o*m-h*T)+f*(o*E-h*c),t[9]=-(r*(c*m-E*T)-_*(n*m-a*T)+f*(n*E-a*c)),t[10]=r*(o*m-h*T)-s*(n*m-a*T)+f*(n*h-a*o),t[11]=-(r*(o*E-h*c)-s*(n*E-a*c)+_*(n*h-a*o)),t[12]=-(s*(c*d-l*T)-_*(o*d-u*T)+f*(o*l-u*c)),t[13]=r*(c*d-l*T)-_*(n*d-i*T)+f*(n*l-i*c),t[14]=-(r*(o*d-u*T)-s*(n*d-i*T)+f*(n*u-i*o)),t[15]=r*(o*l-u*c)-s*(n*l-i*c)+_*(n*u-i*o),t},determinant:function(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],s=t[5],o=t[6],u=t[7],h=t[8],_=t[9],c=t[10],l=t[11],E=t[12],f=t[13],T=t[14],d=t[15];return(e*s-r*a)*(c*d-l*T)-(e*o-n*a)*(_*d-l*f)+(e*u-i*a)*(_*T-c*f)+(r*o-n*s)*(h*d-l*E)-(r*u-i*s)*(h*T-c*E)+(n*u-i*o)*(h*f-_*E)},multiply:D,translate:w,scale:y,rotate:function(t,e,r,n){var i,a,s,u,h,_,c,l,E,f,T,d,m,p,M,R,A,v,I,g,N,S,b,L,x=n[0],C=n[1],P=n[2],O=Math.hypot(x,C,P);return O<o?null:(x*=O=1/O,C*=O,P*=O,i=Math.sin(r),s=1-(a=Math.cos(r)),u=e[0],h=e[1],_=e[2],c=e[3],l=e[4],E=e[5],f=e[6],T=e[7],d=e[8],m=e[9],p=e[10],M=e[11],R=x*x*s+a,A=C*x*s+P*i,v=P*x*s-C*i,I=x*C*s-P*i,g=C*C*s+a,N=P*C*s+x*i,S=x*P*s+C*i,b=C*P*s-x*i,L=P*P*s+a,t[0]=u*R+l*A+d*v,t[1]=h*R+E*A+m*v,t[2]=_*R+f*A+p*v,t[3]=c*R+T*A+M*v,t[4]=u*I+l*g+d*N,t[5]=h*I+E*g+m*N,t[6]=_*I+f*g+p*N,t[7]=c*I+T*g+M*N,t[8]=u*S+l*b+d*L,t[9]=h*S+E*b+m*L,t[10]=_*S+f*b+p*L,t[11]=c*S+T*b+M*L,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},rotateX:G,rotateY:V,rotateZ:X,fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(t,e,r){var n,i,a,s=r[0],u=r[1],h=r[2],_=Math.hypot(s,u,h);return _<o?null:(s*=_=1/_,u*=_,h*=_,n=Math.sin(e),a=1-(i=Math.cos(e)),t[0]=s*s*a+i,t[1]=u*s*a+h*n,t[2]=h*s*a-u*n,t[3]=0,t[4]=s*u*a-h*n,t[5]=u*u*a+i,t[6]=h*u*a+s*n,t[7]=0,t[8]=s*h*a+u*n,t[9]=u*h*a-s*n,t[10]=h*h*a+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},fromXRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:H,fromQuat2:function(t,e){var r=new u(3),n=-e[0],i=-e[1],a=-e[2],s=e[3],o=e[4],h=e[5],_=e[6],c=e[7],l=n*n+i*i+a*a+s*s;return l>0?(r[0]=2*(o*s+c*n+h*a-_*i)/l,r[1]=2*(h*s+c*i+_*n-o*a)/l,r[2]=2*(_*s+c*a+o*i-h*n)/l):(r[0]=2*(o*s+c*n+h*a-_*i),r[1]=2*(h*s+c*i+_*n-o*a),r[2]=2*(_*s+c*a+o*i-h*n)),H(t,e,r),t},getTranslation:W,getScaling:q,getRotation:Y,fromRotationTranslationScale:function(t,e,r,n){var i=e[0],a=e[1],s=e[2],o=e[3],u=i+i,h=a+a,_=s+s,c=i*u,l=i*h,E=i*_,f=a*h,T=a*_,d=s*_,m=o*u,p=o*h,M=o*_,R=n[0],A=n[1],v=n[2];return t[0]=(1-(f+d))*R,t[1]=(l+M)*R,t[2]=(E-p)*R,t[3]=0,t[4]=(l-M)*A,t[5]=(1-(c+d))*A,t[6]=(T+m)*A,t[7]=0,t[8]=(E+p)*v,t[9]=(T-m)*v,t[10]=(1-(c+f))*v,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},fromRotationTranslationScaleOrigin:function(t,e,r,n,i){var a=e[0],s=e[1],o=e[2],u=e[3],h=a+a,_=s+s,c=o+o,l=a*h,E=a*_,f=a*c,T=s*_,d=s*c,m=o*c,p=u*h,M=u*_,R=u*c,A=n[0],v=n[1],I=n[2],g=i[0],N=i[1],S=i[2],b=(1-(T+m))*A,L=(E+R)*A,x=(f-M)*A,C=(E-R)*v,P=(1-(l+m))*v,O=(d+p)*v,U=(f+M)*I,F=(d-p)*I,B=(1-(l+T))*I;return t[0]=b,t[1]=L,t[2]=x,t[3]=0,t[4]=C,t[5]=P,t[6]=O,t[7]=0,t[8]=U,t[9]=F,t[10]=B,t[11]=0,t[12]=r[0]+g-(b*g+C*N+U*S),t[13]=r[1]+N-(L*g+P*N+F*S),t[14]=r[2]+S-(x*g+O*N+B*S),t[15]=1,t},fromQuat:j,frustum:function(t,e,r,n,i,a,s){var o=1/(r-e),u=1/(i-n),h=1/(a-s);return t[0]=2*a*o,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*o,t[9]=(i+n)*u,t[10]=(s+a)*h,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*a*2*h,t[15]=0,t},perspective:k,perspectiveFromFieldOfView:function(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),o=Math.tan(e.rightDegrees*Math.PI/180),u=2/(s+o),h=2/(i+a);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=h,t[6]=0,t[7]=0,t[8]=-(s-o)*u*.5,t[9]=(i-a)*h*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},ortho:z,lookAt:K,targetTo:function(t,e,r,n){var i=e[0],a=e[1],s=e[2],o=n[0],u=n[1],h=n[2],_=i-r[0],c=a-r[1],l=s-r[2],E=_*_+c*c+l*l;E>0&&(_*=E=1/Math.sqrt(E),c*=E,l*=E);var f=u*l-h*c,T=h*_-o*l,d=o*c-u*_;return(E=f*f+T*T+d*d)>0&&(f*=E=1/Math.sqrt(E),T*=E,d*=E),t[0]=f,t[1]=T,t[2]=d,t[3]=0,t[4]=c*d-l*T,t[5]=l*f-_*d,t[6]=_*T-c*f,t[7]=0,t[8]=_,t[9]=c,t[10]=l,t[11]=0,t[12]=i,t[13]=a,t[14]=s,t[15]=1,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},subtract:Z,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},multiplyScalarAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},equals:function(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],u=t[5],h=t[6],_=t[7],c=t[8],l=t[9],E=t[10],f=t[11],T=t[12],d=t[13],m=t[14],p=t[15],M=e[0],R=e[1],A=e[2],v=e[3],I=e[4],g=e[5],N=e[6],S=e[7],b=e[8],L=e[9],x=e[10],C=e[11],P=e[12],O=e[13],U=e[14],F=e[15];return Math.abs(r-M)<=o*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(n-R)<=o*Math.max(1,Math.abs(n),Math.abs(R))&&Math.abs(i-A)<=o*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(a-v)<=o*Math.max(1,Math.abs(a),Math.abs(v))&&Math.abs(s-I)<=o*Math.max(1,Math.abs(s),Math.abs(I))&&Math.abs(u-g)<=o*Math.max(1,Math.abs(u),Math.abs(g))&&Math.abs(h-N)<=o*Math.max(1,Math.abs(h),Math.abs(N))&&Math.abs(_-S)<=o*Math.max(1,Math.abs(_),Math.abs(S))&&Math.abs(c-b)<=o*Math.max(1,Math.abs(c),Math.abs(b))&&Math.abs(l-L)<=o*Math.max(1,Math.abs(l),Math.abs(L))&&Math.abs(E-x)<=o*Math.max(1,Math.abs(E),Math.abs(x))&&Math.abs(f-C)<=o*Math.max(1,Math.abs(f),Math.abs(C))&&Math.abs(T-P)<=o*Math.max(1,Math.abs(T),Math.abs(P))&&Math.abs(d-O)<=o*Math.max(1,Math.abs(d),Math.abs(O))&&Math.abs(m-U)<=o*Math.max(1,Math.abs(m),Math.abs(U))&&Math.abs(p-F)<=o*Math.max(1,Math.abs(p),Math.abs(F))},mul:Q,sub:$});function tt(){var t=new u(3);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function et(t){var e=new u(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function rt(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function nt(t,e,r){var n=new u(3);return n[0]=t,n[1]=e,n[2]=r,n}function it(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function at(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t}function st(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function ot(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function ut(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function ht(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function _t(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.hypot(r,n,i)}function ct(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function lt(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function Et(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function ft(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Tt(t,e,r){var n=e[0],i=e[1],a=e[2],s=r[0],o=r[1],u=r[2];return t[0]=i*u-a*o,t[1]=a*s-n*u,t[2]=n*o-i*s,t}function dt(t,e,r){var n=e[0],i=e[1],a=e[2],s=r[3]*n+r[7]*i+r[11]*a+r[15];return s=s||1,t[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/s,t[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/s,t[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/s,t}function mt(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t}var pt,Mt=st,Rt=ot,At=ut,vt=_t,It=ct,gt=rt,Nt=lt,St=(pt=tt(),function(t,e,r,n,i,a){var s,o;for(e||(e=3),r||(r=0),o=n?Math.min(n*e+r,t.length):t.length,s=r;s<o;s+=e)pt[0]=t[s],pt[1]=t[s+1],pt[2]=t[s+2],i(pt,pt,a),t[s]=pt[0],t[s+1]=pt[1],t[s+2]=pt[2];return t}),bt=Object.freeze({__proto__:null,create:tt,clone:et,length:rt,fromValues:nt,copy:it,set:function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},add:at,subtract:st,multiply:ot,divide:ut,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:ht,scaleAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},distance:_t,squaredDistance:ct,squaredLength:lt,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},normalize:Et,dot:ft,cross:Tt,lerp:function(t,e,r,n){var i=e[0],a=e[1],s=e[2];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=s+n*(r[2]-s),t},hermite:function(t,e,r,n,i,a){var s=a*a,o=s*(2*a-3)+1,u=s*(a-2)+a,h=s*(a-1),_=s*(3-2*a);return t[0]=e[0]*o+r[0]*u+n[0]*h+i[0]*_,t[1]=e[1]*o+r[1]*u+n[1]*h+i[1]*_,t[2]=e[2]*o+r[2]*u+n[2]*h+i[2]*_,t},bezier:function(t,e,r,n,i,a){var s=1-a,o=s*s,u=a*a,h=o*s,_=3*a*o,c=3*u*s,l=u*a;return t[0]=e[0]*h+r[0]*_+n[0]*c+i[0]*l,t[1]=e[1]*h+r[1]*_+n[1]*c+i[1]*l,t[2]=e[2]*h+r[2]*_+n[2]*c+i[2]*l,t},random:function(t,e){e=e||1;var r=2*h()*Math.PI,n=2*h()-1,i=Math.sqrt(1-n*n)*e;return t[0]=Math.cos(r)*i,t[1]=Math.sin(r)*i,t[2]=n*e,t},transformMat4:dt,transformMat3:mt,transformQuat:function(t,e,r){var n=r[0],i=r[1],a=r[2],s=r[3],o=e[0],u=e[1],h=e[2],_=i*h-a*u,c=a*o-n*h,l=n*u-i*o,E=i*l-a*c,f=a*_-n*l,T=n*c-i*_,d=2*s;return _*=d,c*=d,l*=d,E*=2,f*=2,T*=2,t[0]=o+_+E,t[1]=u+c+f,t[2]=h+l+T,t},rotateX:function(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},rotateY:function(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},rotateZ:function(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},angle:function(t,e){var r=nt(t[0],t[1],t[2]),n=nt(e[0],e[1],e[2]);Et(r,r),Et(n,n);var i=ft(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},equals:function(t,e){var r=t[0],n=t[1],i=t[2],a=e[0],s=e[1],u=e[2];return Math.abs(r-a)<=o*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(n-s)<=o*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=o*Math.max(1,Math.abs(i),Math.abs(u))},sub:Mt,mul:Rt,div:At,dist:vt,sqrDist:It,len:gt,sqrLen:Nt,forEach:St});function Lt(){var t=new u(4);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function xt(t){var e=new u(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Ct(t,e,r,n){var i=new u(4);return i[0]=t,i[1]=e,i[2]=r,i[3]=n,i}function Pt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Ot(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function Ut(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function Ft(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function Bt(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function Dt(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function wt(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function yt(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return Math.hypot(r,n,i,a)}function Gt(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return r*r+n*n+i*i+a*a}function Vt(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.hypot(e,r,n,i)}function Xt(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function Ht(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=r*r+n*n+i*i+a*a;return s>0&&(s=1/Math.sqrt(s)),t[0]=r*s,t[1]=n*s,t[2]=i*s,t[3]=a*s,t}function Wt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function qt(t,e,r,n){var i=e[0],a=e[1],s=e[2],o=e[3];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=s+n*(r[2]-s),t[3]=o+n*(r[3]-o),t}function Yt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function jt(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],s=e[0],u=e[1],h=e[2],_=e[3];return Math.abs(r-s)<=o*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-u)<=o*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-h)<=o*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-_)<=o*Math.max(1,Math.abs(a),Math.abs(_))}var kt=Ft,zt=Bt,Kt=Dt,Zt=yt,Qt=Gt,$t=Vt,Jt=Xt,te=function(){var t=Lt();return function(e,r,n,i,a,s){var o,u;for(r||(r=4),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,o=n;o<u;o+=r)t[0]=e[o],t[1]=e[o+1],t[2]=e[o+2],t[3]=e[o+3],a(t,t,s),e[o]=t[0],e[o+1]=t[1],e[o+2]=t[2],e[o+3]=t[3];return e}}(),ee=Object.freeze({__proto__:null,create:Lt,clone:xt,fromValues:Ct,copy:Pt,set:Ot,add:Ut,subtract:Ft,multiply:Bt,divide:Dt,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},scale:wt,scaleAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},distance:yt,squaredDistance:Gt,length:Vt,squaredLength:Xt,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},normalize:Ht,dot:Wt,cross:function(t,e,r,n){var i=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],s=r[0]*n[3]-r[3]*n[0],o=r[1]*n[2]-r[2]*n[1],u=r[1]*n[3]-r[3]*n[1],h=r[2]*n[3]-r[3]*n[2],_=e[0],c=e[1],l=e[2],E=e[3];return t[0]=c*h-l*u+E*o,t[1]=-_*h+l*s-E*a,t[2]=_*u-c*s+E*i,t[3]=-_*o+c*a-l*i,t},lerp:qt,random:function(t,e){var r,n,i,a,s,o;e=e||1;do{s=(r=2*h()-1)*r+(n=2*h()-1)*n}while(s>=1);do{o=(i=2*h()-1)*i+(a=2*h()-1)*a}while(o>=1);var u=Math.sqrt((1-s)/o);return t[0]=e*r,t[1]=e*n,t[2]=e*i*u,t[3]=e*a*u,t},transformMat4:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*s,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*s,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*s,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*s,t},transformQuat:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=r[0],o=r[1],u=r[2],h=r[3],_=h*n+o*a-u*i,c=h*i+u*n-s*a,l=h*a+s*i-o*n,E=-s*n-o*i-u*a;return t[0]=_*h+E*-s+c*-u-l*-o,t[1]=c*h+E*-o+l*-s-_*-u,t[2]=l*h+E*-u+_*-o-c*-s,t[3]=e[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:Yt,equals:jt,sub:kt,mul:zt,div:Kt,dist:Zt,sqrDist:Qt,len:$t,sqrLen:Jt,forEach:te});function re(){var t=new u(4);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ne(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function ie(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=r[0],u=r[1],h=r[2],_=r[3];return t[0]=n*_+s*o+i*h-a*u,t[1]=i*_+s*u+a*o-n*h,t[2]=a*_+s*h+n*u-i*o,t[3]=s*_-n*o-i*u-a*h,t}function ae(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],s=e[3],o=Math.sin(r),u=Math.cos(r);return t[0]=n*u+s*o,t[1]=i*u+a*o,t[2]=a*u-i*o,t[3]=s*u-n*o,t}function se(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],s=e[3],o=Math.sin(r),u=Math.cos(r);return t[0]=n*u-a*o,t[1]=i*u+s*o,t[2]=a*u+n*o,t[3]=s*u-i*o,t}function oe(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],s=e[3],o=Math.sin(r),u=Math.cos(r);return t[0]=n*u+i*o,t[1]=i*u-n*o,t[2]=a*u+s*o,t[3]=s*u-a*o,t}function ue(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=Math.sqrt(r*r+n*n+i*i),o=Math.exp(a),u=s>0?o*Math.sin(s)/s:0;return t[0]=r*u,t[1]=n*u,t[2]=i*u,t[3]=o*Math.cos(s),t}function he(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=Math.sqrt(r*r+n*n+i*i),o=s>0?Math.atan2(s,a)/s:0;return t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=.5*Math.log(r*r+n*n+i*i+a*a),t}function _e(t,e,r,n){var i,a,s,u,h,_=e[0],c=e[1],l=e[2],E=e[3],f=r[0],T=r[1],d=r[2],m=r[3];return(a=_*f+c*T+l*d+E*m)<0&&(a=-a,f=-f,T=-T,d=-d,m=-m),1-a>o?(i=Math.acos(a),s=Math.sin(i),u=Math.sin((1-n)*i)/s,h=Math.sin(n*i)/s):(u=1-n,h=n),t[0]=u*_+h*f,t[1]=u*c+h*T,t[2]=u*l+h*d,t[3]=u*E+h*m,t}function ce(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var a=(i+1)%3,s=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*a+a]-e[3*s+s]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*a+s]-e[3*s+a])*r,t[a]=(e[3*a+i]+e[3*i+a])*r,t[s]=(e[3*s+i]+e[3*i+s])*r}return t}var le,Ee,fe,Te,de,me,pe=xt,Me=Ct,Re=Pt,Ae=Ot,ve=Ut,Ie=ie,ge=wt,Ne=Wt,Se=qt,be=Vt,Le=be,xe=Xt,Ce=xe,Pe=Ht,Oe=Yt,Ue=jt,Fe=(le=tt(),Ee=nt(1,0,0),fe=nt(0,1,0),function(t,e,r){var n=ft(e,r);return n<-.999999?(Tt(le,Ee,e),gt(le)<1e-6&&Tt(le,fe,e),Et(le,le),ne(t,le,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Tt(le,e,r),t[0]=le[0],t[1]=le[1],t[2]=le[2],t[3]=1+n,Pe(t,t))}),Be=(Te=re(),de=re(),function(t,e,r,n,i,a){return _e(Te,e,i,a),_e(de,r,n,a),_e(t,Te,de,2*a*(1-a)),t}),De=(me=I(),function(t,e,r,n){return me[0]=r[0],me[3]=r[1],me[6]=r[2],me[1]=n[0],me[4]=n[1],me[7]=n[2],me[2]=-e[0],me[5]=-e[1],me[8]=-e[2],Pe(t,ce(t,me))}),we=Object.freeze({__proto__:null,create:re,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},setAxisAngle:ne,getAxisAngle:function(t,e){var r=2*Math.acos(e[3]),n=Math.sin(r/2);return n>o?(t[0]=e[0]/n,t[1]=e[1]/n,t[2]=e[2]/n):(t[0]=1,t[1]=0,t[2]=0),r},getAngle:function(t,e){var r=Ne(t,e);return Math.acos(2*r*r-1)},multiply:ie,rotateX:ae,rotateY:se,rotateZ:oe,calculateW:function(t,e){var r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t},exp:ue,ln:he,pow:function(t,e,r){return he(t,e),ge(t,t,r),ue(t,t),t},slerp:_e,random:function(t){var e=h(),r=h(),n=h(),i=Math.sqrt(1-e),a=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*r),t[1]=i*Math.cos(2*Math.PI*r),t[2]=a*Math.sin(2*Math.PI*n),t[3]=a*Math.cos(2*Math.PI*n),t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],s=r*r+n*n+i*i+a*a,o=s?1/s:0;return t[0]=-r*o,t[1]=-n*o,t[2]=-i*o,t[3]=a*o,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},fromMat3:ce,fromEuler:function(t,e,r,n){var i=.5*Math.PI/180;e*=i,r*=i,n*=i;var a=Math.sin(e),s=Math.cos(e),o=Math.sin(r),u=Math.cos(r),h=Math.sin(n),_=Math.cos(n);return t[0]=a*u*_-s*o*h,t[1]=s*o*_+a*u*h,t[2]=s*u*h-a*o*_,t[3]=s*u*_+a*o*h,t},str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},clone:pe,fromValues:Me,copy:Re,set:Ae,add:ve,mul:Ie,scale:ge,dot:Ne,lerp:Se,length:be,len:Le,squaredLength:xe,sqrLen:Ce,normalize:Pe,exactEquals:Oe,equals:Ue,rotationTo:Fe,sqlerp:Be,setAxes:De});function ye(t,e,r){var n=.5*r[0],i=.5*r[1],a=.5*r[2],s=e[0],o=e[1],u=e[2],h=e[3];return t[0]=s,t[1]=o,t[2]=u,t[3]=h,t[4]=n*h+i*u-a*o,t[5]=i*h+a*s-n*u,t[6]=a*h+n*o-i*s,t[7]=-n*s-i*o-a*u,t}function Ge(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}var Ve=Re;var Xe=Re;function He(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=r[4],u=r[5],h=r[6],_=r[7],c=e[4],l=e[5],E=e[6],f=e[7],T=r[0],d=r[1],m=r[2],p=r[3];return t[0]=n*p+s*T+i*m-a*d,t[1]=i*p+s*d+a*T-n*m,t[2]=a*p+s*m+n*d-i*T,t[3]=s*p-n*T-i*d-a*m,t[4]=n*_+s*o+i*h-a*u+c*p+f*T+l*m-E*d,t[5]=i*_+s*u+a*o-n*h+l*p+f*d+E*T-c*m,t[6]=a*_+s*h+n*u-i*o+E*p+f*m+c*d-l*T,t[7]=s*_-n*o-i*u-a*h+f*p-c*T-l*d-E*m,t}var We=He;var qe=Ne;var Ye=be,je=Ye,ke=xe,ze=ke;var Ke=Object.freeze({__proto__:null,create:function(){var t=new u(8);return u!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},clone:function(t){var e=new u(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},fromValues:function(t,e,r,n,i,a,s,o){var h=new u(8);return h[0]=t,h[1]=e,h[2]=r,h[3]=n,h[4]=i,h[5]=a,h[6]=s,h[7]=o,h},fromRotationTranslationValues:function(t,e,r,n,i,a,s){var o=new u(8);o[0]=t,o[1]=e,o[2]=r,o[3]=n;var h=.5*i,_=.5*a,c=.5*s;return o[4]=h*n+_*r-c*e,o[5]=_*n+c*t-h*r,o[6]=c*n+h*e-_*t,o[7]=-h*t-_*e-c*r,o},fromRotationTranslation:ye,fromTranslation:function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},fromRotation:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fromMat4:function(t,e){var r=re();Y(r,e);var n=new u(3);return W(n,e),ye(t,r,n),t},copy:Ge,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},set:function(t,e,r,n,i,a,s,o,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=s,t[6]=o,t[7]=u,t},getReal:Ve,getDual:function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},setReal:Xe,setDual:function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},getTranslation:function(t,e){var r=e[4],n=e[5],i=e[6],a=e[7],s=-e[0],o=-e[1],u=-e[2],h=e[3];return t[0]=2*(r*h+a*s+n*u-i*o),t[1]=2*(n*h+a*o+i*s-r*u),t[2]=2*(i*h+a*u+r*o-n*s),t},translate:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=.5*r[0],u=.5*r[1],h=.5*r[2],_=e[4],c=e[5],l=e[6],E=e[7];return t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=s*o+i*h-a*u+_,t[5]=s*u+a*o-n*h+c,t[6]=s*h+n*u-i*o+l,t[7]=-n*o-i*u-a*h+E,t},rotateX:function(t,e,r){var n=-e[0],i=-e[1],a=-e[2],s=e[3],o=e[4],u=e[5],h=e[6],_=e[7],c=o*s+_*n+u*a-h*i,l=u*s+_*i+h*n-o*a,E=h*s+_*a+o*i-u*n,f=_*s-o*n-u*i-h*a;return ae(t,e,r),n=t[0],i=t[1],a=t[2],s=t[3],t[4]=c*s+f*n+l*a-E*i,t[5]=l*s+f*i+E*n-c*a,t[6]=E*s+f*a+c*i-l*n,t[7]=f*s-c*n-l*i-E*a,t},rotateY:function(t,e,r){var n=-e[0],i=-e[1],a=-e[2],s=e[3],o=e[4],u=e[5],h=e[6],_=e[7],c=o*s+_*n+u*a-h*i,l=u*s+_*i+h*n-o*a,E=h*s+_*a+o*i-u*n,f=_*s-o*n-u*i-h*a;return se(t,e,r),n=t[0],i=t[1],a=t[2],s=t[3],t[4]=c*s+f*n+l*a-E*i,t[5]=l*s+f*i+E*n-c*a,t[6]=E*s+f*a+c*i-l*n,t[7]=f*s-c*n-l*i-E*a,t},rotateZ:function(t,e,r){var n=-e[0],i=-e[1],a=-e[2],s=e[3],o=e[4],u=e[5],h=e[6],_=e[7],c=o*s+_*n+u*a-h*i,l=u*s+_*i+h*n-o*a,E=h*s+_*a+o*i-u*n,f=_*s-o*n-u*i-h*a;return oe(t,e,r),n=t[0],i=t[1],a=t[2],s=t[3],t[4]=c*s+f*n+l*a-E*i,t[5]=l*s+f*i+E*n-c*a,t[6]=E*s+f*a+c*i-l*n,t[7]=f*s-c*n-l*i-E*a,t},rotateByQuatAppend:function(t,e,r){var n=r[0],i=r[1],a=r[2],s=r[3],o=e[0],u=e[1],h=e[2],_=e[3];return t[0]=o*s+_*n+u*a-h*i,t[1]=u*s+_*i+h*n-o*a,t[2]=h*s+_*a+o*i-u*n,t[3]=_*s-o*n-u*i-h*a,o=e[4],u=e[5],h=e[6],_=e[7],t[4]=o*s+_*n+u*a-h*i,t[5]=u*s+_*i+h*n-o*a,t[6]=h*s+_*a+o*i-u*n,t[7]=_*s-o*n-u*i-h*a,t},rotateByQuatPrepend:function(t,e,r){var n=e[0],i=e[1],a=e[2],s=e[3],o=r[0],u=r[1],h=r[2],_=r[3];return t[0]=n*_+s*o+i*h-a*u,t[1]=i*_+s*u+a*o-n*h,t[2]=a*_+s*h+n*u-i*o,t[3]=s*_-n*o-i*u-a*h,o=r[4],u=r[5],h=r[6],_=r[7],t[4]=n*_+s*o+i*h-a*u,t[5]=i*_+s*u+a*o-n*h,t[6]=a*_+s*h+n*u-i*o,t[7]=s*_-n*o-i*u-a*h,t},rotateAroundAxis:function(t,e,r,n){if(Math.abs(n)<o)return Ge(t,e);var i=Math.hypot(r[0],r[1],r[2]);n*=.5;var a=Math.sin(n),s=a*r[0]/i,u=a*r[1]/i,h=a*r[2]/i,_=Math.cos(n),c=e[0],l=e[1],E=e[2],f=e[3];t[0]=c*_+f*s+l*h-E*u,t[1]=l*_+f*u+E*s-c*h,t[2]=E*_+f*h+c*u-l*s,t[3]=f*_-c*s-l*u-E*h;var T=e[4],d=e[5],m=e[6],p=e[7];return t[4]=T*_+p*s+d*h-m*u,t[5]=d*_+p*u+m*s-T*h,t[6]=m*_+p*h+T*u-d*s,t[7]=p*_-T*s-d*u-m*h,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},multiply:He,mul:We,scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},dot:qe,lerp:function(t,e,r,n){var i=1-n;return qe(e,r)<0&&(n=-n),t[0]=e[0]*i+r[0]*n,t[1]=e[1]*i+r[1]*n,t[2]=e[2]*i+r[2]*n,t[3]=e[3]*i+r[3]*n,t[4]=e[4]*i+r[4]*n,t[5]=e[5]*i+r[5]*n,t[6]=e[6]*i+r[6]*n,t[7]=e[7]*i+r[7]*n,t},invert:function(t,e){var r=ke(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},length:Ye,len:je,squaredLength:ke,sqrLen:ze,normalize:function(t,e){var r=ke(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,i=e[1]/r,a=e[2]/r,s=e[3]/r,o=e[4],u=e[5],h=e[6],_=e[7],c=n*o+i*u+a*h+s*_;t[0]=n,t[1]=i,t[2]=a,t[3]=s,t[4]=(o-n*c)/r,t[5]=(u-i*c)/r,t[6]=(h-a*c)/r,t[7]=(_-s*c)/r}return t},str:function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},equals:function(t,e){var r=t[0],n=t[1],i=t[2],a=t[3],s=t[4],u=t[5],h=t[6],_=t[7],c=e[0],l=e[1],E=e[2],f=e[3],T=e[4],d=e[5],m=e[6],p=e[7];return Math.abs(r-c)<=o*Math.max(1,Math.abs(r),Math.abs(c))&&Math.abs(n-l)<=o*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-E)<=o*Math.max(1,Math.abs(i),Math.abs(E))&&Math.abs(a-f)<=o*Math.max(1,Math.abs(a),Math.abs(f))&&Math.abs(s-T)<=o*Math.max(1,Math.abs(s),Math.abs(T))&&Math.abs(u-d)<=o*Math.max(1,Math.abs(u),Math.abs(d))&&Math.abs(h-m)<=o*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(_-p)<=o*Math.max(1,Math.abs(_),Math.abs(p))}});function Ze(){var t=new u(2);return u!=Float32Array&&(t[0]=0,t[1]=0),t}function Qe(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function $e(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function Je(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function tr(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function er(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function rr(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function nr(t){var e=t[0],r=t[1];return e*e+r*r}var ir=rr,ar=Qe,sr=$e,or=Je,ur=tr,hr=er,_r=nr,cr=function(){var t=Ze();return function(e,r,n,i,a,s){var o,u;for(r||(r=2),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,o=n;o<u;o+=r)t[0]=e[o],t[1]=e[o+1],a(t,t,s),e[o]=t[0],e[o+1]=t[1];return e}}(),lr=Object.freeze({__proto__:null,create:Ze,clone:function(t){var e=new u(2);return e[0]=t[0],e[1]=t[1],e},fromValues:function(t,e){var r=new u(2);return r[0]=t,r[1]=e,r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,r){return t[0]=e,t[1]=r,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},subtract:Qe,multiply:$e,divide:Je,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},scaleAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},distance:tr,squaredDistance:er,length:rr,squaredLength:nr,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},normalize:function(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},cross:function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},lerp:function(t,e,r,n){var i=e[0],a=e[1];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t},random:function(t,e){e=e||1;var r=2*h()*Math.PI;return t[0]=Math.cos(r)*e,t[1]=Math.sin(r)*e,t},transformMat2:function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t},transformMat2d:function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t},transformMat3:function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t},transformMat4:function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t},rotate:function(t,e,r,n){var i=e[0]-r[0],a=e[1]-r[1],s=Math.sin(n),o=Math.cos(n);return t[0]=i*o-a*s+r[0],t[1]=i*s+a*o+r[1],t},angle:function(t,e){var r=t[0],n=t[1],i=e[0],a=e[1],s=r*r+n*n;s>0&&(s=1/Math.sqrt(s));var o=i*i+a*a;o>0&&(o=1/Math.sqrt(o));var u=(r*i+n*a)*s*o;return u>1?0:u<-1?Math.PI:Math.acos(u)},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},equals:function(t,e){var r=t[0],n=t[1],i=e[0],a=e[1];return Math.abs(r-i)<=o*Math.max(1,Math.abs(r),Math.abs(i))&&Math.abs(n-a)<=o*Math.max(1,Math.abs(n),Math.abs(a))},len:ir,sub:ar,mul:sr,div:or,dist:ur,sqrDist:hr,sqrLen:_r,forEach:cr}),Er=Object.freeze({__proto__:null,glMatrix:l,mat2:m,mat2d:v,mat3:P,mat4:J,quat:we,quat2:Ke,vec2:lr,vec3:bt,vec4:ee});const fr=()=>{const t=document.createElement("canvas");return!!(t.getContext("experimental-webgl2")||t.getContext("webgl2"))};function Tr(t,e){const r=t.getExtension(e);if(!r)return!1;const n=e.split("_")[0],i=new RegExp(n+"$");for(const e in r){if("function"==typeof r[e]){const n=e.replace(i,"");e.substring&&(t[n]=r[e].bind(r))}}return!0}const dr=["EXT_shader_texture_lod","EXT_sRGB","EXT_frag_depth","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_color_buffer_half_float","OES_vertex_array_object","WEBGL_depth_texture","ANGLE_instanced_arrays","WEBGL_color_buffer_float","WEBGL_draw_buffers","EXT_color_buffer_float"],mr=(()=>{let t=!1;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(t=!0),t})(),pr=(t,e)=>{if("number"==typeof t)return c(t,e);if(t.length!==e.length)return!1;let r=!0;return t.forEach(((t,n)=>{r=c(t,e[n])&&r})),r},Mr=t=>{let e,r;return t.touches?(e=t.touches[0].pageX,r=t.touches[0].pageY):(e=t.clientX,r=t.clientY),{x:e,y:r}},Rr={ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALPHA:6406,ALPHA_BITS:3413,ALWAYS:519,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATTACHED_SHADERS:35717,BACK:1029,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BROWSER_DEFAULT_WEBGL:37444,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,COMPILE_STATUS:35713,COMPRESSED_TEXTURE_FORMATS:34467,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_LOST_WEBGL:37442,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH_ATTACHMENT:36096,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,RED:6403,DEPTH_COMPONENT16:33189,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DONT_CARE:4352,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,FASTEST:4353,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GREATER:516,GREEN_BITS:3411,HALF_FLOAT:36193,HIGH_FLOAT:36338,HIGH_INT:36341,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE_ALPHA:6410,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_RENDERBUFFER_SIZE:34024,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIRRORED_REPEAT:33648,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NUM_COMPRESSED_TEXTURE_FORMATS:34466,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,RED_BITS:3410,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,REPEAT:10497,REPLACE:7681,RGB:6407,RGB5_A1:32855,RGB565:36194,RGBA:6408,RGBA4:32854,SAMPLER_2D:35678,SAMPLER_CUBE:35680,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SHADER_COMPILER:36346,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_CLEAR_VALUE:2961,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,TEXTURE_2D:3553,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,UNPACK_ALIGNMENT:3317,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VIEWPORT:2978,ZERO:0,R8:33321},Ar={0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6403:"RED",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33321:"R8",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36193:"HALF_FLOAT",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"};var vr={alpha:!1,depth:!0,premultipliedAlpha:!1};let Ir=0;function gr(){let t,e,r=[0,0,0,0],n=0,i=0,a=0,o=fr(),u=mr;const h=O(),_=O(),c=O(),l=I(),E=O(),f=I();this.id="WebGLContext"+Ir++,this.canvas,this.gl,this.CONTEXT_LOST="contextLost",this.CONTEXT_RESTORED="contextRestored",this.shaderCount=0,this.bufferCount=0,this.textureCount=0,this.frameBufferCount=0,this.maxAnisotropy=0,this.multiRenderTargetSupport=!1,this.maxMultiRenderTargets=0,this.init=function(t,e={}){const r=s({},vr,e);if(void 0!==t){if(t instanceof HTMLCanvasElement){this.canvas=t;let n=o?"webgl2":"webgl";e.webgl1&&(n="webgl",o=!1),this.gl=t.getContext(n,r)}else window.WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?(o=!0,this.gl=t,this.canvas=t.canvas):t instanceof WebGLRenderingContext?(o=!1,this.gl=t,this.canvas=t.canvas):console.error("The source has to be one of the following : Canvas, WebGLRenderingContext or WebGL2RenderingContext");this.canvas.addEventListener("webglcontextlost",d),this.canvas.addEventListener("webglcontextrestored",m),this.extensions=(t=>{const{gl:e}=t,r=window.WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,n={};dr.forEach((t=>{n[t]=e.getExtension(t)})),r||(n.OES_vertex_array_object||console.error("OES_vertex_array_object extension is not supported"),Tr(e,"OES_vertex_array_object"),Tr(e,"ANGLE_instanced_arrays"),Tr(e,"WEBGL_draw_buffers"));const i=n.EXT_texture_filter_anisotropic;if(i&&(t.maxAnisotropy=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),t.multiRenderTargetSupport=!!t.gl.drawBuffers,t.multiRenderTargetSupport){const r=t.gl.MAX_DRAW_BUFFERS||n.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL;t.maxMultiRenderTargets=e.getParameter(r)}return n})(this),(t=>{for(const e in Rr)t[e]?console.log("already exist : ",e):t[e]=Rr[e];if(t.webgl2){const e=/^[^a-z]*$/;for(const r in t.gl)e.test(r)&&-1===r.indexOf("FLOAT")&&(t[r]=t.gl[r],Rr[r]=t.gl[r],Ar[t[r]]=r)}})(this),this.setSize(this.canvas.width,this.canvas.height),this.enable(this.BLEND),this.enableAlphaBlending(),this.enable(this.DEPTH_TEST),this.enable(this.CULL_FACE),this.cullFace(Nr.BACK)}else{const t=document.createElement("canvas");this.init(t,r)}},this.clear=function(t=0,e=0,r=0,n=0){const{gl:i}=this;i.clearColor(t,e,r,n),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},this.setSize=function(t,e){i=Math.floor(t),a=Math.floor(e),this.canvas.width=i,this.canvas.height=a,n=i/a,this.viewport(0,0,i,a)},this.viewport=function(t,e,n,i){pr(r,[t,e,n,i])||(r=[t,e,n,i],this.gl.viewport(t,e,n,i))},this.getViewport=function(){return r},this.getAspectRatio=function(){return n},this.enable=function(t){this.gl.enable(t)},this.disable=function(t){this.gl.disable(t)},this.cullFace=function(t){this.gl.cullFace(t)},this.enableAlphaBlending=function(){const{gl:t}=this;t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA)},this.enableAdditiveBlending=function(){const{gl:t}=this;t.blendFunc(t.ONE,t.ONE)},this.setMatrices=function(t){e=t,this.setModelMatrix(_)},this.setModelMatrix=function(t){U(c,t),void 0!==e&&(D(h,e.viewMatrix,c),g(l,h),S(l,l),N(l,l),g(f,h),S(f,f),B(E,e.viewMatrix))},this.useShader=function(e){t=e,this.shaderProgram=e.shaderProgram,this.gl.useProgram(this.shaderProgram)},this.draw=function(e){if(e.length)return void e.forEach((t=>this.draw(t)));T(),t.updateUniforms(),e.bind(this);const{drawType:r}=e,{gl:n}=this;e.isInstanced?n.drawElementsInstanced(e.drawType,e.numItems,n.UNSIGNED_SHORT,0,e.numInstance):r===n.POINTS?n.drawArrays(r,0,e.vertexSize):n.drawElements(r,e.numItems,n.UNSIGNED_INT,0),e.unbind()},this.getCamera=function(){return e},this.destroy=function(t=!0){this.gl.getExtension("WEBGL_lose_context").loseContext(),t&&void 0!==this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)},this.__defineGetter__("width",(function(){return i})),this.__defineGetter__("height",(function(){return a})),this.__defineGetter__("webgl2",(function(){return o})),this.__defineGetter__("isMobile",(function(){return u})),this.__defineGetter__("aspectRatio",(function(){return n}));const T=()=>{void 0!==e&&(t.uniform("uProjectionMatrix","mat4",e.projectionMatrix),t.uniform("uViewMatrix","mat4",e.viewMatrix),t.uniform("uNormalMatrix","mat3",l),t.uniform("uModelViewMatrixInverse","mat3",f)),t.uniform("uModelMatrix","mat4",c)},d=()=>{this.emit(this.CONTEXT_LOST)},m=()=>{this.emit(this.CONTEXT_RESTORED)}}gr.prototype=Object.assign(Object.create(e.prototype),{constructor:gr});const Nr=new gr,Sr={float:"uniform1f",vec2:"uniform2fv",vec3:"uniform3fv",vec4:"uniform4fv",int:"uniform1i",ivec2:"uniform2i",ivec3:"uniform3i",ivec4:"uniform4i",mat2:"uniformMatrix2fv",mat3:"uniformMatrix3fv",mat4:"uniformMatrix4fv"},br=t=>"number"==typeof t?t:t.slice?t.slice(0):new Float32Array(t),Lr=t=>"object"==typeof t?function(t){return 9===t.length?"mat3":16===t.length?"mat4":"vec"+t.length}(t):"float";var xr="precision highp float;attribute vec3 aVertexPosition;attribute vec2 aTextureCoord;attribute vec3 aNormal;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;varying vec2 vTextureCoord;varying vec3 vNormal;void main(void){gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(aVertexPosition,1.0);vTextureCoord=aTextureCoord;vNormal=aNormal;}";function Cr(t,e){let r;this.vertexShader=t||xr,this.fragmentShader=e||"precision highp float;void main(void){gl_FragColor=vec4(1.0);}",this.shaderProgram;let n={};this.bind=function(t){if(void 0===t||void 0===r||t===r){if(r=t||Nr,!this.shaderProgram){const t=i(this.vertexShader,!0),e=i(this.fragmentShader,!1);a(t,e)}r.useShader(this)}else console.error("this shader has been bind to a different WebGL Rendering Context",r.id)},this.uniform=function(t,e,r){let i,a;void 0===r?(a=Lr(e),i=e):(a=e,i=r);const s=Sr[a];if(n[t]){const e=n[t];pr(e.value,i)||(e.value=br(i),e.changed=!0)}else n[t]={type:a,uniformType:s,value:br(i),changed:!0};return this},this.updateUniforms=function(){if(!r)return void console.warn("No WebGL Context has been set yet, please call shader.bind() first");const{gl:t}=r;for(let e in n){const r=n[e];if(r.changed){const n=e;r.uniformLoc||(r.uniformLoc=t.getUniformLocation(this.shaderProgram,n));const{uniformLoc:i,uniformType:a,value:s}=r;null!==i&&(-1===a.indexOf("Matrix")?t[a](i,s):t[a](i,!1,s)),r.changed=!1}}},this.destroy=function(){const{gl:t}=r;t.deleteProgram(this.shaderProgram),r.shaderCount--};const i=(t,e)=>{const{gl:n}=r,i=e?r.VERTEX_SHADER:r.FRAGMENT_SHADER,a=n.createShader(i);return n.shaderSource(a,t),n.compileShader(a),n.getShaderParameter(a,n.COMPILE_STATUS)?a:(console.warn("Error in Shader : ",n.getShaderInfoLog(a)),console.log((t=>{const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=`${t+1}: ${e[t]}`;return e.join("\n")})(t)),null)},a=(t,e)=>{const{gl:n}=r;this.shaderProgram=n.createProgram(),n.attachShader(this.shaderProgram,t),n.attachShader(this.shaderProgram,e),n.deleteShader(t),n.deleteShader(e),n.linkProgram(this.shaderProgram),r.shaderCount++}}function Pr(t=Rr.TRIANGLES){this.drawType=t,this.numItems=0;let e,r,n,i,a,s=[],o=[],u=[],h=!0,_=!1,c=0;this.bufferData=function(t,e,r,n=Rr.STATIC_DRAW,i=!1){let a,s=[];if("number"==typeof t[0]){if(a=t,void 0===r)return console.error("Missing element size for flatten data :",e),this;for(let t=0;t<a.length;t+=r){const e=[];for(let n=0;n<r;n++)e.push(a[t+n]);s.push(e)}}else s=t,a=(t=>{if(t[0]instanceof Float32Array)return t.reduce(((t,e)=>{for(let r=0;r<e.length;r++)t.push(e[r]);return t}),[]);return t.flat()})(t);const o=void 0===r?t[0].length:r;return l(a,t,e,o,n,i)},this.bufferInstance=function(t,e){const r=t[0].length;return c=t.length,this.bufferData(t,e,r,Rr.STATIC_DRAW,!0)},this.bufferVertex=function(t,e=Rr.STATIC_DRAW){return this.bufferData(t,"aVertexPosition",3,e)},this.bufferTexCoord=function(t,e=Rr.STATIC_DRAW){return this.bufferData(t,"aTextureCoord",2,e)},this.bufferNormal=function(t,e=Rr.STATIC_DRAW){return this.bufferData(t,"aNormal",3,e)},this.bufferIndex=function(t,e=Rr.STATIC_DRAW){return r=e,n=new Uint32Array(t),this.numItems=n.length,h=!0,this},this.bind=function(t){if(void 0!==t&&void 0!==a&&t!==a)return void console.error("this mesh has been bind to a different WebGL Rendering Context");a=t||GL;const{gl:r}=a;E(),r.bindVertexArray(e),this.vertexSize=this.getSource("aVertexPosition").length},this.unbind=function(){},this.getAttribute=function(t){return s.find((e=>e.name===t))},this.getAttributes=function(){return s},this.getSource=function(t){const e=this.getAttribute(t);return e?e.source:[]},this.generateFaces=function(){let t,e,r,i,a,s;u=[];const{vertices:o}=this;for(let h=0;h<n.length;h+=3){t=n[h],e=n[h+1],r=n[h+2],i=o[t],a=o[e],s=o[r];const _={indices:[t,e,r],vertices:[i,a,s]};u.push(_)}},this.destroy=function(){const{gl:t}=a;s.forEach((e=>{t.deleteBuffer(e.buffer),e.source=[],e.dataArray=[],a.bufferCount--})),i&&(t.deleteBuffer(i),a.bufferCount--),t.deleteVertexArray(e),s=[],n=[],o=[]},this.__defineGetter__("vertices",(function(){return this.getSource("aVertexPosition")})),this.__defineGetter__("coords",(function(){return this.getSource("aTextureCoord")})),this.__defineGetter__("normal",(function(){return this.getSource("aNormal")})),this.__defineGetter__("indices",(function(){return n})),this.__defineGetter__("faces",(function(){return u})),this.__defineGetter__("isInstanced",(function(){return _})),this.__defineGetter__("numInstance",(function(){return c}));const l=(t,e,r,n,i=Rr.STATIC_DRAW,a=!1)=>{const u=i;_=a||_;const h=new Float32Array(t),c=this.getAttribute(r);return c?(c.itemSize=n,c.dataArray=h,c.source=e):s.push({name:r,source:e,itemSize:n,usage:u,dataArray:h,isInstanced:a}),o.push(r),this},E=()=>{const{shaderProgram:t,gl:r}=a;0!=o.length&&(e||(e=r.createVertexArray()),r.bindVertexArray(e),s.forEach((e=>{if(-1!==o.indexOf(e.name)){const n=function(t,e){let r;const{gl:n}=e;return void 0!==t.buffer?r=t.buffer:(r=n.createBuffer(),t.buffer=r,e.bufferCount++),r}(e,a);r.bindBuffer(r.ARRAY_BUFFER,n),r.bufferData(r.ARRAY_BUFFER,e.dataArray,e.usage);const i=((t,e,r)=>(void 0===e.cacheAttribLoc&&(e.cacheAttribLoc={}),void 0===e.cacheAttribLoc[r]&&(e.cacheAttribLoc[r]=t.getAttribLocation(e,r)),e.cacheAttribLoc[r]))(r,t,e.name);i>=0&&(r.enableVertexAttribArray(i),r.vertexAttribPointer(i,e.itemSize,r.FLOAT,!1,0,0)),e.attrPosition=i,e.isInstanced&&r.vertexAttribDivisor(i,1)}})),f(),r.bindVertexArray(null),h=!1,o=[])},f=()=>{const{gl:t}=a;h&&(i||(i=t.createBuffer(),a.bufferCount++),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,n,r))}}const Or=t=>0!==t&&!(t&t-1),Ur=function(t,e,r){if(!t.minFilter){let n=Rr.LINEAR;e&&e&&Or(e)&&Or(r)&&(n=Rr.NEAREST_MIPMAP_LINEAR),t.minFilter=n}return t.mipmap=void 0===t.mipmap||t.mipmap,t.magFilter=t.magFilter||Rr.LINEAR,t.wrapS=t.wrapS||Rr.CLAMP_TO_EDGE,t.wrapT=t.wrapT||Rr.CLAMP_TO_EDGE,t.internalFormat=t.internalFormat||Rr.RGBA,t.format=t.format||Rr.RGBA,t.premultiplyAlpha=void 0!==t.premultiplyAlpha&&t.premultiplyAlpha,t.level=t.level||0,t.type=t.type||Rr.UNSIGNED_BYTE,t},Fr=t=>t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement,Br=(t,e)=>{t.webgl2&&(e.type===Rr.HALF_FLOAT?(e.type=t.gl.HALF_FLOAT,e.internalFormat=Rr.RGBA16F):e.type===Rr.FLOAT&&(e.internalFormat=Rr.RGBA32F))};class Dr{constructor(t){this._value=t}set(t,e=1){this._value=this._value,this._value=0===e?this._value&0<<t:this._value|1<<t}get(t){let e=this._value&1<<t;return e>>=t,1===e}reset(t){this._value=t}get value(){return this._value}}const wr={DRAW_BUFFERS:"This browser doesn't support multi render targets : WEBGL_draw_buffers",FRAMEBUFFER_CONTEXT:"This framebuffer has been bind to a different WebGL Rendering Context",SHADER_CONTEXT:"This shader has been bind to a different WebGL Rendering Context",TEXTURE_CONTEXT:"This texture has been bind to a different WebGL Rendering Context",CUBE_TEXTURE_CONTEXT:"This cube texture has been bind to a different WebGL Rendering Context"},yr=(t,e="")=>{console.error(t,e)};class Gr{constructor(t,e={},r=0,n=0){this._source=t,this._isHtmlElement=Fr(this._source),(this._isHtmlElement||!t||((t,e)=>{let r=!0;return"Array"===t.constructor.name&&(console.error("Please convert texture source to Unit8Array or Float32Array"),r=!1),void 0===e.type&&"Uint8Array"!==t.constructor.name&&console.error("Using none Unit8Array, pleaes specify type in the texture parameters"),r})(t,e))&&(this._getDimension(t,r,n),this._params=Ur(e,this._width,this._height),this._checkMipmap(),this._parametersState=new Dr(0))}bind(t,e){if(void 0!==e&&void 0!==this.GL&&e!==this.GL)return void yr(wr.TEXTURE_CONTEXT,this.GL.id);this.GL=e||Nr;const{gl:r}=this.GL;this.createTexture(this.GL),r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_2D,this._texture),this._checkParameters()}createTexture(t){void 0===t||void 0===this.GL||t===this.GL?(this.GL=t||Nr,this._texture||(Br(this.GL,this._params),this._uploadTexture())):yr(wr.TEXTURE_CONTEXT,this.GL.id)}updateTexture(t){this._source=t,this._uploadTexture()}generateMipmap(){if(!this._generateMipmap)return;const{gl:t}=this.GL;t.bindTexture(t.TEXTURE_2D,this._texture),t.generateMipmap(t.TEXTURE_2D)}destroy(){const{gl:t}=this.GL;t.deleteTexture(this._texture),this.GL.textureCount--}showProperties(){console.log("Dimension :",this._width,this._height);for(const t in this._params)console.log(t,Ar[this._params[t]]||this._params[t])}_uploadTexture(){const{gl:t}=this.GL;this._texture||(this._texture=t.createTexture(),this.GL.textureCount++),t.bindTexture(t.TEXTURE_2D,this._texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),this._isHtmlElement&&!this.GL.webgl2?t.texImage2D(t.TEXTURE_2D,0,this._params.internalFormat,this._params.format,this._params.type,this._source):t.texImage2D(t.TEXTURE_2D,0,this._params.internalFormat,this._width,this._height,0,this._params.format,this._params.type,this._source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this._params.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._params.minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._params.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._params.wrapT),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha),this._generateMipmap&&t.generateMipmap(t.TEXTURE_2D)}_checkParameters(){const{gl:t}=this.GL;this._parametersState.value>0&&(this._parametersState.get(0)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._params.minFilter):this._parametersState.get(1)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this._params.magFilter):this._parametersState.get(2)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._params.wrapS):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._params.wrapT)),this._parametersState.reset(0)}_getDimension(t,e,r){t?(this._width=t.width||t.videoWidth,this._height=t.height||t.videoWidth,this._width=this._width||e,this._height=this._height||r,this._width&&this._height||(this._width=this._height=Math.sqrt(t.length/4))):(this._width=e,this._height=r)}_checkMipmap(){this._generateMipmap=this._params.mipmap,Or(this._width)&&Or(this._height)||(this._generateMipmap=!1);-1===Ar[this._params.minFilter].indexOf("MIPMAP")&&(this._generateMipmap=!1)}get texture(){return this._texture}set minFilter(t){this._params.minFilter=t,this._parametersState.set(0,1)}get minFilter(){return this._params.minFilter}set magFilter(t){this._params.magFilter=t,this._parametersState.set(1,1)}get magFilter(){return this._params.magFilter}set wrapS(t){this._params.wrapS=t,this._parametersState.set(2,1)}get wrapS(){return this._params.wrapS}set wrapT(t){this._params.wrapT=t,this._parametersState.set(3,1)}get wrapT(){return this._params.wrapT}get width(){return this._width}get height(){return this._height}}const Vr=t=>{const e=t.map((t=>Math.floor(255*t))),r=document.createElement("canvas");r.width=r.height=4;const n=r.getContext("2d");return n.fillStyle=`rgba(${e[0]}, ${e[1]}, ${e[2]}, 1)`,n.fillRect(0,0,r.width,r.height),new Gr(r)};function Xr(t,e,r={},n=1){let i,a;const s=t,o=e,u=r,h=n,_=[];let c;this.bind=function(t,e=!0){if(void 0!==t&&void 0!==i&&t!==i)return void yr(wr.FRAMEBUFFER_CONTEXT,i.id);i=t||Nr;const{gl:r}=i;h>1&&!i.multiRenderTargetSupport&&yr(wr.DRAW_BUFFERS,i.id),a||l(),e&&i.viewport(0,0,s,o),r.bindFramebuffer(r.FRAMEBUFFER,a)},this.unbind=function(t=!0){t&&i.viewport(0,0,i.width,i.height);const{gl:e}=i;e.bindFramebuffer(e.FRAMEBUFFER,null),_.forEach((t=>{t.generateMipmap()}))},this.getTexture=function(t=0){return _[t]},this.destroy=function(){const{gl:t}=i;_.forEach((t=>t.destroy())),c.destroy(),t.deleteFramebuffer(a),i.frameBufferCount--};const l=()=>{E();const{gl:t}=i;a=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,a),i.frameBufferCount++;const e=i.webgl2?t.DRAW_FRAMEBUFFER:t.FRAMEBUFFER,r=[];for(let n=0;n<h;n++)t.framebufferTexture2D(e,t.COLOR_ATTACHMENT0+n,t.TEXTURE_2D,_[n].texture,0),r.push(Rr["COLOR_ATTACHMENT"+n]);i.multiRenderTargetSupport&&t.drawBuffers(r),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,c.texture,0),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},E=()=>{for(let t=0;t<h;t++)_.push(f());const{gl:t}=i,e=i.webgl2?t.DEPTH_COMPONENT16:t.DEPTH_COMPONENT;c=f(e,Rr.UNSIGNED_INT,Rr.DEPTH_COMPONENT,{minFilter:Rr.NEAREST,magFilter:Rr.NEAREST,mipmap:!1})},f=(t,e,r,n={})=>{const a=Object.assign({},u);r||(r=t),a.internalFormat=t||Rr.RGBA,a.format=r||Rr.RGBA,a.type=e||a.type,Object.assign(a,n);const h=new Gr(null,a,s,o);return h.createTexture(i),h};this.__defineGetter__("texture",(function(){return _[0]})),this.__defineGetter__("depthTexture",(function(){return c})),this.__defineGetter__("width",(function(){return s})),this.__defineGetter__("height",(function(){return o}))}class Hr{constructor(){this._mtxView=O(),this._mtxProj=O(),this._near=0,this._far=0,this._lookDir=tt()}lookAt(t,e,r=[0,1,0]){K(this._mtxView,t,e,r)}setFromViewProjection(t,e){U(this._mtxView,t),U(this._mtxProj,e)}setViewMatrix(t){U(this._mtxView,t)}setProjectionMatrix(t){U(this._mtxProj,t)}_updateMatrices(){}get viewMatrix(){return this._mtxView}get view(){return this._mtxView}get projectionMatrix(){return this._mtxProj}get projection(){return this._mtxProj}get position(){const t=O();return B(t,this._mtxView),[t[12],t[13],t[14]]}get direction(){const t=I();return g(t,this._mtxView),N(t,t),mt(this._lookDir,[0,0,-1],t),Et(this._lookDir,this._lookDir),this._lookDir}set near(t){this._near=t,this._updateMatrices()}get near(){return this._near}set far(t){this._far=t,this._updateMatrices()}get far(){return this._far}}function Wr(t,e){this.origin=t,this.direction=e;const r=tt(),n=tt(),i=tt(),a=tt(),s=tt(),o=tt(),u=tt(),h=tt();this.at=function(t){return it(a,this.direction),ht(a,a,t),at(a,a,this.origin),a},this.lookAt=function(t){Mt(this.direction,t,this.origin),Et(this.origin,this.origin)},this.closestPointToPoint=function(t){const e=tt();Mt(t,this.origin);const r=ft(e,this.direction);return r<0?et(this.origin):(it(e,this.direction),ht(e,e,r),at(e,e,this.origin),e)},this.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},this.distanceSqToPoint=function(t){const e=tt();Mt(e,t,this.origin);const r=ft(e,this.direction);return r<0?ct(this.origin,t):(it(e,this.direction),ht(e,e,r),at(e,e,this.origin),ct(e,t))},this.intersectsSphere=function(t,e){return this.distanceToPoint(t)<=e},this.intersectSphere=function(t,e){const r=tt();Mt(r,t,this.origin);const n=ft(r,this.direction),i=ft(r,r)-n*n,a=e*e;if(i>a)return null;const s=Math.sqrt(a-i),o=n-s,u=n+s;return o<0&&u<0?null:o<0?this.at(u):this.at(o)},this.intersectTriangle=function(t,e,a,_=!0){it(r,t),it(n,e),it(i,a),Mt(s,n,r),Mt(o,i,r),Tt(u,s,o);let c,l=ft(this.direction,u);if(l>0){if(_)return null;c=1}else{if(!(l<0))return null;c=-1,l=-l}Mt(h,this.origin,r),Tt(o,h,o);const E=c*ft(this.direction,o);if(E<0)return null;Tt(s,s,h);const f=c*ft(this.direction,s);if(f<0)return null;if(E+f>l)return null;const T=-c*ft(h,u);return T<0?null:this.at(T/l)}}class qr extends Hr{constructor(t,e,r,n){super(),this._fov=0,this._ratio=0,this.setPerspective(t,e,r,n)}setPerspective(t,e,r,n){k(this._mtxProj,t,e,r,n),this._near=r,this._far=n,this._fov=t,this._ratio=e}setAspectRatio(t){this._ratio=t,this._updateMatrices()}generateRay(t,e){const r=O(),n=tt();return D(r,this._mtxProj,this._mtxView),B(r,r),dt(n,t,r),Mt(n,n,this.position),Et(n,n),e?(e.origin=this.position,e.direction=n):e=new Wr(this.position,n),e}_updateMatrices(){this.setPerspective(this._fov,this._ratio,this._near,this._far)}}class Yr{constructor(t){return this._GL=t||Nr,this._uniforms={},this._uniformTextures=[],this._fbo,this._clearColor={r:0,g:0,b:0,a:0},this}setClearColor(t=0,e=0,r=0,n=0){return this._clearColor.r=t,this._clearColor.g=e,this._clearColor.b=r,this._clearColor.a=n,this}useProgram(t,e){return this._shader=t instanceof Cr?t:new Cr(t,e),this}setMesh(t){return this._mesh=t,this}createMesh(t){return this._mesh=new Pr(t),this}bufferVertex(t){return this._mesh||(this._mesh=new Pr),this._mesh.bufferVertex(t),this}bufferTexCoord(t){return this._mesh||(this._mesh=new Pr),this._mesh.bufferTexCoord(t),this}bufferNormal(t){return this._mesh||(this._mesh=new Pr),this._mesh.bufferNormal(t),this}bufferIndex(t){return this._mesh||(this._mesh=new Pr),this._mesh.bufferIndex(t),this}bufferInstance(t,e){return this._mesh?(this._mesh.bufferInstance(t,e),this):(console.warn("Need to create mesh first"),this)}bufferData(t,e){return this._mesh||(this._mesh=new Pr),this._mesh.bufferData(t,e),this}uniform(t,e,r){const n=t;let i,a;return void 0===r?(a=Lr(e),i=e):(a=e,i=r),this._uniforms[n]={type:a,value:i},this}uniformTexture(t,e,r){return this.bindTexture(t,e,r)}bindTexture(t,e,r){return void 0!==r?this._uniformTextures[r]={name:t,texture:e}:this._uniformTextures.push({name:t,texture:e}),this}bindFrameBuffer(t){return this._fbo=t,this}draw(){if(this._shader){if(this._mesh){if(this._fbo){const{r:t,g:e,b:r,a:n}=this._clearColor;this._fbo.bind(this._GL),this._GL.clear(t,e,r,n)}this._shader.bind(this._GL);for(const t in this._uniforms){const e=this._uniforms[t];this._shader.uniform(t,e.type,e.value)}return this._uniformTextures.forEach(((t,e)=>{void 0!==t&&(this._shader.uniform(t.name,"int",e),t.texture.bind(e,this._GL))})),this._GL.draw(this._mesh),this._fbo&&this._fbo.unbind(),this}console.warn("No Mesh assigned for draw call")}else console.warn("No GLShader assigned for draw call")}get shader(){return this._shader}get framebuffer(){return this._fbo}}var jr="precision highp float;uniform vec3 uColor;uniform float uOpacity;void main(void){gl_FragColor=vec4(uColor,uOpacity);}";class kr extends Yr{constructor(t){super(t);const e=this._GL;this.createMesh(e.LINES).bufferVertex([[0,0,0],[1,0,0]]).bufferIndex([0,1]).useProgram("precision highp float;attribute vec3 aVertexPosition;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;uniform vec3 uPosA;uniform vec3 uPosB;void main(void){vec3 pos=mix(uPosA,uPosB,aVertexPosition.x);gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(pos,1.0);}",jr),this.color=[1,1,1],this.opacity=.75}draw(t,e,r,n){this.uniform("uPosA",t).uniform("uPosB",e).uniform("uOpacity",n||this.opacity).uniform("uColor",r||this.color),super.draw()}}const zr={plane:(t,e,r,n="xy")=>{const i=[],a=[],s=[],o=[],u=t/r,h=e/r,_=1/r,c=.5*-t,l=.5*-e;let E=0;for(let t=0;t<r;t++)for(let e=0;e<r;e++){const f=u*t+c,T=h*e+l,d=t/r,m=e/r;"xz"===n?(i.push([f,0,T+h]),i.push([f+u,0,T+h]),i.push([f+u,0,T]),i.push([f,0,T]),a.push([d,1-(m+_)]),a.push([d+_,1-(m+_)]),a.push([d+_,1-m]),a.push([d,1-m]),o.push([0,1,0]),o.push([0,1,0]),o.push([0,1,0]),o.push([0,1,0])):"yz"===n?(i.push([0,T,f]),i.push([0,T,f+u]),i.push([0,T+h,f+u]),i.push([0,T+h,f]),a.push([d,m]),a.push([d+_,m]),a.push([d+_,m+_]),a.push([d,m+_]),o.push([1,0,0]),o.push([1,0,0]),o.push([1,0,0]),o.push([1,0,0])):(i.push([f,T,0]),i.push([f+u,T,0]),i.push([f+u,T+h,0]),i.push([f,T+h,0]),a.push([d,m]),a.push([d+_,m]),a.push([d+_,m+_]),a.push([d,m+_]),o.push([0,0,1]),o.push([0,0,1]),o.push([0,0,1]),o.push([0,0,1])),s.push(4*E+0),s.push(4*E+1),s.push(4*E+2),s.push(4*E+0),s.push(4*E+2),s.push(4*E+3),E++}return(new Pr).bufferVertex(i).bufferTexCoord(a).bufferIndex(s).bufferNormal(o)},cube:(t,e,r,n=!1)=>{const i=t/2,a=(e=e||t)/2,s=(r=r||t)/2,o=[],u=[],h=[],_=[];let c=0;o.push([-i,a,-s]),o.push([i,a,-s]),o.push([i,-a,-s]),o.push([-i,-a,-s]),_.push([0,0,-1]),_.push([0,0,-1]),_.push([0,0,-1]),_.push([0,0,-1]),u.push([0,0]),u.push([1,0]),u.push([1,1]),u.push([0,1]),h.push(4*c+0),h.push(4*c+1),h.push(4*c+2),h.push(4*c+0),h.push(4*c+2),h.push(4*c+3),c++,o.push([i,a,-s]),o.push([i,a,s]),o.push([i,-a,s]),o.push([i,-a,-s]),_.push([1,0,0]),_.push([1,0,0]),_.push([1,0,0]),_.push([1,0,0]),u.push([0,0]),u.push([1,0]),u.push([1,1]),u.push([0,1]),h.push(4*c+0),h.push(4*c+1),h.push(4*c+2),h.push(4*c+0),h.push(4*c+2),h.push(4*c+3),c++,o.push([i,a,s]),o.push([-i,a,s]),o.push([-i,-a,s]),o.push([i,-a,s]),_.push([0,0,1]),_.push([0,0,1]),_.push([0,0,1]),_.push([0,0,1]),u.push([0,0]),u.push([1,0]),u.push([1,1]),u.push([0,1]),h.push(4*c+0),h.push(4*c+1),h.push(4*c+2),h.push(4*c+0),h.push(4*c+2),h.push(4*c+3),c++,o.push([-i,a,s]),o.push([-i,a,-s]),o.push([-i,-a,-s]),o.push([-i,-a,s]),_.push([-1,0,0]),_.push([-1,0,0]),_.push([-1,0,0]),_.push([-1,0,0]),u.push([0,0]),u.push([1,0]),u.push([1,1]),u.push([0,1]),h.push(4*c+0),h.push(4*c+1),h.push(4*c+2),h.push(4*c+0),h.push(4*c+2),h.push(4*c+3),c++,o.push([i,a,-s]),o.push([-i,a,-s]),o.push([-i,a,s]),o.push([i,a,s]),_.push([0,1,0]),_.push([0,1,0]),_.push([0,1,0]),_.push([0,1,0]),u.push([0,0]),u.push([1,0]),u.push([1,1]),u.push([0,1]),h.push(4*c+0),h.push(4*c+1),h.push(4*c+2),h.push(4*c+0),h.push(4*c+2),h.push(4*c+3),c++,o.push([i,-a,s]),o.push([-i,-a,s]),o.push([-i,-a,-s]),o.push([i,-a,-s]),_.push([0,-1,0]),_.push([0,-1,0]),_.push([0,-1,0]),_.push([0,-1,0]),u.push([0,0]),u.push([1,0]),u.push([1,1]),u.push([0,1]),h.push(4*c+0),h.push(4*c+1),h.push(4*c+2),h.push(4*c+0),h.push(4*c+2),h.push(4*c+3),n&&h.reverse();return(new Pr).bufferVertex(o).bufferTexCoord(u).bufferIndex(h).bufferNormal(_)},sphere:(t,e,r=!1)=>{const n=[],i=[],a=[],s=[],o=1/e;let u=0;function h(r,n,i=!1){const a=r/e*Math.PI-.5*Math.PI,s=n/e*Math.PI*2,o=i?1:t,u=[];u[1]=Math.sin(a)*o;const h=Math.cos(a)*o;u[0]=Math.cos(s)*h,u[2]=Math.sin(s)*h;const _=1e4;return u[0]=Math.floor(u[0]*_)/_,u[1]=Math.floor(u[1]*_)/_,u[2]=Math.floor(u[2]*_)/_,u}for(let t=0;t<e;t++)for(let r=0;r<e;r++){n.push(h(t,r)),n.push(h(t+1,r)),n.push(h(t+1,r+1)),n.push(h(t,r+1)),s.push(h(t,r,!0)),s.push(h(t+1,r,!0)),s.push(h(t+1,r+1,!0)),s.push(h(t,r+1,!0));const _=r/e,c=t/e;i.push([1-_,c]),i.push([1-_,c+o]),i.push([1-_-o,c+o]),i.push([1-_-o,c]),a.push(4*u+0),a.push(4*u+1),a.push(4*u+2),a.push(4*u+0),a.push(4*u+2),a.push(4*u+3),u++}r&&a.reverse();return(new Pr).bufferVertex(n).bufferTexCoord(i).bufferIndex(a).bufferNormal(s)},bigTriangle:()=>(new Pr).bufferData([[-1,-1],[-1,4],[4,-1]],"aPosition",2).bufferIndex([2,1,0])};const Kr={simpleColorFrag:jr,copyFrag:"\n#define SHADER_NAME SIMPLE_TEXTURE\nprecision highp float;varying vec2 vTextureCoord;uniform sampler2D texture;void main(void){gl_FragColor=texture2D(texture,vTextureCoord);}",bigTriangleVert:"\n#define SHADER_NAME BIG_TRIANGLE_VERTEX\nprecision mediump float;attribute vec2 aPosition;varying vec2 vTextureCoord;void main(void){gl_Position=vec4(aPosition,0.0,1.0);vTextureCoord=aPosition*.5+.5;}",generalVert:"precision highp float;attribute vec3 aVertexPosition;attribute vec2 aTextureCoord;attribute vec3 aNormal;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;uniform vec3 uTranslate;uniform vec3 uScale;uniform vec3 uRotation;varying vec2 vTextureCoord;varying vec3 vNormal;vec2 rotate(vec2 v,float a){float s=sin(a);float c=cos(a);mat2 m=mat2(c,s,-s,c);return m*v;}void main(void){vec3 pos=aVertexPosition*uScale;pos.yz=rotate(pos.yz,uRotation.x);pos.xz=rotate(pos.xz,uRotation.y);pos.xy=rotate(pos.xy,uRotation.z);pos+=uTranslate;gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(pos,1.0);vTextureCoord=aTextureCoord;vNormal=aNormal;}",skyboxVert:"\n#define SHADER_NAME SKYBOX_VERTEX\nprecision highp float;attribute vec3 aVertexPosition;attribute vec2 aTextureCoord;attribute vec3 aNormal;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;varying vec2 vTextureCoord;varying vec3 vVertex;varying vec3 vNormal;void main(void){mat4 matView=uViewMatrix;matView[3][0]=0.0;matView[3][1]=0.0;matView[3][2]=0.0;gl_Position=uProjectionMatrix*matView*uModelMatrix*vec4(aVertexPosition,1.0);vTextureCoord=aTextureCoord;vVertex=aVertexPosition;vNormal=aNormal;}"};class Zr extends Yr{constructor(t){super(t),this.setMesh(zr.sphere(1,12)).useProgram(Kr.generalVert,Kr.simpleColorFrag).uniform("uRotation",[0,0,0])}draw(t,e=[1,1,1],r=[1,1,1],n=1){this.uniform("uTranslate",t).uniform("uScale",e).uniform("uColor",r).uniform("uOpacity",n),super.draw(0)}}const{mat4:Qr,vec4:$r}=Er;class Jr{constructor(t,e,r,n={},i=1){this._fbos=[];for(let a=0;a<t;a++){const t=new Xr(e,r,n,i);this._fbos.push(t)}}swap(){const t=this._fbos.shift();this._fbos.push(t)}get read(){return this._fbos[this._fbos.length-1]}get write(){return this._fbos[0]}get all(){return this._fbos}}const tn=(t,e=!1)=>new Promise(((r,n)=>{const i=new XMLHttpRequest;i.addEventListener("load",(t=>{r(i.response)})),e&&(i.responseType="arraybuffer"),i.open("GET",t),i.send()}));function en(t){t instanceof ArrayBuffer&&(t=new Uint8Array(t));let e=0;const r=t.length;function n(){let n="";do{const r=t[e];if(10===r){++e;break}n+=String.fromCharCode(r)}while(++e<r);return n}let i=0,a=0,s=1;let o=!1;for(let t=0;t<20;t++){const t=n();let e;if(e=t.match("FORMAT=32-bit_rle_rgbe"))o=!0;else if(e=t.match("EXPOSURE=\\s*([0-9]*[.][0-9]*)"))s=Number(e[1]);else if(e=t.match("-Y ([0-9]+) \\+X ([0-9]+)")){a=Number(e[1]),i=Number(e[2]);break}}if(!o)throw new Error("File is not run length encoded!");const u=new Uint8Array(i*a*4);!function(t,e,r,n,i,a){const s=new Array(4);let o,u,h,_=null;const c=new Array(2),l=t.length;function E(e){let r=0;do{e[r++]=t[n]}while(++n<l&&r<e.length);return r}function f(e,r,i){let a=0;do{e[r+a++]=t[n]}while(++n<l&&a<i);return a}function T(t,e,r,n){const i=4*n,a=f(e,r,i);if(a<i)throw new Error(`Error reading raw pixels: got ${a} bytes, expected ${i}`)}for(;a>0;){if(E(s)<s.length)throw new Error("Error reading bytes: expected "+s.length);if(2!==s[0]||2!==s[1]||0!=(128&s[2]))return e[r++]=s[0],e[r++]=s[1],e[r++]=s[2],e[r++]=s[3],void T(0,e,r,i*a-1);if(((255&s[2])<<8|255&s[3])!==i)throw new Error(`Wrong scanline width ${(255&s[2])<<8|255&s[3]}, expected ${i}`);null===_&&(_=new Array(4*i)),o=0;for(let t=0;t<4;t++)for(u=(t+1)*i;o<u;){if(E(c)<c.length)throw new Error("Error reading 2-byte buffer");if((255&c[0])>128){if(h=(255&c[0])-128,0===h||h>u-o)throw new Error("Bad scanline data");for(;h-- >0;)_[o++]=c[1]}else{if(h=255&c[0],0===h||h>u-o)throw new Error("Bad scanline data");if(_[o++]=c[1],--h>0){if(f(_,o,h)<h)throw new Error("Error reading non-run data");o+=h}}}for(let t=0;t<i;t++)e[r+0]=_[t],e[r+1]=_[t+i],e[r+2]=_[t+2*i],e[r+3]=_[t+3*i],r+=4;a--}}(t,u,0,e,i,a);const h=new Float32Array(i*a*4);for(let t=0;t<u.length;t+=4){let e=u[t+0]/255,r=u[t+1]/255,n=u[t+2]/255;const i=u[t+3],a=Math.pow(2,i-128);e*=a,r*=a,n*=a;const s=t;h[s+0]=e,h[s+1]=r,h[s+2]=n,h[s+3]=1}return{shape:[i,a],exposure:s,gamma:1,data:h}}var rn=un("DXT1"),nn=un("DXT3"),an=un("DXT5"),sn=un("DX10"),on=function(t){var e,r,n=new Int32Array(t,0,31);if(542327876!==n[0])throw new Error("Invalid magic number in DDS header");if(4&!n[20])throw new Error("Unsupported format, must contain a FourCC code");var i=n[21];switch(i){case rn:e=8,r="dxt1";break;case nn:e=16,r="dxt3";break;case an:e=16,r="dxt5";break;case 116:r="rgba32f";break;case sn:var a=new Uint32Array(t.slice(128,148));r=a[0];var s=a[1];a[2],a[3],a[4];if(3!==s||2!==r)throw new Error("Unsupported DX10 texture format "+r);r="rgba32f";break;default:throw new Error("Unsupported FourCC code: "+(o=i,String.fromCharCode(255&o,o>>8&255,o>>16&255,o>>24&255)))}var o;var u=n[2],h=1;131072&u&&(h=Math.max(1,n[7]));var _=!1;512&n[28]&&(_=!0);var c,l=n[4],E=n[3],f=n[1]+4,T=l,d=E,m=[];i===sn&&(f+=20);if(_)for(var p=0;p<6;p++){if("rgba32f"!==r)throw new Error("Only RGBA32f cubemaps are supported");l=T,E=d;for(var M=Math.log(l)/Math.log(2)+1,R=0;R<M;R++)c=l*E*16,m.push({offset:f,length:c,shape:[l,E]}),R<h&&(f+=c),l=Math.floor(l/2),E=Math.floor(E/2)}else for(R=0;R<h;R++)c=Math.max(4,l)/4*Math.max(4,E)/4*e,m.push({offset:f,length:c,shape:[l,E]}),f+=c,l=Math.floor(l/2),E=Math.floor(E/2);return{shape:[T,d],images:m,format:r,flags:u,cubemap:_}};function un(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}const hn=function(t){const e=on(t),{flags:r}=e,n=new Int32Array(t,0,31);let i=1;131072&r&&(i=Math.max(1,n[7]));return e.images.map((e=>({data:new Float32Array(t.slice(e.offset,e.offset+e.length)),shape:e.shape,mipmapCount:i})))},_n=t=>{const e=t.split("\n"),r=[],n=[],i=[],a=[],s=[],o=[],u=[];let h,_=0;const c=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,l=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,E=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,f=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,T=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,d=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,m=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/;function p(t){const e=parseInt(t);return 3*(e>=0?e-1:e+a.length/3)}function M(t){const e=parseInt(t);return 3*(e>=0?e-1:e+s.length/3)}function R(t){const e=parseInt(t);return 2*(e>=0?e-1:e+o.length/2)}function A(t,e,n){r.push([a[t],a[t+1],a[t+2]]),r.push([a[e],a[e+1],a[e+2]]),r.push([a[n],a[n+1],a[n+2]]),u.push(3*_+0),u.push(3*_+1),u.push(3*_+2),_++}function v(t,e,r){n.push([o[t],o[t+1]]),n.push([o[e],o[e+1]]),n.push([o[r],o[r+1]])}function I(t,e,r){i.push([s[t],s[t+1],s[t+2]]),i.push([s[e],s[e+1],s[e+2]]),i.push([s[r],s[r+1],s[r+2]])}function g(t,e,r,n,i,a,s,o,u,h,_,c){let l,E=p(t),f=p(e),T=p(r);void 0===n?A(E,f,T):(l=p(n),A(E,f,l),A(f,T,l)),void 0!==i&&(E=R(i),f=R(a),T=R(s),void 0===n?v(E,f,T):(l=R(o),v(E,f,l),v(f,T,l))),void 0!==u&&(E=M(u),f=M(h),T=M(_),void 0===n?I(E,f,T):(l=M(c),I(E,f,l),I(f,T,l)))}for(let t=0;t<e.length;t++){let r=e[t];r=r.trim(),0!==r.length&&"#"!==r.charAt(0)&&(null!==(h=c.exec(r))?a.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])):null!==(h=l.exec(r))?s.push(parseFloat(h[1]),parseFloat(h[2]),parseFloat(h[3])):null!==(h=E.exec(r))?o.push(parseFloat(h[1]),parseFloat(h[2])):null!==(h=f.exec(r))?g(h[1],h[2],h[3],h[4]):null!==(h=T.exec(r))?g(h[2],h[5],h[8],h[11],h[3],h[6],h[9],h[12]):null!==(h=d.exec(r))?g(h[2],h[6],h[10],h[14],h[3],h[7],h[11],h[15],h[4],h[8],h[12],h[16]):null!==(h=m.exec(r))&&g(h[2],h[5],h[8],h[11],void 0,void 0,void 0,void 0,h[3],h[6],h[9],h[12]))}return cn({positions:r,coords:n,normals:i,indices:u})},cn=t=>{const e=t.normals.length>0,r=t.coords.length>0;let n;if(t.positions.length>65535){const i=[];let a=0;const s={};for(s.positions=t.positions.concat(),s.coords=t.coords.concat(),s.indices=t.indices.concat(),s.normals=t.normals.concat();t.indices.length>0;){const o=Math.min(65535,t.positions.length),u=t.indices.splice(0,o),h=[],_=[],c=[];let l,E=0;for(let t=0;t<u.length;t++)u[t]>E&&(E=u[t]),l=u[t],h.push(s.positions[l]),r&&_.push(s.coords[l]),e&&c.push(s.normals[l]),u[t]-=a;a=E+1,n=new Pr,n.bufferVertex(h),r&&n.bufferTexCoord(_),n.bufferIndex(u),e&&n.bufferNormal(c),i.push(n)}return i}return n=new Pr,n.bufferVertex(t.positions),r&&n.bufferTexCoord(t.coords),n.bufferIndex(t.indices),e&&n.bufferNormal(t.normals),n};let ln=window,En=60,fn=performance.now(),Tn=0,dn=0,mn=fn;const pn=[],Mn=[],Rn=[],An=[];let vn=[],In=[],gn=0;!function t(){!function(){let t,e=0,r=1e3/En,n=0;for(e=0;e<pn.length;e++)t=pn[e],null!=t&&t.func(t.args);for(;vn.length>0;)t=vn.pop(),t.func(t.args);let i=performance.now();for(dn=(i-fn)/1e3,Tn=i-mn,e=0;e<Mn.length;e++)t=Mn[e],i-t.time>t.delay&&(t.func(t.args),Mn.splice(e,1));for(i=performance.now();Rn.length>0;){if(t=Rn.shift(),n=performance.now(),!(n-i<r)){Rn.unshift(t);break}t.func(t.args)}for(i=performance.now();An.length>0;)t=An.shift(),n=performance.now(),n-i<r&&t.func(t.args);mn=i,vn=vn.concat(In),In=[]}(),ln.requestAnimationFrame(t)}();var Nn=function(t,e){const r=++gn;return pn[r]={func:t,args:e},r},Sn=function(t){return void 0!==pn[t]&&(pn[t]=null),-1};class bn{constructor(t,e=.1){this.easing=e,this._value=t,this._targetValue=t,this._efIndex=Nn((()=>this._update()))}_update(){this._checkLimit(),this._value+=(this._targetValue-this._value)*this.easing,Math.abs(this._targetValue-this._value)<1e-4&&(this._value=this._targetValue)}setTo(t){this._targetValue=this._value=t}add(t){this._targetValue+=t}limit(t,e){t>e?this.limit(e,t):(this._min=t,this._max=e,this._checkLimit())}_checkLimit(){void 0!==this._min&&this._targetValue<this._min&&(this._targetValue=this._min),void 0!==this._max&&this._targetValue>this._max&&(this._targetValue=this._max)}destroy(){Sn(this._efIndex)}set value(t){this._targetValue=t}get value(){return this._value}get targetValue(){return this._targetValue}}const Ln={Linear:{None:t=>t},Quadratic:{In:t=>t*t,Out:t=>t*(2-t),InOut:t=>(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},Cubic:{In:t=>t*t*t,Out:t=>--t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},Quartic:{In:t=>t*t*t*t,Out:t=>1- --t*t*t*t,InOut:t=>(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},Quintic:{In:t=>t*t*t*t*t,Out:t=>--t*t*t*t*t+1,InOut:t=>(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},Sinusoidal:{In:t=>1-Math.cos(t*Math.PI/2),Out:t=>Math.sin(t*Math.PI/2),InOut:t=>.5*(1-Math.cos(Math.PI*t))},Exponential:{In:t=>0===t?0:Math.pow(1024,t-1),Out:t=>1===t?1:1-Math.pow(2,-10*t),InOut:t=>0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},Circular:{In:t=>1-Math.sqrt(1-t*t),Out:t=>Math.sqrt(1- --t*t),InOut:t=>(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},Elastic:{In(t){let e,r=.1;return 0===t?0:1===t?1:(!r||r<1?(r=1,e=.1):e=.4*Math.asin(1/r)/(2*Math.PI),-r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},Out(t){let e,r=.1;return 0===t?0:1===t?1:(!r||r<1?(r=1,e=.1):e=.4*Math.asin(1/r)/(2*Math.PI),r*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},InOut(t){let e,r=.1;const n=.4;return 0===t?0:1===t?1:(!r||r<1?(r=1,e=.1):e=n*Math.asin(1/r)/(2*Math.PI),(t*=2)<1?r*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)*-.5:r*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/n)*.5+1)}},Back:{In(t){const e=1.70158;return t*t*((e+1)*t-e)},Out(t){const e=1.70158;return--t*t*((e+1)*t+e)+1},InOut(t){const e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}},Bounce:{in:t=>1-Ln.Bounce.out(1-t),out:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,inOut:t=>t<.5?.5*Ln.Bounce.in(2*t):.5*Ln.Bounce.out(2*t-1)+.5}};const xn=function(t,e){const r=e||{};return t.touches?(r.x=t.touches[0].pageX,r.y=t.touches[0].pageY):(r.x=t.clientX,r.y=t.clientY),r};class Cn{constructor(t,e=window,r=10){this._target=t,this._listenerTarget=e,this._mouse={},this._preMouse={},this.center=tt(),this._up=nt(0,1,0),this.radius=new bn(r),this.position=nt(0,0,this.radius.value),this.positionOffset=tt(),this._rx=new bn(0),this._rx.limit(-Math.PI/2,Math.PI/2),this._ry=new bn(0),this._preRX=0,this._preRY=0,this._isLockZoom=!1,this._isLockRotation=!1,this._isInvert=!1,this.sensitivity=1,this._wheelBind=t=>this._onWheel(t),this._downBind=t=>this._onDown(t),this._moveBind=t=>this._onMove(t),this._upBind=()=>this._onUp(),this.connect(),Nn((()=>this._loop()))}connect(){this.disconnect(),this._listenerTarget.addEventListener("mousewheel",this._wheelBind),this._listenerTarget.addEventListener("DOMMouseScroll",this._wheelBind),this._listenerTarget.addEventListener("mousedown",this._downBind),this._listenerTarget.addEventListener("touchstart",this._downBind),this._listenerTarget.addEventListener("mousemove",this._moveBind),this._listenerTarget.addEventListener("touchmove",this._moveBind),window.addEventListener("touchend",this._upBind),window.addEventListener("mouseup",this._upBind)}disconnect(){this._listenerTarget.removeEventListener("mousewheel",this._wheelBind),this._listenerTarget.removeEventListener("DOMMouseScroll",this._wheelBind),this._listenerTarget.removeEventListener("mousedown",this._downBind),this._listenerTarget.removeEventListener("touchstart",this._downBind),this._listenerTarget.removeEventListener("mousemove",this._moveBind),this._listenerTarget.removeEventListener("touchmove",this._moveBind),window.removeEventListener("touchend",this._upBind),window.removeEventListener("mouseup",this._upBind)}lock(t=!0){this._isLockZoom=t,this._isLockRotation=t,this._isMouseDown=!1}lockZoom(t=!0){this._isLockZoom=t}lockRotation(t=!0){this._isLockRotation=t}inverseControl(t=!0){this._isInvert=t}_onDown(t){this._isLockRotation||(this._isMouseDown=!0,xn(t,this._mouse),xn(t,this._preMouse),this._preRX=this._rx.targetValue,this._preRY=this._ry.targetValue)}_onMove(t){if(!this._isLockRotation&&(xn(t,this._mouse),t.touches&&t.preventDefault(),this._isMouseDown)){let t=-(this._mouse.x-this._preMouse.x);this._isInvert&&(t*=-1),this._ry.value=this._preRY-.01*t*this.sensitivity;let e=-(this._mouse.y-this._preMouse.y);this._isInvert&&(e*=-1),this._rx.value=this._preRX-.01*e*this.sensitivity}}_onUp(){this._isLockRotation||(this._isMouseDown=!1)}_onWheel(t){if(this._isLockZoom)return;const e=t.wheelDelta,r=t.detail;let n=0;n=r?e?e/r/40*r>0?1:-1:-r/3:e/120,this.radius.add(2*-n),this.radius.targetValue<0&&(this.radius.value=1e-4)}_loop(){this._updatePosition(),this._target&&this._updateCamera()}update(){this._updatePosition()}_updatePosition(){this.position[1]=Math.sin(this._rx.value)*this.radius.value;const t=Math.cos(this._rx.value)*this.radius.value;this.position[0]=Math.cos(this._ry.value+.5*Math.PI)*t,this.position[2]=Math.sin(this._ry.value+.5*Math.PI)*t,at(this.position,this.position,this.positionOffset)}_updateCamera(){this._target.lookAt(this.position,this.center,this._up)}get rx(){return this._rx}get ry(){return this._ry}}Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function t(){var e=isNaN(arguments[0])?1:Number(arguments[0]);return e?Array.prototype.reduce.call(this,(function(r,n){return Array.isArray(n)?r.push.apply(r,t.call(n,e-1)):r.push(n),r}),[]):Array.prototype.slice.call(this)},writable:!0}),t.BasicColorShader=class extends Cr{constructor(t=[1,1,1],e=1){super(xr,jr),this.color=t,this.opacity=e}get color(){return this._color}set color(t){this._color=t,this.uniform("uColor",this._color)}get opacity(){return this._opacity}set opacity(t){this._opacity=t,this.uniform("uOpacity",this._opacity)}},t.BitSwitch=Dr,t.Camera=Hr,t.CameraOrtho=class extends Hr{constructor(t,e,r,n,i=.1,a=100){super(),this._left=0,this._right=0,this._top=0,this._bottom=0,this.ortho(t,e,r,n,i,a)}ortho(t,e,r,n,i=.1,a=100){this.left=t,this.right=e,this.top=r,this.bottom=n,z(this._mtxProj,t,e,n,r,i,a),this._left=t,this._right=e,this._top=r,this._bottom=n,this._near=i,this._far=a}_updateMatrices(){this.ortho(this._left,this._right,this._top,this._bottom,this._near,this._far)}},t.CameraPerspective=qr,t.DiffuseLightShader=class extends Cr{constructor(t=[1,1,1],e=[1,1,1],r=.5){super(xr,"precision highp float;varying vec3 vNormal;uniform vec3 uColor;uniform vec3 uLight;uniform float uLightIntensity;\n#pragma glslify: diffuse = require(glsl-utils/diffuse.glsl)\nvoid main(void){float g=diffuse(vNormal,uLight,uLightIntensity);gl_FragColor=vec4(uColor*g,1.0);}"),this.color=t,this.light=e,this.intensity=r}get color(){return this._color}set color(t){this._color=t,this.uniform("uColor",this._color)}get light(){return this._light}set light(t){this._light=t,this.uniform("uLight",this._light)}get intensity(){return this._intensity}set intensity(t){this._intensity=t,this.uniform("uLightIntensity",this._intensity)}},t.Draw=Yr,t.DrawAxis=class extends Yr{constructor(t){super(t);const e=this._GL,r=1e3,n=[[-r,0,0],[r,0,0],[0,-r,0],[0,r,0],[0,0,-r],[0,0,r]];this.createMesh(e.LINES).bufferVertex(n).bufferData([[1,0,0],[1,0,0],[0,1,0],[0,1,0],[0,0,1],[0,0,1]],"aColor").bufferIndex([0,1,2,3,4,5]).useProgram("precision highp float;attribute vec3 aVertexPosition;attribute vec3 aColor;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;varying vec3 vColor;void main(void){gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(aVertexPosition,1.0);vColor=aColor;}","precision highp float;varying vec3 vColor;uniform float uOpacity;void main(void){gl_FragColor=vec4(vColor,uOpacity);}"),this.opacity=.75}draw(){this.uniform("uOpacity",this.opacity),super.draw()}},t.DrawBall=Zr,t.DrawCamera=class{constructor(t){const e=t||Nr;this._dLine=new kr(e),this._dBall=new Zr(e),this.mtx=Qr.create(),this.color=[1,1,1],this.opacity=.75,this._points=[[1,1,-1,1],[-1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[1,1,1,1],[-1,1,1,1],[1,-1,1,1],[-1,-1,1,1]],this._lines=[[0,1],[1,3],[3,2],[2,0],[4,5],[5,7],[7,6],[6,4],[0,4],[1,5],[2,6],[3,7]]}draw(t,e,r){const n=e||this.color,i=r||this.opacity;Qr.identity(this.mtx,this.mtx),Qr.mul(this.mtx,t.projection,t.view),Qr.invert(this.mtx,this.mtx);const a=this._points.map((t=>{const e=$r.clone(t);return $r.transformMat4(e,e,this.mtx),e[0]/=e[3],e[1]/=e[3],e[2]/=e[3],[e[0],e[1],e[2]]})),s=.02;a.forEach((t=>{this._dBall.draw(t,[s,s,s],n,i)})),this._lines.forEach((t=>{this._dLine.draw(a[t[0]],a[t[1]],n,i)}))}},t.DrawCopy=class extends Yr{constructor(t){super(t),this.setMesh(zr.bigTriangle()).useProgram(Kr.bigTriangleVert,Kr.copyFrag)}draw(t){this.bindTexture("texture",t,0),super.draw(0)}},t.DrawDotsPlane=class extends Yr{constructor(t){super(t);const e=this._GL,r=[],n=[];let i=0;const a=100;let s,o;for(s=-100;s<a;s+=1)for(o=-100;o<a;o+=1)r.push([s,o,0]),n.push(i),i++,r.push([s,0,o]),n.push(i),i++;this.createMesh(e.POINTS).bufferVertex(r).bufferIndex(n).useProgram("#define SHADER_NAME DOTS_PLANE_VERTEX\nprecision highp float;attribute vec3 aVertexPosition;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;uniform vec2 uViewport;uniform float uScale;uniform float uPointScale;const float radius=0.008;void main(void){gl_Position=uProjectionMatrix*uViewMatrix*uModelMatrix*vec4(aVertexPosition*uScale,1.0);float distOffset=uViewport.y*uProjectionMatrix[1][1]*radius/gl_Position.w;gl_PointSize=distOffset*uPointScale;}",jr),this.color=[1,1,1],this.opacity=.5,this.pointScale=1,this.scale=1}draw(){const{width:t,height:e}=this._GL;this.uniform("uColor",this.color).uniform("uOpacity",this.opacity).uniform("uScale",this.scale).uniform("uPointScale",this.pointScale).uniform("uViewport",[t,e]),super.draw()}},t.DrawLine=kr,t.EaseNumber=bn,t.FboArray=Jr,t.FboPingPong=class extends Jr{constructor(t,e,r={},n=1){super(2,t,e,r,n)}},t.FrameBuffer=Xr,t.GL=Nr,t.GLCubeTexture=class{constructor(t,e={},r=0,n=0){this._source=t,this._isHtmlElement=Fr(this._source[0]),this._getDimension(t,r,n),this._params=Ur(e,this._width,this._height),this._checkMipmap()}bind(t,e){this.createTexture(e);const{gl:r}=this.GL;r.activeTexture(r.TEXTURE0+t),r.bindTexture(r.TEXTURE_CUBE_MAP,this._texture)}unbind(){this.GL.gl.bindTexture(gl.TEXTURE_CUBE_MAP,null)}createTexture(t){void 0===t||void 0===this.GL||t===this.GL?(this.GL=t||Nr,this._texture||(Br(this.GL,this._params),this._uploadTexture())):yr(wr.CUBE_TEXTURE_CONTEXT,this.GL.id)}showProperties(){console.log("Dimension :",this._width,this._height);for(const t in this._params)console.log(t,Ar[this._params[t]]||this._params[t])}_uploadTexture(){const{gl:t}=this.GL,e=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z];let r=1,n=0;r=this._source.length/6,this.numLevels=r,this._texture=t.createTexture(),t.bindTexture(t.TEXTURE_CUBE_MAP,this._texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1);let i=this._width,a=this._height;for(let s=0;s<r;s++)e.forEach(((e,o)=>{n=o*r+s,this._isHtmlElement&&!this.GL.webgl2?this._source[n].length>0&&t.texImage2D(e,s,this._params.internalFormat,this._params.format,this._params.type,this._source[n]):this._source[n].length>0&&t.texImage2D(e,s,this._params.internalFormat,i,a,0,this._params.format,this._params.type,this._source[n])})),i>>=1,a>>=1;this._generateMipmap&&t.generateMipmap(t.TEXTURE_CUBE_MAP),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,this._params.magFilter),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,this._params.minFilter),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,this._params.wrapS),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,this._params.wrapT),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha),t.bindTexture(t.TEXTURE_CUBE_MAP,null)}_checkMipmap(){this._generateMipmap=this._params.mipmap,Or(this._width)&&Or(this._height)||(this._generateMipmap=!1);-1===Ar[this._params.minFilter].indexOf("MIPMAP")&&(this._generateMipmap=!1)}_getDimension(t,e,r){t?(this._width=t[0].width||t[0].videoWidth,this._height=t[0].height||t[0].videoWidth,this._width=this._width||e,this._height=this._height||r,this._width&&this._height||(this._width=this._height=Math.sqrt(t[0].length/4))):(this._width=e,this._height=r)}get texture(){return this._texture}get width(){return this._width}get height(){return this._height}},t.GLShader=Cr,t.GLTexture=Gr,t.GLTool=gr,t.Geom=zr,t.HitTestor=class extends e{constructor(t,e,r,n=!1,i=window){super(),this._mesh=t,this._mesh.generateFaces(),this._camera=e,this.faceVertices=t.faces.map((t=>t.vertices)),this.clickTolerance=8,this._ray=new Wr([0,0,0],[0,0,-1]),this._hit=nt(-999,-999,-999),this._lastPos,this._firstPos,this.modelMatrix=O(),this.resolution=r||[window.innerWidth,window.innerHeight],this._listenerTarget=i,this._skippingMove=n,this._onMoveBind=t=>this._onMove(t),this._onDownBind=t=>this._onDown(t),this._onUpBind=()=>this._onUp(),this.connect()}connect(){this._listenerTarget.addEventListener("mousedown",this._onDownBind),this._listenerTarget.addEventListener("mousemove",this._onMoveBind),this._listenerTarget.addEventListener("mouseup",this._onUpBind)}disconnect(){this._listenerTarget.removeEventListener("mousedown",this._onDownBind),this._listenerTarget.removeEventListener("mousemove",this._onMoveBind),this._listenerTarget.removeEventListener("mouseup",this._onUpBind)}_checkHit(t="onHit"){const e=this._camera;if(!e)return;const r=this._lastPos.x/this.resolution[0]*2-1,n=-this._lastPos.y/this.resolution[1]*2+1;let i;e.generateRay([r,n,0],this._ray);const a=tt(),s=tt(),o=tt();let u=0;const h=(t,e)=>{dt(e,t,this.modelMatrix)};for(let t=0;t<this.faceVertices.length;t++){const r=this.faceVertices[t];h(r[0],a),h(r[1],s),h(r[2],o);const n=this._ray.intersectTriangle(a,s,o);if(n)if(i){const t=vt(n,e.position);t<u&&(i=et(n),u=t)}else i=et(n),u=vt(i,e.position)}i?(this._hit=et(i),this.emit(t,{hit:i})):this.emit("onUp")}_onDown(t){this._firstPos=Mr(t),this._lastPos=Mr(t),this._checkHit("onDown")}_onMove(t){this._lastPos=Mr(t),this._skippingMove||this._checkHit()}_onUp(){(function(t,e){const r=t.x-e.x,n=t.y-e.y;return Math.sqrt(r*r+n*n)})(this._firstPos,this._lastPos)<this.clickTolerance&&this._checkHit()}},t.Mesh=Pr,t.Object3D=function(){let t=tt(),e=tt(),r=nt(1,1,1),n=O(),i=O(),a=O(),s=O(),o=O(),u=O(),h=re(),_=[],c=!0;this.update=function(t){void 0!==t&&U(i,t),c=!0,l()},this.addChild=function(t){_.push(t)},this.removeChild=function(t){const e=_.indexOf(t);-1!=e?_.splice(e,1):console.warn("Child no exist")},this.setRotationFromQuaternion=function(t){Re(h,t),c=!0};const l=()=>{c&&(F(a),F(o),F(s),G(s,s,e[0]),V(s,s,e[1]),X(s,s,e[2]),j(u,h),Q(s,u,s),y(o,o,r),w(a,a,t),Q(n,a,s),Q(n,n,o),Q(n,i,n),_.forEach((t=>{t.update(n)})),c=!1)};this.__defineGetter__("matrix",(function(){return l(),n})),this.__defineSetter__("x",(function(e){t[0]=e,c=!0})),this.__defineGetter__("x",(function(){return t[0]})),this.__defineSetter__("y",(function(e){t[1]=e,c=!0})),this.__defineGetter__("y",(function(){return t[1]})),this.__defineSetter__("z",(function(e){t[2]=e,c=!0})),this.__defineGetter__("z",(function(){return t[2]})),this.__defineSetter__("scaleX",(function(t){r[0]=t,c=!0})),this.__defineGetter__("scaleX",(function(){return r[0]})),this.__defineSetter__("scaleY",(function(t){r[1]=t,c=!0})),this.__defineGetter__("scaleY",(function(){return r[1]})),this.__defineSetter__("scaleZ",(function(t){r[2]=t,c=!0})),this.__defineGetter__("scaleZ",(function(){return r[2]})),this.__defineSetter__("rotationX",(function(t){e[0]=t,c=!0})),this.__defineGetter__("rotationX",(function(){return e[0]})),this.__defineSetter__("rotationY",(function(t){e[1]=t,c=!0})),this.__defineGetter__("rotationY",(function(){return e[1]})),this.__defineSetter__("rotationZ",(function(t){e[2]=t,c=!0})),this.__defineGetter__("rotationZ",(function(){return e[2]})),this.__defineGetter__("children",(function(){return _}))},t.OrbitalControl=Cn,t.PBRShader=class extends Cr{constructor(){super("#version 300 es\n#define SHADER_NAME pbr_vert\nprecision highp float;in vec3 aVertexPosition;in vec2 aTextureCoord;in vec3 aNormal;uniform mat4 uModelMatrix;uniform mat4 uViewMatrix;uniform mat4 uProjectionMatrix;uniform mat3 uNormalMatrix;uniform mat3 uModelViewMatrixInverse;out vec2 vTextureCoord;out vec3 vNormal;out vec3 vPosition;void main(void){vec4 position=uModelMatrix*vec4(aVertexPosition,1.0);vPosition=position.xyz/position.w;vNormal=normalize(vec3(uModelMatrix*vec4(aNormal,0.0)));vTextureCoord=aTextureCoord;gl_Position=uProjectionMatrix*uViewMatrix*position;}","#version 300 es\n#define SHADER_NAME pbr_frag\nprecision highp float;uniform sampler2D uBRDFMap;uniform samplerCube uRadianceMap;uniform samplerCube uIrradianceMap;uniform vec3 uBaseColor;uniform sampler2D uColorMap;uniform sampler2D uORMMap;uniform float uOcclusionStrength;uniform float uRoughness;uniform float uMetallic;uniform float uExposure;uniform sampler2D uNormalMap;uniform float uNormalScale;uniform sampler2D uEmissiveMap;uniform vec3 uEmissiveFactor;uniform vec3 uLightDirection;uniform vec3 uLightColor;uniform vec3 uCameraPos;uniform vec4 uScaleDiffBaseMR;uniform vec4 uScaleFGDSpec;uniform vec4 uScaleIBLAmbient;in vec2 vTextureCoord;in vec3 vNormal;in vec3 vPosition;out vec4 oColor;struct PBRInfo{float NdotL;float NdotV;float NdotH;float LdotH;float VdotH;float perceptualRoughness;float metalness;vec3 reflectance0;vec3 reflectance90;float alphaRoughness;vec3 diffuseColor;vec3 specularColor;};const float M_PI=3.141592653589793;const float c_MinRoughness=0.04;vec4 SRGBtoLINEAR(vec4 srgbIn){\n#ifdef MANUAL_SRGB\n#ifdef SRGB_FAST_APPROXIMATION\nvec3 linOut=pow(srgbIn.xyz,vec3(2.2));\n#else\nvec3 bLess=step(vec3(0.04045),srgbIn.xyz);vec3 linOut=mix(srgbIn.xyz/vec3(12.92),pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)),bLess);\n#endif\nreturn vec4(linOut,srgbIn.w);;\n#else\nreturn srgbIn;\n#endif\n}vec3 getNormal(){vec3 pos_dx=dFdx(vPosition);vec3 pos_dy=dFdy(vPosition);vec3 tex_dx=dFdx(vec3(vTextureCoord,0.0));vec3 tex_dy=dFdy(vec3(vTextureCoord,0.0));vec3 t=(tex_dy.t*pos_dx-tex_dx.t*pos_dy)/(tex_dx.s*tex_dy.t-tex_dy.s*tex_dx.t);vec3 ng=normalize(vNormal);t=normalize(t-ng*dot(ng,t));vec3 b=normalize(cross(ng,t));mat3 tbn=mat3(t,b,ng);vec3 n=texture(uNormalMap,vTextureCoord).rgb;n=normalize(tbn*((2.0*n-1.0)*vec3(uNormalScale,uNormalScale,1.0)));return n;}vec3 getIBLContribution(PBRInfo pbrInputs,vec3 n,vec3 reflection){float mipCount=7.0;float lod=(pbrInputs.perceptualRoughness*mipCount);vec3 brdf=SRGBtoLINEAR(texture(uBRDFMap,vec2(pbrInputs.NdotV,1.0-pbrInputs.perceptualRoughness))).rgb;vec3 diffuseLight=SRGBtoLINEAR(texture(uIrradianceMap,n)).rgb;\n#ifdef USE_TEX_LOD\nvec3 specularLight=SRGBtoLINEAR(textureCubeLodEXT(uRadianceMap,reflection,lod)).rgb;\n#else\nvec3 specularLight=SRGBtoLINEAR(texture(uRadianceMap,reflection)).rgb;\n#endif\nvec3 diffuse=diffuseLight*pbrInputs.diffuseColor;vec3 specular=specularLight*(pbrInputs.specularColor*brdf.x+brdf.y);diffuse*=uScaleIBLAmbient.x;specular*=uScaleIBLAmbient.y;return diffuse+specular;}vec3 diffuse(PBRInfo pbrInputs){return pbrInputs.diffuseColor/M_PI;}vec3 specularReflection(PBRInfo pbrInputs){return pbrInputs.reflectance0+(pbrInputs.reflectance90-pbrInputs.reflectance0)*pow(clamp(1.0-pbrInputs.VdotH,0.0,1.0),5.0);}float geometricOcclusion(PBRInfo pbrInputs){float NdotL=pbrInputs.NdotL;float NdotV=pbrInputs.NdotV;float r=pbrInputs.alphaRoughness;float attenuationL=2.0*NdotL/(NdotL+sqrt(r*r+(1.0-r*r)*(NdotL*NdotL)));float attenuationV=2.0*NdotV/(NdotV+sqrt(r*r+(1.0-r*r)*(NdotV*NdotV)));return attenuationL*attenuationV;}float microfacetDistribution(PBRInfo pbrInputs){float roughnessSq=pbrInputs.alphaRoughness*pbrInputs.alphaRoughness;float f=(pbrInputs.NdotH*roughnessSq-pbrInputs.NdotH)*pbrInputs.NdotH+1.0;return roughnessSq/(M_PI*f*f);}void main(void){vec4 orm=texture(uORMMap,vTextureCoord);float perceptualRoughness=uRoughness*orm.g;float metallic=uMetallic*orm.b;perceptualRoughness=clamp(perceptualRoughness,c_MinRoughness,1.0);metallic=clamp(metallic,0.0,1.0);float alphaRoughness=perceptualRoughness*perceptualRoughness;vec4 baseColor=SRGBtoLINEAR(texture(uColorMap,vTextureCoord));baseColor.rgb*=uBaseColor;vec3 f0=vec3(0.04);vec3 diffuseColor=baseColor.rgb*(vec3(1.0)-f0);diffuseColor*=1.0-metallic;vec3 specularColor=mix(f0,baseColor.rgb,metallic);float reflectance=max(max(specularColor.r,specularColor.g),specularColor.b);float reflectance90=clamp(reflectance*25.0,0.0,1.0);vec3 specularEnvironmentR0=specularColor.rgb;vec3 specularEnvironmentR90=vec3(1.0,1.0,1.0)*reflectance90;vec3 n=getNormal();vec3 v=normalize(uCameraPos-vPosition);vec3 l=normalize(uLightDirection);vec3 h=normalize(l+v);vec3 reflection=-normalize(reflect(v,n));float NdotL=clamp(dot(n,l),0.001,1.0);float NdotV=abs(dot(n,v))+0.001;float NdotH=clamp(dot(n,h),0.0,1.0);float LdotH=clamp(dot(l,h),0.0,1.0);float VdotH=clamp(dot(v,h),0.0,1.0);PBRInfo pbrInputs=PBRInfo(NdotL,NdotV,NdotH,LdotH,VdotH,perceptualRoughness,metallic,specularEnvironmentR0,specularEnvironmentR90,alphaRoughness,diffuseColor,specularColor);vec3 F=specularReflection(pbrInputs);float G=geometricOcclusion(pbrInputs);float D=microfacetDistribution(pbrInputs);vec3 diffuseContrib=(1.0-F)*diffuse(pbrInputs);vec3 specContrib=F*G*D/(4.0*NdotL*NdotV);vec3 color=NdotL*uLightColor*(diffuseContrib+specContrib);color+=getIBLContribution(pbrInputs,n,reflection);color=mix(color,color*orm.r,uOcclusionStrength);vec3 emissive=SRGBtoLINEAR(texture(uEmissiveMap,vTextureCoord)).rgb*uEmissiveFactor;color+=emissive;color=mix(color,F,uScaleFGDSpec.x);color=mix(color,vec3(G),uScaleFGDSpec.y);color=mix(color,vec3(D),uScaleFGDSpec.z);color=mix(color,specContrib,uScaleFGDSpec.w);color=mix(color,diffuseContrib,uScaleDiffBaseMR.x);color=mix(color,baseColor.rgb,uScaleDiffBaseMR.y);color=mix(color,vec3(metallic),uScaleDiffBaseMR.z);color=mix(color,vec3(perceptualRoughness),uScaleDiffBaseMR.w);oColor=vec4(pow(color,vec3(1.0/uExposure)),baseColor.a);}"),this.textureWhite=Vr([1,1,1]),this._textureLut=this.textureWhite,this._roughness=1,this._metallic=1,this._textureColor=this.textureWhite,this._baseColor=[1,1,1],this._textureNormal=this.textureWhite,this._normalScale=0,this._textureORM=this.textureWhite,this._aoStrength=1,this._textureEmissive=this.textureWhite,this._emissiveColor=[0,0,0],this._exposure=2.2,this._cameraPos=[0,0,1],this.uniform("uBRDFMap","int",0),this.uniform("uRadianceMap","int",1),this.uniform("uIrradianceMap","int",2),this.uniform("uColorMap","int",3),this.uniform("uNormalMap","int",4),this.uniform("uORMMap","int",5),this.uniform("uEmissiveMap","int",6),this.uniform("uRoughness",this._roughness),this.uniform("uMetallic",this._metallic),this.uniform("uBaseColor",this._baseColor),this.uniform("uNormalScale",this._normalScale),this.uniform("uOcclusionStrength",this._aoStrength),this.uniform("uEmissiveFactor",this._emissiveColor),this.uniform("uCameraPos",this._cameraPos),this.uniform("uScaleDiffBaseMR",[0,0,0,0]),this.uniform("uScaleFGDSpec",[0,0,0,0]),this.uniform("uScaleIBLAmbient",[1,1,1,1]),this.uniform("uExposure",this._exposure),this.diffuseOffset=0}bindAllTextures(t){const e=t||Nr;this._textureLut.bind(0,e),this._textureRad?this._textureRad.bind(1,e):console.log("No Radiance Texture found"),this._textureIrr?this._textureIrr.bind(2,e):console.log("No Irradiance Texture found"),this._textureColor.bind(3),this._textureNormal.bind(4),this._textureORM.bind(5),this._textureEmissive.bind(6)}set lutMap(t){this._textureLut=t}set radianceMap(t){this._textureRad=t}set irradianceMap(t){this._textureIrr=t}set roughness(t){this._roughness=t,this.uniform("uRoughness",this._roughness);const e=Math.pow((1-this._roughness)*(1-this._metallic),2)*this.diffuseOffset;this.uniform("uScaleDiffBaseMR",[e,0,0,0])}get roughness(){return this._roughness}set metallic(t){this._metallic=t,this.uniform("uMetallic",this._metallic)}get metallic(){return this._metallic}set baseColor(t){this._baseColor=t,this.uniform("uBaseColor",this._baseColor)}get baseColor(){return this._baseColor}set normalScale(t){this._normalScale=t,this.uniform("uNormalScale",this._normalScale)}get normalScale(){return this._normalScale}set aoStrength(t){this._aoStrength=t,this.uniform("uOcclusionStrength",this._aoStrength)}get aoStrength(){return this._aoStrength}set emissiveColor(t){this._emissiveColor=t,this.uniform("uEmissiveFactor",this._emissiveColor)}get emissiveColor(){return this._emissiveColor}set cameraPosition(t){this._cameraPos=t,this.uniform("uCameraPos",this._cameraPos)}get cameraPosition(){return this._cameraPos}set exposure(t){this._exposure=t,this.uniform("uExposure",this._exposure)}get exposure(){return this._exposure}},t.Ray=Wr,t.Scene=class{constructor(t){this._GL=t||Nr,this.camera=new qr,this.camera.setPerspective(45*Math.PI/180,Nr.aspectRatio,.1,100),this.orbitalControl=new Cn(this.camera,window,15),this.orbitalControl.radius.value=10,this._isRunning=!0,this._initTextures(),this._initViews(),window.addEventListener("resize",(()=>this.resize())),this._efIndex=Nn((()=>this._loop()))}stop(){this._isRunning=!1}resume(){this._isRunning=!0}_initTextures(){}_initViews(){}update(){}render(){}_loop(){this._isRunning&&(this.update(),this._GL.viewport(0,0,this._GL.width,this._GL.height),this._GL.setMatrices(this.camera),this.render())}resize(){this._GL.setSize(window.innerWidth,window.innerHeight),this.camera.setAspectRatio(this._GL.aspectRatio)}},t.ShaderLibs=Kr,t.SpringNumber=class{constructor(t,e=.1,r=.9){this._value=t,this._targetValue=t,this.speed=e,this.decreaseRate=r,this._velocity=0,this._efIndex=Nn((()=>this._update()))}_update(){const t=1e-4;this._checkLimit(),Math.abs(this._targetValue-this._value)<t?this._value=this._targetValue:(this._velocity+=(this._targetValue-this._value)*this.speed,this._value+=this._velocity,this._velocity*=this.decreaseRate,Math.abs(this._targetValue-this._value)<t&&(this._value=this._targetValue))}limit(t,e){t>e?this.limit(e,t):(this._min=t,this._max=e,this._checkLimit())}_checkLimit(){void 0!==this._min&&this._targetValue<this._min&&(this._targetValue=this._min),void 0!==this._max&&this._targetValue>this._max&&(this._targetValue=this._max)}destroy(){Sn(this._efIndex)}set value(t){this._targetValue=t}get value(){return this._value}},t.TweenNumber=class{constructor(t,e="expOut",r=.01){this._value=t,this._startValue=t,this._targetValue=t,this._counter=1,this.speed=r,this.easing=e,this._needUpdate=!0,this._efIndex=Nn((()=>this._update()))}_update(){let t=this._counter+this.speed;t>1&&(t=1),this._counter!==t?(this._counter=t,this._needUpdate=!0):this._needUpdate=!1}limit(t,e){t>e?this.limit(e,t):(this._min=t,this._max=e,this._checkLimit())}setTo(t){this._value=t,this._targetValue=t,this._counter=1}_checkLimit(){void 0!==this._min&&this._targetValue<this._min&&(this._targetValue=this._min),void 0!==this._max&&this._targetValue>this._max&&(this._targetValue=this._max)}destroy(){Sn(this._efIndex)}set value(t){this._startValue=this._value,this._targetValue=t,this._checkLimit(),this._counter=0}get value(){if(this._needUpdate){const t=function(t){switch(t){default:case"linear":return Ln.Linear.None;case"expIn":return Ln.Exponential.In;case"expOut":return Ln.Exponential.Out;case"expInOut":return Ln.Exponential.InOut;case"cubicIn":return Ln.Cubic.In;case"cubicOut":return Ln.Cubic.Out;case"cubicInOut":return Ln.Cubic.InOut;case"quarticIn":return Ln.Quartic.In;case"quarticOut":return Ln.Quartic.Out;case"quarticInOut":return Ln.Quartic.InOut;case"quinticIn":return Ln.Quintic.In;case"quinticOut":return Ln.Quintic.Out;case"quinticInOut":return Ln.Quintic.InOut;case"sinusoidalIn":return Ln.Sinusoidal.In;case"sinusoidalOut":return Ln.Sinusoidal.Out;case"sinusoidalInOut":return Ln.Sinusoidal.InOut;case"circularIn":return Ln.Circular.In;case"circularOut":return Ln.Circular.Out;case"circularInOut":return Ln.Circular.InOut;case"elasticIn":return Ln.Elastic.In;case"elasticOut":return Ln.Elastic.Out;case"elasticInOut":return Ln.Elastic.InOut;case"backIn":return Ln.Back.In;case"backOut":return Ln.Back.Out;case"backInOut":return Ln.Back.InOut;case"bounceIn":return Ln.Bounce.in;case"bounceOut":return Ln.Bounce.out;case"bounceInOut":return Ln.Bounce.inOut}}(this.easing)(this._counter);this._value=this._startValue+t*(this._targetValue-this._startValue),this._needUpdate=!1}return this._value}get targetValue(){return this._targetValue}},t.WebGLConst=Rr,t.WebGLNumber=Ar,t.checkWebGL2=fr,t.getColorTexture=Vr,t.loadBinary=tn,t.loadDds=t=>new Promise(((e,r)=>{tn(t,!0).then((t=>{e(hn(t))}),(t=>{r(t)}))})),t.loadHdr=t=>new Promise(((e,r)=>{tn(t,!0).then((t=>{e(en(t))}),(t=>{r(t)}))})),t.loadObj=t=>new Promise(((e,r)=>{tn(t,!1).then((t=>{e(_n(t))}),(t=>{r(t)}))})),t.parseDds=hn,t.parseHdr=en,t.parseObj=_n,Object.defineProperty(t,"__esModule",{value:!0})}));
