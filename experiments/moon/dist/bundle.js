/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var t={427:t=>{"use strict";t.exports=function(){try{return!!new Blob}catch(t){return!1}}()},42:(t,e,n)=>{"use strict";var o=n(187).EventEmitter;function i(){o.call(this),this.setMaxListeners(20)}i.prototype=Object.create(o.prototype),i.prototype.constructor=i,i.prototype.off=function(t,e){return e?this.removeListener(t,e):t?this.removeAllListeners(t):this.removeAllListeners()},t.exports=i},622:(t,e,n)=>{"use strict";var o=n(42),i=n(388),r=0;t.exports=function t(e){var n,s={},a=[],u=[],l=0,h=0,c={},d=function(o){return Array.isArray(o)?(o.forEach(d),n):((r=o.assets&&Array.isArray(o.assets)?t(f(o,e)):i(f(o,e))).once("destroy",y),u.push(r),c[r.id]=r,n);var r},p=function(t){return arguments.length?s[t]?s[t]:c[t]:a},f=function(t,e){return"string"==typeof t&&(t={url:t}),void 0===t.isTouchLocked&&(t.isTouchLocked=e.isTouchLocked),void 0===t.blob&&(t.blob=e.blob),void 0===t.basePath&&(t.basePath=e.basePath),t.id=t.id||t.url||String(++r),t.type=t.type||(n=t.url)&&n.split("?")[0].split(".").pop().toLowerCase(),t.crossOrigin=t.crossOrigin||e.crossOrigin,t.webAudioContext=t.webAudioContext||e.webAudioContext,t.log=e.log,t;var n},v=function(t){var e=l+t;n.emit("progress",e/h)},m=function(t,e,o){Array.isArray(t)&&(t={id:e,file:t,type:o}),l++,n.emit("progress",l/h),s[t.id]=t.file,a.push(t),n.emit("childcomplete",t),E()},_=function(t){h--,n.listeners("error").length?n.emit("error",t):console.error(t),E()},y=function(t){c[t]=null,delete c[t],s[t]=null,delete s[t],a.some((function(e,n){if(e.id===t)return a.splice(n,1),!0}))},E=function(){l>=h&&n.emit("complete",a,s,e.id,"group")};return n=Object.create(o.prototype,{_events:{value:{}},id:{get:function(){return e.id}},add:{value:d},start:{value:function(){return h=u.length,u.forEach((function(t){t.on("progress",v).once("complete",m).once("error",_).start()})),u=[],n}},get:{value:p},find:{value:function(t){if(p(t))return p(t);var e=null;return Object.keys(c).some((function(n){return!!(e=c[n].find&&c[n].find(t))})),e}},getLoader:{value:function(t){return c[t]}},loaded:{get:function(){return l>=h}},file:{get:function(){return a}},destroy:{value:function(){for(;u.length;)u.pop().destroy();return n.off("error"),n.off("progress"),n.off("complete"),a=[],s={},e.webAudioContext=null,h=0,l=0,Object.keys(c).forEach((function(t){c[t].destroy()})),c={},n.emit("destroy",n.id),n}}}),e=f(e||{},{basePath:"",blob:!1,touchLocked:!1,crossOrigin:null,webAudioContext:null,log:!1}),Array.isArray(e.assets)&&d(e.assets),n}},370:(t,e,n)=>{"use strict";var o=n(622);o.stats=n(795),t.exports=o},388:(t,e,n)=>{"use strict";var o=n(42),i=n(427),r=n(795);t.exports=function(t){var e,n,s,a,u,l,h=t.id,c=t.basePath||"",d=t.url,p=t.type,f=t.crossOrigin,v=t.isTouchLocked,m=t.blob&&i,_=t.webAudioContext,y=t.log,E=function(t){t&&(l={id:h,file:t,type:p},e.emit("progress",1),e.emit("complete",l,h,p),N())},g=function(t,e){n=e||x,(s=new XMLHttpRequest).open("GET",c+d,!0),s.responseType=t,s.addEventListener("progress",b),s.addEventListener("load",n),s.addEventListener("error",L),s.send()},b=function(t){t.lengthComputable&&e.emit("progress",t.loaded/t.total)},x=function(){w()&&E(s.response)},w=function(){return s&&s.status<400?(r.update(s,a,d,y),!0):(L(s&&s.statusText),!1)},A=function(){s=new Image,f&&(s.crossOrigin="anonymous"),s.addEventListener("error",L,!1),s.addEventListener("load",T,!1),s.src=c+d},T=function(t){window.clearTimeout(u),t||!s.error&&s.readyState?E(s):L()},R=function(){g("blob",(function(){w()&&((s=new Image).addEventListener("error",L,!1),s.addEventListener("load",M,!1),s.src=window.URL.createObjectURL(s.response))}))},M=function(){window.URL.revokeObjectURL(s.src),E(s)},S=function(){g("arraybuffer",(function(){w()&&_.decodeAudioData(s.response,(function(t){s=null,E(t)}),(function(t){L(t)}))}))},C=function(t){s=document.createElement(t),v||(window.clearTimeout(u),u=window.setTimeout(T,2e3),s.addEventListener("canplaythrough",T,!1)),s.addEventListener("error",L,!1),s.preload="auto",s.src=c+d,s.load(),v&&E(s)},L=function(t){window.clearTimeout(u);var n=t;s&&s.tagName&&s.error?n="MediaError: "+["","ABORTED","NETWORK","DECODE","SRC_NOT_SUPPORTED"][s.error.code]+" "+s.src:s&&s.statusText?n=s.statusText:t&&t.message?n=t.message:t&&t.type&&(n=t.type),e.emit("error",'Error loading "'+c+d+'" '+n),P()},N=function(){e.off("error"),e.off("progress"),e.off("complete"),s&&(s.removeEventListener("progress",b),s.removeEventListener("load",n),s.removeEventListener("error",L),s.removeEventListener("load",T),s.removeEventListener("canplaythrough",T),s.removeEventListener("load",M))},P=function(){N(),s&&s.abort&&s.readyState<4&&s.abort(),s=null,_=null,l=null,window.clearTimeout(u),e.emit("destroy",h)};return e=Object.create(o.prototype,{_events:{value:{}},id:{value:t.id},start:{value:function(){switch(a=Date.now(),p){case"json":g("json",(function(){if(w()){var t=s.response;"string"==typeof t&&(t=JSON.parse(t)),E(t)}}));break;case"jpg":case"png":case"gif":case"webp":case"svg":m?R():A();break;case"mp3":case"ogg":case"opus":case"wav":case"m4a":_?S():C("audio");break;case"ogv":case"mp4":case"webm":case"hls":m?g("blob"):C("video");break;case"bin":case"binary":g("arraybuffer");break;case"txt":case"text":g("text");break;default:throw"AssetsLoader ERROR: Unknown type for file with URL: "+c+d+" ("+p+")"}}},loaded:{get:function(){return!!l}},file:{get:function(){return l}},destroy:{value:P}})}},795:t=>{"use strict";t.exports={mbs:0,secs:0,update:function(t,e,n,o){var i,r=t.getAllResponseHeaders();if(r){var s=r.match(/content-length: (\d+)/i);s&&s.length&&(i=s[1])}if(i){var a=(i=parseInt(i,10))/1024/1024,u=(Date.now()-e)/1e3;this.secs+=u,this.mbs+=a,o&&this.log(n,a,u)}else o&&console.warn.call(console,"Can't get Content-Length:",n)},log:function(t,e,n){if(t){var o="File loaded: "+t.substr(t.lastIndexOf("/")+1)+" size:"+e.toFixed(2)+"mb time:"+n.toFixed(2)+"s speed:"+(e/n).toFixed(2)+"mbps";console.log.call(console,o)}var i="Total loaded: "+this.mbs.toFixed(2)+"mb time:"+this.secs.toFixed(2)+"s speed:"+this.getMbps().toFixed(2)+"mbps";console.log.call(console,i)},getMbps:function(){return this.mbs/this.secs}}},125:t=>{t.exports=function t(e,n,o){function i(s,a){if(!n[s]){if(!e[s]){if(r)return r(s,!0);throw new Error("Cannot find module '"+s+"'")}var u=n[s]={exports:{}};e[s][0].call(u.exports,(function(t){return i(e[s][1][t]||t)}),u,u.exports,t,e,n,o)}return n[s].exports}for(var r=void 0,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(t,e,n){e.exports={name:"cannon",version:"0.6.2",description:"A lightweight 3D physics engine written in JavaScript.",homepage:"https://github.com/schteppe/cannon.js",author:"Stefan Hedman <schteppe@gmail.com> (http://steffe.se)",keywords:["cannon.js","cannon","physics","engine","3d"],main:"./build/cannon.js",engines:{node:"*"},repository:{type:"git",url:"https://github.com/schteppe/cannon.js.git"},bugs:{url:"https://github.com/schteppe/cannon.js/issues"},licenses:[{type:"MIT"}],devDependencies:{jshint:"latest","uglify-js":"latest",nodeunit:"^0.9.0",grunt:"~0.4.0","grunt-contrib-jshint":"~0.1.1","grunt-contrib-nodeunit":"^0.4.1","grunt-contrib-concat":"~0.1.3","grunt-contrib-uglify":"^0.5.1","grunt-browserify":"^2.1.4","grunt-contrib-yuidoc":"^0.5.2",browserify:"*"},dependencies:{}}},{}],2:[function(t,e,n){e.exports={version:t("../package.json").version,AABB:t("./collision/AABB"),ArrayCollisionMatrix:t("./collision/ArrayCollisionMatrix"),Body:t("./objects/Body"),Box:t("./shapes/Box"),Broadphase:t("./collision/Broadphase"),Constraint:t("./constraints/Constraint"),ContactEquation:t("./equations/ContactEquation"),Narrowphase:t("./world/Narrowphase"),ConeTwistConstraint:t("./constraints/ConeTwistConstraint"),ContactMaterial:t("./material/ContactMaterial"),ConvexPolyhedron:t("./shapes/ConvexPolyhedron"),Cylinder:t("./shapes/Cylinder"),DistanceConstraint:t("./constraints/DistanceConstraint"),Equation:t("./equations/Equation"),EventTarget:t("./utils/EventTarget"),FrictionEquation:t("./equations/FrictionEquation"),GSSolver:t("./solver/GSSolver"),GridBroadphase:t("./collision/GridBroadphase"),Heightfield:t("./shapes/Heightfield"),HingeConstraint:t("./constraints/HingeConstraint"),LockConstraint:t("./constraints/LockConstraint"),Mat3:t("./math/Mat3"),Material:t("./material/Material"),NaiveBroadphase:t("./collision/NaiveBroadphase"),ObjectCollisionMatrix:t("./collision/ObjectCollisionMatrix"),Pool:t("./utils/Pool"),Particle:t("./shapes/Particle"),Plane:t("./shapes/Plane"),PointToPointConstraint:t("./constraints/PointToPointConstraint"),Quaternion:t("./math/Quaternion"),Ray:t("./collision/Ray"),RaycastVehicle:t("./objects/RaycastVehicle"),RaycastResult:t("./collision/RaycastResult"),RigidVehicle:t("./objects/RigidVehicle"),RotationalEquation:t("./equations/RotationalEquation"),RotationalMotorEquation:t("./equations/RotationalMotorEquation"),SAPBroadphase:t("./collision/SAPBroadphase"),SPHSystem:t("./objects/SPHSystem"),Shape:t("./shapes/Shape"),Solver:t("./solver/Solver"),Sphere:t("./shapes/Sphere"),SplitSolver:t("./solver/SplitSolver"),Spring:t("./objects/Spring"),Trimesh:t("./shapes/Trimesh"),Vec3:t("./math/Vec3"),Vec3Pool:t("./utils/Vec3Pool"),World:t("./world/World")}},{"../package.json":1,"./collision/AABB":3,"./collision/ArrayCollisionMatrix":4,"./collision/Broadphase":5,"./collision/GridBroadphase":6,"./collision/NaiveBroadphase":7,"./collision/ObjectCollisionMatrix":8,"./collision/Ray":9,"./collision/RaycastResult":10,"./collision/SAPBroadphase":11,"./constraints/ConeTwistConstraint":12,"./constraints/Constraint":13,"./constraints/DistanceConstraint":14,"./constraints/HingeConstraint":15,"./constraints/LockConstraint":16,"./constraints/PointToPointConstraint":17,"./equations/ContactEquation":19,"./equations/Equation":20,"./equations/FrictionEquation":21,"./equations/RotationalEquation":22,"./equations/RotationalMotorEquation":23,"./material/ContactMaterial":24,"./material/Material":25,"./math/Mat3":27,"./math/Quaternion":28,"./math/Vec3":30,"./objects/Body":31,"./objects/RaycastVehicle":32,"./objects/RigidVehicle":33,"./objects/SPHSystem":34,"./objects/Spring":35,"./shapes/Box":37,"./shapes/ConvexPolyhedron":38,"./shapes/Cylinder":39,"./shapes/Heightfield":40,"./shapes/Particle":41,"./shapes/Plane":42,"./shapes/Shape":43,"./shapes/Sphere":44,"./shapes/Trimesh":45,"./solver/GSSolver":46,"./solver/Solver":47,"./solver/SplitSolver":48,"./utils/EventTarget":49,"./utils/Pool":51,"./utils/Vec3Pool":54,"./world/Narrowphase":55,"./world/World":56}],3:[function(t,e,n){var o=t("../math/Vec3");function i(t){t=t||{},this.lowerBound=new o,t.lowerBound&&this.lowerBound.copy(t.lowerBound),this.upperBound=new o,t.upperBound&&this.upperBound.copy(t.upperBound)}t("../utils/Utils"),e.exports=i;var r=new o;i.prototype.setFromPoints=function(t,e,n,o){var i=this.lowerBound,s=this.upperBound,a=n;i.copy(t[0]),a&&a.vmult(i,i),s.copy(i);for(var u=1;u<t.length;u++){var l=t[u];a&&(a.vmult(l,r),l=r),l.x>s.x&&(s.x=l.x),l.x<i.x&&(i.x=l.x),l.y>s.y&&(s.y=l.y),l.y<i.y&&(i.y=l.y),l.z>s.z&&(s.z=l.z),l.z<i.z&&(i.z=l.z)}return e&&(e.vadd(i,i),e.vadd(s,s)),o&&(i.x-=o,i.y-=o,i.z-=o,s.x+=o,s.y+=o,s.z+=o),this},i.prototype.copy=function(t){return this.lowerBound.copy(t.lowerBound),this.upperBound.copy(t.upperBound),this},i.prototype.clone=function(){return(new i).copy(this)},i.prototype.extend=function(t){var e=t.lowerBound.x;this.lowerBound.x>e&&(this.lowerBound.x=e);var n=t.upperBound.x;this.upperBound.x<n&&(this.upperBound.x=n),e=t.lowerBound.y,this.lowerBound.y>e&&(this.lowerBound.y=e),n=t.upperBound.y,this.upperBound.y<n&&(this.upperBound.y=n),e=t.lowerBound.z,this.lowerBound.z>e&&(this.lowerBound.z=e),n=t.upperBound.z,this.upperBound.z<n&&(this.upperBound.z=n)},i.prototype.overlaps=function(t){var e=this.lowerBound,n=this.upperBound,o=t.lowerBound,i=t.upperBound;return(o.x<=n.x&&n.x<=i.x||e.x<=i.x&&i.x<=n.x)&&(o.y<=n.y&&n.y<=i.y||e.y<=i.y&&i.y<=n.y)&&(o.z<=n.z&&n.z<=i.z||e.z<=i.z&&i.z<=n.z)},i.prototype.contains=function(t){var e=this.lowerBound,n=this.upperBound,o=t.lowerBound,i=t.upperBound;return e.x<=o.x&&n.x>=i.x&&e.y<=o.y&&n.y>=i.y&&e.z<=o.z&&n.z>=i.z},i.prototype.getCorners=function(t,e,n,o,i,r,s,a){var u=this.lowerBound,l=this.upperBound;t.copy(u),e.set(l.x,u.y,u.z),n.set(l.x,l.y,u.z),o.set(u.x,l.y,l.z),i.set(l.x,u.y,u.z),r.set(u.x,l.y,u.z),s.set(u.x,u.y,l.z),a.copy(l)};var s=[new o,new o,new o,new o,new o,new o,new o,new o];i.prototype.toLocalFrame=function(t,e){var n=s,o=n[0],i=n[1],r=n[2],a=n[3],u=n[4],l=n[5],h=n[6],c=n[7];this.getCorners(o,i,r,a,u,l,h,c);for(var d=0;8!==d;d++){var p=n[d];t.pointToLocal(p,p)}return e.setFromPoints(n)},i.prototype.toWorldFrame=function(t,e){var n=s,o=n[0],i=n[1],r=n[2],a=n[3],u=n[4],l=n[5],h=n[6],c=n[7];this.getCorners(o,i,r,a,u,l,h,c);for(var d=0;8!==d;d++){var p=n[d];t.pointToWorld(p,p)}return e.setFromPoints(n)}},{"../math/Vec3":30,"../utils/Utils":53}],4:[function(t,e,n){function o(){this.matrix=[]}e.exports=o,o.prototype.get=function(t,e){if(t=t.index,(e=e.index)>t){var n=e;e=t,t=n}return this.matrix[(t*(t+1)>>1)+e-1]},o.prototype.set=function(t,e,n){if(t=t.index,(e=e.index)>t){var o=e;e=t,t=o}this.matrix[(t*(t+1)>>1)+e-1]=n?1:0},o.prototype.reset=function(){for(var t=0,e=this.matrix.length;t!==e;t++)this.matrix[t]=0},o.prototype.setNumObjects=function(t){this.matrix.length=t*(t-1)>>1}},{}],5:[function(t,e,n){var o=t("../objects/Body"),i=t("../math/Vec3"),r=t("../math/Quaternion");function s(){this.world=null,this.useBoundingBoxes=!1,this.dirty=!0}t("../shapes/Shape"),t("../shapes/Plane"),e.exports=s,s.prototype.collisionPairs=function(t,e,n){throw new Error("collisionPairs not implemented for this BroadPhase class!")};var a=o.STATIC|o.KINEMATIC;s.prototype.needBroadphaseCollision=function(t,e){return 0!=(t.collisionFilterGroup&e.collisionFilterMask)&&0!=(e.collisionFilterGroup&t.collisionFilterMask)&&(0==(t.type&a)&&t.sleepState!==o.SLEEPING||0==(e.type&a)&&e.sleepState!==o.SLEEPING)},s.prototype.intersectionTest=function(t,e,n,o){this.useBoundingBoxes?this.doBoundingBoxBroadphase(t,e,n,o):this.doBoundingSphereBroadphase(t,e,n,o)};var u=new i;new i,new r,new i,s.prototype.doBoundingSphereBroadphase=function(t,e,n,o){var i=u;e.position.vsub(t.position,i);var r=Math.pow(t.boundingRadius+e.boundingRadius,2);i.norm2()<r&&(n.push(t),o.push(e))},s.prototype.doBoundingBoxBroadphase=function(t,e,n,o){t.aabbNeedsUpdate&&t.computeAABB(),e.aabbNeedsUpdate&&e.computeAABB(),t.aabb.overlaps(e.aabb)&&(n.push(t),o.push(e))};var l={keys:[]},h=[],c=[];s.prototype.makePairsUnique=function(t,e){for(var n=l,o=h,i=c,r=t.length,s=0;s!==r;s++)o[s]=t[s],i[s]=e[s];for(t.length=0,e.length=0,s=0;s!==r;s++){var a=o[s].id,u=i[s].id;n[d=a<u?a+","+u:u+","+a]=s,n.keys.push(d)}for(s=0;s!==n.keys.length;s++){var d=n.keys.pop(),p=n[d];t.push(o[p]),e.push(i[p]),delete n[d]}},s.prototype.setWorld=function(t){};var d=new i;s.boundingSphereCheck=function(t,e){var n=d;return t.position.vsub(e.position,n),Math.pow(t.shape.boundingSphereRadius+e.shape.boundingSphereRadius,2)>n.norm2()},s.prototype.aabbQuery=function(t,e,n){return console.warn(".aabbQuery is not implemented in this Broadphase subclass."),[]}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Plane":42,"../shapes/Shape":43}],6:[function(t,e,n){e.exports=s;var o=t("./Broadphase"),i=t("../math/Vec3"),r=t("../shapes/Shape");function s(t,e,n,r,s){o.apply(this),this.nx=n||10,this.ny=r||10,this.nz=s||10,this.aabbMin=t||new i(100,100,100),this.aabbMax=e||new i(-100,-100,-100);var a=this.nx*this.ny*this.nz;if(a<=0)throw"GridBroadphase: Each dimension's n must be >0";this.bins=[],this.binLengths=[],this.bins.length=a,this.binLengths.length=a;for(var u=0;u<a;u++)this.bins[u]=[],this.binLengths[u]=0}s.prototype=new o,s.prototype.constructor=s;var a=new i;new i,s.prototype.collisionPairs=function(t,e,n){for(var o=t.numObjects(),i=t.bodies,s=this.aabbMax,u=this.aabbMin,l=this.nx,h=this.ny,c=this.nz,d=h*c,p=c,f=s.x,v=s.y,m=s.z,_=u.x,y=u.y,E=u.z,g=l/(f-_),b=h/(v-y),x=c/(m-E),w=(f-_)/l,A=(v-y)/h,T=(m-E)/c,R=.5*Math.sqrt(w*w+A*A+T*T),M=r.types,S=M.SPHERE,C=M.PLANE,L=(M.BOX,M.COMPOUND,M.CONVEXPOLYHEDRON,this.bins),N=this.binLengths,P=this.bins.length,I=0;I!==P;I++)N[I]=0;var B=Math.ceil;function F(t,e,n,o,i,r,s){var a=(t-_)*g|0,u=(e-y)*b|0,f=(n-E)*x|0,v=B((o-_)*g),m=B((i-y)*b),w=B((r-E)*x);a<0?a=0:a>=l&&(a=l-1),u<0?u=0:u>=h&&(u=h-1),f<0?f=0:f>=c&&(f=c-1),v<0?v=0:v>=l&&(v=l-1),m<0?m=0:m>=h&&(m=h-1),w<0?w=0:w>=c&&(w=c-1),u*=p,f*=1,v*=d,m*=p,w*=1;for(var A=a*=d;A<=v;A+=d)for(var T=u;T<=m;T+=p)for(var R=f;R<=w;R+=1){var M=A+T+R;L[M][N[M]++]=s}}for(u=Math.min,s=Math.max,I=0;I!==o;I++){var O=(et=i[I]).shape;switch(O.type){case S:var U=et.position.x,V=et.position.y,D=et.position.z,q=O.radius;F(U-q,V-q,D-q,U+q,V+q,D+q,et);break;case C:O.worldNormalNeedsUpdate&&O.computeWorldNormal(et.quaternion);var z=O.worldNormal,k=_+.5*w-et.position.x,j=y+.5*A-et.position.y,G=E+.5*T-et.position.z,H=a;H.set(k,j,G);for(var W=0,X=0;W!==l;W++,X+=d,H.y=j,H.x+=w)for(var Y=0,K=0;Y!==h;Y++,K+=p,H.z=G,H.y+=A)for(var Z=0,Q=0;Z!==c;Z++,Q+=1,H.z+=T)if(H.dot(z)<R){var J=X+K+Q;L[J][N[J]++]=et}break;default:et.aabbNeedsUpdate&&et.computeAABB(),F(et.aabb.lowerBound.x,et.aabb.lowerBound.y,et.aabb.lowerBound.z,et.aabb.upperBound.x,et.aabb.upperBound.y,et.aabb.upperBound.z,et)}}for(I=0;I!==P;I++){var $=N[I];if($>1){var tt=L[I];for(W=0;W!==$;W++){var et=tt[W];for(Y=0;Y!==W;Y++){var nt=tt[Y];this.needBroadphaseCollision(et,nt)&&this.intersectionTest(et,nt,e,n)}}}}this.makePairsUnique(e,n)}},{"../math/Vec3":30,"../shapes/Shape":43,"./Broadphase":5}],7:[function(t,e,n){e.exports=r;var o=t("./Broadphase"),i=t("./AABB");function r(){o.apply(this)}r.prototype=new o,r.prototype.constructor=r,r.prototype.collisionPairs=function(t,e,n){var o,i,r,s,a=t.bodies,u=a.length;for(o=0;o!==u;o++)for(i=0;i!==o;i++)r=a[o],s=a[i],this.needBroadphaseCollision(r,s)&&this.intersectionTest(r,s,e,n)},new i,r.prototype.aabbQuery=function(t,e,n){n=n||[];for(var o=0;o<t.bodies.length;o++){var i=t.bodies[o];i.aabbNeedsUpdate&&i.computeAABB(),i.aabb.overlaps(e)&&n.push(i)}return n}},{"./AABB":3,"./Broadphase":5}],8:[function(t,e,n){function o(){this.matrix={}}e.exports=o,o.prototype.get=function(t,e){if(t=t.id,(e=e.id)>t){var n=e;e=t,t=n}return t+"-"+e in this.matrix},o.prototype.set=function(t,e,n){if(t=t.id,(e=e.id)>t){var o=e;e=t,t=o}n?this.matrix[t+"-"+e]=!0:delete this.matrix[t+"-"+e]},o.prototype.reset=function(){this.matrix={}},o.prototype.setNumObjects=function(t){}},{}],9:[function(t,e,n){e.exports=l;var o=t("../math/Vec3"),i=t("../math/Quaternion"),r=t("../math/Transform"),s=(t("../shapes/ConvexPolyhedron"),t("../shapes/Box"),t("../collision/RaycastResult")),a=t("../shapes/Shape"),u=t("../collision/AABB");function l(t,e){this.from=t?t.clone():new o,this.to=e?e.clone():new o,this._direction=new o,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=l.ANY,this.result=new s,this.hasHit=!1,this.callback=function(t){}}l.prototype.constructor=l,l.CLOSEST=1,l.ANY=2,l.ALL=4;var h=new u,c=[];l.prototype.intersectWorld=function(t,e){return this.mode=e.mode||l.ANY,this.result=e.result||new s,this.skipBackfaces=!!e.skipBackfaces,this.collisionFilterMask=void 0!==e.collisionFilterMask?e.collisionFilterMask:-1,this.collisionFilterGroup=void 0!==e.collisionFilterGroup?e.collisionFilterGroup:-1,e.from&&this.from.copy(e.from),e.to&&this.to.copy(e.to),this.callback=e.callback||function(){},this.hasHit=!1,this.result.reset(),this._updateDirection(),this.getAABB(h),c.length=0,t.broadphase.aabbQuery(t,h,c),this.intersectBodies(c),this.hasHit};var d=new o,p=new o;function f(t,e,n,o){o.vsub(e,B),n.vsub(e,d),t.vsub(e,p);var i,r,s=B.dot(B),a=B.dot(d),u=B.dot(p),l=d.dot(d),h=d.dot(p);return(i=l*u-a*h)>=0&&(r=s*h-a*u)>=0&&i+r<s*l-a*a}l.pointInTriangle=f;var v=new o,m=new i;l.prototype.intersectBody=function(t,e){e&&(this.result=e,this._updateDirection());var n=this.checkCollisionResponse;if((!n||t.collisionResponse)&&0!=(this.collisionFilterGroup&t.collisionFilterMask)&&0!=(t.collisionFilterGroup&this.collisionFilterMask))for(var o=v,i=m,r=0,s=t.shapes.length;r<s;r++){var a=t.shapes[r];if((!n||a.collisionResponse)&&(t.quaternion.mult(t.shapeOrientations[r],i),t.quaternion.vmult(t.shapeOffsets[r],o),o.vadd(t.position,o),this.intersectShape(a,i,o,t),this.result._shouldStop))break}},l.prototype.intersectBodies=function(t,e){e&&(this.result=e,this._updateDirection());for(var n=0,o=t.length;!this.result._shouldStop&&n<o;n++)this.intersectBody(t[n])},l.prototype._updateDirection=function(){this.to.vsub(this.from,this._direction),this._direction.normalize()},l.prototype.intersectShape=function(t,e,n,o){if(!(function(t,e,n){n.vsub(t,B);var o=B.dot(e);return e.mult(o,F),F.vadd(t,F),n.distanceTo(F)}(this.from,this._direction,n)>t.boundingSphereRadius)){var i=this[t.type];i&&i.call(this,t,e,n,o)}},new o,new o;var _=new o,y=new o,E=new o,g=new o;new o,new s,l.prototype.intersectBox=function(t,e,n,o){return this.intersectConvex(t.convexPolyhedronRepresentation,e,n,o)},l.prototype[a.types.BOX]=l.prototype.intersectBox,l.prototype.intersectPlane=function(t,e,n,i){var r=this.from,s=this.to,a=this._direction,u=new o(0,0,1);e.vmult(u,u);var l=new o;r.vsub(n,l);var h=l.dot(u);if(s.vsub(n,l),!(h*l.dot(u)>0||r.distanceTo(s)<h)){var c=u.dot(a);if(!(Math.abs(c)<this.precision)){var d=new o,p=new o,f=new o;r.vsub(n,d);var v=-u.dot(d)/c;a.scale(v,p),r.vadd(p,f),this.reportIntersection(u,f,t,i,-1)}}},l.prototype[a.types.PLANE]=l.prototype.intersectPlane,l.prototype.getAABB=function(t){var e=this.to,n=this.from;t.lowerBound.x=Math.min(e.x,n.x),t.lowerBound.y=Math.min(e.y,n.y),t.lowerBound.z=Math.min(e.z,n.z),t.upperBound.x=Math.max(e.x,n.x),t.upperBound.y=Math.max(e.y,n.y),t.upperBound.z=Math.max(e.z,n.z)};var b={faceList:[0]};l.prototype.intersectHeightfield=function(t,e,n,i){t.data,t.elementSize;var s=new o,a=new l(this.from,this.to);r.pointToLocalFrame(n,e,a.from,a.from),r.pointToLocalFrame(n,e,a.to,a.to);var u=[],h=null,c=null,d=null,p=null,f=t.getIndexOfPosition(a.from.x,a.from.y,u,!1);if(f&&(h=u[0],c=u[1],d=u[0],p=u[1]),(f=t.getIndexOfPosition(a.to.x,a.to.y,u,!1))&&((null===h||u[0]<h)&&(h=u[0]),(null===d||u[0]>d)&&(d=u[0]),(null===c||u[1]<c)&&(c=u[1]),(null===p||u[1]>p)&&(p=u[1])),null!==h){var v=[];t.getRectMinMax(h,c,d,p,v);for(var m=h;m<=d;m++)for(var _=c;_<=p;_++){if(this.result._shouldStop)return;if(t.getConvexTrianglePillar(m,_,!1),r.pointToWorldFrame(n,e,t.pillarOffset,s),this.intersectConvex(t.pillarConvex,e,s,i,b),this.result._shouldStop)return;t.getConvexTrianglePillar(m,_,!0),r.pointToWorldFrame(n,e,t.pillarOffset,s),this.intersectConvex(t.pillarConvex,e,s,i,b)}}},l.prototype[a.types.HEIGHTFIELD]=l.prototype.intersectHeightfield;var x=new o,w=new o;l.prototype.intersectSphere=function(t,e,n,o){var i=this.from,r=this.to,s=t.radius,a=Math.pow(r.x-i.x,2)+Math.pow(r.y-i.y,2)+Math.pow(r.z-i.z,2),u=2*((r.x-i.x)*(i.x-n.x)+(r.y-i.y)*(i.y-n.y)+(r.z-i.z)*(i.z-n.z)),l=Math.pow(i.x-n.x,2)+Math.pow(i.y-n.y,2)+Math.pow(i.z-n.z,2)-Math.pow(s,2),h=Math.pow(u,2)-4*a*l,c=x,d=w;if(!(h<0))if(0===h)i.lerp(r,h,c),c.vsub(n,d),d.normalize(),this.reportIntersection(d,c,t,o,-1);else{var p=(-u-Math.sqrt(h))/(2*a),f=(-u+Math.sqrt(h))/(2*a);if(p>=0&&p<=1&&(i.lerp(r,p,c),c.vsub(n,d),d.normalize(),this.reportIntersection(d,c,t,o,-1)),this.result._shouldStop)return;f>=0&&f<=1&&(i.lerp(r,f,c),c.vsub(n,d),d.normalize(),this.reportIntersection(d,c,t,o,-1))}},l.prototype[a.types.SPHERE]=l.prototype.intersectSphere;var A=new o,T=(new o,new o,new o);l.prototype.intersectConvex=function(t,e,n,o,i){for(var r=A,s=T,a=i&&i.faceList||null,u=t.faces,l=t.vertices,h=t.faceNormals,c=this._direction,d=this.from,p=this.to,v=d.distanceTo(p),m=a?a.length:u.length,b=this.result,x=0;!b._shouldStop&&x<m;x++){var w=a?a[x]:x,R=u[w],M=h[w],S=e,C=n;s.copy(l[R[0]]),S.vmult(s,s),s.vadd(C,s),s.vsub(d,s),S.vmult(M,r);var L=c.dot(r);if(!(Math.abs(L)<this.precision)){var N=r.dot(s)/L;if(!(N<0)){c.mult(N,_),_.vadd(d,_),y.copy(l[R[0]]),S.vmult(y,y),C.vadd(y,y);for(var P=1;!b._shouldStop&&P<R.length-1;P++){E.copy(l[R[P]]),g.copy(l[R[P+1]]),S.vmult(E,E),S.vmult(g,g),C.vadd(E,E),C.vadd(g,g);var I=_.distanceTo(d);!f(_,y,E,g)&&!f(_,E,y,g)||I>v||this.reportIntersection(r,_,t,o,w)}}}}},l.prototype[a.types.CONVEXPOLYHEDRON]=l.prototype.intersectConvex;var R=new o,M=new o,S=new o,C=new o,L=new o,N=new o,P=(new u,[]),I=new r;l.prototype.intersectTrimesh=function(t,e,n,o,i){var s=R,a=P,u=I,l=T,h=M,c=S,d=C,p=N,v=L,m=(i&&i.faceList,t.indices),b=(t.vertices,t.faceNormals,this.from),x=this.to,w=this._direction;u.position.copy(n),u.quaternion.copy(e),r.vectorToLocalFrame(n,e,w,h),r.pointToLocalFrame(n,e,b,c),r.pointToLocalFrame(n,e,x,d);var A=c.distanceSquared(d);t.tree.rayQuery(this,u,a);for(var B=0,F=a.length;!this.result._shouldStop&&B!==F;B++){var O=a[B];t.getNormal(O,s),t.getVertex(m[3*O],y),y.vsub(c,l);var U=h.dot(s),V=s.dot(l)/U;if(!(V<0)){h.scale(V,_),_.vadd(c,_),t.getVertex(m[3*O+1],E),t.getVertex(m[3*O+2],g);var D=_.distanceSquared(c);!f(_,E,y,g)&&!f(_,y,E,g)||D>A||(r.vectorToWorldFrame(e,s,v),r.pointToWorldFrame(n,e,_,p),this.reportIntersection(v,p,t,o,O))}}a.length=0},l.prototype[a.types.TRIMESH]=l.prototype.intersectTrimesh,l.prototype.reportIntersection=function(t,e,n,o,i){var r=this.from,s=this.to,a=r.distanceTo(e),u=this.result;if(!(this.skipBackfaces&&t.dot(this._direction)>0))switch(u.hitFaceIndex=void 0!==i?i:-1,this.mode){case l.ALL:this.hasHit=!0,u.set(r,s,t,e,n,o,a),u.hasHit=!0,this.callback(u);break;case l.CLOSEST:(a<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(r,s,t,e,n,o,a));break;case l.ANY:this.hasHit=!0,u.hasHit=!0,u.set(r,s,t,e,n,o,a),u._shouldStop=!0}};var B=new o,F=new o},{"../collision/AABB":3,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/Box":37,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43}],10:[function(t,e,n){var o=t("../math/Vec3");function i(){this.rayFromWorld=new o,this.rayToWorld=new o,this.hitNormalWorld=new o,this.hitPointWorld=new o,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1}e.exports=i,i.prototype.reset=function(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this._shouldStop=!1},i.prototype.abort=function(){this._shouldStop=!0},i.prototype.set=function(t,e,n,o,i,r,s){this.rayFromWorld.copy(t),this.rayToWorld.copy(e),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(o),this.shape=i,this.body=r,this.distance=s}},{"../math/Vec3":30}],11:[function(t,e,n){t("../shapes/Shape");var o=t("../collision/Broadphase");function i(t){o.apply(this),this.axisList=[],this.world=null,this.axisIndex=0;var e=this.axisList;this._addBodyHandler=function(t){e.push(t.body)},this._removeBodyHandler=function(t){var n=e.indexOf(t.body);-1!==n&&e.splice(n,1)},t&&this.setWorld(t)}e.exports=i,i.prototype=new o,i.prototype.setWorld=function(t){this.axisList.length=0;for(var e=0;e<t.bodies.length;e++)this.axisList.push(t.bodies[e]);t.removeEventListener("addBody",this._addBodyHandler),t.removeEventListener("removeBody",this._removeBodyHandler),t.addEventListener("addBody",this._addBodyHandler),t.addEventListener("removeBody",this._removeBodyHandler),this.world=t,this.dirty=!0},i.insertionSortX=function(t){for(var e=1,n=t.length;e<n;e++){for(var o=t[e],i=e-1;i>=0&&!(t[i].aabb.lowerBound.x<=o.aabb.lowerBound.x);i--)t[i+1]=t[i];t[i+1]=o}return t},i.insertionSortY=function(t){for(var e=1,n=t.length;e<n;e++){for(var o=t[e],i=e-1;i>=0&&!(t[i].aabb.lowerBound.y<=o.aabb.lowerBound.y);i--)t[i+1]=t[i];t[i+1]=o}return t},i.insertionSortZ=function(t){for(var e=1,n=t.length;e<n;e++){for(var o=t[e],i=e-1;i>=0&&!(t[i].aabb.lowerBound.z<=o.aabb.lowerBound.z);i--)t[i+1]=t[i];t[i+1]=o}return t},i.prototype.collisionPairs=function(t,e,n){var o,r,s=this.axisList,a=s.length,u=this.axisIndex;for(this.dirty&&(this.sortList(),this.dirty=!1),o=0;o!==a;o++){var l=s[o];for(r=o+1;r<a;r++){var h=s[r];if(this.needBroadphaseCollision(l,h)){if(!i.checkBounds(l,h,u))break;this.intersectionTest(l,h,e,n)}}}},i.prototype.sortList=function(){for(var t=this.axisList,e=this.axisIndex,n=t.length,o=0;o!==n;o++){var r=t[o];r.aabbNeedsUpdate&&r.computeAABB()}0===e?i.insertionSortX(t):1===e?i.insertionSortY(t):2===e&&i.insertionSortZ(t)},i.checkBounds=function(t,e,n){var o,i;0===n?(o=t.position.x,i=e.position.x):1===n?(o=t.position.y,i=e.position.y):2===n&&(o=t.position.z,i=e.position.z);var r=t.boundingRadius;return i-e.boundingRadius<o+r},i.prototype.autoDetectAxis=function(){for(var t=0,e=0,n=0,o=0,i=0,r=0,s=this.axisList,a=s.length,u=1/a,l=0;l!==a;l++){var h=s[l],c=h.position.x;t+=c,e+=c*c;var d=h.position.y;n+=d,o+=d*d;var p=h.position.z;i+=p,r+=p*p}var f=e-t*t*u,v=o-n*n*u,m=r-i*i*u;this.axisIndex=f>v?f>m?0:2:v>m?1:2},i.prototype.aabbQuery=function(t,e,n){n=n||[],this.dirty&&(this.sortList(),this.dirty=!1);var o=this.axisIndex,i="x";1===o&&(i="y"),2===o&&(i="z");for(var r=this.axisList,s=(e.lowerBound[i],e.upperBound[i],0);s<r.length;s++){var a=r[s];a.aabbNeedsUpdate&&a.computeAABB(),a.aabb.overlaps(e)&&n.push(a)}return n}},{"../collision/Broadphase":5,"../shapes/Shape":43}],12:[function(t,e,n){e.exports=a,t("./Constraint");var o=t("./PointToPointConstraint"),i=t("../equations/ConeEquation"),r=t("../equations/RotationalEquation"),s=(t("../equations/ContactEquation"),t("../math/Vec3"));function a(t,e,n){var a=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,u=n.pivotA?n.pivotA.clone():new s,l=n.pivotB?n.pivotB.clone():new s;this.axisA=n.axisA?n.axisA.clone():new s,this.axisB=n.axisB?n.axisB.clone():new s,o.call(this,t,u,e,l,a),this.collideConnected=!!n.collideConnected,this.angle=void 0!==n.angle?n.angle:0;var h=this.coneEquation=new i(t,e,n),c=this.twistEquation=new r(t,e,n);this.twistAngle=void 0!==n.twistAngle?n.twistAngle:0,h.maxForce=0,h.minForce=-a,c.maxForce=0,c.minForce=-a,this.equations.push(h,c)}a.prototype=new o,a.constructor=a,new s,new s,a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.coneEquation,i=this.twistEquation;o.prototype.update.call(this),t.vectorToWorldFrame(this.axisA,n.axisA),e.vectorToWorldFrame(this.axisB,n.axisB),this.axisA.tangents(i.axisA,i.axisA),t.vectorToWorldFrame(i.axisA,i.axisA),this.axisB.tangents(i.axisB,i.axisB),e.vectorToWorldFrame(i.axisB,i.axisB),n.angle=this.angle,i.maxAngle=this.twistAngle}},{"../equations/ConeEquation":18,"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],13:[function(t,e,n){e.exports=i;var o=t("../utils/Utils");function i(t,e,n){n=o.defaults(n,{collideConnected:!0,wakeUpBodies:!0}),this.equations=[],this.bodyA=t,this.bodyB=e,this.id=i.idCounter++,this.collideConnected=n.collideConnected,n.wakeUpBodies&&(t&&t.wakeUp(),e&&e.wakeUp())}i.prototype.update=function(){throw new Error("method update() not implmemented in this Constraint subclass!")},i.prototype.enable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!0},i.prototype.disable=function(){for(var t=this.equations,e=0;e<t.length;e++)t[e].enabled=!1},i.idCounter=0},{"../utils/Utils":53}],14:[function(t,e,n){e.exports=r;var o=t("./Constraint"),i=t("../equations/ContactEquation");function r(t,e,n,r){o.call(this,t,e),void 0===n&&(n=t.position.distanceTo(e.position)),void 0===r&&(r=1e6),this.distance=n;var s=this.distanceEquation=new i(t,e);this.equations.push(s),s.minForce=-r,s.maxForce=r}r.prototype=new o,r.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.distanceEquation,o=.5*this.distance,i=n.ni;e.position.vsub(t.position,i),i.normalize(),i.mult(o,n.ri),i.mult(-o,n.rj)}},{"../equations/ContactEquation":19,"./Constraint":13}],15:[function(t,e,n){e.exports=a,t("./Constraint");var o=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),r=t("../equations/RotationalMotorEquation"),s=(t("../equations/ContactEquation"),t("../math/Vec3"));function a(t,e,n){var a=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,u=n.pivotA?n.pivotA.clone():new s,l=n.pivotB?n.pivotB.clone():new s;o.call(this,t,u,e,l,a),(this.axisA=n.axisA?n.axisA.clone():new s(1,0,0)).normalize(),(this.axisB=n.axisB?n.axisB.clone():new s(1,0,0)).normalize();var h=this.rotationalEquation1=new i(t,e,n),c=this.rotationalEquation2=new i(t,e,n),d=this.motorEquation=new r(t,e,a);d.enabled=!1,this.equations.push(h,c,d)}a.prototype=new o,a.constructor=a,a.prototype.enableMotor=function(){this.motorEquation.enabled=!0},a.prototype.disableMotor=function(){this.motorEquation.enabled=!1},a.prototype.setMotorSpeed=function(t){this.motorEquation.targetVelocity=t},a.prototype.setMotorMaxForce=function(t){this.motorEquation.maxForce=t,this.motorEquation.minForce=-t};var u=new s,l=new s;a.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.motorEquation,i=this.rotationalEquation1,r=this.rotationalEquation2,s=u,a=l,h=this.axisA,c=this.axisB;o.prototype.update.call(this),t.quaternion.vmult(h,s),e.quaternion.vmult(c,a),s.tangents(i.axisA,r.axisA),i.axisB.copy(a),r.axisB.copy(a),this.motorEquation.enabled&&(t.quaternion.vmult(this.axisA,n.axisA),e.quaternion.vmult(this.axisB,n.axisB))}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],16:[function(t,e,n){e.exports=s,t("./Constraint");var o=t("./PointToPointConstraint"),i=t("../equations/RotationalEquation"),r=(t("../equations/RotationalMotorEquation"),t("../equations/ContactEquation"),t("../math/Vec3"));function s(t,e,n){var s=void 0!==(n=n||{}).maxForce?n.maxForce:1e6,a=new r,u=new r,l=new r;t.position.vadd(e.position,l),l.scale(.5,l),e.pointToLocalFrame(l,u),t.pointToLocalFrame(l,a),o.call(this,t,a,e,u,s);var h=this.rotationalEquation1=new i(t,e,n),c=this.rotationalEquation2=new i(t,e,n),d=this.rotationalEquation3=new i(t,e,n);this.equations.push(h,c,d)}s.prototype=new o,s.constructor=s,new r,new r,s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=(this.motorEquation,this.rotationalEquation1),i=this.rotationalEquation2,s=this.rotationalEquation3;o.prototype.update.call(this),t.vectorToWorldFrame(r.UNIT_X,n.axisA),e.vectorToWorldFrame(r.UNIT_Y,n.axisB),t.vectorToWorldFrame(r.UNIT_Y,i.axisA),e.vectorToWorldFrame(r.UNIT_Z,i.axisB),t.vectorToWorldFrame(r.UNIT_Z,s.axisA),e.vectorToWorldFrame(r.UNIT_X,s.axisB)}},{"../equations/ContactEquation":19,"../equations/RotationalEquation":22,"../equations/RotationalMotorEquation":23,"../math/Vec3":30,"./Constraint":13,"./PointToPointConstraint":17}],17:[function(t,e,n){e.exports=s;var o=t("./Constraint"),i=t("../equations/ContactEquation"),r=t("../math/Vec3");function s(t,e,n,s,a){o.call(this,t,n),a=void 0!==a?a:1e6,this.pivotA=e?e.clone():new r,this.pivotB=s?s.clone():new r;var u=this.equationX=new i(t,n),l=this.equationY=new i(t,n),h=this.equationZ=new i(t,n);this.equations.push(u,l,h),u.minForce=l.minForce=h.minForce=-a,u.maxForce=l.maxForce=h.maxForce=a,u.ni.set(1,0,0),l.ni.set(0,1,0),h.ni.set(0,0,1)}s.prototype=new o,s.prototype.update=function(){var t=this.bodyA,e=this.bodyB,n=this.equationX,o=this.equationY,i=this.equationZ;t.quaternion.vmult(this.pivotA,n.ri),e.quaternion.vmult(this.pivotB,n.rj),o.ri.copy(n.ri),o.rj.copy(n.rj),i.ri.copy(n.ri),i.rj.copy(n.rj)}},{"../equations/ContactEquation":19,"../math/Vec3":30,"./Constraint":13}],18:[function(t,e,n){e.exports=r;var o=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function r(t,e,n){var r=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;i.call(this,t,e,-r,r),this.axisA=n.axisA?n.axisA.clone():new o(1,0,0),this.axisB=n.axisB?n.axisB.clone():new o(0,1,0),this.angle=void 0!==n.angle?n.angle:0}r.prototype=new i,r.prototype.constructor=r;var s=new o,a=new o;r.prototype.computeB=function(t){var e=this.a,n=this.b,o=this.axisA,i=this.axisB,r=s,u=a,l=this.jacobianElementA,h=this.jacobianElementB;return o.cross(i,r),i.cross(o,u),l.rotational.copy(u),h.rotational.copy(r),-(Math.cos(this.angle)-o.dot(i))*e-this.computeGW()*n-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],19:[function(t,e,n){e.exports=r;var o=t("./Equation"),i=t("../math/Vec3");function r(t,e,n){n=void 0!==n?n:1e6,o.call(this,t,e,0,n),this.restitution=0,this.ri=new i,this.rj=new i,this.ni=new i}t("../math/Mat3"),r.prototype=new o,r.prototype.constructor=r;var s=new i,a=new i,u=new i;r.prototype.computeB=function(t){var e=this.a,n=this.b,o=this.bi,i=this.bj,r=this.ri,l=this.rj,h=s,c=a,d=o.velocity,p=o.angularVelocity,f=(o.force,o.torque,i.velocity),v=i.angularVelocity,m=(i.force,i.torque,u),_=this.jacobianElementA,y=this.jacobianElementB,E=this.ni;r.cross(E,h),l.cross(E,c),E.negate(_.spatial),h.negate(_.rotational),y.spatial.copy(E),y.rotational.copy(c),m.copy(i.position),m.vadd(l,m),m.vsub(o.position,m),m.vsub(r,m);var g=E.dot(m),b=this.restitution+1;return-g*e-(b*f.dot(E)-b*d.dot(E)+v.dot(c)-p.dot(h))*n-t*this.computeGiMf()};var l=new i,h=new i,c=new i,d=new i,p=new i;r.prototype.getImpactVelocityAlongNormal=function(){var t=l,e=h,n=c,o=d,i=p;return this.bi.position.vadd(this.ri,n),this.bj.position.vadd(this.rj,o),this.bi.getVelocityAtWorldPoint(n,t),this.bj.getVelocityAtWorldPoint(o,e),t.vsub(e,i),this.ni.dot(i)}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],20:[function(t,e,n){e.exports=r;var o=t("../math/JacobianElement"),i=t("../math/Vec3");function r(t,e,n,i){this.id=r.id++,this.minForce=void 0===n?-1e6:n,this.maxForce=void 0===i?1e6:i,this.bi=t,this.bj=e,this.a=0,this.b=0,this.eps=0,this.jacobianElementA=new o,this.jacobianElementB=new o,this.enabled=!0,this.setSpookParams(1e7,4,1/60)}r.prototype.constructor=r,r.id=0,r.prototype.setSpookParams=function(t,e,n){var o=e,i=t,r=n;this.a=4/(r*(1+4*o)),this.b=4*o/(1+4*o),this.eps=4/(r*r*i*(1+4*o))},r.prototype.computeB=function(t,e,n){var o=this.computeGW();return-this.computeGq()*t-o*e-this.computeGiMf()*n},r.prototype.computeGq=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,o=this.bj,i=n.position,r=o.position;return t.spatial.dot(i)+e.spatial.dot(r)};var s=new i;r.prototype.computeGW=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,o=this.bj,i=n.velocity,r=o.velocity,a=n.angularVelocity||s,u=o.angularVelocity||s;return t.multiplyVectors(i,a)+e.multiplyVectors(r,u)},r.prototype.computeGWlambda=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,o=this.bj,i=n.vlambda,r=o.vlambda,a=n.wlambda||s,u=o.wlambda||s;return t.multiplyVectors(i,a)+e.multiplyVectors(r,u)};var a=new i,u=new i,l=new i,h=new i;r.prototype.computeGiMf=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,o=this.bj,i=n.force,r=n.torque,s=o.force,c=o.torque,d=n.invMassSolve,p=o.invMassSolve;return n.invInertiaWorldSolve?n.invInertiaWorldSolve.vmult(r,l):l.set(0,0,0),o.invInertiaWorldSolve?o.invInertiaWorldSolve.vmult(c,h):h.set(0,0,0),i.mult(d,a),s.mult(p,u),t.multiplyVectors(a,l)+e.multiplyVectors(u,h)};var c=new i;r.prototype.computeGiMGt=function(){var t=this.jacobianElementA,e=this.jacobianElementB,n=this.bi,o=this.bj,i=n.invMassSolve,r=o.invMassSolve,s=n.invInertiaWorldSolve,a=o.invInertiaWorldSolve,u=i+r;return s&&(s.vmult(t.rotational,c),u+=c.dot(t.rotational)),a&&(a.vmult(e.rotational,c),u+=c.dot(e.rotational)),u};var d=new i;new i,new i,new i,new i,new i,r.prototype.addToWlambda=function(t){var e=this.jacobianElementA,n=this.jacobianElementB,o=this.bi,i=this.bj,r=d;e.spatial.mult(o.invMassSolve*t,r),o.vlambda.vadd(r,o.vlambda),n.spatial.mult(i.invMassSolve*t,r),i.vlambda.vadd(r,i.vlambda),o.invInertiaWorldSolve&&(o.invInertiaWorldSolve.vmult(e.rotational,r),r.mult(t,r),o.wlambda.vadd(r,o.wlambda)),i.invInertiaWorldSolve&&(i.invInertiaWorldSolve.vmult(n.rotational,r),r.mult(t,r),i.wlambda.vadd(r,i.wlambda))},r.prototype.computeC=function(){return this.computeGiMGt()+this.eps}},{"../math/JacobianElement":26,"../math/Vec3":30}],21:[function(t,e,n){e.exports=r;var o=t("./Equation"),i=t("../math/Vec3");function r(t,e,n){o.call(this,t,e,-n,n),this.ri=new i,this.rj=new i,this.t=new i}t("../math/Mat3"),r.prototype=new o,r.prototype.constructor=r;var s=new i,a=new i;r.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.ri),o=this.rj,i=s,r=a,u=this.t;n.cross(u,i),o.cross(u,r);var l=this.jacobianElementA,h=this.jacobianElementB;return u.negate(l.spatial),i.negate(l.rotational),h.spatial.copy(u),h.rotational.copy(r),-this.computeGW()*e-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],22:[function(t,e,n){e.exports=r;var o=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function r(t,e,n){var r=void 0!==(n=n||{}).maxForce?n.maxForce:1e6;i.call(this,t,e,-r,r),this.axisA=n.axisA?n.axisA.clone():new o(1,0,0),this.axisB=n.axisB?n.axisB.clone():new o(0,1,0),this.maxAngle=Math.PI/2}r.prototype=new i,r.prototype.constructor=r;var s=new o,a=new o;r.prototype.computeB=function(t){var e=this.a,n=this.b,o=this.axisA,i=this.axisB,r=s,u=a,l=this.jacobianElementA,h=this.jacobianElementB;return o.cross(i,r),i.cross(o,u),l.rotational.copy(u),h.rotational.copy(r),-(Math.cos(this.maxAngle)-o.dot(i))*e-this.computeGW()*n-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],23:[function(t,e,n){e.exports=r;var o=t("../math/Vec3"),i=(t("../math/Mat3"),t("./Equation"));function r(t,e,n){n=void 0!==n?n:1e6,i.call(this,t,e,-n,n),this.axisA=new o,this.axisB=new o,this.targetVelocity=0}r.prototype=new i,r.prototype.constructor=r,r.prototype.computeB=function(t){this.a;var e=this.b,n=(this.bi,this.bj,this.axisA),o=this.axisB,i=this.jacobianElementA,r=this.jacobianElementB;return i.rotational.copy(n),o.negate(r.rotational),-(this.computeGW()-this.targetVelocity)*e-t*this.computeGiMf()}},{"../math/Mat3":27,"../math/Vec3":30,"./Equation":20}],24:[function(t,e,n){var o=t("../utils/Utils");function i(t,e,n){n=o.defaults(n,{friction:.3,restitution:.3,contactEquationStiffness:1e7,contactEquationRelaxation:3,frictionEquationStiffness:1e7,frictionEquationRelaxation:3}),this.id=i.idCounter++,this.materials=[t,e],this.friction=n.friction,this.restitution=n.restitution,this.contactEquationStiffness=n.contactEquationStiffness,this.contactEquationRelaxation=n.contactEquationRelaxation,this.frictionEquationStiffness=n.frictionEquationStiffness,this.frictionEquationRelaxation=n.frictionEquationRelaxation}e.exports=i,i.idCounter=0},{"../utils/Utils":53}],25:[function(t,e,n){function o(t){var e="";"string"==typeof(t=t||{})?(e=t,t={}):"object"==typeof t&&(e=""),this.name=e,this.id=o.idCounter++,this.friction=void 0!==t.friction?t.friction:-1,this.restitution=void 0!==t.restitution?t.restitution:-1}e.exports=o,o.idCounter=0},{}],26:[function(t,e,n){e.exports=i;var o=t("./Vec3");function i(){this.spatial=new o,this.rotational=new o}i.prototype.multiplyElement=function(t){return t.spatial.dot(this.spatial)+t.rotational.dot(this.rotational)},i.prototype.multiplyVectors=function(t,e){return t.dot(this.spatial)+e.dot(this.rotational)}},{"./Vec3":30}],27:[function(t,e,n){e.exports=i;var o=t("./Vec3");function i(t){this.elements=t||[0,0,0,0,0,0,0,0,0]}i.prototype.identity=function(){var t=this.elements;t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1},i.prototype.setZero=function(){var t=this.elements;t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t[8]=0},i.prototype.setTrace=function(t){var e=this.elements;e[0]=t.x,e[4]=t.y,e[8]=t.z},i.prototype.getTrace=function(t){t=t||new o;var e=this.elements;t.x=e[0],t.y=e[4],t.z=e[8]},i.prototype.vmult=function(t,e){e=e||new o;var n=this.elements,i=t.x,r=t.y,s=t.z;return e.x=n[0]*i+n[1]*r+n[2]*s,e.y=n[3]*i+n[4]*r+n[5]*s,e.z=n[6]*i+n[7]*r+n[8]*s,e},i.prototype.smult=function(t){for(var e=0;e<this.elements.length;e++)this.elements[e]*=t},i.prototype.mmult=function(t,e){for(var n=e||new i,o=0;o<3;o++)for(var r=0;r<3;r++){for(var s=0,a=0;a<3;a++)s+=t.elements[o+3*a]*this.elements[a+3*r];n.elements[o+3*r]=s}return n},i.prototype.scale=function(t,e){e=e||new i;for(var n=this.elements,o=e.elements,r=0;3!==r;r++)o[3*r+0]=t.x*n[3*r+0],o[3*r+1]=t.y*n[3*r+1],o[3*r+2]=t.z*n[3*r+2];return e},i.prototype.solve=function(t,e){e=e||new o;for(var n,i=[],r=0;r<12;r++)i.push(0);for(r=0;r<3;r++)for(n=0;n<3;n++)i[r+4*n]=this.elements[r+3*n];i[3]=t.x,i[7]=t.y,i[11]=t.z;var s,a,u=3,l=u;do{if(0===i[(r=l-u)+4*r])for(n=r+1;n<l;n++)if(0!==i[r+4*n]){s=4;do{i[(a=4-s)+4*r]+=i[a+4*n]}while(--s);break}if(0!==i[r+4*r])for(n=r+1;n<l;n++){var h=i[r+4*n]/i[r+4*r];s=4;do{i[(a=4-s)+4*n]=a<=r?0:i[a+4*n]-i[a+4*r]*h}while(--s)}}while(--u);if(e.z=i[11]/i[10],e.y=(i[7]-i[6]*e.z)/i[5],e.x=(i[3]-i[2]*e.z-i[1]*e.y)/i[0],isNaN(e.x)||isNaN(e.y)||isNaN(e.z)||e.x===1/0||e.y===1/0||e.z===1/0)throw"Could not solve equation! Got x=["+e.toString()+"], b=["+t.toString()+"], A=["+this.toString()+"]";return e},i.prototype.e=function(t,e,n){if(void 0===n)return this.elements[e+3*t];this.elements[e+3*t]=n},i.prototype.copy=function(t){for(var e=0;e<t.elements.length;e++)this.elements[e]=t.elements[e];return this},i.prototype.toString=function(){for(var t="",e=0;e<9;e++)t+=this.elements[e]+",";return t},i.prototype.reverse=function(t){t=t||new i;for(var e,n=[],o=0;o<18;o++)n.push(0);for(o=0;o<3;o++)for(e=0;e<3;e++)n[o+6*e]=this.elements[o+3*e];n[3]=1,n[9]=0,n[15]=0,n[4]=0,n[10]=1,n[16]=0,n[5]=0,n[11]=0,n[17]=1;var r,s,a=3,u=a;do{if(0===n[(o=u-a)+6*o])for(e=o+1;e<u;e++)if(0!==n[o+6*e]){r=6;do{n[(s=6-r)+6*o]+=n[s+6*e]}while(--r);break}if(0!==n[o+6*o])for(e=o+1;e<u;e++){var l=n[o+6*e]/n[o+6*o];r=6;do{n[(s=6-r)+6*e]=s<=o?0:n[s+6*e]-n[s+6*o]*l}while(--r)}}while(--a);o=2;do{e=o-1;do{l=n[o+6*e]/n[o+6*o],r=6;do{n[(s=6-r)+6*e]=n[s+6*e]-n[s+6*o]*l}while(--r)}while(e--)}while(--o);o=2;do{l=1/n[o+6*o],r=6;do{n[(s=6-r)+6*o]=n[s+6*o]*l}while(--r)}while(o--);o=2;do{e=2;do{if(s=n[3+e+6*o],isNaN(s)||s===1/0)throw"Could not reverse! A=["+this.toString()+"]";t.e(o,e,s)}while(e--)}while(o--);return t},i.prototype.setRotationFromQuaternion=function(t){var e=t.x,n=t.y,o=t.z,i=t.w,r=e+e,s=n+n,a=o+o,u=e*r,l=e*s,h=e*a,c=n*s,d=n*a,p=o*a,f=i*r,v=i*s,m=i*a,_=this.elements;return _[0]=1-(c+p),_[1]=l-m,_[2]=h+v,_[3]=l+m,_[4]=1-(u+p),_[5]=d-f,_[6]=h-v,_[7]=d+f,_[8]=1-(u+c),this},i.prototype.transpose=function(t){for(var e=(t=t||new i).elements,n=this.elements,o=0;3!==o;o++)for(var r=0;3!==r;r++)e[3*o+r]=n[3*r+o];return t}},{"./Vec3":30}],28:[function(t,e,n){e.exports=i;var o=t("./Vec3");function i(t,e,n,o){this.x=void 0!==t?t:0,this.y=void 0!==e?e:0,this.z=void 0!==n?n:0,this.w=void 0!==o?o:1}i.prototype.set=function(t,e,n,o){this.x=t,this.y=e,this.z=n,this.w=o},i.prototype.toString=function(){return this.x+","+this.y+","+this.z+","+this.w},i.prototype.toArray=function(){return[this.x,this.y,this.z,this.w]},i.prototype.setFromAxisAngle=function(t,e){var n=Math.sin(.5*e);this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this.w=Math.cos(.5*e)},i.prototype.toAxisAngle=function(t){t=t||new o,this.normalize();var e=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(t.x=this.x,t.y=this.y,t.z=this.z):(t.x=this.x/n,t.y=this.y/n,t.z=this.z/n),[t,e]};var r=new o,s=new o;i.prototype.setFromVectors=function(t,e){if(t.isAntiparallelTo(e)){var n=r,o=s;t.tangents(n,o),this.setFromAxisAngle(n,Math.PI)}else{var i=t.cross(e);this.x=i.x,this.y=i.y,this.z=i.z,this.w=Math.sqrt(Math.pow(t.norm(),2)*Math.pow(e.norm(),2))+t.dot(e),this.normalize()}};var a=new o,u=new o,l=new o;i.prototype.mult=function(t,e){e=e||new i;var n=this.w,o=a,r=u,s=l;return o.set(this.x,this.y,this.z),r.set(t.x,t.y,t.z),e.w=n*t.w-o.dot(r),o.cross(r,s),e.x=n*r.x+t.w*o.x+s.x,e.y=n*r.y+t.w*o.y+s.y,e.z=n*r.z+t.w*o.z+s.z,e},i.prototype.inverse=function(t){var e=this.x,n=this.y,o=this.z,r=this.w;t=t||new i,this.conjugate(t);var s=1/(e*e+n*n+o*o+r*r);return t.x*=s,t.y*=s,t.z*=s,t.w*=s,t},i.prototype.conjugate=function(t){return(t=t||new i).x=-this.x,t.y=-this.y,t.z=-this.z,t.w=this.w,t},i.prototype.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(t=1/t,this.x*=t,this.y*=t,this.z*=t,this.w*=t)},i.prototype.normalizeFast=function(){var t=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;0===t?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=t,this.y*=t,this.z*=t,this.w*=t)},i.prototype.vmult=function(t,e){e=e||new o;var n=t.x,i=t.y,r=t.z,s=this.x,a=this.y,u=this.z,l=this.w,h=l*n+a*r-u*i,c=l*i+u*n-s*r,d=l*r+s*i-a*n,p=-s*n-a*i-u*r;return e.x=h*l+p*-s+c*-u-d*-a,e.y=c*l+p*-a+d*-s-h*-u,e.z=d*l+p*-u+h*-a-c*-s,e},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},i.prototype.toEuler=function(t,e){var n,o,i;e=e||"YZX";var r=this.x,s=this.y,a=this.z,u=this.w;if("YZX"!==e)throw new Error("Euler order "+e+" not supported yet.");var l=r*s+a*u;if(l>.499&&(n=2*Math.atan2(r,u),o=Math.PI/2,i=0),l<-.499&&(n=-2*Math.atan2(r,u),o=-Math.PI/2,i=0),isNaN(n)){var h=r*r,c=s*s,d=a*a;n=Math.atan2(2*s*u-2*r*a,1-2*c-2*d),o=Math.asin(2*l),i=Math.atan2(2*r*u-2*s*a,1-2*h-2*d)}t.y=n,t.z=o,t.x=i},i.prototype.setFromEuler=function(t,e,n,o){o=o||"XYZ";var i=Math.cos(t/2),r=Math.cos(e/2),s=Math.cos(n/2),a=Math.sin(t/2),u=Math.sin(e/2),l=Math.sin(n/2);return"XYZ"===o?(this.x=a*r*s+i*u*l,this.y=i*u*s-a*r*l,this.z=i*r*l+a*u*s,this.w=i*r*s-a*u*l):"YXZ"===o?(this.x=a*r*s+i*u*l,this.y=i*u*s-a*r*l,this.z=i*r*l-a*u*s,this.w=i*r*s+a*u*l):"ZXY"===o?(this.x=a*r*s-i*u*l,this.y=i*u*s+a*r*l,this.z=i*r*l+a*u*s,this.w=i*r*s-a*u*l):"ZYX"===o?(this.x=a*r*s-i*u*l,this.y=i*u*s+a*r*l,this.z=i*r*l-a*u*s,this.w=i*r*s+a*u*l):"YZX"===o?(this.x=a*r*s+i*u*l,this.y=i*u*s+a*r*l,this.z=i*r*l-a*u*s,this.w=i*r*s-a*u*l):"XZY"===o&&(this.x=a*r*s-i*u*l,this.y=i*u*s-a*r*l,this.z=i*r*l+a*u*s,this.w=i*r*s+a*u*l),this},i.prototype.clone=function(){return new i(this.x,this.y,this.z,this.w)}},{"./Vec3":30}],29:[function(t,e,n){var o=t("./Vec3"),i=t("./Quaternion");function r(t){t=t||{},this.position=new o,t.position&&this.position.copy(t.position),this.quaternion=new i,t.quaternion&&this.quaternion.copy(t.quaternion)}e.exports=r;var s=new i;r.pointToLocalFrame=function(t,e,n,i){return i=i||new o,n.vsub(t,i),e.conjugate(s),s.vmult(i,i),i},r.prototype.pointToLocal=function(t,e){return r.pointToLocalFrame(this.position,this.quaternion,t,e)},r.pointToWorldFrame=function(t,e,n,i){return i=i||new o,e.vmult(n,i),i.vadd(t,i),i},r.prototype.pointToWorld=function(t,e){return r.pointToWorldFrame(this.position,this.quaternion,t,e)},r.prototype.vectorToWorldFrame=function(t,e){return e=e||new o,this.quaternion.vmult(t,e),e},r.vectorToWorldFrame=function(t,e,n){return t.vmult(e,n),n},r.vectorToLocalFrame=function(t,e,n,i){return i=i||new o,e.w*=-1,e.vmult(n,i),e.w*=-1,i}},{"./Quaternion":28,"./Vec3":30}],30:[function(t,e,n){e.exports=i;var o=t("./Mat3");function i(t,e,n){this.x=t||0,this.y=e||0,this.z=n||0}i.ZERO=new i(0,0,0),i.UNIT_X=new i(1,0,0),i.UNIT_Y=new i(0,1,0),i.UNIT_Z=new i(0,0,1),i.prototype.cross=function(t,e){var n=t.x,o=t.y,r=t.z,s=this.x,a=this.y,u=this.z;return(e=e||new i).x=a*r-u*o,e.y=u*n-s*r,e.z=s*o-a*n,e},i.prototype.set=function(t,e,n){return this.x=t,this.y=e,this.z=n,this},i.prototype.setZero=function(){this.x=this.y=this.z=0},i.prototype.vadd=function(t,e){if(!e)return new i(this.x+t.x,this.y+t.y,this.z+t.z);e.x=t.x+this.x,e.y=t.y+this.y,e.z=t.z+this.z},i.prototype.vsub=function(t,e){if(!e)return new i(this.x-t.x,this.y-t.y,this.z-t.z);e.x=this.x-t.x,e.y=this.y-t.y,e.z=this.z-t.z},i.prototype.crossmat=function(){return new o([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])},i.prototype.normalize=function(){var t=this.x,e=this.y,n=this.z,o=Math.sqrt(t*t+e*e+n*n);if(o>0){var i=1/o;this.x*=i,this.y*=i,this.z*=i}else this.x=0,this.y=0,this.z=0;return o},i.prototype.unit=function(t){t=t||new i;var e=this.x,n=this.y,o=this.z,r=Math.sqrt(e*e+n*n+o*o);return r>0?(r=1/r,t.x=e*r,t.y=n*r,t.z=o*r):(t.x=1,t.y=0,t.z=0),t},i.prototype.norm=function(){var t=this.x,e=this.y,n=this.z;return Math.sqrt(t*t+e*e+n*n)},i.prototype.length=i.prototype.norm,i.prototype.norm2=function(){return this.dot(this)},i.prototype.lengthSquared=i.prototype.norm2,i.prototype.distanceTo=function(t){var e=this.x,n=this.y,o=this.z,i=t.x,r=t.y,s=t.z;return Math.sqrt((i-e)*(i-e)+(r-n)*(r-n)+(s-o)*(s-o))},i.prototype.distanceSquared=function(t){var e=this.x,n=this.y,o=this.z,i=t.x,r=t.y,s=t.z;return(i-e)*(i-e)+(r-n)*(r-n)+(s-o)*(s-o)},i.prototype.mult=function(t,e){e=e||new i;var n=this.x,o=this.y,r=this.z;return e.x=t*n,e.y=t*o,e.z=t*r,e},i.prototype.scale=i.prototype.mult,i.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},i.prototype.isZero=function(){return 0===this.x&&0===this.y&&0===this.z},i.prototype.negate=function(t){return(t=t||new i).x=-this.x,t.y=-this.y,t.z=-this.z,t};var r=new i,s=new i;i.prototype.tangents=function(t,e){var n=this.norm();if(n>0){var o=r,i=1/n;o.set(this.x*i,this.y*i,this.z*i);var a=s;Math.abs(o.x)<.9?(a.set(1,0,0),o.cross(a,t)):(a.set(0,1,0),o.cross(a,t)),o.cross(t,e)}else t.set(1,0,0),e.set(0,1,0)},i.prototype.toString=function(){return this.x+","+this.y+","+this.z},i.prototype.toArray=function(){return[this.x,this.y,this.z]},i.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},i.prototype.lerp=function(t,e,n){var o=this.x,i=this.y,r=this.z;n.x=o+(t.x-o)*e,n.y=i+(t.y-i)*e,n.z=r+(t.z-r)*e},i.prototype.almostEquals=function(t,e){return void 0===e&&(e=1e-6),!(Math.abs(this.x-t.x)>e||Math.abs(this.y-t.y)>e||Math.abs(this.z-t.z)>e)},i.prototype.almostZero=function(t){return void 0===t&&(t=1e-6),!(Math.abs(this.x)>t||Math.abs(this.y)>t||Math.abs(this.z)>t)};var a=new i;i.prototype.isAntiparallelTo=function(t,e){return this.negate(a),a.almostEquals(t,e)},i.prototype.clone=function(){return new i(this.x,this.y,this.z)}},{"./Mat3":27}],31:[function(t,e,n){e.exports=l;var o=t("../utils/EventTarget"),i=(t("../shapes/Shape"),t("../math/Vec3")),r=t("../math/Mat3"),s=t("../math/Quaternion"),a=(t("../material/Material"),t("../collision/AABB")),u=t("../shapes/Box");function l(t){t=t||{},o.apply(this),this.id=l.idCounter++,this.world=null,this.preStep=null,this.postStep=null,this.vlambda=new i,this.collisionFilterGroup="number"==typeof t.collisionFilterGroup?t.collisionFilterGroup:1,this.collisionFilterMask="number"==typeof t.collisionFilterMask?t.collisionFilterMask:1,this.collisionResponse=!0,this.position=new i,t.position&&this.position.copy(t.position),this.previousPosition=new i,this.initPosition=new i,this.velocity=new i,t.velocity&&this.velocity.copy(t.velocity),this.initVelocity=new i,this.force=new i;var e="number"==typeof t.mass?t.mass:0;this.mass=e,this.invMass=e>0?1/e:0,this.material=t.material||null,this.linearDamping="number"==typeof t.linearDamping?t.linearDamping:.01,this.type=e<=0?l.STATIC:l.DYNAMIC,typeof t.type==typeof l.STATIC&&(this.type=t.type),this.allowSleep=void 0===t.allowSleep||t.allowSleep,this.sleepState=0,this.sleepSpeedLimit=void 0!==t.sleepSpeedLimit?t.sleepSpeedLimit:.1,this.sleepTimeLimit=void 0!==t.sleepTimeLimit?t.sleepTimeLimit:1,this.timeLastSleepy=0,this._wakeUpAfterNarrowphase=!1,this.torque=new i,this.quaternion=new s,t.quaternion&&this.quaternion.copy(t.quaternion),this.initQuaternion=new s,this.angularVelocity=new i,t.angularVelocity&&this.angularVelocity.copy(t.angularVelocity),this.initAngularVelocity=new i,this.interpolatedPosition=new i,this.interpolatedQuaternion=new s,this.shapes=[],this.shapeOffsets=[],this.shapeOrientations=[],this.inertia=new i,this.invInertia=new i,this.invInertiaWorld=new r,this.invMassSolve=0,this.invInertiaSolve=new i,this.invInertiaWorldSolve=new r,this.fixedRotation=void 0!==t.fixedRotation&&t.fixedRotation,this.angularDamping=void 0!==t.angularDamping?t.angularDamping:.01,this.aabb=new a,this.aabbNeedsUpdate=!0,this.wlambda=new i,t.shape&&this.addShape(t.shape),this.updateMassProperties()}l.prototype=new o,l.prototype.constructor=l,l.DYNAMIC=1,l.STATIC=2,l.KINEMATIC=4,l.AWAKE=0,l.SLEEPY=1,l.SLEEPING=2,l.idCounter=0,l.prototype.wakeUp=function(){var t=this.sleepState;this.sleepState=0,t===l.SLEEPING&&this.dispatchEvent({type:"wakeup"})},l.prototype.sleep=function(){this.sleepState=l.SLEEPING,this.velocity.set(0,0,0),this.angularVelocity.set(0,0,0)},l.sleepyEvent={type:"sleepy"},l.sleepEvent={type:"sleep"},l.prototype.sleepTick=function(t){if(this.allowSleep){var e=this.sleepState,n=this.velocity.norm2()+this.angularVelocity.norm2(),o=Math.pow(this.sleepSpeedLimit,2);e===l.AWAKE&&n<o?(this.sleepState=l.SLEEPY,this.timeLastSleepy=t,this.dispatchEvent(l.sleepyEvent)):e===l.SLEEPY&&n>o?this.wakeUp():e===l.SLEEPY&&t-this.timeLastSleepy>this.sleepTimeLimit&&(this.sleep(),this.dispatchEvent(l.sleepEvent))}},l.prototype.updateSolveMassProperties=function(){this.sleepState===l.SLEEPING||this.type===l.KINEMATIC?(this.invMassSolve=0,this.invInertiaSolve.setZero(),this.invInertiaWorldSolve.setZero()):(this.invMassSolve=this.invMass,this.invInertiaSolve.copy(this.invInertia),this.invInertiaWorldSolve.copy(this.invInertiaWorld))},l.prototype.pointToLocalFrame=function(t,e){return e=e||new i,t.vsub(this.position,e),this.quaternion.conjugate().vmult(e,e),e},l.prototype.vectorToLocalFrame=function(t,e){return e=e||new i,this.quaternion.conjugate().vmult(t,e),e},l.prototype.pointToWorldFrame=function(t,e){return e=e||new i,this.quaternion.vmult(t,e),e.vadd(this.position,e),e},l.prototype.vectorToWorldFrame=function(t,e){return e=e||new i,this.quaternion.vmult(t,e),e};var h=new i,c=new s;l.prototype.addShape=function(t,e,n){var o=new i,r=new s;return e&&o.copy(e),n&&r.copy(n),this.shapes.push(t),this.shapeOffsets.push(o),this.shapeOrientations.push(r),this.updateMassProperties(),this.updateBoundingRadius(),this.aabbNeedsUpdate=!0,this},l.prototype.updateBoundingRadius=function(){for(var t=this.shapes,e=this.shapeOffsets,n=t.length,o=0,i=0;i!==n;i++){var r=t[i];r.updateBoundingSphereRadius();var s=e[i].norm(),a=r.boundingSphereRadius;s+a>o&&(o=s+a)}this.boundingRadius=o};var d=new a;l.prototype.computeAABB=function(){for(var t=this.shapes,e=this.shapeOffsets,n=this.shapeOrientations,o=t.length,i=h,r=c,s=this.quaternion,a=this.aabb,u=d,l=0;l!==o;l++){var p=t[l];n[l].mult(s,r),r.vmult(e[l],i),i.vadd(this.position,i),p.calculateWorldAABB(i,r,u.lowerBound,u.upperBound),0===l?a.copy(u):a.extend(u)}this.aabbNeedsUpdate=!1};var p=new r,f=new r;new r,l.prototype.updateInertiaWorld=function(t){var e=this.invInertia;if(e.x!==e.y||e.y!==e.z||t){var n=p,o=f;n.setRotationFromQuaternion(this.quaternion),n.transpose(o),n.scale(e,n),n.mmult(o,this.invInertiaWorld)}};var v=new i,m=new i;l.prototype.applyForce=function(t,e){if(this.type===l.DYNAMIC){var n=v;e.vsub(this.position,n);var o=m;n.cross(t,o),this.force.vadd(t,this.force),this.torque.vadd(o,this.torque)}};var _=new i,y=new i;l.prototype.applyLocalForce=function(t,e){if(this.type===l.DYNAMIC){var n=_,o=y;this.vectorToWorldFrame(t,n),this.pointToWorldFrame(e,o),this.applyForce(n,o)}};var E=new i,g=new i,b=new i;l.prototype.applyImpulse=function(t,e){if(this.type===l.DYNAMIC){var n=E;e.vsub(this.position,n);var o=g;o.copy(t),o.mult(this.invMass,o),this.velocity.vadd(o,this.velocity);var i=b;n.cross(t,i),this.invInertiaWorld.vmult(i,i),this.angularVelocity.vadd(i,this.angularVelocity)}};var x=new i,w=new i;l.prototype.applyLocalImpulse=function(t,e){if(this.type===l.DYNAMIC){var n=x,o=w;this.vectorToWorldFrame(t,n),this.pointToWorldFrame(e,o),this.applyImpulse(n,o)}};var A=new i;l.prototype.updateMassProperties=function(){var t=A;this.invMass=this.mass>0?1/this.mass:0;var e=this.inertia,n=this.fixedRotation;this.computeAABB(),t.set((this.aabb.upperBound.x-this.aabb.lowerBound.x)/2,(this.aabb.upperBound.y-this.aabb.lowerBound.y)/2,(this.aabb.upperBound.z-this.aabb.lowerBound.z)/2),u.calculateInertia(t,this.mass,e),this.invInertia.set(e.x>0&&!n?1/e.x:0,e.y>0&&!n?1/e.y:0,e.z>0&&!n?1/e.z:0),this.updateInertiaWorld(!0)},l.prototype.getVelocityAtWorldPoint=function(t,e){var n=new i;return t.vsub(this.position,n),this.angularVelocity.cross(n,e),this.velocity.vadd(e,e),e}},{"../collision/AABB":3,"../material/Material":25,"../math/Mat3":27,"../math/Quaternion":28,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Shape":43,"../utils/EventTarget":49}],32:[function(t,e,n){t("./Body");var o=t("../math/Vec3"),i=t("../math/Quaternion"),r=(t("../collision/RaycastResult"),t("../collision/Ray")),s=t("../objects/WheelInfo");function a(t){this.chassisBody=t.chassisBody,this.wheelInfos=[],this.sliding=!1,this.world=null,this.indexRightAxis=void 0!==t.indexRightAxis?t.indexRightAxis:1,this.indexForwardAxis=void 0!==t.indexForwardAxis?t.indexForwardAxis:0,this.indexUpAxis=void 0!==t.indexUpAxis?t.indexUpAxis:2}e.exports=a,new o,new o,new o;var u=new o,l=new o,h=new o;new r,a.prototype.addWheel=function(t){var e=new s(t=t||{}),n=this.wheelInfos.length;return this.wheelInfos.push(e),n},a.prototype.setSteeringValue=function(t,e){this.wheelInfos[e].steering=t},new o,a.prototype.applyEngineForce=function(t,e){this.wheelInfos[e].engineForce=t},a.prototype.setBrake=function(t,e){this.wheelInfos[e].brake=t},a.prototype.addToWorld=function(t){this.constraints,t.add(this.chassisBody);var e=this;this.preStepCallback=function(){e.updateVehicle(t.dt)},t.addEventListener("preStep",this.preStepCallback),this.world=t},a.prototype.getVehicleAxisWorld=function(t,e){e.set(0===t?1:0,1===t?1:0,2===t?1:0),this.chassisBody.vectorToWorldFrame(e,e)},a.prototype.updateVehicle=function(t){for(var e=this.wheelInfos,n=e.length,i=this.chassisBody,r=0;r<n;r++)this.updateWheelTransform(r);this.currentVehicleSpeedKmHour=3.6*i.velocity.norm();var s=new o;for(this.getVehicleAxisWorld(this.indexForwardAxis,s),s.dot(i.velocity)<0&&(this.currentVehicleSpeedKmHour*=-1),r=0;r<n;r++)this.castRay(e[r]);this.updateSuspension(t);var a=new o,u=new o;for(r=0;r<n;r++){var l=(p=e[r]).suspensionForce;l>p.maxSuspensionForce&&(l=p.maxSuspensionForce),p.raycastResult.hitNormalWorld.scale(l*t,a),p.raycastResult.hitPointWorld.vsub(i.position,u),i.applyImpulse(a,p.raycastResult.hitPointWorld)}this.updateFriction(t);var h=new o,c=new o,d=new o;for(r=0;r<n;r++){var p=e[r];i.getVelocityAtWorldPoint(p.chassisConnectionPointWorld,d);var f=1;if(1===this.indexUpAxis&&(f=-1),p.isInContact){this.getVehicleAxisWorld(this.indexForwardAxis,c);var v=c.dot(p.raycastResult.hitNormalWorld);p.raycastResult.hitNormalWorld.scale(v,h),c.vsub(h,c);var m=c.dot(d);p.deltaRotation=f*m*t/p.radius}!p.sliding&&p.isInContact||0===p.engineForce||!p.useCustomSlidingRotationalSpeed||(p.deltaRotation=(p.engineForce>0?1:-1)*p.customSlidingRotationalSpeed*t),Math.abs(p.brake)>Math.abs(p.engineForce)&&(p.deltaRotation=0),p.rotation+=p.deltaRotation,p.deltaRotation*=.99}},a.prototype.updateSuspension=function(t){for(var e=this.chassisBody.mass,n=this.wheelInfos,o=n.length,i=0;i<o;i++){var r=n[i];if(r.isInContact){var s,a=r.suspensionRestLength-r.suspensionLength;s=r.suspensionStiffness*a*r.clippedInvContactDotSuspension;var u=r.suspensionRelativeVelocity;s-=(u<0?r.dampingCompression:r.dampingRelaxation)*u,r.suspensionForce=s*e,r.suspensionForce<0&&(r.suspensionForce=0)}else r.suspensionForce=0}},a.prototype.removeFromWorld=function(t){this.constraints,t.remove(this.chassisBody),t.removeEventListener("preStep",this.preStepCallback),this.world=null};var c=new o,d=new o;a.prototype.castRay=function(t){var e=c,n=d;this.updateWheelTransformWorld(t);var i=this.chassisBody,r=-1,s=t.suspensionRestLength+t.radius;t.directionWorld.scale(s,e);var a=t.chassisConnectionPointWorld;a.vadd(e,n);var u=t.raycastResult;u.reset();var l=i.collisionResponse;i.collisionResponse=!1,this.world.rayTest(a,n,u),i.collisionResponse=l;var h=u.body;if(t.raycastResult.groundObject=0,h){r=u.distance,t.raycastResult.hitNormalWorld=u.hitNormalWorld,t.isInContact=!0;var p=u.distance;t.suspensionLength=p-t.radius;var f=t.suspensionRestLength-t.maxSuspensionTravel,v=t.suspensionRestLength+t.maxSuspensionTravel;t.suspensionLength<f&&(t.suspensionLength=f),t.suspensionLength>v&&(t.suspensionLength=v,t.raycastResult.reset());var m=t.raycastResult.hitNormalWorld.dot(t.directionWorld),_=new o;i.getVelocityAtWorldPoint(t.raycastResult.hitPointWorld,_);var y=t.raycastResult.hitNormalWorld.dot(_);if(m>=-.1)t.suspensionRelativeVelocity=0,t.clippedInvContactDotSuspension=10;else{var E=-1/m;t.suspensionRelativeVelocity=y*E,t.clippedInvContactDotSuspension=E}}else t.suspensionLength=t.suspensionRestLength+0*t.maxSuspensionTravel,t.suspensionRelativeVelocity=0,t.directionWorld.scale(-1,t.raycastResult.hitNormalWorld),t.clippedInvContactDotSuspension=1;return r},a.prototype.updateWheelTransformWorld=function(t){t.isInContact=!1;var e=this.chassisBody;e.pointToWorldFrame(t.chassisConnectionPointLocal,t.chassisConnectionPointWorld),e.vectorToWorldFrame(t.directionLocal,t.directionWorld),e.vectorToWorldFrame(t.axleLocal,t.axleWorld)},a.prototype.updateWheelTransform=function(t){var e=u,n=l,o=h,r=this.wheelInfos[t];this.updateWheelTransformWorld(r),r.directionLocal.scale(-1,e),n.copy(r.axleLocal),e.cross(n,o),o.normalize(),n.normalize();var s=r.steering,a=new i;a.setFromAxisAngle(e,s);var c=new i;c.setFromAxisAngle(n,r.rotation);var d=r.worldTransform.quaternion;this.chassisBody.quaternion.mult(a,d),d.mult(c,d),d.normalize();var p=r.worldTransform.position;p.copy(r.directionWorld),p.scale(r.suspensionLength,p),p.vadd(r.chassisConnectionPointWorld,p)};var p=[new o(1,0,0),new o(0,1,0),new o(0,0,1)];a.prototype.getWheelTransformWorld=function(t){return this.wheelInfos[t].worldTransform};var f=new o,v=[],m=[];a.prototype.updateFriction=function(t){for(var e=f,n=this.wheelInfos,i=n.length,r=this.chassisBody,s=m,a=v,u=0;u<i;u++)d=(R=n[u]).raycastResult.body,R.sideImpulse=0,R.forwardImpulse=0,s[u]||(s[u]=new o),a[u]||(a[u]=new o);for(u=0;u<i;u++)if(d=(R=n[u]).raycastResult.body){var l=a[u];this.getWheelTransformWorld(u).vectorToWorldFrame(p[this.indexRightAxis],l);var h=R.raycastResult.hitNormalWorld,c=l.dot(h);h.scale(c,e),l.vsub(e,l),l.normalize(),h.cross(l,s[u]),s[u].normalize(),R.sideImpulse=C(r,R.raycastResult.hitPointWorld,d,R.raycastResult.hitPointWorld,l),R.sideImpulse*=1}for(this.sliding=!1,u=0;u<i;u++){var d=(R=n[u]).raycastResult.body,_=0;if(R.slipInfo=1,d){var y=R.brake?R.brake:0;_=g(r,d,R.raycastResult.hitPointWorld,s[u],y);var E=y/(_+=R.engineForce*t);R.slipInfo*=E}if(R.forwardImpulse=0,R.skidInfo=1,d){R.skidInfo=1;var b=R.suspensionForce*t*R.frictionSlip,x=b*b;R.forwardImpulse=_;var w=.5*R.forwardImpulse,A=1*R.sideImpulse,T=w*w+A*A;R.sliding=!1,T>x&&(this.sliding=!0,R.sliding=!0,E=b/Math.sqrt(T),R.skidInfo*=E)}}if(this.sliding)for(u=0;u<i;u++)0!==(R=n[u]).sideImpulse&&R.skidInfo<1&&(R.forwardImpulse*=R.skidInfo,R.sideImpulse*=R.skidInfo);for(u=0;u<i;u++){var R=n[u],M=new o;if(M.copy(R.raycastResult.hitPointWorld),0!==R.forwardImpulse){var S=new o;s[u].scale(R.forwardImpulse,S),r.applyImpulse(S,M)}if(0!==R.sideImpulse){d=R.raycastResult.body;var L=new o;L.copy(R.raycastResult.hitPointWorld);var N=new o;a[u].scale(R.sideImpulse,N),r.pointToLocalFrame(M,M),M["xyz"[this.indexUpAxis]]*=R.rollInfluence,r.pointToWorldFrame(M,M),r.applyImpulse(N,M),N.scale(-1,N),d.applyImpulse(N,L)}}};var _=new o,y=new o,E=new o;function g(t,e,n,o,i){var r=0,s=n,a=_,u=y,l=E;return t.getVelocityAtWorldPoint(s,a),e.getVelocityAtWorldPoint(s,u),a.vsub(u,l),i<(r=-o.dot(l)*(1/(T(t,n,o)+T(e,n,o))))&&(r=i),r<-i&&(r=-i),r}var b=new o,x=new o,w=new o,A=new o;function T(t,e,n){var o=b,i=x,r=w,s=A;return e.vsub(t.position,o),o.cross(n,i),t.invInertiaWorld.vmult(i,s),s.cross(o,r),t.invMass+n.dot(r)}var R=new o,M=new o,S=new o;function C(t,e,n,o,i,r){if(i.norm2()>1.1)return 0;var s=R,a=M,u=S;return t.getVelocityAtWorldPoint(e,s),n.getVelocityAtWorldPoint(o,a),s.vsub(a,u),-.2*i.dot(u)*(1/(t.invMass+n.invMass))}},{"../collision/Ray":9,"../collision/RaycastResult":10,"../math/Quaternion":28,"../math/Vec3":30,"../objects/WheelInfo":36,"./Body":31}],33:[function(t,e,n){var o=t("./Body"),i=t("../shapes/Sphere"),r=t("../shapes/Box"),s=t("../math/Vec3"),a=t("../constraints/HingeConstraint");function u(t){if(this.wheelBodies=[],this.coordinateSystem=void 0===t.coordinateSystem?new s(1,2,3):t.coordinateSystem.clone(),this.chassisBody=t.chassisBody,!this.chassisBody){var e=new r(new s(5,2,.5));this.chassisBody=new o(1,e)}this.constraints=[],this.wheelAxes=[],this.wheelForces=[]}e.exports=u,u.prototype.addWheel=function(t){var e=(t=t||{}).body;e||(e=new o(1,new i(1.2))),this.wheelBodies.push(e),this.wheelForces.push(0),new s;var n=void 0!==t.position?t.position.clone():new s,r=new s;this.chassisBody.pointToWorldFrame(n,r),e.position.set(r.x,r.y,r.z);var u=void 0!==t.axis?t.axis.clone():new s(0,1,0);this.wheelAxes.push(u);var l=new a(this.chassisBody,e,{pivotA:n,axisA:u,pivotB:s.ZERO,axisB:u,collideConnected:!1});return this.constraints.push(l),this.wheelBodies.length-1},u.prototype.setSteeringValue=function(t,e){var n=this.wheelAxes[e],o=Math.cos(t),i=Math.sin(t),r=n.x,s=n.y;this.constraints[e].axisA.set(o*r-i*s,i*r+o*s,0)},u.prototype.setMotorSpeed=function(t,e){var n=this.constraints[e];n.enableMotor(),n.motorTargetVelocity=t},u.prototype.disableMotor=function(t){this.constraints[t].disableMotor()};var l=new s;u.prototype.setWheelForce=function(t,e){this.wheelForces[e]=t},u.prototype.applyWheelForce=function(t,e){var n=this.wheelAxes[e],o=this.wheelBodies[e],i=o.torque;n.scale(t,l),o.vectorToWorldFrame(l,l),i.vadd(l,i)},u.prototype.addToWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),o=0;o<n.length;o++)t.add(n[o]);for(o=0;o<e.length;o++)t.addConstraint(e[o]);t.addEventListener("preStep",this._update.bind(this))},u.prototype._update=function(){for(var t=this.wheelForces,e=0;e<t.length;e++)this.applyWheelForce(t[e],e)},u.prototype.removeFromWorld=function(t){for(var e=this.constraints,n=this.wheelBodies.concat([this.chassisBody]),o=0;o<n.length;o++)t.remove(n[o]);for(o=0;o<e.length;o++)t.removeConstraint(e[o])};var h=new s;u.prototype.getWheelSpeed=function(t){var e=this.wheelAxes[t],n=this.wheelBodies[t].angularVelocity;return this.chassisBody.vectorToWorldFrame(e,h),n.dot(h)}},{"../constraints/HingeConstraint":15,"../math/Vec3":30,"../shapes/Box":37,"../shapes/Sphere":44,"./Body":31}],34:[function(t,e,n){e.exports=i,t("../shapes/Shape");var o=t("../math/Vec3");function i(){this.particles=[],this.density=1,this.smoothingRadius=1,this.speedOfSound=1,this.viscosity=.01,this.eps=1e-6,this.pressures=[],this.densities=[],this.neighbors=[]}t("../math/Quaternion"),t("../shapes/Particle"),t("../objects/Body"),t("../material/Material"),i.prototype.add=function(t){this.particles.push(t),this.neighbors.length<this.particles.length&&this.neighbors.push([])},i.prototype.remove=function(t){var e=this.particles.indexOf(t);-1!==e&&(this.particles.splice(e,1),this.neighbors.length>this.particles.length&&this.neighbors.pop())};var r=new o;i.prototype.getNeighbors=function(t,e){for(var n=this.particles.length,o=t.id,i=this.smoothingRadius*this.smoothingRadius,s=r,a=0;a!==n;a++){var u=this.particles[a];u.position.vsub(t.position,s),o!==u.id&&s.norm2()<i&&e.push(u)}};var s=new o,a=new o,u=new o,l=new o,h=new o,c=new o;i.prototype.update=function(){for(var t=this.particles.length,e=s,n=this.speedOfSound,o=this.eps,i=0;i!==t;i++){var r=this.particles[i];(A=this.neighbors[i]).length=0,this.getNeighbors(r,A),A.push(this.particles[i]);for(var d=A.length,p=0,f=0;f!==d;f++){r.position.vsub(A[f].position,e);var v=e.norm(),m=this.w(v);p+=A[f].mass*m}this.densities[i]=p,this.pressures[i]=n*n*(this.densities[i]-this.density)}var _=a,y=u,E=l,g=h,b=c;for(i=0;i!==t;i++){var x,w,A,T=this.particles[i];for(_.set(0,0,0),y.set(0,0,0),d=(A=this.neighbors[i]).length,f=0;f!==d;f++){var R=A[f];T.position.vsub(R.position,g);var M=g.norm();x=-R.mass*(this.pressures[i]/(this.densities[i]*this.densities[i]+o)+this.pressures[f]/(this.densities[f]*this.densities[f]+o)),this.gradw(g,E),E.mult(x,E),_.vadd(E,_),R.velocity.vsub(T.velocity,b),b.mult(1/(1e-4+this.densities[i]*this.densities[f])*this.viscosity*R.mass,b),w=this.nablaw(M),b.mult(w,b),y.vadd(b,y)}y.mult(T.mass,y),_.mult(T.mass,_),T.force.vadd(y,T.force),T.force.vadd(_,T.force)}},i.prototype.w=function(t){var e=this.smoothingRadius;return 315/(64*Math.PI*Math.pow(e,9))*Math.pow(e*e-t*t,3)},i.prototype.gradw=function(t,e){var n=t.norm(),o=this.smoothingRadius;t.mult(945/(32*Math.PI*Math.pow(o,9))*Math.pow(o*o-n*n,2),e)},i.prototype.nablaw=function(t){var e=this.smoothingRadius;return 945/(32*Math.PI*Math.pow(e,9))*(e*e-t*t)*(7*t*t-3*e*e)}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Particle":41,"../shapes/Shape":43}],35:[function(t,e,n){var o=t("../math/Vec3");function i(t,e,n){n=n||{},this.restLength="number"==typeof n.restLength?n.restLength:1,this.stiffness=n.stiffness||100,this.damping=n.damping||1,this.bodyA=t,this.bodyB=e,this.localAnchorA=new o,this.localAnchorB=new o,n.localAnchorA&&this.localAnchorA.copy(n.localAnchorA),n.localAnchorB&&this.localAnchorB.copy(n.localAnchorB),n.worldAnchorA&&this.setWorldAnchorA(n.worldAnchorA),n.worldAnchorB&&this.setWorldAnchorB(n.worldAnchorB)}e.exports=i,i.prototype.setWorldAnchorA=function(t){this.bodyA.pointToLocalFrame(t,this.localAnchorA)},i.prototype.setWorldAnchorB=function(t){this.bodyB.pointToLocalFrame(t,this.localAnchorB)},i.prototype.getWorldAnchorA=function(t){this.bodyA.pointToWorldFrame(this.localAnchorA,t)},i.prototype.getWorldAnchorB=function(t){this.bodyB.pointToWorldFrame(this.localAnchorB,t)};var r=new o,s=new o,a=new o,u=new o,l=new o,h=new o,c=new o,d=new o,p=new o,f=new o,v=new o;i.prototype.applyForce=function(){var t=this.stiffness,e=this.damping,n=this.restLength,o=this.bodyA,i=this.bodyB,m=r,_=s,y=a,E=u,g=v,b=l,x=h,w=c,A=d,T=p,R=f;this.getWorldAnchorA(b),this.getWorldAnchorB(x),b.vsub(o.position,w),x.vsub(i.position,A),x.vsub(b,m);var M=m.norm();_.copy(m),_.normalize(),i.velocity.vsub(o.velocity,y),i.angularVelocity.cross(A,g),y.vadd(g,y),o.angularVelocity.cross(w,g),y.vsub(g,y),_.mult(-t*(M-n)-e*y.dot(_),E),o.force.vsub(E,o.force),i.force.vadd(E,i.force),w.cross(E,T),A.cross(E,R),o.torque.vsub(T,o.torque),i.torque.vadd(R,i.torque)}},{"../math/Vec3":30}],36:[function(t,e,n){var o=t("../math/Vec3"),i=t("../math/Transform"),r=t("../collision/RaycastResult"),s=t("../utils/Utils");function a(t){t=s.defaults(t,{chassisConnectionPointLocal:new o,chassisConnectionPointWorld:new o,directionLocal:new o,directionWorld:new o,axleLocal:new o,axleWorld:new o,suspensionRestLength:1,suspensionMaxLength:2,radius:1,suspensionStiffness:100,dampingCompression:10,dampingRelaxation:10,frictionSlip:1e4,steering:0,rotation:0,deltaRotation:0,rollInfluence:.01,maxSuspensionForce:Number.MAX_VALUE,isFrontWheel:!0,clippedInvContactDotSuspension:1,suspensionRelativeVelocity:0,suspensionForce:0,skidInfo:0,suspensionLength:0,maxSuspensionTravel:1,useCustomSlidingRotationalSpeed:!1,customSlidingRotationalSpeed:-.1}),this.maxSuspensionTravel=t.maxSuspensionTravel,this.customSlidingRotationalSpeed=t.customSlidingRotationalSpeed,this.useCustomSlidingRotationalSpeed=t.useCustomSlidingRotationalSpeed,this.sliding=!1,this.chassisConnectionPointLocal=t.chassisConnectionPointLocal.clone(),this.chassisConnectionPointWorld=t.chassisConnectionPointWorld.clone(),this.directionLocal=t.directionLocal.clone(),this.directionWorld=t.directionWorld.clone(),this.axleLocal=t.axleLocal.clone(),this.axleWorld=t.axleWorld.clone(),this.suspensionRestLength=t.suspensionRestLength,this.suspensionMaxLength=t.suspensionMaxLength,this.radius=t.radius,this.suspensionStiffness=t.suspensionStiffness,this.dampingCompression=t.dampingCompression,this.dampingRelaxation=t.dampingRelaxation,this.frictionSlip=t.frictionSlip,this.steering=0,this.rotation=0,this.deltaRotation=0,this.rollInfluence=t.rollInfluence,this.maxSuspensionForce=t.maxSuspensionForce,this.engineForce=0,this.brake=0,this.isFrontWheel=t.isFrontWheel,this.clippedInvContactDotSuspension=1,this.suspensionRelativeVelocity=0,this.suspensionForce=0,this.skidInfo=0,this.suspensionLength=0,this.sideImpulse=0,this.forwardImpulse=0,this.raycastResult=new r,this.worldTransform=new i,this.isInContact=!1}e.exports=a;var u=new o,l=new o;u=new o,a.prototype.updateWheel=function(t){var e=this.raycastResult;if(this.isInContact){var n=e.hitNormalWorld.dot(e.directionWorld);e.hitPointWorld.vsub(t.position,l),t.getVelocityAtWorldPoint(l,u);var o=e.hitNormalWorld.dot(u);if(n>=-.1)this.suspensionRelativeVelocity=0,this.clippedInvContactDotSuspension=10;else{var i=-1/n;this.suspensionRelativeVelocity=o*i,this.clippedInvContactDotSuspension=i}}else e.suspensionLength=this.suspensionRestLength,this.suspensionRelativeVelocity=0,e.directionWorld.scale(-1,e.hitNormalWorld),this.clippedInvContactDotSuspension=1}},{"../collision/RaycastResult":10,"../math/Transform":29,"../math/Vec3":30,"../utils/Utils":53}],37:[function(t,e,n){e.exports=s;var o=t("./Shape"),i=t("../math/Vec3"),r=t("./ConvexPolyhedron");function s(t){o.call(this),this.type=o.types.BOX,this.halfExtents=t,this.convexPolyhedronRepresentation=null,this.updateConvexPolyhedronRepresentation(),this.updateBoundingSphereRadius()}s.prototype=new o,s.prototype.constructor=s,s.prototype.updateConvexPolyhedronRepresentation=function(){var t=this.halfExtents.x,e=this.halfExtents.y,n=this.halfExtents.z,o=i,s=[new o(-t,-e,-n),new o(t,-e,-n),new o(t,e,-n),new o(-t,e,-n),new o(-t,-e,n),new o(t,-e,n),new o(t,e,n),new o(-t,e,n)],a=(new o(0,0,1),new o(0,1,0),new o(1,0,0),new r(s,[[3,2,1,0],[4,5,6,7],[5,4,0,1],[2,3,7,6],[0,4,7,3],[1,2,6,5]]));this.convexPolyhedronRepresentation=a,a.material=this.material},s.prototype.calculateLocalInertia=function(t,e){return e=e||new i,s.calculateInertia(this.halfExtents,t,e),e},s.calculateInertia=function(t,e,n){var o=t;n.x=1/12*e*(2*o.y*2*o.y+2*o.z*2*o.z),n.y=1/12*e*(2*o.x*2*o.x+2*o.z*2*o.z),n.z=1/12*e*(2*o.y*2*o.y+2*o.x*2*o.x)},s.prototype.getSideNormals=function(t,e){var n=t,o=this.halfExtents;if(n[0].set(o.x,0,0),n[1].set(0,o.y,0),n[2].set(0,0,o.z),n[3].set(-o.x,0,0),n[4].set(0,-o.y,0),n[5].set(0,0,-o.z),void 0!==e)for(var i=0;i!==n.length;i++)e.vmult(n[i],n[i]);return n},s.prototype.volume=function(){return 8*this.halfExtents.x*this.halfExtents.y*this.halfExtents.z},s.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.halfExtents.norm()};var a=new i;new i,s.prototype.forEachWorldCorner=function(t,e,n){for(var o=this.halfExtents,i=[[o.x,o.y,o.z],[-o.x,o.y,o.z],[-o.x,-o.y,o.z],[-o.x,-o.y,-o.z],[o.x,-o.y,-o.z],[o.x,o.y,-o.z],[-o.x,o.y,-o.z],[o.x,-o.y,o.z]],r=0;r<i.length;r++)a.set(i[r][0],i[r][1],i[r][2]),e.vmult(a,a),t.vadd(a,a),n(a.x,a.y,a.z)};var u=[new i,new i,new i,new i,new i,new i,new i,new i];s.prototype.calculateWorldAABB=function(t,e,n,o){var i=this.halfExtents;u[0].set(i.x,i.y,i.z),u[1].set(-i.x,i.y,i.z),u[2].set(-i.x,-i.y,i.z),u[3].set(-i.x,-i.y,-i.z),u[4].set(i.x,-i.y,-i.z),u[5].set(i.x,i.y,-i.z),u[6].set(-i.x,i.y,-i.z),u[7].set(i.x,-i.y,i.z);var r=u[0];e.vmult(r,r),t.vadd(r,r),o.copy(r),n.copy(r);for(var s=1;s<8;s++){r=u[s],e.vmult(r,r),t.vadd(r,r);var a=r.x,l=r.y,h=r.z;a>o.x&&(o.x=a),l>o.y&&(o.y=l),h>o.z&&(o.z=h),a<n.x&&(n.x=a),l<n.y&&(n.y=l),h<n.z&&(n.z=h)}}},{"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],38:[function(t,e,n){e.exports=s;var o=t("./Shape"),i=t("../math/Vec3"),r=(t("../math/Quaternion"),t("../math/Transform"));function s(t,e,n){o.call(this),this.type=o.types.CONVEXPOLYHEDRON,this.vertices=t||[],this.worldVertices=[],this.worldVerticesNeedsUpdate=!0,this.faces=e||[],this.faceNormals=[],this.computeNormals(),this.worldFaceNormalsNeedsUpdate=!0,this.worldFaceNormals=[],this.uniqueEdges=[],this.uniqueAxes=n?n.slice():null,this.computeEdges(),this.updateBoundingSphereRadius()}s.prototype=new o,s.prototype.constructor=s;var a=new i;s.prototype.computeEdges=function(){var t=this.faces,e=this.vertices,n=(e.length,this.uniqueEdges);n.length=0;for(var o=a,i=0;i!==t.length;i++)for(var r=t[i],s=r.length,u=0;u!==s;u++){var l=(u+1)%s;e[r[u]].vsub(e[r[l]],o),o.normalize();for(var h=!1,c=0;c!==n.length;c++)if(n[c].almostEquals(o)||n[c].almostEquals(o)){h=!0;break}h||n.push(o.clone())}},s.prototype.computeNormals=function(){this.faceNormals.length=this.faces.length;for(var t=0;t<this.faces.length;t++){for(var e=0;e<this.faces[t].length;e++)if(!this.vertices[this.faces[t][e]])throw new Error("Vertex "+this.faces[t][e]+" not found!");var n=this.faceNormals[t]||new i;this.getFaceNormal(t,n),n.negate(n),this.faceNormals[t]=n;var o=this.vertices[this.faces[t][0]];if(n.dot(o)<0)for(console.error(".faceNormals["+t+"] = Vec3("+n.toString()+") looks like it points into the shape? The vertices follow. Make sure they are ordered CCW around the normal, using the right hand rule."),e=0;e<this.faces[t].length;e++)console.warn(".vertices["+this.faces[t][e]+"] = Vec3("+this.vertices[this.faces[t][e]].toString()+")")}};var u=new i,l=new i;s.computeNormal=function(t,e,n,o){e.vsub(t,l),n.vsub(e,u),u.cross(l,o),o.isZero()||o.normalize()},s.prototype.getFaceNormal=function(t,e){var n=this.faces[t],o=this.vertices[n[0]],i=this.vertices[n[1]],r=this.vertices[n[2]];return s.computeNormal(o,i,r,e)};var h=new i;s.prototype.clipAgainstHull=function(t,e,n,o,r,s,a,u,l){for(var c=h,d=-1,p=-Number.MAX_VALUE,f=0;f<n.faces.length;f++){c.copy(n.faceNormals[f]),r.vmult(c,c);var v=c.dot(s);v>p&&(p=v,d=f)}for(var m=[],_=n.faces[d],y=_.length,E=0;E<y;E++){var g=n.vertices[_[E]],b=new i;b.copy(g),r.vmult(b,b),o.vadd(b,b),m.push(b)}d>=0&&this.clipFaceAgainstHull(s,t,e,m,a,u,l)};var c=new i,d=new i,p=new i,f=new i,v=new i,m=new i;s.prototype.findSeparatingAxis=function(t,e,n,o,i,r,s,a){var u=c,l=d,h=p,_=f,y=v,E=m,g=Number.MAX_VALUE,b=this;if(b.uniqueAxes)for(w=0;w!==b.uniqueAxes.length;w++){if(n.vmult(b.uniqueAxes[w],u),!1===(R=b.testSepAxis(u,t,e,n,o,i)))return!1;R<g&&(g=R,r.copy(u))}else for(var x=s?s.length:b.faces.length,w=0;w<x;w++){var A=s?s[w]:w;if(u.copy(b.faceNormals[A]),n.vmult(u,u),!1===(R=b.testSepAxis(u,t,e,n,o,i)))return!1;R<g&&(g=R,r.copy(u))}if(t.uniqueAxes)for(w=0;w!==t.uniqueAxes.length;w++){if(i.vmult(t.uniqueAxes[w],l),!1===(R=b.testSepAxis(l,t,e,n,o,i)))return!1;R<g&&(g=R,r.copy(l))}else{var T=a?a.length:t.faces.length;for(w=0;w<T;w++){var R;if(A=a?a[w]:w,l.copy(t.faceNormals[A]),i.vmult(l,l),!1===(R=b.testSepAxis(l,t,e,n,o,i)))return!1;R<g&&(g=R,r.copy(l))}}for(var M=0;M!==b.uniqueEdges.length;M++){n.vmult(b.uniqueEdges[M],_);for(var S=0;S!==t.uniqueEdges.length;S++)if(i.vmult(t.uniqueEdges[S],y),_.cross(y,E),!E.almostZero()){E.normalize();var C=b.testSepAxis(E,t,e,n,o,i);if(!1===C)return!1;C<g&&(g=C,r.copy(E))}}return o.vsub(e,h),h.dot(r)>0&&r.negate(r),!0};var _=[],y=[];s.prototype.testSepAxis=function(t,e,n,o,i,r){s.project(this,t,n,o,_),s.project(e,t,i,r,y);var a=_[0],u=_[1],l=y[0],h=y[1];if(a<h||l<u)return!1;var c=a-h,d=l-u;return c<d?c:d};var E=new i,g=new i;s.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(E,g);var n=g.x-E.x,o=g.y-E.y,i=g.z-E.z;e.x=1/12*t*(2*o*2*o+2*i*2*i),e.y=1/12*t*(2*n*2*n+2*i*2*i),e.z=1/12*t*(2*o*2*o+2*n*2*n)},s.prototype.getPlaneConstantOfFace=function(t){var e=this.faces[t],n=this.faceNormals[t],o=this.vertices[e[0]];return-n.dot(o)};var b=new i,x=new i,w=new i,A=new i,T=new i,R=new i,M=new i,S=new i;s.prototype.clipFaceAgainstHull=function(t,e,n,o,i,r,s){for(var a=b,u=x,l=w,h=A,c=T,d=R,p=M,f=S,v=this,m=o,_=[],y=-1,E=Number.MAX_VALUE,g=0;g<v.faces.length;g++){a.copy(v.faceNormals[g]),n.vmult(a,a);var C=a.dot(t);C<E&&(E=C,y=g)}if(!(y<0)){var L=v.faces[y];L.connectedFaces=[];for(var N=0;N<v.faces.length;N++)for(var P=0;P<v.faces[N].length;P++)-1!==L.indexOf(v.faces[N][P])&&N!==y&&-1===L.connectedFaces.indexOf(N)&&L.connectedFaces.push(N);m.length;for(var I=L.length,B=0;B<I;B++){var F=v.vertices[L[B]],O=v.vertices[L[(B+1)%I]];F.vsub(O,u),l.copy(u),n.vmult(l,l),e.vadd(l,l),h.copy(this.faceNormals[y]),n.vmult(h,h),e.vadd(h,h),l.cross(h,c),c.negate(c),d.copy(F),n.vmult(d,d),e.vadd(d,d),d.dot(c);var U=L.connectedFaces[B];p.copy(this.faceNormals[U]);var V=this.getPlaneConstantOfFace(U);f.copy(p),n.vmult(f,f);var D=V-f.dot(e);for(this.clipFaceAgainstPlane(m,_,f,D);m.length;)m.shift();for(;_.length;)m.push(_.shift())}for(p.copy(this.faceNormals[y]),V=this.getPlaneConstantOfFace(y),f.copy(p),n.vmult(f,f),D=V-f.dot(e),N=0;N<m.length;N++){var q=f.dot(m[N])+D;if(q<=i&&(console.log("clamped: depth="+q+" to minDist="+i),q=i),q<=r){var z=m[N];if(q<=0){var k={point:z,normal:f,depth:q};s.push(k)}}}}},s.prototype.clipFaceAgainstPlane=function(t,e,n,o){var r,s,a=t.length;if(a<2)return e;var u=t[t.length-1],l=t[0];r=n.dot(u)+o;for(var h=0;h<a;h++){if(l=t[h],s=n.dot(l)+o,r<0)if(s<0)(c=new i).copy(l),e.push(c);else{var c=new i;u.lerp(l,r/(r-s),c),e.push(c)}else s<0&&(c=new i,u.lerp(l,r/(r-s),c),e.push(c),e.push(l));u=l,r=s}return e},s.prototype.computeWorldVertices=function(t,e){for(var n=this.vertices.length;this.worldVertices.length<n;)this.worldVertices.push(new i);for(var o=this.vertices,r=this.worldVertices,s=0;s!==n;s++)e.vmult(o[s],r[s]),t.vadd(r[s],r[s]);this.worldVerticesNeedsUpdate=!1},new i,s.prototype.computeLocalAABB=function(t,e){var n=this.vertices.length,o=this.vertices;t.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE),e.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);for(var i=0;i<n;i++){var r=o[i];r.x<t.x?t.x=r.x:r.x>e.x&&(e.x=r.x),r.y<t.y?t.y=r.y:r.y>e.y&&(e.y=r.y),r.z<t.z?t.z=r.z:r.z>e.z&&(e.z=r.z)}},s.prototype.computeWorldFaceNormals=function(t){for(var e=this.faceNormals.length;this.worldFaceNormals.length<e;)this.worldFaceNormals.push(new i);for(var n=this.faceNormals,o=this.worldFaceNormals,r=0;r!==e;r++)t.vmult(n[r],o[r]);this.worldFaceNormalsNeedsUpdate=!1},s.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=0,o=e.length;n!==o;n++){var i=e[n].norm2();i>t&&(t=i)}this.boundingSphereRadius=Math.sqrt(t)};var C=new i;s.prototype.calculateWorldAABB=function(t,e,n,o){for(var i,r,s,a,u,l,h=this.vertices.length,c=this.vertices,d=0;d<h;d++){C.copy(c[d]),e.vmult(C,C),t.vadd(C,C);var p=C;p.x<i||void 0===i?i=p.x:(p.x>a||void 0===a)&&(a=p.x),p.y<r||void 0===r?r=p.y:(p.y>u||void 0===u)&&(u=p.y),p.z<s||void 0===s?s=p.z:(p.z>l||void 0===l)&&(l=p.z)}n.set(i,r,s),o.set(a,u,l)},s.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},s.prototype.getAveragePointLocal=function(t){t=t||new i;for(var e=this.vertices.length,n=this.vertices,o=0;o<e;o++)t.vadd(n[o],t);return t.mult(1/e,t),t},s.prototype.transformAllPoints=function(t,e){var n=this.vertices.length,o=this.vertices;if(e){for(var i=0;i<n;i++){var r=o[i];e.vmult(r,r)}for(i=0;i<this.faceNormals.length;i++)r=this.faceNormals[i],e.vmult(r,r)}if(t)for(i=0;i<n;i++)(r=o[i]).vadd(t,r)};var L=new i,N=new i,P=new i;s.prototype.pointIsInside=function(t){var e=this.vertices.length,n=this.vertices,o=this.faces,i=this.faceNormals,r=this.faces.length,s=L;this.getAveragePointLocal(s);for(var a=0;a<r;a++){this.faces[a].length,e=i[a];var u=n[o[a][0]],l=N;t.vsub(u,l);var h=e.dot(l),c=P;s.vsub(u,c);var d=e.dot(c);if(h<0&&d>0||h>0&&d<0)return!1}return-1},new i;var I=new i,B=new i;s.project=function(t,e,n,o,i){var s=t.vertices.length,a=I,u=0,l=0,h=B,c=t.vertices;h.setZero(),r.vectorToLocalFrame(n,o,e,a),r.pointToLocalFrame(n,o,h,h);var d=h.dot(a);l=u=c[0].dot(a);for(var p=1;p<s;p++){var f=c[p].dot(a);f>u&&(u=f),f<l&&(l=f)}if((l-=d)>(u-=d)){var v=l;l=u,u=v}i[0]=u,i[1]=l}},{"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"./Shape":43}],39:[function(t,e,n){e.exports=s;var o=t("./Shape"),i=t("../math/Vec3"),r=(t("../math/Quaternion"),t("./ConvexPolyhedron"));function s(t,e,n,s){var a=s,u=[],l=[],h=[],c=[],d=[],p=Math.cos,f=Math.sin;u.push(new i(e*p(0),e*f(0),.5*-n)),c.push(0),u.push(new i(t*p(0),t*f(0),.5*n)),d.push(1);for(var v=0;v<a;v++){var m=2*Math.PI/a*(v+1),_=2*Math.PI/a*(v+.5);v<a-1?(u.push(new i(e*p(m),e*f(m),.5*-n)),c.push(2*v+2),u.push(new i(t*p(m),t*f(m),.5*n)),d.push(2*v+3),h.push([2*v+2,2*v+3,2*v+1,2*v])):h.push([0,1,2*v+1,2*v]),(a%2==1||v<a/2)&&l.push(new i(p(_),f(_),0))}h.push(d),l.push(new i(0,0,1));var y=[];for(v=0;v<c.length;v++)y.push(c[c.length-v-1]);h.push(y),this.type=o.types.CONVEXPOLYHEDRON,r.call(this,u,h,l)}s.prototype=new r},{"../math/Quaternion":28,"../math/Vec3":30,"./ConvexPolyhedron":38,"./Shape":43}],40:[function(t,e,n){var o=t("./Shape"),i=t("./ConvexPolyhedron"),r=t("../math/Vec3"),s=t("../utils/Utils");function a(t,e){e=s.defaults(e,{maxValue:null,minValue:null,elementSize:1}),this.data=t,this.maxValue=e.maxValue,this.minValue=e.minValue,this.elementSize=e.elementSize,null===e.minValue&&this.updateMinValue(),null===e.maxValue&&this.updateMaxValue(),this.cacheEnabled=!0,o.call(this),this.pillarConvex=new i,this.pillarOffset=new r,this.type=o.types.HEIGHTFIELD,this.updateBoundingSphereRadius(),this._cachedPillars={}}e.exports=a,a.prototype=new o,a.prototype.update=function(){this._cachedPillars={}},a.prototype.updateMinValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var o=0;o!==t[n].length;o++){var i=t[n][o];i<e&&(e=i)}this.minValue=e},a.prototype.updateMaxValue=function(){for(var t=this.data,e=t[0][0],n=0;n!==t.length;n++)for(var o=0;o!==t[n].length;o++){var i=t[n][o];i>e&&(e=i)}this.maxValue=e},a.prototype.setHeightValueAtIndex=function(t,e,n){this.data[t][e]=n,this.clearCachedConvexTrianglePillar(t,e,!1),t>0&&(this.clearCachedConvexTrianglePillar(t-1,e,!0),this.clearCachedConvexTrianglePillar(t-1,e,!1)),e>0&&(this.clearCachedConvexTrianglePillar(t,e-1,!0),this.clearCachedConvexTrianglePillar(t,e-1,!1)),e>0&&t>0&&this.clearCachedConvexTrianglePillar(t-1,e-1,!0)},a.prototype.getRectMinMax=function(t,e,n,o,i){i=i||[];for(var r=this.data,s=this.minValue,a=t;a<=n;a++)for(var u=e;u<=o;u++){var l=r[a][u];l>s&&(s=l)}i[0]=this.minValue,i[1]=s},a.prototype.getIndexOfPosition=function(t,e,n,o){var i=this.elementSize,r=this.data,s=Math.floor(t/i),a=Math.floor(e/i);return n[0]=s,n[1]=a,o&&(s<0&&(s=0),a<0&&(a=0),s>=r.length-1&&(s=r.length-1),a>=r[0].length-1&&(a=r[0].length-1)),!(s<0||a<0||s>=r.length-1||a>=r[0].length-1)},a.prototype.getHeightAt=function(t,e,n){var o=[];this.getIndexOfPosition(t,e,o,n);var i=[];return this.getRectMinMax(o[0],o[1]+1,o[0],o[1]+1,i),(i[0]+i[1])/2},a.prototype.getCacheConvexTrianglePillarKey=function(t,e,n){return t+"_"+e+"_"+(n?1:0)},a.prototype.getCachedConvexTrianglePillar=function(t,e,n){return this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},a.prototype.setCachedConvexTrianglePillar=function(t,e,n,o,i){this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]={convex:o,offset:i}},a.prototype.clearCachedConvexTrianglePillar=function(t,e,n){delete this._cachedPillars[this.getCacheConvexTrianglePillarKey(t,e,n)]},a.prototype.getConvexTrianglePillar=function(t,e,n){var o=this.pillarConvex,s=this.pillarOffset;if(this.cacheEnabled){if(a=this.getCachedConvexTrianglePillar(t,e,n))return this.pillarConvex=a.convex,void(this.pillarOffset=a.offset);o=new i,s=new r,this.pillarConvex=o,this.pillarOffset=s}var a=this.data,u=this.elementSize,l=o.faces;o.vertices.length=6;for(var h=0;h<6;h++)o.vertices[h]||(o.vertices[h]=new r);for(l.length=5,h=0;h<5;h++)l[h]||(l[h]=[]);var c=o.vertices,d=(Math.min(a[t][e],a[t+1][e],a[t][e+1],a[t+1][e+1])-this.minValue)/2+this.minValue;n?(s.set((t+.75)*u,(e+.75)*u,d),c[0].set(.25*u,.25*u,a[t+1][e+1]-d),c[1].set(-.75*u,.25*u,a[t][e+1]-d),c[2].set(.25*u,-.75*u,a[t+1][e]-d),c[3].set(.25*u,.25*u,-d-1),c[4].set(-.75*u,.25*u,-d-1),c[5].set(.25*u,-.75*u,-d-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=2,l[2][1]=5,l[2][2]=3,l[2][3]=0,l[3][0]=3,l[3][1]=4,l[3][2]=1,l[3][3]=0,l[4][0]=1,l[4][1]=4,l[4][2]=5,l[4][3]=2):(s.set((t+.25)*u,(e+.25)*u,d),c[0].set(-.25*u,-.25*u,a[t][e]-d),c[1].set(.75*u,-.25*u,a[t+1][e]-d),c[2].set(-.25*u,.75*u,a[t][e+1]-d),c[3].set(-.25*u,-.25*u,-d-1),c[4].set(.75*u,-.25*u,-d-1),c[5].set(-.25*u,.75*u,-d-1),l[0][0]=0,l[0][1]=1,l[0][2]=2,l[1][0]=5,l[1][1]=4,l[1][2]=3,l[2][0]=0,l[2][1]=2,l[2][2]=5,l[2][3]=3,l[3][0]=1,l[3][1]=0,l[3][2]=3,l[3][3]=4,l[4][0]=4,l[4][1]=5,l[4][2]=2,l[4][3]=1),o.computeNormals(),o.computeEdges(),o.updateBoundingSphereRadius(),this.setCachedConvexTrianglePillar(t,e,n,o,s)},a.prototype.calculateLocalInertia=function(t,e){return(e=e||new r).set(0,0,0),e},a.prototype.volume=function(){return Number.MAX_VALUE},a.prototype.calculateWorldAABB=function(t,e,n,o){n.set(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE),o.set(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE)},a.prototype.updateBoundingSphereRadius=function(){var t=this.data,e=this.elementSize;this.boundingSphereRadius=new r(t.length*e,t[0].length*e,Math.max(Math.abs(this.maxValue),Math.abs(this.minValue))).norm()}},{"../math/Vec3":30,"../utils/Utils":53,"./ConvexPolyhedron":38,"./Shape":43}],41:[function(t,e,n){e.exports=r;var o=t("./Shape"),i=t("../math/Vec3");function r(){o.call(this),this.type=o.types.PARTICLE}r.prototype=new o,r.prototype.constructor=r,r.prototype.calculateLocalInertia=function(t,e){return(e=e||new i).set(0,0,0),e},r.prototype.volume=function(){return 0},r.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=0},r.prototype.calculateWorldAABB=function(t,e,n,o){n.copy(t),o.copy(t)}},{"../math/Vec3":30,"./Shape":43}],42:[function(t,e,n){e.exports=r;var o=t("./Shape"),i=t("../math/Vec3");function r(){o.call(this),this.type=o.types.PLANE,this.worldNormal=new i,this.worldNormalNeedsUpdate=!0,this.boundingSphereRadius=Number.MAX_VALUE}r.prototype=new o,r.prototype.constructor=r,r.prototype.computeWorldNormal=function(t){var e=this.worldNormal;e.set(0,0,1),t.vmult(e,e),this.worldNormalNeedsUpdate=!1},r.prototype.calculateLocalInertia=function(t,e){return e||new i},r.prototype.volume=function(){return Number.MAX_VALUE};var s=new i;r.prototype.calculateWorldAABB=function(t,e,n,o){s.set(0,0,1),e.vmult(s,s);var i=Number.MAX_VALUE;n.set(-i,-i,-i),o.set(i,i,i),1===s.x&&(o.x=t.x),1===s.y&&(o.y=t.y),1===s.z&&(o.z=t.z),-1===s.x&&(n.x=t.x),-1===s.y&&(n.y=t.y),-1===s.z&&(n.z=t.z)},r.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=Number.MAX_VALUE}},{"../math/Vec3":30,"./Shape":43}],43:[function(t,e,n){e.exports=o;var o=t("./Shape");function o(){this.id=o.idCounter++,this.type=0,this.boundingSphereRadius=0,this.collisionResponse=!0,this.material=null}t("../math/Vec3"),t("../math/Quaternion"),t("../material/Material"),o.prototype.constructor=o,o.prototype.updateBoundingSphereRadius=function(){throw"computeBoundingSphereRadius() not implemented for shape type "+this.type},o.prototype.volume=function(){throw"volume() not implemented for shape type "+this.type},o.prototype.calculateLocalInertia=function(t,e){throw"calculateLocalInertia() not implemented for shape type "+this.type},o.idCounter=0,o.types={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256}},{"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"./Shape":43}],44:[function(t,e,n){e.exports=r;var o=t("./Shape"),i=t("../math/Vec3");function r(t){if(o.call(this),this.radius=void 0!==t?Number(t):1,this.type=o.types.SPHERE,this.radius<0)throw new Error("The sphere radius cannot be negative.");this.updateBoundingSphereRadius()}r.prototype=new o,r.prototype.constructor=r,r.prototype.calculateLocalInertia=function(t,e){e=e||new i;var n=2*t*this.radius*this.radius/5;return e.x=n,e.y=n,e.z=n,e},r.prototype.volume=function(){return 4*Math.PI*this.radius/3},r.prototype.updateBoundingSphereRadius=function(){this.boundingSphereRadius=this.radius},r.prototype.calculateWorldAABB=function(t,e,n,o){for(var i=this.radius,r=["x","y","z"],s=0;s<r.length;s++){var a=r[s];n[a]=t[a]-i,o[a]=t[a]+i}}},{"../math/Vec3":30,"./Shape":43}],45:[function(t,e,n){e.exports=u;var o=t("./Shape"),i=t("../math/Vec3"),r=(t("../math/Quaternion"),t("../math/Transform")),s=t("../collision/AABB"),a=t("../utils/Octree");function u(t,e){o.call(this),this.type=o.types.TRIMESH,this.vertices=new Float32Array(t),this.indices=new Int16Array(e),this.normals=new Float32Array(e.length),this.aabb=new s,this.edges=null,this.scale=new i(1,1,1),this.tree=new a,this.updateEdges(),this.updateNormals(),this.updateAABB(),this.updateBoundingSphereRadius(),this.updateTree()}u.prototype=new o,u.prototype.constructor=u;var l=new i;u.prototype.updateTree=function(){var t=this.tree;t.reset(),t.aabb.copy(this.aabb);var e=this.scale;t.aabb.lowerBound.x*=1/e.x,t.aabb.lowerBound.y*=1/e.y,t.aabb.lowerBound.z*=1/e.z,t.aabb.upperBound.x*=1/e.x,t.aabb.upperBound.y*=1/e.y,t.aabb.upperBound.z*=1/e.z;for(var n=new s,o=new i,r=new i,a=new i,u=[o,r,a],l=0;l<this.indices.length/3;l++){var h=3*l;this._getUnscaledVertex(this.indices[h],o),this._getUnscaledVertex(this.indices[h+1],r),this._getUnscaledVertex(this.indices[h+2],a),n.setFromPoints(u),t.insert(n,l)}t.removeEmptyNodes()};var h=new s;u.prototype.getTrianglesInAABB=function(t,e){h.copy(t);var n=this.scale,o=n.x,i=n.y,r=n.z,s=h.lowerBound,a=h.upperBound;return s.x/=o,s.y/=i,s.z/=r,a.x/=o,a.y/=i,a.z/=r,this.tree.aabbQuery(h,e)},u.prototype.setScale=function(t){var e=this.scale.x===this.scale.y===this.scale.z,n=t.x===t.y===t.z;e&&n||this.updateNormals(),this.scale.copy(t),this.updateAABB(),this.updateBoundingSphereRadius()},u.prototype.updateNormals=function(){for(var t=l,e=this.normals,n=0;n<this.indices.length/3;n++){var o=3*n,i=this.indices[o],r=this.indices[o+1],s=this.indices[o+2];this.getVertex(i,v),this.getVertex(r,m),this.getVertex(s,_),u.computeNormal(m,v,_,t),e[o]=t.x,e[o+1]=t.y,e[o+2]=t.z}},u.prototype.updateEdges=function(){for(var t={},e=function(e,n){t[i<r?i+"_"+r:r+"_"+i]=!0},n=0;n<this.indices.length/3;n++){var o=3*n,i=this.indices[o],r=this.indices[o+1];this.indices[o+2];e(),e(),e()}var s=Object.keys(t);for(this.edges=new Int16Array(2*s.length),n=0;n<s.length;n++){var a=s[n].split("_");this.edges[2*n]=parseInt(a[0],10),this.edges[2*n+1]=parseInt(a[1],10)}},u.prototype.getEdgeVertex=function(t,e,n){var o=this.edges[2*t+(e?1:0)];this.getVertex(o,n)};var c=new i,d=new i;u.prototype.getEdgeVector=function(t,e){var n=c,o=d;this.getEdgeVertex(t,0,n),this.getEdgeVertex(t,1,o),o.vsub(n,e)};var p=new i,f=new i;u.computeNormal=function(t,e,n,o){e.vsub(t,f),n.vsub(e,p),p.cross(f,o),o.isZero()||o.normalize()};var v=new i,m=new i,_=new i;u.prototype.getVertex=function(t,e){var n=this.scale;return this._getUnscaledVertex(t,e),e.x*=n.x,e.y*=n.y,e.z*=n.z,e},u.prototype._getUnscaledVertex=function(t,e){var n=3*t,o=this.vertices;return e.set(o[n],o[n+1],o[n+2])},u.prototype.getWorldVertex=function(t,e,n,o){return this.getVertex(t,o),r.pointToWorldFrame(e,n,o,o),o},u.prototype.getTriangleVertices=function(t,e,n,o){var i=3*t;this.getVertex(this.indices[i],e),this.getVertex(this.indices[i+1],n),this.getVertex(this.indices[i+2],o)},u.prototype.getNormal=function(t,e){var n=3*t;return e.set(this.normals[n],this.normals[n+1],this.normals[n+2])};var y=new s;u.prototype.calculateLocalInertia=function(t,e){this.computeLocalAABB(y);var n=y.upperBound.x-y.lowerBound.x,o=y.upperBound.y-y.lowerBound.y,i=y.upperBound.z-y.lowerBound.z;return e.set(1/12*t*(2*o*2*o+2*i*2*i),1/12*t*(2*n*2*n+2*i*2*i),1/12*t*(2*o*2*o+2*n*2*n))};var E=new i;u.prototype.computeLocalAABB=function(t){var e=t.lowerBound,n=t.upperBound,o=this.vertices.length,i=(this.vertices,E);this.getVertex(0,i),e.copy(i),n.copy(i);for(var r=0;r!==o;r++)this.getVertex(r,i),i.x<e.x?e.x=i.x:i.x>n.x&&(n.x=i.x),i.y<e.y?e.y=i.y:i.y>n.y&&(n.y=i.y),i.z<e.z?e.z=i.z:i.z>n.z&&(n.z=i.z)},u.prototype.updateAABB=function(){this.computeLocalAABB(this.aabb)},u.prototype.updateBoundingSphereRadius=function(){for(var t=0,e=this.vertices,n=new i,o=0,r=e.length/3;o!==r;o++){this.getVertex(o,n);var s=n.norm2();s>t&&(t=s)}this.boundingSphereRadius=Math.sqrt(t)},new i;var g=new r,b=new s;u.prototype.calculateWorldAABB=function(t,e,n,o){var i=g,r=b;i.position=t,i.quaternion=e,this.aabb.toWorldFrame(i,r),n.copy(r.lowerBound),o.copy(r.upperBound)},u.prototype.volume=function(){return 4*Math.PI*this.boundingSphereRadius/3},u.createTorus=function(t,e,n,o,i){t=t||1,e=e||.5,n=n||8,o=o||6,i=i||2*Math.PI;for(var r=[],s=[],a=0;a<=n;a++)for(var l=0;l<=o;l++){var h=l/o*i,c=a/n*Math.PI*2,d=(t+e*Math.cos(c))*Math.cos(h),p=(t+e*Math.cos(c))*Math.sin(h),f=e*Math.sin(c);r.push(d,p,f)}for(a=1;a<=n;a++)for(l=1;l<=o;l++){var v=(o+1)*a+l-1,m=(o+1)*(a-1)+l-1,_=(o+1)*(a-1)+l,y=(o+1)*a+l;s.push(v,m,y),s.push(m,_,y)}return new u(r,s)}},{"../collision/AABB":3,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../utils/Octree":50,"./Shape":43}],46:[function(t,e,n){e.exports=i,t("../math/Vec3"),t("../math/Quaternion");var o=t("./Solver");function i(){o.call(this),this.iterations=10,this.tolerance=1e-7}i.prototype=new o;var r=[],s=[],a=[];i.prototype.solve=function(t,e){var n,o,i,u,l,h=0,c=this.iterations,d=this.tolerance*this.tolerance,p=this.equations,f=p.length,v=e.bodies,m=v.length,_=t;if(0!==f)for(var y=0;y!==m;y++)v[y].updateSolveMassProperties();var E=s,g=a,b=r;for(E.length=f,g.length=f,b.length=f,y=0;y!==f;y++){var x=p[y];b[y]=0,g[y]=x.computeB(_),E[y]=1/x.computeC()}if(0!==f){for(y=0;y!==m;y++){var w=(R=v[y]).vlambda,A=R.wlambda;w.set(0,0,0),A&&A.set(0,0,0)}for(h=0;h!==c;h++){u=0;for(var T=0;T!==f;T++)x=p[T],n=g[T],o=E[T],(l=b[T])+(i=o*(n-x.computeGWlambda()-x.eps*l))<x.minForce?i=x.minForce-l:l+i>x.maxForce&&(i=x.maxForce-l),b[T]+=i,u+=i>0?i:-i,x.addToWlambda(i);if(u*u<d)break}for(y=0;y!==m;y++){var R,M=(R=v[y]).velocity,S=R.angularVelocity;M.vadd(R.vlambda,M),S&&S.vadd(R.wlambda,S)}}return h}},{"../math/Quaternion":28,"../math/Vec3":30,"./Solver":47}],47:[function(t,e,n){function o(){this.equations=[]}e.exports=o,o.prototype.solve=function(t,e){return 0},o.prototype.addEquation=function(t){t.enabled&&this.equations.push(t)},o.prototype.removeEquation=function(t){var e=this.equations,n=e.indexOf(t);-1!==n&&e.splice(n,1)},o.prototype.removeAllEquations=function(){this.equations.length=0}},{}],48:[function(t,e,n){e.exports=r,t("../math/Vec3"),t("../math/Quaternion");var o=t("./Solver"),i=t("../objects/Body");function r(t){for(o.call(this),this.iterations=10,this.tolerance=1e-7,this.subsolver=t,this.nodes=[],this.nodePool=[];this.nodePool.length<128;)this.nodePool.push(this.createNode())}r.prototype=new o;var s=[],a=[],u={bodies:[]},l=i.STATIC;function h(t){for(var e=t.length,n=0;n!==e;n++){var o=t[n];if(!(o.visited||o.body.type&l))return o}return!1}var c=[];function d(t,e,n,o){for(c.push(t),t.visited=!0,e(t,n,o);c.length;)for(var i,r=c.pop();i=h(r.children);)i.visited=!0,e(i,n,o),c.push(i)}function p(t,e,n){e.push(t.body);for(var o=t.eqs.length,i=0;i!==o;i++){var r=t.eqs[i];-1===n.indexOf(r)&&n.push(r)}}function f(t,e){return e.id-t.id}r.prototype.createNode=function(){return{body:null,children:[],eqs:[],visited:!1}},r.prototype.solve=function(t,e){for(var n=s,o=this.nodePool,i=e.bodies,r=this.equations,l=r.length,c=i.length,v=this.subsolver;o.length<c;)o.push(this.createNode());n.length=c;for(var m=0;m<c;m++)n[m]=o[m];for(m=0;m!==c;m++){var _=n[m];_.body=i[m],_.children.length=0,_.eqs.length=0,_.visited=!1}for(var y=0;y!==l;y++){var E=r[y],g=(m=i.indexOf(E.bi),i.indexOf(E.bj)),b=n[m],x=n[g];b.children.push(x),b.eqs.push(E),x.children.push(b),x.eqs.push(E)}var w,A=0,T=a;v.tolerance=this.tolerance,v.iterations=this.iterations;for(var R=u;w=h(n);){T.length=0,R.bodies.length=0,d(w,p,R.bodies,T);var M=T.length;for(T=T.sort(f),m=0;m!==M;m++)v.addEquation(T[m]);v.solve(t,R),v.removeAllEquations(),A++}return A}},{"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"./Solver":47}],49:[function(t,e,n){var o=function(){};e.exports=o,o.prototype={constructor:o,addEventListener:function(t,e){void 0===this._listeners&&(this._listeners={});var n=this._listeners;return void 0===n[t]&&(n[t]=[]),-1===n[t].indexOf(e)&&n[t].push(e),this},hasEventListener:function(t,e){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[t]&&-1!==n[t].indexOf(e)},removeEventListener:function(t,e){if(void 0===this._listeners)return this;var n=this._listeners;if(void 0===n[t])return this;var o=n[t].indexOf(e);return-1!==o&&n[t].splice(o,1),this},dispatchEvent:function(t){if(void 0===this._listeners)return this;var e=this._listeners[t.type];if(void 0!==e){t.target=this;for(var n=0,o=e.length;n<o;n++)e[n].call(this,t)}return this}}},{}],50:[function(t,e,n){var o=t("../collision/AABB"),i=t("../math/Vec3");function r(t){t=t||{},this.root=t.root||null,this.aabb=t.aabb?t.aabb.clone():new o,this.data=[],this.children=[]}function s(t,e){(e=e||{}).root=null,e.aabb=t,r.call(this,e),this.maxDepth=void 0!==e.maxDepth?e.maxDepth:8}e.exports=s,s.prototype=new r,r.prototype.reset=function(t,e){this.children.length=this.data.length=0},r.prototype.insert=function(t,e,n){var o=this.data;if(n=n||0,!this.aabb.contains(t))return!1;var i=this.children;if(n<(this.maxDepth||this.root.maxDepth)){var r=!1;i.length||(this.subdivide(),r=!0);for(var s=0;8!==s;s++)if(i[s].insert(t,e,n+1))return!0;r&&(i.length=0)}return o.push(e),!0};var a=new i;r.prototype.subdivide=function(){var t=this.aabb,e=t.lowerBound,n=t.upperBound,s=this.children;s.push(new r({aabb:new o({lowerBound:new i(0,0,0)})}),new r({aabb:new o({lowerBound:new i(1,0,0)})}),new r({aabb:new o({lowerBound:new i(1,1,0)})}),new r({aabb:new o({lowerBound:new i(1,1,1)})}),new r({aabb:new o({lowerBound:new i(0,1,1)})}),new r({aabb:new o({lowerBound:new i(0,0,1)})}),new r({aabb:new o({lowerBound:new i(1,0,1)})}),new r({aabb:new o({lowerBound:new i(0,1,0)})})),n.vsub(e,a),a.scale(.5,a);for(var u=this.root||this,l=0;8!==l;l++){var h=s[l];h.root=u;var c=h.aabb.lowerBound;c.x*=a.x,c.y*=a.y,c.z*=a.z,c.vadd(e,c),c.vadd(a,h.aabb.upperBound)}},r.prototype.aabbQuery=function(t,e){this.data,this.children;for(var n=[this];n.length;){var o=n.pop();o.aabb.overlaps(t)&&Array.prototype.push.apply(e,o.data),Array.prototype.push.apply(n,o.children)}return e};var u=new o;r.prototype.rayQuery=function(t,e,n){return t.getAABB(u),u.toLocalFrame(e,u),this.aabbQuery(u,n),n},r.prototype.removeEmptyNodes=function(){for(var t=[this];t.length;){for(var e=t.pop(),n=e.children.length-1;n>=0;n--)e.children[n].data.length||e.children.splice(n,1);Array.prototype.push.apply(t,e.children)}}},{"../collision/AABB":3,"../math/Vec3":30}],51:[function(t,e,n){function o(){this.objects=[],this.type=Object}e.exports=o,o.prototype.release=function(){for(var t=arguments.length,e=0;e!==t;e++)this.objects.push(arguments[e])},o.prototype.get=function(){return 0===this.objects.length?this.constructObject():this.objects.pop()},o.prototype.constructObject=function(){throw new Error("constructObject() not implemented in this Pool subclass yet!")}},{}],52:[function(t,e,n){function o(){this.data={keys:[]}}e.exports=o,o.prototype.get=function(t,e){if(t>e){var n=e;e=t,t=n}return this.data[t+"-"+e]},o.prototype.set=function(t,e,n){if(t>e){var o=e;e=t,t=o}var i=t+"-"+e;this.get(t,e)||this.data.keys.push(i),this.data[i]=n},o.prototype.reset=function(){for(var t=this.data,e=t.keys;e.length>0;)delete t[e.pop()]}},{}],53:[function(t,e,n){function o(){}e.exports=o,o.defaults=function(t,e){for(var n in t=t||{},e)n in t||(t[n]=e[n]);return t}},{}],54:[function(t,e,n){e.exports=r;var o=t("../math/Vec3"),i=t("./Pool");function r(){i.call(this),this.type=o}r.prototype=new i,r.prototype.constructObject=function(){return new o}},{"../math/Vec3":30,"./Pool":51}],55:[function(t,e,n){e.exports=d;var o=t("../collision/AABB"),i=t("../shapes/Shape"),r=t("../collision/Ray"),s=t("../math/Vec3"),a=t("../math/Transform"),u=(t("../shapes/ConvexPolyhedron"),t("../math/Quaternion")),l=(t("../solver/Solver"),t("../utils/Vec3Pool")),h=t("../equations/ContactEquation"),c=t("../equations/FrictionEquation");function d(t){this.contactPointPool=[],this.frictionEquationPool=[],this.result=[],this.frictionResult=[],this.v3pool=new l,this.world=t,this.currentContactMaterial=null,this.enableFrictionReduction=!1}d.prototype.createContactEquation=function(t,e,n,o,i,r){var s;this.contactPointPool.length?((s=this.contactPointPool.pop()).bi=t,s.bj=e):s=new h(t,e),s.enabled=t.collisionResponse&&e.collisionResponse&&n.collisionResponse&&o.collisionResponse;var a=this.currentContactMaterial;s.restitution=a.restitution,s.setSpookParams(a.contactEquationStiffness,a.contactEquationRelaxation,this.world.dt);var u=n.material||t.material,l=o.material||e.material;return u&&l&&u.restitution>=0&&l.restitution>=0&&(s.restitution=u.restitution*l.restitution),s.si=i||n,s.sj=r||o,s},d.prototype.createFrictionEquationsFromContact=function(t,e){var n=t.bi,o=t.bj,i=t.si,r=t.sj,s=this.world,a=this.currentContactMaterial,u=a.friction,l=i.material||n.material,h=r.material||o.material;if(l&&h&&l.friction>=0&&h.friction>=0&&(u=l.friction*h.friction),u>0){var d=u*s.gravity.length(),p=n.invMass+o.invMass;p>0&&(p=1/p);var f=this.frictionEquationPool,v=f.length?f.pop():new c(n,o,d*p),m=f.length?f.pop():new c(n,o,d*p);return v.bi=m.bi=n,v.bj=m.bj=o,v.minForce=m.minForce=-d*p,v.maxForce=m.maxForce=d*p,v.ri.copy(t.ri),v.rj.copy(t.rj),m.ri.copy(t.ri),m.rj.copy(t.rj),t.ni.tangents(v.t,m.t),v.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),m.setSpookParams(a.frictionEquationStiffness,a.frictionEquationRelaxation,s.dt),v.enabled=m.enabled=t.enabled,e.push(v,m),!0}return!1};var p=new s,f=new s,v=new s;d.prototype.createFrictionFromAverage=function(t){var e=this.result[this.result.length-1];if(this.createFrictionEquationsFromContact(e,this.frictionResult)&&1!==t){var n=this.frictionResult[this.frictionResult.length-2],o=this.frictionResult[this.frictionResult.length-1];p.setZero(),f.setZero(),v.setZero();for(var i=e.bi,r=(e.bj,0);r!==t;r++)(e=this.result[this.result.length-1-r]).bodyA!==i?(p.vadd(e.ni,p),f.vadd(e.ri,f),v.vadd(e.rj,v)):(p.vsub(e.ni,p),f.vadd(e.rj,f),v.vadd(e.ri,v));var s=1/t;f.scale(s,n.ri),v.scale(s,n.rj),o.ri.copy(n.ri),o.rj.copy(n.rj),p.normalize(),p.tangents(n.t,o.t)}};var m=new s,_=new s,y=new u,E=new u;d.prototype.getContacts=function(t,e,n,o,i,r,s){this.contactPointPool=i,this.frictionEquationPool=s,this.result=o,this.frictionResult=r;for(var a=y,u=E,l=m,h=_,c=0,d=t.length;c!==d;c++){var p=t[c],f=e[c],v=null;p.material&&f.material&&(v=n.getContactMaterial(p.material,f.material)||null);for(var g=0;g<p.shapes.length;g++){p.quaternion.mult(p.shapeOrientations[g],a),p.quaternion.vmult(p.shapeOffsets[g],l),l.vadd(p.position,l);for(var b=p.shapes[g],x=0;x<f.shapes.length;x++){f.quaternion.mult(f.shapeOrientations[x],u),f.quaternion.vmult(f.shapeOffsets[x],h),h.vadd(f.position,h);var w=f.shapes[x];if(!(l.distanceTo(h)>b.boundingSphereRadius+w.boundingSphereRadius)){var A=null;b.material&&w.material&&(A=n.getContactMaterial(b.material,w.material)||null),this.currentContactMaterial=A||v||n.defaultContactMaterial;var T=this[b.type|w.type];T&&(b.type<w.type?T.call(this,b,w,l,h,a,u,p,f,b,w):T.call(this,w,b,h,l,u,a,f,p,b,w))}}}}},d.prototype[i.types.BOX|i.types.BOX]=d.prototype.boxBox=function(t,e,n,o,i,r,s,a){t.convexPolyhedronRepresentation.material=t.material,e.convexPolyhedronRepresentation.material=e.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e.convexPolyhedronRepresentation,n,o,i,r,s,a,t,e)},d.prototype[i.types.BOX|i.types.CONVEXPOLYHEDRON]=d.prototype.boxConvex=function(t,e,n,o,i,r,s,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexConvex(t.convexPolyhedronRepresentation,e,n,o,i,r,s,a,t,e)},d.prototype[i.types.BOX|i.types.PARTICLE]=d.prototype.boxParticle=function(t,e,n,o,i,r,s,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexParticle(t.convexPolyhedronRepresentation,e,n,o,i,r,s,a,t,e)},d.prototype[i.types.SPHERE]=d.prototype.sphereSphere=function(t,e,n,o,i,r,s,a){var u=this.createContactEquation(s,a,t,e);o.vsub(n,u.ni),u.ni.normalize(),u.ri.copy(u.ni),u.rj.copy(u.ni),u.ri.mult(t.radius,u.ri),u.rj.mult(-e.radius,u.rj),u.ri.vadd(n,u.ri),u.ri.vsub(s.position,u.ri),u.rj.vadd(o,u.rj),u.rj.vsub(a.position,u.rj),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)};var g=new s,b=new s,x=new s;d.prototype[i.types.PLANE|i.types.TRIMESH]=d.prototype.planeTrimesh=function(t,e,n,o,i,r,u,l){var h=new s,c=g;c.set(0,0,1),i.vmult(c,c);for(var d=0;d<e.vertices.length/3;d++){e.getVertex(d,h);var p=new s;p.copy(h),a.pointToWorldFrame(o,r,p,h);var f=b;if(h.vsub(n,f),c.dot(f)<=0){var v=this.createContactEquation(u,l,t,e);v.ni.copy(c);var m=x;c.scale(f.dot(c),m),h.vsub(m,m),v.ri.copy(m),v.ri.vsub(u.position,v.ri),v.rj.copy(h),v.rj.vsub(l.position,v.rj),this.result.push(v),this.createFrictionEquationsFromContact(v,this.frictionResult)}}};var w=new s,A=new s,T=(new s,new s),R=new s,M=new s,S=new s,C=new s,L=new s,N=new s,P=new s,I=new s,B=new s,F=new s,O=new o,U=[];d.prototype[i.types.SPHERE|i.types.TRIMESH]=d.prototype.sphereTrimesh=function(t,e,n,o,i,s,u,l){var h=M,c=S,d=C,p=L,f=N,v=P,m=O,_=R,y=A,E=U;a.pointToLocalFrame(o,s,n,f);var g=t.radius;m.lowerBound.set(f.x-g,f.y-g,f.z-g),m.upperBound.set(f.x+g,f.y+g,f.z+g),e.getTrianglesInAABB(m,E);for(var b=T,x=t.radius*t.radius,V=0;V<E.length;V++)for(var D=0;D<3;D++)e.getVertex(e.indices[3*E[V]+D],b),b.vsub(f,y),y.norm2()<=x&&(_.copy(b),a.pointToWorldFrame(o,s,_,b),b.vsub(n,y),(k=this.createContactEquation(u,l,t,e)).ni.copy(y),k.ni.normalize(),k.ri.copy(k.ni),k.ri.scale(t.radius,k.ri),k.ri.vadd(n,k.ri),k.ri.vsub(u.position,k.ri),k.rj.copy(b),k.rj.vsub(l.position,k.rj),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult));for(V=0;V<E.length;V++)for(D=0;D<3;D++){e.getVertex(e.indices[3*E[V]+D],h),e.getVertex(e.indices[3*E[V]+(D+1)%3],c),c.vsub(h,d),f.vsub(c,v);var q=v.dot(d);f.vsub(h,v);var z=v.dot(d);if(z>0&&q<0&&(f.vsub(h,v),p.copy(d),p.normalize(),z=v.dot(p),p.scale(z,v),v.vadd(h,v),(Y=v.distanceTo(f))<t.radius)){var k=this.createContactEquation(u,l,t,e);v.vsub(f,k.ni),k.ni.normalize(),k.ni.scale(t.radius,k.ri),a.pointToWorldFrame(o,s,v,v),v.vsub(l.position,k.rj),a.vectorToWorldFrame(s,k.ni,k.ni),a.vectorToWorldFrame(s,k.ri,k.ri),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult)}}for(var j=I,G=B,H=F,W=w,X=(V=0,E.length);V!==X;V++){e.getTriangleVertices(E[V],j,G,H),e.getNormal(E[V],W),f.vsub(j,v);var Y=v.dot(W);W.scale(Y,v),f.vsub(v,v),Y=v.distanceTo(f),r.pointInTriangle(v,j,G,H)&&Y<t.radius&&(k=this.createContactEquation(u,l,t,e),v.vsub(f,k.ni),k.ni.normalize(),k.ni.scale(t.radius,k.ri),a.pointToWorldFrame(o,s,v,v),v.vsub(l.position,k.rj),a.vectorToWorldFrame(s,k.ni,k.ni),a.vectorToWorldFrame(s,k.ri,k.ri),this.result.push(k),this.createFrictionEquationsFromContact(k,this.frictionResult))}E.length=0};var V=new s,D=new s;d.prototype[i.types.SPHERE|i.types.PLANE]=d.prototype.spherePlane=function(t,e,n,o,i,r,s,a){var u=this.createContactEquation(s,a,t,e);if(u.ni.set(0,0,1),r.vmult(u.ni,u.ni),u.ni.negate(u.ni),u.ni.normalize(),u.ni.mult(t.radius,u.ri),n.vsub(o,V),u.ni.mult(u.ni.dot(V),D),V.vsub(D,u.rj),-V.dot(u.ni)<=t.radius){var l=u.ri,h=u.rj;l.vadd(n,l),l.vsub(s.position,l),h.vadd(o,h),h.vsub(a.position,h),this.result.push(u),this.createFrictionEquationsFromContact(u,this.frictionResult)}};var q=new s,z=new s,k=new s;function j(t,e,n){for(var o=null,i=t.length,r=0;r!==i;r++){var s=t[r],a=q;t[(r+1)%i].vsub(s,a);var u=z;a.cross(e,u);var l=k;n.vsub(s,l);var h=u.dot(l);if(!(null===o||h>0&&!0===o||h<=0&&!1===o))return!1;null===o&&(o=h>0)}return!0}var G=new s,H=new s,W=new s,X=new s,Y=[new s,new s,new s,new s,new s,new s],K=new s,Z=new s,Q=new s,J=new s;d.prototype[i.types.SPHERE|i.types.BOX]=d.prototype.sphereBox=function(t,e,n,o,i,r,s,a){var u=this.v3pool,l=Y;n.vsub(o,G),e.getSideNormals(l,r);for(var h=t.radius,c=!1,d=Z,p=Q,f=J,v=null,m=0,_=0,y=0,E=null,g=0,b=l.length;g!==b&&!1===c;g++){var x=H;x.copy(l[g]);var w=x.norm();x.normalize();var A=G.dot(x);if(A<w+h&&A>0){var T=W,R=X;T.copy(l[(g+1)%3]),R.copy(l[(g+2)%3]);var M=T.norm(),S=R.norm();T.normalize(),R.normalize();var C=G.dot(T),L=G.dot(R);if(C<M&&C>-M&&L<S&&L>-S){var N=Math.abs(A-w-h);(null===E||N<E)&&(E=N,_=C,y=L,v=w,d.copy(x),p.copy(T),f.copy(R),m++)}}}if(m){c=!0;var P=this.createContactEquation(s,a,t,e);d.mult(-h,P.ri),P.ni.copy(d),P.ni.negate(P.ni),d.mult(v,d),p.mult(_,p),d.vadd(p,d),f.mult(y,f),d.vadd(f,P.rj),P.ri.vadd(n,P.ri),P.ri.vsub(s.position,P.ri),P.rj.vadd(o,P.rj),P.rj.vsub(a.position,P.rj),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult)}for(var I=u.get(),B=K,F=0;2!==F&&!c;F++)for(var O=0;2!==O&&!c;O++)for(var U=0;2!==U&&!c;U++)I.set(0,0,0),F?I.vadd(l[0],I):I.vsub(l[0],I),O?I.vadd(l[1],I):I.vsub(l[1],I),U?I.vadd(l[2],I):I.vsub(l[2],I),o.vadd(I,B),B.vsub(n,B),B.norm2()<h*h&&(c=!0,(P=this.createContactEquation(s,a,t,e)).ri.copy(B),P.ri.normalize(),P.ni.copy(P.ri),P.ri.mult(h,P.ri),P.rj.copy(I),P.ri.vadd(n,P.ri),P.ri.vsub(s.position,P.ri),P.rj.vadd(o,P.rj),P.rj.vsub(a.position,P.rj),this.result.push(P),this.createFrictionEquationsFromContact(P,this.frictionResult));u.release(I),I=null;var V=u.get(),D=u.get(),q=(P=u.get(),u.get()),z=(N=u.get(),l.length);for(F=0;F!==z&&!c;F++)for(O=0;O!==z&&!c;O++)if(F%3!=O%3){l[O].cross(l[F],V),V.normalize(),l[F].vadd(l[O],D),P.copy(n),P.vsub(D,P),P.vsub(o,P);var k=P.dot(V);for(V.mult(k,q),U=0;U===F%3||U===O%3;)U++;N.copy(n),N.vsub(q,N),N.vsub(D,N),N.vsub(o,N);var j=Math.abs(k),$=N.norm();if(j<l[U].norm()&&$<h){c=!0;var tt=this.createContactEquation(s,a,t,e);D.vadd(q,tt.rj),tt.rj.copy(tt.rj),N.negate(tt.ni),tt.ni.normalize(),tt.ri.copy(tt.rj),tt.ri.vadd(o,tt.ri),tt.ri.vsub(n,tt.ri),tt.ri.normalize(),tt.ri.mult(h,tt.ri),tt.ri.vadd(n,tt.ri),tt.ri.vsub(s.position,tt.ri),tt.rj.vadd(o,tt.rj),tt.rj.vsub(a.position,tt.rj),this.result.push(tt),this.createFrictionEquationsFromContact(tt,this.frictionResult)}}u.release(V,D,P,q,N)};var $=new s,tt=new s,et=new s,nt=new s,ot=new s,it=new s,rt=new s,st=new s,at=new s,ut=new s;d.prototype[i.types.SPHERE|i.types.CONVEXPOLYHEDRON]=d.prototype.sphereConvex=function(t,e,n,o,i,r,s,a){var u=this.v3pool;n.vsub(o,$);for(var l=e.faceNormals,h=e.faces,c=e.vertices,d=t.radius,p=0;p!==c.length;p++){var f=c[p],v=ot;r.vmult(f,v),o.vadd(v,v);var m=nt;if(v.vsub(n,m),m.norm2()<d*d)return _=!0,(N=this.createContactEquation(s,a,t,e)).ri.copy(m),N.ri.normalize(),N.ni.copy(N.ri),N.ri.mult(d,N.ri),v.vsub(o,N.rj),N.ri.vadd(n,N.ri),N.ri.vsub(s.position,N.ri),N.rj.vadd(o,N.rj),N.rj.vsub(a.position,N.rj),this.result.push(N),void this.createFrictionEquationsFromContact(N,this.frictionResult)}for(var _=!1,y=(p=0,h.length);p!==y&&!1===_;p++){var E=l[p],g=h[p],b=it;r.vmult(E,b);var x=rt;r.vmult(c[g[0]],x),x.vadd(o,x);var w=st;b.mult(-d,w),n.vadd(w,w);var A=at;w.vsub(x,A);var T=A.dot(b),R=ut;if(n.vsub(x,R),T<0&&R.dot(b)>0){for(var M=[],S=0,C=g.length;S!==C;S++){var L=u.get();r.vmult(c[g[S]],L),o.vadd(L,L),M.push(L)}if(j(M,b,n)){_=!0;var N=this.createContactEquation(s,a,t,e);b.mult(-d,N.ri),b.negate(N.ni);var P=u.get();b.mult(-T,P);var I=u.get();b.mult(-d,I),n.vsub(o,N.rj),N.rj.vadd(I,N.rj),N.rj.vadd(P,N.rj),N.rj.vadd(o,N.rj),N.rj.vsub(a.position,N.rj),N.ri.vadd(n,N.ri),N.ri.vsub(s.position,N.ri),u.release(P),u.release(I),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult),S=0;for(var B=M.length;S!==B;S++)u.release(M[S]);return}for(S=0;S!==g.length;S++){var F=u.get(),O=u.get();r.vmult(c[g[(S+1)%g.length]],F),r.vmult(c[g[(S+2)%g.length]],O),o.vadd(F,F),o.vadd(O,O);var U=tt;O.vsub(F,U);var V=et;U.unit(V);var D=u.get(),q=u.get();n.vsub(F,q);var z=q.dot(V);V.mult(z,D),D.vadd(F,D);var k=u.get();if(D.vsub(n,k),z>0&&z*z<U.norm2()&&k.norm2()<d*d){for(N=this.createContactEquation(s,a,t,e),D.vsub(o,N.rj),D.vsub(n,N.ni),N.ni.normalize(),N.ni.mult(d,N.ri),N.rj.vadd(o,N.rj),N.rj.vsub(a.position,N.rj),N.ri.vadd(n,N.ri),N.ri.vsub(s.position,N.ri),this.result.push(N),this.createFrictionEquationsFromContact(N,this.frictionResult),S=0,B=M.length;S!==B;S++)u.release(M[S]);return u.release(F),u.release(O),u.release(D),u.release(k),void u.release(q)}u.release(F),u.release(O),u.release(D),u.release(k),u.release(q)}for(S=0,B=M.length;S!==B;S++)u.release(M[S])}}},new s,new s,d.prototype[i.types.PLANE|i.types.BOX]=d.prototype.planeBox=function(t,e,n,o,i,r,s,a){e.convexPolyhedronRepresentation.material=e.material,e.convexPolyhedronRepresentation.collisionResponse=e.collisionResponse,this.planeConvex(t,e.convexPolyhedronRepresentation,n,o,i,r,s,a)};var lt=new s,ht=new s,ct=new s,dt=new s;d.prototype[i.types.PLANE|i.types.CONVEXPOLYHEDRON]=d.prototype.planeConvex=function(t,e,n,o,i,r,s,a){var u=lt,l=ht;l.set(0,0,1),i.vmult(l,l);for(var h=0,c=ct,d=0;d!==e.vertices.length;d++)if(u.copy(e.vertices[d]),r.vmult(u,u),o.vadd(u,u),u.vsub(n,c),l.dot(c)<=0){var p=this.createContactEquation(s,a,t,e),f=dt;l.mult(l.dot(c),f),u.vsub(f,f),f.vsub(n,p.ri),p.ni.copy(l),u.vsub(o,p.rj),p.ri.vadd(n,p.ri),p.ri.vsub(s.position,p.ri),p.rj.vadd(o,p.rj),p.rj.vsub(a.position,p.rj),this.result.push(p),h++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(p,this.frictionResult)}this.enableFrictionReduction&&h&&this.createFrictionFromAverage(h)};var pt=new s,ft=new s;d.prototype[i.types.CONVEXPOLYHEDRON]=d.prototype.convexConvex=function(t,e,n,o,i,r,s,a,u,l,h,c){var d=pt;if(!(n.distanceTo(o)>t.boundingSphereRadius+e.boundingSphereRadius)&&t.findSeparatingAxis(e,n,i,o,r,d,h,c)){var p=[],f=ft;t.clipAgainstHull(n,i,e,o,r,d,-100,100,p);for(var v=0,m=0;m!==p.length;m++){var _=this.createContactEquation(s,a,t,e,u,l),y=_.ri,E=_.rj;d.negate(_.ni),p[m].normal.negate(f),f.mult(p[m].depth,f),p[m].point.vadd(f,y),E.copy(p[m].point),y.vsub(n,y),E.vsub(o,E),y.vadd(n,y),y.vsub(s.position,y),E.vadd(o,E),E.vsub(a.position,E),this.result.push(_),v++,this.enableFrictionReduction||this.createFrictionEquationsFromContact(_,this.frictionResult)}this.enableFrictionReduction&&v&&this.createFrictionFromAverage(v)}};var vt=new s,mt=new s,_t=new s;d.prototype[i.types.PLANE|i.types.PARTICLE]=d.prototype.planeParticle=function(t,e,n,o,i,r,s,a){var u=vt;u.set(0,0,1),s.quaternion.vmult(u,u);var l=mt;if(o.vsub(s.position,l),u.dot(l)<=0){var h=this.createContactEquation(a,s,e,t);h.ni.copy(u),h.ni.negate(h.ni),h.ri.set(0,0,0);var c=_t;u.mult(u.dot(o),c),o.vsub(c,c),h.rj.copy(c),this.result.push(h),this.createFrictionEquationsFromContact(h,this.frictionResult)}};var yt=new s;d.prototype[i.types.PARTICLE|i.types.SPHERE]=d.prototype.sphereParticle=function(t,e,n,o,i,r,s,a){var u=yt;if(u.set(0,0,1),o.vsub(n,u),u.norm2()<=t.radius*t.radius){var l=this.createContactEquation(a,s,e,t);u.normalize(),l.rj.copy(u),l.rj.mult(t.radius,l.rj),l.ni.copy(u),l.ni.negate(l.ni),l.ri.set(0,0,0),this.result.push(l),this.createFrictionEquationsFromContact(l,this.frictionResult)}};var Et=new u,gt=new s,bt=(new s,new s),xt=new s,wt=new s;d.prototype[i.types.PARTICLE|i.types.CONVEXPOLYHEDRON]=d.prototype.convexParticle=function(t,e,n,o,i,r,s,a){var u=-1,l=bt,h=wt,c=null,d=gt;if(d.copy(o),d.vsub(n,d),i.conjugate(Et),Et.vmult(d,d),t.pointIsInside(d)){t.worldVerticesNeedsUpdate&&t.computeWorldVertices(n,i),t.worldFaceNormalsNeedsUpdate&&t.computeWorldFaceNormals(i);for(var p=0,f=t.faces.length;p!==f;p++){var v=[t.worldVertices[t.faces[p][0]]],m=t.worldFaceNormals[p];o.vsub(v[0],xt);var _=-m.dot(xt);(null===c||Math.abs(_)<Math.abs(c))&&(c=_,u=p,l.copy(m))}if(-1!==u){var y=this.createContactEquation(a,s,e,t);l.mult(c,h),h.vadd(o,h),h.vsub(n,h),y.rj.copy(h),l.negate(y.ni),y.ri.set(0,0,0);var E=y.ri,g=y.rj;E.vadd(o,E),E.vsub(a.position,E),g.vadd(n,g),g.vsub(s.position,g),this.result.push(y),this.createFrictionEquationsFromContact(y,this.frictionResult)}else console.warn("Point found inside convex, but did not find penetrating face!")}},d.prototype[i.types.BOX|i.types.HEIGHTFIELD]=d.prototype.boxHeightfield=function(t,e,n,o,i,r,s,a){t.convexPolyhedronRepresentation.material=t.material,t.convexPolyhedronRepresentation.collisionResponse=t.collisionResponse,this.convexHeightfield(t.convexPolyhedronRepresentation,e,n,o,i,r,s,a)};var At=new s,Tt=new s,Rt=[0];d.prototype[i.types.CONVEXPOLYHEDRON|i.types.HEIGHTFIELD]=d.prototype.convexHeightfield=function(t,e,n,o,i,r,s,u){var l=e.data,h=e.elementSize,c=t.boundingSphereRadius,d=Tt,p=Rt,f=At;a.pointToLocalFrame(o,r,n,f);var v=Math.floor((f.x-c)/h)-1,m=Math.ceil((f.x+c)/h)+1,_=Math.floor((f.y-c)/h)-1,y=Math.ceil((f.y+c)/h)+1;if(!(m<0||y<0||v>l.length||_>l[0].length)){v<0&&(v=0),m<0&&(m=0),_<0&&(_=0),y<0&&(y=0),v>=l.length&&(v=l.length-1),m>=l.length&&(m=l.length-1),y>=l[0].length&&(y=l[0].length-1),_>=l[0].length&&(_=l[0].length-1);var E=[];e.getRectMinMax(v,_,m,y,E);var g=E[0],b=E[1];if(!(f.z-c>b||f.z+c<g))for(var x=v;x<m;x++)for(var w=_;w<y;w++)e.getConvexTrianglePillar(x,w,!1),a.pointToWorldFrame(o,r,e.pillarOffset,d),n.distanceTo(d)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,d,i,r,s,u,null,null,p,null),e.getConvexTrianglePillar(x,w,!0),a.pointToWorldFrame(o,r,e.pillarOffset,d),n.distanceTo(d)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.convexConvex(t,e.pillarConvex,n,d,i,r,s,u,null,null,p,null)}};var Mt=new s,St=new s;d.prototype[i.types.SPHERE|i.types.HEIGHTFIELD]=d.prototype.sphereHeightfield=function(t,e,n,o,i,r,s,u){var l=e.data,h=t.radius,c=e.elementSize,d=St,p=Mt;a.pointToLocalFrame(o,r,n,p);var f=Math.floor((p.x-h)/c)-1,v=Math.ceil((p.x+h)/c)+1,m=Math.floor((p.y-h)/c)-1,_=Math.ceil((p.y+h)/c)+1;if(!(v<0||_<0||f>l.length||_>l[0].length)){f<0&&(f=0),v<0&&(v=0),m<0&&(m=0),_<0&&(_=0),f>=l.length&&(f=l.length-1),v>=l.length&&(v=l.length-1),_>=l[0].length&&(_=l[0].length-1),m>=l[0].length&&(m=l[0].length-1);var y=[];e.getRectMinMax(f,m,v,_,y);var E=y[0],g=y[1];if(!(p.z-h>g||p.z+h<E))for(var b=this.result,x=f;x<v;x++)for(var w=m;w<_;w++){var A=b.length;if(e.getConvexTrianglePillar(x,w,!1),a.pointToWorldFrame(o,r,e.pillarOffset,d),n.distanceTo(d)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,d,i,r,s,u),e.getConvexTrianglePillar(x,w,!0),a.pointToWorldFrame(o,r,e.pillarOffset,d),n.distanceTo(d)<e.pillarConvex.boundingSphereRadius+t.boundingSphereRadius&&this.sphereConvex(t,e.pillarConvex,n,d,i,r,s,u),b.length-A>2)return}}}},{"../collision/AABB":3,"../collision/Ray":9,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../math/Quaternion":28,"../math/Transform":29,"../math/Vec3":30,"../shapes/ConvexPolyhedron":38,"../shapes/Shape":43,"../solver/Solver":47,"../utils/Vec3Pool":54}],56:[function(t,e,n){e.exports=y;var o=t("../shapes/Shape"),i=t("../math/Vec3"),r=t("../math/Quaternion"),s=t("../solver/GSSolver"),a=(t("../utils/Vec3Pool"),t("../equations/ContactEquation"),t("../equations/FrictionEquation"),t("./Narrowphase")),u=t("../utils/EventTarget"),l=t("../collision/ArrayCollisionMatrix"),h=t("../material/Material"),c=t("../material/ContactMaterial"),d=t("../objects/Body"),p=t("../utils/TupleDictionary"),f=t("../collision/RaycastResult"),v=t("../collision/AABB"),m=t("../collision/Ray"),_=t("../collision/NaiveBroadphase");function y(){u.apply(this),this.dt=-1,this.allowSleep=!1,this.contacts=[],this.frictionEquations=[],this.quatNormalizeSkip=0,this.quatNormalizeFast=!1,this.time=0,this.stepnumber=0,this.default_dt=1/60,this.nextId=0,this.gravity=new i,this.broadphase=new _,this.bodies=[],this.solver=new s,this.constraints=[],this.narrowphase=new a(this),this.collisionMatrix=new l,this.collisionMatrixPrevious=new l,this.materials=[],this.contactmaterials=[],this.contactMaterialTable=new p,this.defaultMaterial=new h("default"),this.defaultContactMaterial=new c(this.defaultMaterial,this.defaultMaterial,{friction:.3,restitution:0}),this.doProfiling=!1,this.profile={solve:0,makeContactConstraints:0,broadphase:0,integrate:0,narrowphase:0},this.subsystems=[],this.addBodyEvent={type:"addBody",body:null},this.removeBodyEvent={type:"removeBody",body:null}}y.prototype=new u,new v;var E=new m;if(y.prototype.getContactMaterial=function(t,e){return this.contactMaterialTable.get(t.id,e.id)},y.prototype.numObjects=function(){return this.bodies.length},y.prototype.collisionMatrixTick=function(){var t=this.collisionMatrixPrevious;this.collisionMatrixPrevious=this.collisionMatrix,this.collisionMatrix=t,this.collisionMatrix.reset()},y.prototype.add=y.prototype.addBody=function(t){-1===this.bodies.indexOf(t)&&(t.index=this.bodies.length,this.bodies.push(t),t.world=this,t.initPosition.copy(t.position),t.initVelocity.copy(t.velocity),t.timeLastSleepy=this.time,t instanceof d&&(t.initAngularVelocity.copy(t.angularVelocity),t.initQuaternion.copy(t.quaternion)),this.collisionMatrix.setNumObjects(this.bodies.length),this.addBodyEvent.body=t,this.dispatchEvent(this.addBodyEvent))},y.prototype.addConstraint=function(t){this.constraints.push(t)},y.prototype.removeConstraint=function(t){var e=this.constraints.indexOf(t);-1!==e&&this.constraints.splice(e,1)},y.prototype.rayTest=function(t,e,n){n instanceof f?this.raycastClosest(t,e,{skipBackfaces:!0},n):this.raycastAll(t,e,{skipBackfaces:!0},n)},y.prototype.raycastAll=function(t,e,n,o){return n.mode=m.ALL,n.from=t,n.to=e,n.callback=o,E.intersectWorld(this,n)},y.prototype.raycastAny=function(t,e,n,o){return n.mode=m.ANY,n.from=t,n.to=e,n.result=o,E.intersectWorld(this,n)},y.prototype.raycastClosest=function(t,e,n,o){return n.mode=m.CLOSEST,n.from=t,n.to=e,n.result=o,E.intersectWorld(this,n)},y.prototype.remove=function(t){t.world=null;var e=this.bodies.length-1,n=this.bodies,o=n.indexOf(t);if(-1!==o){n.splice(o,1);for(var i=0;i!==n.length;i++)n[i].index=i;this.collisionMatrix.setNumObjects(e),this.removeBodyEvent.body=t,this.dispatchEvent(this.removeBodyEvent)}},y.prototype.removeBody=y.prototype.remove,y.prototype.addMaterial=function(t){this.materials.push(t)},y.prototype.addContactMaterial=function(t){this.contactmaterials.push(t),this.contactMaterialTable.set(t.materials[0].id,t.materials[1].id,t)},"undefined"==typeof performance&&(performance={}),!performance.now){var g=Date.now();performance.timing&&performance.timing.navigationStart&&(g=performance.timing.navigationStart),performance.now=function(){return Date.now()-g}}var b=new i;y.prototype.step=function(t,e,n){if(n=n||10,0===(e=e||0))this.internalStep(t),this.time+=t;else{var o=Math.floor((this.time+e)/t)-Math.floor(this.time/t);o=Math.min(o,n);for(var i=performance.now(),r=0;r!==o&&(this.internalStep(t),!(performance.now()-i>1e3*t));r++);this.time+=e;for(var s=this.time%t/t,a=b,u=this.bodies,l=0;l!==u.length;l++){var h=u[l];h.type!==d.STATIC&&h.sleepState!==d.SLEEPING?(h.position.vsub(h.previousPosition,a),a.scale(s,a),h.position.vadd(a,h.interpolatedPosition)):(h.interpolatedPosition.copy(h.position),h.interpolatedQuaternion.copy(h.quaternion))}}};var x={type:"postStep"},w={type:"preStep"},A={type:"collide",body:null,contact:null},T=[],R=[],M=[],S=[],C=(new i,new i,new i,new i,new i,new i,new i,new i,new i,new r,new r),L=new r,N=new i;y.prototype.internalStep=function(t){this.dt=t;var e,n=this.contacts,i=M,r=S,s=this.numObjects(),a=this.bodies,u=this.solver,l=this.gravity,h=this.doProfiling,c=this.profile,p=d.DYNAMIC,f=this.constraints,v=R,m=(l.norm(),l.x),_=l.y,y=l.z,E=0;for(h&&(e=performance.now()),E=0;E!==s;E++)if((q=a[E]).type&p){var g=q.force,b=q.mass;g.x+=b*m,g.y+=b*_,g.z+=b*y}E=0;for(var P=this.subsystems.length;E!==P;E++)this.subsystems[E].update();h&&(e=performance.now()),i.length=0,r.length=0,this.broadphase.collisionPairs(this,i,r),h&&(c.broadphase=performance.now()-e);var I=f.length;for(E=0;E!==I;E++)if(!(k=f[E]).collideConnected)for(var B=i.length-1;B>=0;B-=1)(k.bodyA===i[B]&&k.bodyB===r[B]||k.bodyB===i[B]&&k.bodyA===r[B])&&(i.splice(B,1),r.splice(B,1));this.collisionMatrixTick(),h&&(e=performance.now());var F=T,O=n.length;for(E=0;E!==O;E++)F.push(n[E]);n.length=0;var U=this.frictionEquations.length;for(E=0;E!==U;E++)v.push(this.frictionEquations[E]);for(this.frictionEquations.length=0,this.narrowphase.getContacts(i,r,this,n,F,this.frictionEquations,v),h&&(c.narrowphase=performance.now()-e),h&&(e=performance.now()),E=0;E<this.frictionEquations.length;E++)u.addEquation(this.frictionEquations[E]);for(var V=n.length,D=0;D!==V;D++){var q=(k=n[D]).bi,z=k.bj;k.si,k.sj,(q.material&&z.material&&this.getContactMaterial(q.material,z.material)||this.defaultContactMaterial).friction,q.material&&z.material&&(q.material.friction>=0&&z.material.friction>=0&&(q.material.friction,z.material.friction),q.material.restitution>=0&&z.material.restitution>=0&&(k.restitution=q.material.restitution*z.material.restitution)),u.addEquation(k),q.allowSleep&&q.type===d.DYNAMIC&&q.sleepState===d.SLEEPING&&z.sleepState===d.AWAKE&&z.type!==d.STATIC&&z.velocity.norm2()+z.angularVelocity.norm2()>=2*Math.pow(z.sleepSpeedLimit,2)&&(q._wakeUpAfterNarrowphase=!0),z.allowSleep&&z.type===d.DYNAMIC&&z.sleepState===d.SLEEPING&&q.sleepState===d.AWAKE&&q.type!==d.STATIC&&q.velocity.norm2()+q.angularVelocity.norm2()>=2*Math.pow(q.sleepSpeedLimit,2)&&(z._wakeUpAfterNarrowphase=!0),this.collisionMatrix.set(q,z,!0),this.collisionMatrixPrevious.get(q,z)||(A.body=z,A.contact=k,q.dispatchEvent(A),A.body=q,z.dispatchEvent(A))}for(h&&(c.makeContactConstraints=performance.now()-e,e=performance.now()),E=0;E!==s;E++)(q=a[E])._wakeUpAfterNarrowphase&&(q.wakeUp(),q._wakeUpAfterNarrowphase=!1);for(I=f.length,E=0;E!==I;E++){var k;(k=f[E]).update(),B=0;for(var j=k.equations.length;B!==j;B++){var G=k.equations[B];u.addEquation(G)}}u.solve(t,this),h&&(c.solve=performance.now()-e),u.removeAllEquations();var H=Math.pow;for(E=0;E!==s;E++)if((q=a[E]).type&p){var W=H(1-q.linearDamping,t),X=q.velocity;X.mult(W,X);var Y=q.angularVelocity;if(Y){var K=H(1-q.angularDamping,t);Y.mult(K,Y)}}for(this.dispatchEvent(w),E=0;E!==s;E++)(q=a[E]).preStep&&q.preStep.call(q);h&&(e=performance.now());var Z=C,Q=L,J=this.stepnumber,$=d.DYNAMIC|d.KINEMATIC,tt=J%(this.quatNormalizeSkip+1)==0,et=this.quatNormalizeFast,nt=.5*t;for(o.types.PLANE,o.types.CONVEXPOLYHEDRON,E=0;E!==s;E++){var ot=a[E],it=ot.force,rt=ot.torque;if(ot.type&$&&ot.sleepState!==d.SLEEPING){var st=ot.velocity,at=ot.angularVelocity,ut=ot.position,lt=ot.quaternion,ht=ot.invMass,ct=ot.invInertiaWorld;st.x+=it.x*ht*t,st.y+=it.y*ht*t,st.z+=it.z*ht*t,ot.angularVelocity&&(ct.vmult(rt,N),N.mult(t,N),N.vadd(at,at)),ut.x+=st.x*t,ut.y+=st.y*t,ut.z+=st.z*t,ot.angularVelocity&&(Z.set(at.x,at.y,at.z,0),Z.mult(lt,Q),lt.x+=nt*Q.x,lt.y+=nt*Q.y,lt.z+=nt*Q.z,lt.w+=nt*Q.w,tt&&(et?lt.normalizeFast():lt.normalize())),ot.aabb&&(ot.aabbNeedsUpdate=!0),ot.updateInertiaWorld&&ot.updateInertiaWorld()}}for(this.clearForces(),this.broadphase.dirty=!0,h&&(c.integrate=performance.now()-e),this.time+=t,this.stepnumber+=1,this.dispatchEvent(x),E=0;E!==s;E++){var dt=(q=a[E]).postStep;dt&&dt.call(q)}if(this.allowSleep)for(E=0;E!==s;E++)a[E].sleepTick(this.time)},y.prototype.clearForces=function(){for(var t=this.bodies,e=t.length,n=0;n!==e;n++){var o=t[n];o.force,o.torque,o.force.set(0,0,0),o.torque.set(0,0,0)}}},{"../collision/AABB":3,"../collision/ArrayCollisionMatrix":4,"../collision/NaiveBroadphase":7,"../collision/Ray":9,"../collision/RaycastResult":10,"../equations/ContactEquation":19,"../equations/FrictionEquation":21,"../material/ContactMaterial":24,"../material/Material":25,"../math/Quaternion":28,"../math/Vec3":30,"../objects/Body":31,"../shapes/Shape":43,"../solver/GSSolver":46,"../utils/EventTarget":49,"../utils/TupleDictionary":52,"../utils/Vec3Pool":54,"./Narrowphase":55}]},{},[2])(2)},187:t=>{"use strict";var e,n="object"==typeof Reflect?Reflect:null,o=n&&"function"==typeof n.apply?n.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};e=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var i=Number.isNaN||function(t){return t!=t};function r(){r.init.call(this)}t.exports=r,t.exports.once=function(t,e){return new Promise((function(n,o){function i(n){t.removeListener(e,r),o(n)}function r(){"function"==typeof t.removeListener&&t.removeListener("error",i),n([].slice.call(arguments))}v(t,e,r,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&v(t,"error",e,{once:!0})}(t,i)}))},r.EventEmitter=r,r.prototype._events=void 0,r.prototype._eventsCount=0,r.prototype._maxListeners=void 0;var s=10;function a(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function u(t){return void 0===t._maxListeners?r.defaultMaxListeners:t._maxListeners}function l(t,e,n,o){var i,r,s,l;if(a(n),void 0===(r=t._events)?(r=t._events=Object.create(null),t._eventsCount=0):(void 0!==r.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),r=t._events),s=r[e]),void 0===s)s=r[e]=n,++t._eventsCount;else if("function"==typeof s?s=r[e]=o?[n,s]:[s,n]:o?s.unshift(n):s.push(n),(i=u(t))>0&&s.length>i&&!s.warned){s.warned=!0;var h=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");h.name="MaxListenersExceededWarning",h.emitter=t,h.type=e,h.count=s.length,l=h,console&&console.warn&&console.warn(l)}return t}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function c(t,e,n){var o={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=h.bind(o);return i.listener=n,o.wrapFn=i,i}function d(t,e,n){var o=t._events;if(void 0===o)return[];var i=o[e];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(i):f(i,i.length)}function p(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(t,e){for(var n=new Array(e),o=0;o<e;++o)n[o]=t[o];return n}function v(t,e,n,o){if("function"==typeof t.on)o.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(r){o.once&&t.removeEventListener(e,i),n(r)}))}}Object.defineProperty(r,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");s=t}}),r.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},r.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||i(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},r.prototype.getMaxListeners=function(){return u(this)},r.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var i="error"===t,r=this._events;if(void 0!==r)i=i&&void 0===r.error;else if(!i)return!1;if(i){var s;if(e.length>0&&(s=e[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var u=r[t];if(void 0===u)return!1;if("function"==typeof u)o(u,this,e);else{var l=u.length,h=f(u,l);for(n=0;n<l;++n)o(h[n],this,e)}return!0},r.prototype.addListener=function(t,e){return l(this,t,e,!1)},r.prototype.on=r.prototype.addListener,r.prototype.prependListener=function(t,e){return l(this,t,e,!0)},r.prototype.once=function(t,e){return a(e),this.on(t,c(this,t,e)),this},r.prototype.prependOnceListener=function(t,e){return a(e),this.prependListener(t,c(this,t,e)),this},r.prototype.removeListener=function(t,e){var n,o,i,r,s;if(a(e),void 0===(o=this._events))return this;if(void 0===(n=o[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete o[t],o.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(i=-1,r=n.length-1;r>=0;r--)if(n[r]===e||n[r].listener===e){s=n[r].listener,i=r;break}if(i<0)return this;0===i?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,i),1===n.length&&(o[t]=n[0]),void 0!==o.removeListener&&this.emit("removeListener",t,s||e)}return this},r.prototype.off=r.prototype.removeListener,r.prototype.removeAllListeners=function(t){var e,n,o;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,r=Object.keys(n);for(o=0;o<r.length;++o)"removeListener"!==(i=r[o])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(o=e.length-1;o>=0;o--)this.removeListener(t,e[o]);return this},r.prototype.listeners=function(t){return d(this,t,!0)},r.prototype.rawListeners=function(t){return d(this,t,!1)},r.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):p.call(t,e)},r.prototype.listenerCount=p,r.prototype.eventNames=function(){return this._eventsCount>0?e(this._events):[]}},685:(t,e,n)=>{"use strict";n.r(e),n.d(e,{ARRAY_TYPE:()=>i,EPSILON:()=>o,RANDOM:()=>r,equals:()=>l,setMatrixArrayType:()=>s,toRadian:()=>u});var o=1e-6,i="undefined"!=typeof Float32Array?Float32Array:Array,r=Math.random;function s(t){i=t}var a=Math.PI/180;function u(t){return t*a}function l(t,e){return Math.abs(t-e)<=o*Math.max(1,Math.abs(t),Math.abs(e))}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)})},720:(t,e,n)=>{"use strict";n.r(e),n.d(e,{glMatrix:()=>u,mat2:()=>o,mat2d:()=>i,mat3:()=>st,mat4:()=>at,quat:()=>s,quat2:()=>a,vec2:()=>Sn,vec3:()=>ut,vec4:()=>r});var o={};n.r(o),n.d(o,{LDU:()=>R,add:()=>M,adjoint:()=>_,clone:()=>h,copy:()=>c,create:()=>l,determinant:()=>y,equals:()=>L,exactEquals:()=>C,frob:()=>T,fromRotation:()=>x,fromScaling:()=>w,fromValues:()=>p,identity:()=>d,invert:()=>m,mul:()=>I,multiply:()=>E,multiplyScalar:()=>N,multiplyScalarAndAdd:()=>P,rotate:()=>g,scale:()=>b,set:()=>f,str:()=>A,sub:()=>B,subtract:()=>S,transpose:()=>v});var i={};n.r(i),n.d(i,{add:()=>J,clone:()=>O,copy:()=>U,create:()=>F,determinant:()=>k,equals:()=>ot,exactEquals:()=>nt,frob:()=>Q,fromRotation:()=>X,fromScaling:()=>Y,fromTranslation:()=>K,fromValues:()=>D,identity:()=>V,invert:()=>z,mul:()=>it,multiply:()=>j,multiplyScalar:()=>tt,multiplyScalarAndAdd:()=>et,rotate:()=>G,scale:()=>H,set:()=>q,str:()=>Z,sub:()=>rt,subtract:()=>$,translate:()=>W});var r={};n.r(r),n.d(r,{add:()=>ft,ceil:()=>yt,clone:()=>ht,copy:()=>dt,create:()=>lt,cross:()=>It,dist:()=>Wt,distance:()=>Tt,div:()=>Ht,divide:()=>_t,dot:()=>Pt,equals:()=>zt,exactEquals:()=>qt,floor:()=>Et,forEach:()=>Zt,fromValues:()=>ct,inverse:()=>Lt,len:()=>Yt,length:()=>Mt,lerp:()=>Bt,max:()=>bt,min:()=>gt,mul:()=>Gt,multiply:()=>mt,negate:()=>Ct,normalize:()=>Nt,random:()=>Ft,round:()=>xt,scale:()=>wt,scaleAndAdd:()=>At,set:()=>pt,sqrDist:()=>Xt,sqrLen:()=>Kt,squaredDistance:()=>Rt,squaredLength:()=>St,str:()=>Dt,sub:()=>jt,subtract:()=>vt,transformMat4:()=>Ot,transformQuat:()=>Ut,zero:()=>Vt});var s={};n.r(s),n.d(s,{add:()=>Me,calculateW:()=>se,clone:()=>we,conjugate:()=>pe,copy:()=>Te,create:()=>Qt,dot:()=>Le,equals:()=>Ve,exactEquals:()=>Ue,exp:()=>ae,fromEuler:()=>ve,fromMat3:()=>fe,fromValues:()=>Ae,getAngle:()=>ee,getAxisAngle:()=>te,identity:()=>Jt,invert:()=>de,len:()=>Ie,length:()=>Pe,lerp:()=>Ne,ln:()=>ue,mul:()=>Se,multiply:()=>ne,normalize:()=>Oe,pow:()=>le,random:()=>ce,rotateX:()=>oe,rotateY:()=>ie,rotateZ:()=>re,rotationTo:()=>De,scale:()=>Ce,set:()=>Re,setAxes:()=>ze,setAxisAngle:()=>$t,slerp:()=>he,sqlerp:()=>qe,sqrLen:()=>Fe,squaredLength:()=>Be,str:()=>me});var a={};n.r(a),n.d(a,{add:()=>dn,clone:()=>je,conjugate:()=>En,copy:()=>Ze,create:()=>ke,dot:()=>mn,equals:()=>Mn,exactEquals:()=>Rn,fromMat4:()=>Ke,fromRotation:()=>Ye,fromRotationTranslation:()=>We,fromRotationTranslationValues:()=>He,fromTranslation:()=>Xe,fromValues:()=>Ge,getDual:()=>tn,getReal:()=>$e,getTranslation:()=>on,identity:()=>Qe,invert:()=>yn,len:()=>bn,length:()=>gn,lerp:()=>_n,mul:()=>fn,multiply:()=>pn,normalize:()=>An,rotateAroundAxis:()=>cn,rotateByQuatAppend:()=>ln,rotateByQuatPrepend:()=>hn,rotateX:()=>sn,rotateY:()=>an,rotateZ:()=>un,scale:()=>vn,set:()=>Je,setDual:()=>nn,setReal:()=>en,sqrLen:()=>wn,squaredLength:()=>xn,str:()=>Tn,translate:()=>rn});var u=n(685);function l(){var t=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function h(t){var e=new u.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function c(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function d(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function p(t,e,n,o){var i=new u.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=o,i}function f(t,e,n,o,i){return t[0]=e,t[1]=n,t[2]=o,t[3]=i,t}function v(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}function m(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=n*r-i*o;return s?(s=1/s,t[0]=r*s,t[1]=-o*s,t[2]=-i*s,t[3]=n*s,t):null}function _(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t}function y(t){return t[0]*t[3]-t[2]*t[1]}function E(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=n[0],u=n[1],l=n[2],h=n[3];return t[0]=o*a+r*u,t[1]=i*a+s*u,t[2]=o*l+r*h,t[3]=i*l+s*h,t}function g(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=o*u+r*a,t[1]=i*u+s*a,t[2]=o*-a+r*u,t[3]=i*-a+s*u,t}function b(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=n[0],u=n[1];return t[0]=o*a,t[1]=i*a,t[2]=r*u,t[3]=s*u,t}function x(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t}function w(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t}function A(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function T(t){return Math.hypot(t[0],t[1],t[2],t[3])}function R(t,e,n,o){return t[2]=o[2]/o[0],n[0]=o[0],n[1]=o[1],n[3]=o[3]-t[2]*n[1],[t,e,n]}function M(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function S(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function C(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function L(t,e){var n=t[0],o=t[1],i=t[2],r=t[3],s=e[0],a=e[1],l=e[2],h=e[3];return Math.abs(n-s)<=u.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-a)<=u.EPSILON*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(i-l)<=u.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-h)<=u.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))}function N(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function P(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t}var I=E,B=S;function F(){var t=new u.ARRAY_TYPE(6);return u.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t}function O(t){var e=new u.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function U(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function V(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function D(t,e,n,o,i,r){var s=new u.ARRAY_TYPE(6);return s[0]=t,s[1]=e,s[2]=n,s[3]=o,s[4]=i,s[5]=r,s}function q(t,e,n,o,i,r,s){return t[0]=e,t[1]=n,t[2]=o,t[3]=i,t[4]=r,t[5]=s,t}function z(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=e[4],a=e[5],u=n*r-o*i;return u?(u=1/u,t[0]=r*u,t[1]=-o*u,t[2]=-i*u,t[3]=n*u,t[4]=(i*a-r*s)*u,t[5]=(o*s-n*a)*u,t):null}function k(t){return t[0]*t[3]-t[1]*t[2]}function j(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=n[0],h=n[1],c=n[2],d=n[3],p=n[4],f=n[5];return t[0]=o*l+r*h,t[1]=i*l+s*h,t[2]=o*c+r*d,t[3]=i*c+s*d,t[4]=o*p+r*f+a,t[5]=i*p+s*f+u,t}function G(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=Math.sin(n),h=Math.cos(n);return t[0]=o*h+r*l,t[1]=i*h+s*l,t[2]=o*-l+r*h,t[3]=i*-l+s*h,t[4]=a,t[5]=u,t}function H(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=n[0],h=n[1];return t[0]=o*l,t[1]=i*l,t[2]=r*h,t[3]=s*h,t[4]=a,t[5]=u,t}function W(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=n[0],h=n[1];return t[0]=o,t[1]=i,t[2]=r,t[3]=s,t[4]=o*l+r*h+a,t[5]=i*l+s*h+u,t}function X(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=-n,t[3]=o,t[4]=0,t[5]=0,t}function Y(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t}function K(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t}function Z(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}function Q(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)}function J(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t}function $(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}function tt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t}function et(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t}function nt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]}function ot(t,e){var n=t[0],o=t[1],i=t[2],r=t[3],s=t[4],a=t[5],l=e[0],h=e[1],c=e[2],d=e[3],p=e[4],f=e[5];return Math.abs(n-l)<=u.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(o-h)<=u.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(i-c)<=u.EPSILON*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-d)<=u.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(s-p)<=u.EPSILON*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-f)<=u.EPSILON*Math.max(1,Math.abs(a),Math.abs(f))}var it=j,rt=$,st=n(600),at=n(975),ut=n(160);function lt(){var t=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function ht(t){var e=new u.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ct(t,e,n,o){var i=new u.ARRAY_TYPE(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=o,i}function dt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function pt(t,e,n,o,i){return t[0]=e,t[1]=n,t[2]=o,t[3]=i,t}function ft(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function vt(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function mt(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function _t(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function yt(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Et(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function gt(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function bt(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function xt(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function wt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function At(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t}function Tt(t,e){var n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2],r=e[3]-t[3];return Math.hypot(n,o,i,r)}function Rt(t,e){var n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2],r=e[3]-t[3];return n*n+o*o+i*i+r*r}function Mt(t){var e=t[0],n=t[1],o=t[2],i=t[3];return Math.hypot(e,n,o,i)}function St(t){var e=t[0],n=t[1],o=t[2],i=t[3];return e*e+n*n+o*o+i*i}function Ct(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function Lt(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Nt(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=n*n+o*o+i*i+r*r;return s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=o*s,t[2]=i*s,t[3]=r*s,t}function Pt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function It(t,e,n,o){var i=n[0]*o[1]-n[1]*o[0],r=n[0]*o[2]-n[2]*o[0],s=n[0]*o[3]-n[3]*o[0],a=n[1]*o[2]-n[2]*o[1],u=n[1]*o[3]-n[3]*o[1],l=n[2]*o[3]-n[3]*o[2],h=e[0],c=e[1],d=e[2],p=e[3];return t[0]=c*l-d*u+p*a,t[1]=-h*l+d*s-p*r,t[2]=h*u-c*s+p*i,t[3]=-h*a+c*r-d*i,t}function Bt(t,e,n,o){var i=e[0],r=e[1],s=e[2],a=e[3];return t[0]=i+o*(n[0]-i),t[1]=r+o*(n[1]-r),t[2]=s+o*(n[2]-s),t[3]=a+o*(n[3]-a),t}function Ft(t,e){var n,o,i,r,s,a;e=e||1;do{s=(n=2*u.RANDOM()-1)*n+(o=2*u.RANDOM()-1)*o}while(s>=1);do{a=(i=2*u.RANDOM()-1)*i+(r=2*u.RANDOM()-1)*r}while(a>=1);var l=Math.sqrt((1-s)/a);return t[0]=e*n,t[1]=e*o,t[2]=e*i*l,t[3]=e*r*l,t}function Ot(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3];return t[0]=n[0]*o+n[4]*i+n[8]*r+n[12]*s,t[1]=n[1]*o+n[5]*i+n[9]*r+n[13]*s,t[2]=n[2]*o+n[6]*i+n[10]*r+n[14]*s,t[3]=n[3]*o+n[7]*i+n[11]*r+n[15]*s,t}function Ut(t,e,n){var o=e[0],i=e[1],r=e[2],s=n[0],a=n[1],u=n[2],l=n[3],h=l*o+a*r-u*i,c=l*i+u*o-s*r,d=l*r+s*i-a*o,p=-s*o-a*i-u*r;return t[0]=h*l+p*-s+c*-u-d*-a,t[1]=c*l+p*-a+d*-s-h*-u,t[2]=d*l+p*-u+h*-a-c*-s,t[3]=e[3],t}function Vt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Dt(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function qt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function zt(t,e){var n=t[0],o=t[1],i=t[2],r=t[3],s=e[0],a=e[1],l=e[2],h=e[3];return Math.abs(n-s)<=u.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(o-a)<=u.EPSILON*Math.max(1,Math.abs(o),Math.abs(a))&&Math.abs(i-l)<=u.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-h)<=u.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))}var kt,jt=vt,Gt=mt,Ht=_t,Wt=Tt,Xt=Rt,Yt=Mt,Kt=St,Zt=(kt=lt(),function(t,e,n,o,i,r){var s,a;for(e||(e=4),n||(n=0),a=o?Math.min(o*e+n,t.length):t.length,s=n;s<a;s+=e)kt[0]=t[s],kt[1]=t[s+1],kt[2]=t[s+2],kt[3]=t[s+3],i(kt,kt,r),t[s]=kt[0],t[s+1]=kt[1],t[s+2]=kt[2],t[s+3]=kt[3];return t});function Qt(){var t=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Jt(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function $t(t,e,n){n*=.5;var o=Math.sin(n);return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=Math.cos(n),t}function te(t,e){var n=2*Math.acos(e[3]),o=Math.sin(n/2);return o>u.EPSILON?(t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o):(t[0]=1,t[1]=0,t[2]=0),n}function ee(t,e){var n=Le(t,e);return Math.acos(2*n*n-1)}function ne(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=n[0],u=n[1],l=n[2],h=n[3];return t[0]=o*h+s*a+i*l-r*u,t[1]=i*h+s*u+r*a-o*l,t[2]=r*h+s*l+o*u-i*a,t[3]=s*h-o*a-i*u-r*l,t}function oe(t,e,n){n*=.5;var o=e[0],i=e[1],r=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=o*u+s*a,t[1]=i*u+r*a,t[2]=r*u-i*a,t[3]=s*u-o*a,t}function ie(t,e,n){n*=.5;var o=e[0],i=e[1],r=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=o*u-r*a,t[1]=i*u+s*a,t[2]=r*u+o*a,t[3]=s*u-i*a,t}function re(t,e,n){n*=.5;var o=e[0],i=e[1],r=e[2],s=e[3],a=Math.sin(n),u=Math.cos(n);return t[0]=o*u+i*a,t[1]=i*u-o*a,t[2]=r*u+s*a,t[3]=s*u-r*a,t}function se(t,e){var n=e[0],o=e[1],i=e[2];return t[0]=n,t[1]=o,t[2]=i,t[3]=Math.sqrt(Math.abs(1-n*n-o*o-i*i)),t}function ae(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=Math.sqrt(n*n+o*o+i*i),a=Math.exp(r),u=s>0?a*Math.sin(s)/s:0;return t[0]=n*u,t[1]=o*u,t[2]=i*u,t[3]=a*Math.cos(s),t}function ue(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=Math.sqrt(n*n+o*o+i*i),a=s>0?Math.atan2(s,r)/s:0;return t[0]=n*a,t[1]=o*a,t[2]=i*a,t[3]=.5*Math.log(n*n+o*o+i*i+r*r),t}function le(t,e,n){return ue(t,e),Ce(t,t,n),ae(t,t),t}function he(t,e,n,o){var i,r,s,a,l,h=e[0],c=e[1],d=e[2],p=e[3],f=n[0],v=n[1],m=n[2],_=n[3];return(r=h*f+c*v+d*m+p*_)<0&&(r=-r,f=-f,v=-v,m=-m,_=-_),1-r>u.EPSILON?(i=Math.acos(r),s=Math.sin(i),a=Math.sin((1-o)*i)/s,l=Math.sin(o*i)/s):(a=1-o,l=o),t[0]=a*h+l*f,t[1]=a*c+l*v,t[2]=a*d+l*m,t[3]=a*p+l*_,t}function ce(t){var e=u.RANDOM(),n=u.RANDOM(),o=u.RANDOM(),i=Math.sqrt(1-e),r=Math.sqrt(e);return t[0]=i*Math.sin(2*Math.PI*n),t[1]=i*Math.cos(2*Math.PI*n),t[2]=r*Math.sin(2*Math.PI*o),t[3]=r*Math.cos(2*Math.PI*o),t}function de(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=n*n+o*o+i*i+r*r,a=s?1/s:0;return t[0]=-n*a,t[1]=-o*a,t[2]=-i*a,t[3]=r*a,t}function pe(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function fe(t,e){var n,o=e[0]+e[4]+e[8];if(o>0)n=Math.sqrt(o+1),t[3]=.5*n,n=.5/n,t[0]=(e[5]-e[7])*n,t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var r=(i+1)%3,s=(i+2)%3;n=Math.sqrt(e[3*i+i]-e[3*r+r]-e[3*s+s]+1),t[i]=.5*n,n=.5/n,t[3]=(e[3*r+s]-e[3*s+r])*n,t[r]=(e[3*r+i]+e[3*i+r])*n,t[s]=(e[3*s+i]+e[3*i+s])*n}return t}function ve(t,e,n,o){var i=.5*Math.PI/180;e*=i,n*=i,o*=i;var r=Math.sin(e),s=Math.cos(e),a=Math.sin(n),u=Math.cos(n),l=Math.sin(o),h=Math.cos(o);return t[0]=r*u*h-s*a*l,t[1]=s*a*h+r*u*l,t[2]=s*u*l-r*a*h,t[3]=s*u*h+r*a*l,t}function me(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var _e,ye,Ee,ge,be,xe,we=ht,Ae=ct,Te=dt,Re=pt,Me=ft,Se=ne,Ce=wt,Le=Pt,Ne=Bt,Pe=Mt,Ie=Pe,Be=St,Fe=Be,Oe=Nt,Ue=qt,Ve=zt,De=(_e=ut.create(),ye=ut.fromValues(1,0,0),Ee=ut.fromValues(0,1,0),function(t,e,n){var o=ut.dot(e,n);return o<-.999999?(ut.cross(_e,ye,e),ut.len(_e)<1e-6&&ut.cross(_e,Ee,e),ut.normalize(_e,_e),$t(t,_e,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(ut.cross(_e,e,n),t[0]=_e[0],t[1]=_e[1],t[2]=_e[2],t[3]=1+o,Oe(t,t))}),qe=(ge=Qt(),be=Qt(),function(t,e,n,o,i,r){return he(ge,e,i,r),he(be,n,o,r),he(t,ge,be,2*r*(1-r)),t}),ze=(xe=st.create(),function(t,e,n,o){return xe[0]=n[0],xe[3]=n[1],xe[6]=n[2],xe[1]=o[0],xe[4]=o[1],xe[7]=o[2],xe[2]=-e[0],xe[5]=-e[1],xe[8]=-e[2],Oe(t,fe(t,xe))});function ke(){var t=new u.ARRAY_TYPE(8);return u.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function je(t){var e=new u.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Ge(t,e,n,o,i,r,s,a){var l=new u.ARRAY_TYPE(8);return l[0]=t,l[1]=e,l[2]=n,l[3]=o,l[4]=i,l[5]=r,l[6]=s,l[7]=a,l}function He(t,e,n,o,i,r,s){var a=new u.ARRAY_TYPE(8);a[0]=t,a[1]=e,a[2]=n,a[3]=o;var l=.5*i,h=.5*r,c=.5*s;return a[4]=l*o+h*n-c*e,a[5]=h*o+c*t-l*n,a[6]=c*o+l*e-h*t,a[7]=-l*t-h*e-c*n,a}function We(t,e,n){var o=.5*n[0],i=.5*n[1],r=.5*n[2],s=e[0],a=e[1],u=e[2],l=e[3];return t[0]=s,t[1]=a,t[2]=u,t[3]=l,t[4]=o*l+i*u-r*a,t[5]=i*l+r*s-o*u,t[6]=r*l+o*a-i*s,t[7]=-o*s-i*a-r*u,t}function Xe(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t}function Ye(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ke(t,e){var n=Qt();at.getRotation(n,e);var o=new u.ARRAY_TYPE(3);return at.getTranslation(o,e),We(t,n,o),t}function Ze(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Qe(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Je(t,e,n,o,i,r,s,a,u){return t[0]=e,t[1]=n,t[2]=o,t[3]=i,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t}var $e=Te;function tn(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var en=Te;function nn(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function on(t,e){var n=e[4],o=e[5],i=e[6],r=e[7],s=-e[0],a=-e[1],u=-e[2],l=e[3];return t[0]=2*(n*l+r*s+o*u-i*a),t[1]=2*(o*l+r*a+i*s-n*u),t[2]=2*(i*l+r*u+n*a-o*s),t}function rn(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=.5*n[0],u=.5*n[1],l=.5*n[2],h=e[4],c=e[5],d=e[6],p=e[7];return t[0]=o,t[1]=i,t[2]=r,t[3]=s,t[4]=s*a+i*l-r*u+h,t[5]=s*u+r*a-o*l+c,t[6]=s*l+o*u-i*a+d,t[7]=-o*a-i*u-r*l+p,t}function sn(t,e,n){var o=-e[0],i=-e[1],r=-e[2],s=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=a*s+h*o+u*r-l*i,d=u*s+h*i+l*o-a*r,p=l*s+h*r+a*i-u*o,f=h*s-a*o-u*i-l*r;return oe(t,e,n),o=t[0],i=t[1],r=t[2],s=t[3],t[4]=c*s+f*o+d*r-p*i,t[5]=d*s+f*i+p*o-c*r,t[6]=p*s+f*r+c*i-d*o,t[7]=f*s-c*o-d*i-p*r,t}function an(t,e,n){var o=-e[0],i=-e[1],r=-e[2],s=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=a*s+h*o+u*r-l*i,d=u*s+h*i+l*o-a*r,p=l*s+h*r+a*i-u*o,f=h*s-a*o-u*i-l*r;return ie(t,e,n),o=t[0],i=t[1],r=t[2],s=t[3],t[4]=c*s+f*o+d*r-p*i,t[5]=d*s+f*i+p*o-c*r,t[6]=p*s+f*r+c*i-d*o,t[7]=f*s-c*o-d*i-p*r,t}function un(t,e,n){var o=-e[0],i=-e[1],r=-e[2],s=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=a*s+h*o+u*r-l*i,d=u*s+h*i+l*o-a*r,p=l*s+h*r+a*i-u*o,f=h*s-a*o-u*i-l*r;return re(t,e,n),o=t[0],i=t[1],r=t[2],s=t[3],t[4]=c*s+f*o+d*r-p*i,t[5]=d*s+f*i+p*o-c*r,t[6]=p*s+f*r+c*i-d*o,t[7]=f*s-c*o-d*i-p*r,t}function ln(t,e,n){var o=n[0],i=n[1],r=n[2],s=n[3],a=e[0],u=e[1],l=e[2],h=e[3];return t[0]=a*s+h*o+u*r-l*i,t[1]=u*s+h*i+l*o-a*r,t[2]=l*s+h*r+a*i-u*o,t[3]=h*s-a*o-u*i-l*r,a=e[4],u=e[5],l=e[6],h=e[7],t[4]=a*s+h*o+u*r-l*i,t[5]=u*s+h*i+l*o-a*r,t[6]=l*s+h*r+a*i-u*o,t[7]=h*s-a*o-u*i-l*r,t}function hn(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=n[0],u=n[1],l=n[2],h=n[3];return t[0]=o*h+s*a+i*l-r*u,t[1]=i*h+s*u+r*a-o*l,t[2]=r*h+s*l+o*u-i*a,t[3]=s*h-o*a-i*u-r*l,a=n[4],u=n[5],l=n[6],h=n[7],t[4]=o*h+s*a+i*l-r*u,t[5]=i*h+s*u+r*a-o*l,t[6]=r*h+s*l+o*u-i*a,t[7]=s*h-o*a-i*u-r*l,t}function cn(t,e,n,o){if(Math.abs(o)<u.EPSILON)return Ze(t,e);var i=Math.hypot(n[0],n[1],n[2]);o*=.5;var r=Math.sin(o),s=r*n[0]/i,a=r*n[1]/i,l=r*n[2]/i,h=Math.cos(o),c=e[0],d=e[1],p=e[2],f=e[3];t[0]=c*h+f*s+d*l-p*a,t[1]=d*h+f*a+p*s-c*l,t[2]=p*h+f*l+c*a-d*s,t[3]=f*h-c*s-d*a-p*l;var v=e[4],m=e[5],_=e[6],y=e[7];return t[4]=v*h+y*s+m*l-_*a,t[5]=m*h+y*a+_*s-v*l,t[6]=_*h+y*l+v*a-m*s,t[7]=y*h-v*s-m*a-_*l,t}function dn(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function pn(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=n[4],u=n[5],l=n[6],h=n[7],c=e[4],d=e[5],p=e[6],f=e[7],v=n[0],m=n[1],_=n[2],y=n[3];return t[0]=o*y+s*v+i*_-r*m,t[1]=i*y+s*m+r*v-o*_,t[2]=r*y+s*_+o*m-i*v,t[3]=s*y-o*v-i*m-r*_,t[4]=o*h+s*a+i*l-r*u+c*y+f*v+d*_-p*m,t[5]=i*h+s*u+r*a-o*l+d*y+f*m+p*v-c*_,t[6]=r*h+s*l+o*u-i*a+p*y+f*_+c*m-d*v,t[7]=s*h-o*a-i*u-r*l+f*y-c*v-d*m-p*_,t}var fn=pn;function vn(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var mn=Le;function _n(t,e,n,o){var i=1-o;return mn(e,n)<0&&(o=-o),t[0]=e[0]*i+n[0]*o,t[1]=e[1]*i+n[1]*o,t[2]=e[2]*i+n[2]*o,t[3]=e[3]*i+n[3]*o,t[4]=e[4]*i+n[4]*o,t[5]=e[5]*i+n[5]*o,t[6]=e[6]*i+n[6]*o,t[7]=e[7]*i+n[7]*o,t}function yn(t,e){var n=xn(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function En(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var gn=Pe,bn=gn,xn=Be,wn=xn;function An(t,e){var n=xn(e);if(n>0){n=Math.sqrt(n);var o=e[0]/n,i=e[1]/n,r=e[2]/n,s=e[3]/n,a=e[4],u=e[5],l=e[6],h=e[7],c=o*a+i*u+r*l+s*h;t[0]=o,t[1]=i,t[2]=r,t[3]=s,t[4]=(a-o*c)/n,t[5]=(u-i*c)/n,t[6]=(l-r*c)/n,t[7]=(h-s*c)/n}return t}function Tn(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function Rn(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function Mn(t,e){var n=t[0],o=t[1],i=t[2],r=t[3],s=t[4],a=t[5],l=t[6],h=t[7],c=e[0],d=e[1],p=e[2],f=e[3],v=e[4],m=e[5],_=e[6],y=e[7];return Math.abs(n-c)<=u.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(o-d)<=u.EPSILON*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(i-p)<=u.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=u.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-v)<=u.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(a-m)<=u.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(l-_)<=u.EPSILON*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(h-y)<=u.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))}var Sn=n(437)},600:(t,e,n)=>{"use strict";n.r(e),n.d(e,{add:()=>S,adjoint:()=>p,clone:()=>s,copy:()=>a,create:()=>i,determinant:()=>f,equals:()=>I,exactEquals:()=>P,frob:()=>M,fromMat2d:()=>x,fromMat4:()=>r,fromQuat:()=>w,fromRotation:()=>g,fromScaling:()=>b,fromTranslation:()=>E,fromValues:()=>u,identity:()=>h,invert:()=>d,mul:()=>B,multiply:()=>v,multiplyScalar:()=>L,multiplyScalarAndAdd:()=>N,normalFromMat4:()=>A,projection:()=>T,rotate:()=>_,scale:()=>y,set:()=>l,str:()=>R,sub:()=>F,subtract:()=>C,translate:()=>m,transpose:()=>c});var o=n(685);function i(){var t=new o.ARRAY_TYPE(9);return o.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function r(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function s(t){var e=new o.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function a(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function u(t,e,n,i,r,s,a,u,l){var h=new o.ARRAY_TYPE(9);return h[0]=t,h[1]=e,h[2]=n,h[3]=i,h[4]=r,h[5]=s,h[6]=a,h[7]=u,h[8]=l,h}function l(t,e,n,o,i,r,s,a,u,l){return t[0]=e,t[1]=n,t[2]=o,t[3]=i,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t[8]=l,t}function h(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function c(t,e){if(t===e){var n=e[1],o=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=o,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function d(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=h*s-a*l,d=-h*r+a*u,p=l*r-s*u,f=n*c+o*d+i*p;return f?(f=1/f,t[0]=c*f,t[1]=(-h*o+i*l)*f,t[2]=(a*o-i*s)*f,t[3]=d*f,t[4]=(h*n-i*u)*f,t[5]=(-a*n+i*r)*f,t[6]=p*f,t[7]=(-l*n+o*u)*f,t[8]=(s*n-o*r)*f,t):null}function p(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=e[4],a=e[5],u=e[6],l=e[7],h=e[8];return t[0]=s*h-a*l,t[1]=i*l-o*h,t[2]=o*a-i*s,t[3]=a*u-r*h,t[4]=n*h-i*u,t[5]=i*r-n*a,t[6]=r*l-s*u,t[7]=o*u-n*l,t[8]=n*s-o*r,t}function f(t){var e=t[0],n=t[1],o=t[2],i=t[3],r=t[4],s=t[5],a=t[6],u=t[7],l=t[8];return e*(l*r-s*u)+n*(-l*i+s*a)+o*(u*i-r*a)}function v(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=n[0],p=n[1],f=n[2],v=n[3],m=n[4],_=n[5],y=n[6],E=n[7],g=n[8];return t[0]=d*o+p*s+f*l,t[1]=d*i+p*a+f*h,t[2]=d*r+p*u+f*c,t[3]=v*o+m*s+_*l,t[4]=v*i+m*a+_*h,t[5]=v*r+m*u+_*c,t[6]=y*o+E*s+g*l,t[7]=y*i+E*a+g*h,t[8]=y*r+E*u+g*c,t}function m(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=n[0],p=n[1];return t[0]=o,t[1]=i,t[2]=r,t[3]=s,t[4]=a,t[5]=u,t[6]=d*o+p*s+l,t[7]=d*i+p*a+h,t[8]=d*r+p*u+c,t}function _(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=Math.sin(n),p=Math.cos(n);return t[0]=p*o+d*s,t[1]=p*i+d*a,t[2]=p*r+d*u,t[3]=p*s-d*o,t[4]=p*a-d*i,t[5]=p*u-d*r,t[6]=l,t[7]=h,t[8]=c,t}function y(t,e,n){var o=n[0],i=n[1];return t[0]=o*e[0],t[1]=o*e[1],t[2]=o*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function E(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t}function g(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=-n,t[4]=o,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function b(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function x(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t}function w(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=n+n,a=o+o,u=i+i,l=n*s,h=o*s,c=o*a,d=i*s,p=i*a,f=i*u,v=r*s,m=r*a,_=r*u;return t[0]=1-c-f,t[3]=h-_,t[6]=d+m,t[1]=h+_,t[4]=1-l-f,t[7]=p-v,t[2]=d-m,t[5]=p+v,t[8]=1-l-c,t}function A(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=e[9],d=e[10],p=e[11],f=e[12],v=e[13],m=e[14],_=e[15],y=n*a-o*s,E=n*u-i*s,g=n*l-r*s,b=o*u-i*a,x=o*l-r*a,w=i*l-r*u,A=h*v-c*f,T=h*m-d*f,R=h*_-p*f,M=c*m-d*v,S=c*_-p*v,C=d*_-p*m,L=y*C-E*S+g*M+b*R-x*T+w*A;return L?(L=1/L,t[0]=(a*C-u*S+l*M)*L,t[1]=(u*R-s*C-l*T)*L,t[2]=(s*S-a*R+l*A)*L,t[3]=(i*S-o*C-r*M)*L,t[4]=(n*C-i*R+r*T)*L,t[5]=(o*R-n*S-r*A)*L,t[6]=(v*w-m*x+_*b)*L,t[7]=(m*g-f*w-_*E)*L,t[8]=(f*x-v*g+_*y)*L,t):null}function T(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t}function R(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"}function M(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])}function S(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t}function C(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}function L(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t}function N(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t}function P(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]}function I(t,e){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],u=t[5],l=t[6],h=t[7],c=t[8],d=e[0],p=e[1],f=e[2],v=e[3],m=e[4],_=e[5],y=e[6],E=e[7],g=e[8];return Math.abs(n-d)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(d))&&Math.abs(i-p)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-f)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(s-v)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(a-m)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(u-_)<=o.EPSILON*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(l-y)<=o.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(h-E)<=o.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(c-g)<=o.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))}var B=v,F=C},975:(t,e,n)=>{"use strict";n.r(e),n.d(e,{add:()=>X,adjoint:()=>d,clone:()=>r,copy:()=>s,create:()=>i,determinant:()=>p,equals:()=>J,exactEquals:()=>Q,frob:()=>W,fromQuat:()=>B,fromQuat2:()=>S,fromRotation:()=>w,fromRotationTranslation:()=>M,fromRotationTranslationScale:()=>P,fromRotationTranslationScaleOrigin:()=>I,fromScaling:()=>x,fromTranslation:()=>b,fromValues:()=>a,fromXRotation:()=>A,fromYRotation:()=>T,fromZRotation:()=>R,frustum:()=>F,getRotation:()=>N,getScaling:()=>L,getTranslation:()=>C,identity:()=>l,invert:()=>c,lookAt:()=>j,mul:()=>$,multiply:()=>f,multiplyScalar:()=>K,multiplyScalarAndAdd:()=>Z,ortho:()=>z,orthoNO:()=>q,orthoZO:()=>k,perspective:()=>U,perspectiveFromFieldOfView:()=>D,perspectiveNO:()=>O,perspectiveZO:()=>V,rotate:()=>_,rotateX:()=>y,rotateY:()=>E,rotateZ:()=>g,scale:()=>m,set:()=>u,str:()=>H,sub:()=>tt,subtract:()=>Y,targetTo:()=>G,translate:()=>v,transpose:()=>h});var o=n(685);function i(){var t=new o.ARRAY_TYPE(16);return o.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function r(t){var e=new o.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(t,e,n,i,r,s,a,u,l,h,c,d,p,f,v,m){var _=new o.ARRAY_TYPE(16);return _[0]=t,_[1]=e,_[2]=n,_[3]=i,_[4]=r,_[5]=s,_[6]=a,_[7]=u,_[8]=l,_[9]=h,_[10]=c,_[11]=d,_[12]=p,_[13]=f,_[14]=v,_[15]=m,_}function u(t,e,n,o,i,r,s,a,u,l,h,c,d,p,f,v,m){return t[0]=e,t[1]=n,t[2]=o,t[3]=i,t[4]=r,t[5]=s,t[6]=a,t[7]=u,t[8]=l,t[9]=h,t[10]=c,t[11]=d,t[12]=p,t[13]=f,t[14]=v,t[15]=m,t}function l(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h(t,e){if(t===e){var n=e[1],o=e[2],i=e[3],r=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=o,t[9]=r,t[11]=e[14],t[12]=i,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function c(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=e[9],d=e[10],p=e[11],f=e[12],v=e[13],m=e[14],_=e[15],y=n*a-o*s,E=n*u-i*s,g=n*l-r*s,b=o*u-i*a,x=o*l-r*a,w=i*l-r*u,A=h*v-c*f,T=h*m-d*f,R=h*_-p*f,M=c*m-d*v,S=c*_-p*v,C=d*_-p*m,L=y*C-E*S+g*M+b*R-x*T+w*A;return L?(L=1/L,t[0]=(a*C-u*S+l*M)*L,t[1]=(i*S-o*C-r*M)*L,t[2]=(v*w-m*x+_*b)*L,t[3]=(d*x-c*w-p*b)*L,t[4]=(u*R-s*C-l*T)*L,t[5]=(n*C-i*R+r*T)*L,t[6]=(m*g-f*w-_*E)*L,t[7]=(h*w-d*g+p*E)*L,t[8]=(s*S-a*R+l*A)*L,t[9]=(o*R-n*S-r*A)*L,t[10]=(f*x-v*g+_*y)*L,t[11]=(c*g-h*x-p*y)*L,t[12]=(a*T-s*M-u*A)*L,t[13]=(n*M-o*T+i*A)*L,t[14]=(v*E-f*b-m*y)*L,t[15]=(h*b-c*E+d*y)*L,t):null}function d(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=e[4],a=e[5],u=e[6],l=e[7],h=e[8],c=e[9],d=e[10],p=e[11],f=e[12],v=e[13],m=e[14],_=e[15];return t[0]=a*(d*_-p*m)-c*(u*_-l*m)+v*(u*p-l*d),t[1]=-(o*(d*_-p*m)-c*(i*_-r*m)+v*(i*p-r*d)),t[2]=o*(u*_-l*m)-a*(i*_-r*m)+v*(i*l-r*u),t[3]=-(o*(u*p-l*d)-a*(i*p-r*d)+c*(i*l-r*u)),t[4]=-(s*(d*_-p*m)-h*(u*_-l*m)+f*(u*p-l*d)),t[5]=n*(d*_-p*m)-h*(i*_-r*m)+f*(i*p-r*d),t[6]=-(n*(u*_-l*m)-s*(i*_-r*m)+f*(i*l-r*u)),t[7]=n*(u*p-l*d)-s*(i*p-r*d)+h*(i*l-r*u),t[8]=s*(c*_-p*v)-h*(a*_-l*v)+f*(a*p-l*c),t[9]=-(n*(c*_-p*v)-h*(o*_-r*v)+f*(o*p-r*c)),t[10]=n*(a*_-l*v)-s*(o*_-r*v)+f*(o*l-r*a),t[11]=-(n*(a*p-l*c)-s*(o*p-r*c)+h*(o*l-r*a)),t[12]=-(s*(c*m-d*v)-h*(a*m-u*v)+f*(a*d-u*c)),t[13]=n*(c*m-d*v)-h*(o*m-i*v)+f*(o*d-i*c),t[14]=-(n*(a*m-u*v)-s*(o*m-i*v)+f*(o*u-i*a)),t[15]=n*(a*d-u*c)-s*(o*d-i*c)+h*(o*u-i*a),t}function p(t){var e=t[0],n=t[1],o=t[2],i=t[3],r=t[4],s=t[5],a=t[6],u=t[7],l=t[8],h=t[9],c=t[10],d=t[11],p=t[12],f=t[13],v=t[14],m=t[15];return(e*s-n*r)*(c*m-d*v)-(e*a-o*r)*(h*m-d*f)+(e*u-i*r)*(h*v-c*f)+(n*a-o*s)*(l*m-d*p)-(n*u-i*s)*(l*v-c*p)+(o*u-i*a)*(l*f-h*p)}function f(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=e[9],p=e[10],f=e[11],v=e[12],m=e[13],_=e[14],y=e[15],E=n[0],g=n[1],b=n[2],x=n[3];return t[0]=E*o+g*a+b*c+x*v,t[1]=E*i+g*u+b*d+x*m,t[2]=E*r+g*l+b*p+x*_,t[3]=E*s+g*h+b*f+x*y,E=n[4],g=n[5],b=n[6],x=n[7],t[4]=E*o+g*a+b*c+x*v,t[5]=E*i+g*u+b*d+x*m,t[6]=E*r+g*l+b*p+x*_,t[7]=E*s+g*h+b*f+x*y,E=n[8],g=n[9],b=n[10],x=n[11],t[8]=E*o+g*a+b*c+x*v,t[9]=E*i+g*u+b*d+x*m,t[10]=E*r+g*l+b*p+x*_,t[11]=E*s+g*h+b*f+x*y,E=n[12],g=n[13],b=n[14],x=n[15],t[12]=E*o+g*a+b*c+x*v,t[13]=E*i+g*u+b*d+x*m,t[14]=E*r+g*l+b*p+x*_,t[15]=E*s+g*h+b*f+x*y,t}function v(t,e,n){var o,i,r,s,a,u,l,h,c,d,p,f,v=n[0],m=n[1],_=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*_+e[12],t[13]=e[1]*v+e[5]*m+e[9]*_+e[13],t[14]=e[2]*v+e[6]*m+e[10]*_+e[14],t[15]=e[3]*v+e[7]*m+e[11]*_+e[15]):(o=e[0],i=e[1],r=e[2],s=e[3],a=e[4],u=e[5],l=e[6],h=e[7],c=e[8],d=e[9],p=e[10],f=e[11],t[0]=o,t[1]=i,t[2]=r,t[3]=s,t[4]=a,t[5]=u,t[6]=l,t[7]=h,t[8]=c,t[9]=d,t[10]=p,t[11]=f,t[12]=o*v+a*m+c*_+e[12],t[13]=i*v+u*m+d*_+e[13],t[14]=r*v+l*m+p*_+e[14],t[15]=s*v+h*m+f*_+e[15]),t}function m(t,e,n){var o=n[0],i=n[1],r=n[2];return t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t[3]=e[3]*o,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function _(t,e,n,i){var r,s,a,u,l,h,c,d,p,f,v,m,_,y,E,g,b,x,w,A,T,R,M,S,C=i[0],L=i[1],N=i[2],P=Math.hypot(C,L,N);return P<o.EPSILON?null:(C*=P=1/P,L*=P,N*=P,r=Math.sin(n),a=1-(s=Math.cos(n)),u=e[0],l=e[1],h=e[2],c=e[3],d=e[4],p=e[5],f=e[6],v=e[7],m=e[8],_=e[9],y=e[10],E=e[11],g=C*C*a+s,b=L*C*a+N*r,x=N*C*a-L*r,w=C*L*a-N*r,A=L*L*a+s,T=N*L*a+C*r,R=C*N*a+L*r,M=L*N*a-C*r,S=N*N*a+s,t[0]=u*g+d*b+m*x,t[1]=l*g+p*b+_*x,t[2]=h*g+f*b+y*x,t[3]=c*g+v*b+E*x,t[4]=u*w+d*A+m*T,t[5]=l*w+p*A+_*T,t[6]=h*w+f*A+y*T,t[7]=c*w+v*A+E*T,t[8]=u*R+d*M+m*S,t[9]=l*R+p*M+_*S,t[10]=h*R+f*M+y*S,t[11]=c*R+v*M+E*S,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function y(t,e,n){var o=Math.sin(n),i=Math.cos(n),r=e[4],s=e[5],a=e[6],u=e[7],l=e[8],h=e[9],c=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=r*i+l*o,t[5]=s*i+h*o,t[6]=a*i+c*o,t[7]=u*i+d*o,t[8]=l*i-r*o,t[9]=h*i-s*o,t[10]=c*i-a*o,t[11]=d*i-u*o,t}function E(t,e,n){var o=Math.sin(n),i=Math.cos(n),r=e[0],s=e[1],a=e[2],u=e[3],l=e[8],h=e[9],c=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*i-l*o,t[1]=s*i-h*o,t[2]=a*i-c*o,t[3]=u*i-d*o,t[8]=r*o+l*i,t[9]=s*o+h*i,t[10]=a*o+c*i,t[11]=u*o+d*i,t}function g(t,e,n){var o=Math.sin(n),i=Math.cos(n),r=e[0],s=e[1],a=e[2],u=e[3],l=e[4],h=e[5],c=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*i+l*o,t[1]=s*i+h*o,t[2]=a*i+c*o,t[3]=u*i+d*o,t[4]=l*i-r*o,t[5]=h*i-s*o,t[6]=c*i-a*o,t[7]=d*i-u*o,t}function b(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function x(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function w(t,e,n){var i,r,s,a=n[0],u=n[1],l=n[2],h=Math.hypot(a,u,l);return h<o.EPSILON?null:(a*=h=1/h,u*=h,l*=h,i=Math.sin(e),s=1-(r=Math.cos(e)),t[0]=a*a*s+r,t[1]=u*a*s+l*i,t[2]=l*a*s-u*i,t[3]=0,t[4]=a*u*s-l*i,t[5]=u*u*s+r,t[6]=l*u*s+a*i,t[7]=0,t[8]=a*l*s+u*i,t[9]=u*l*s-a*i,t[10]=l*l*s+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function A(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function R(t,e){var n=Math.sin(e),o=Math.cos(e);return t[0]=o,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function M(t,e,n){var o=e[0],i=e[1],r=e[2],s=e[3],a=o+o,u=i+i,l=r+r,h=o*a,c=o*u,d=o*l,p=i*u,f=i*l,v=r*l,m=s*a,_=s*u,y=s*l;return t[0]=1-(p+v),t[1]=c+y,t[2]=d-_,t[3]=0,t[4]=c-y,t[5]=1-(h+v),t[6]=f+m,t[7]=0,t[8]=d+_,t[9]=f-m,t[10]=1-(h+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function S(t,e){var n=new o.ARRAY_TYPE(3),i=-e[0],r=-e[1],s=-e[2],a=e[3],u=e[4],l=e[5],h=e[6],c=e[7],d=i*i+r*r+s*s+a*a;return d>0?(n[0]=2*(u*a+c*i+l*s-h*r)/d,n[1]=2*(l*a+c*r+h*i-u*s)/d,n[2]=2*(h*a+c*s+u*r-l*i)/d):(n[0]=2*(u*a+c*i+l*s-h*r),n[1]=2*(l*a+c*r+h*i-u*s),n[2]=2*(h*a+c*s+u*r-l*i)),M(t,e,n),t}function C(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function L(t,e){var n=e[0],o=e[1],i=e[2],r=e[4],s=e[5],a=e[6],u=e[8],l=e[9],h=e[10];return t[0]=Math.hypot(n,o,i),t[1]=Math.hypot(r,s,a),t[2]=Math.hypot(u,l,h),t}function N(t,e){var n=new o.ARRAY_TYPE(3);L(n,e);var i=1/n[0],r=1/n[1],s=1/n[2],a=e[0]*i,u=e[1]*r,l=e[2]*s,h=e[4]*i,c=e[5]*r,d=e[6]*s,p=e[8]*i,f=e[9]*r,v=e[10]*s,m=a+c+v,_=0;return m>0?(_=2*Math.sqrt(m+1),t[3]=.25*_,t[0]=(d-f)/_,t[1]=(p-l)/_,t[2]=(u-h)/_):a>c&&a>v?(_=2*Math.sqrt(1+a-c-v),t[3]=(d-f)/_,t[0]=.25*_,t[1]=(u+h)/_,t[2]=(p+l)/_):c>v?(_=2*Math.sqrt(1+c-a-v),t[3]=(p-l)/_,t[0]=(u+h)/_,t[1]=.25*_,t[2]=(d+f)/_):(_=2*Math.sqrt(1+v-a-c),t[3]=(u-h)/_,t[0]=(p+l)/_,t[1]=(d+f)/_,t[2]=.25*_),t}function P(t,e,n,o){var i=e[0],r=e[1],s=e[2],a=e[3],u=i+i,l=r+r,h=s+s,c=i*u,d=i*l,p=i*h,f=r*l,v=r*h,m=s*h,_=a*u,y=a*l,E=a*h,g=o[0],b=o[1],x=o[2];return t[0]=(1-(f+m))*g,t[1]=(d+E)*g,t[2]=(p-y)*g,t[3]=0,t[4]=(d-E)*b,t[5]=(1-(c+m))*b,t[6]=(v+_)*b,t[7]=0,t[8]=(p+y)*x,t[9]=(v-_)*x,t[10]=(1-(c+f))*x,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function I(t,e,n,o,i){var r=e[0],s=e[1],a=e[2],u=e[3],l=r+r,h=s+s,c=a+a,d=r*l,p=r*h,f=r*c,v=s*h,m=s*c,_=a*c,y=u*l,E=u*h,g=u*c,b=o[0],x=o[1],w=o[2],A=i[0],T=i[1],R=i[2],M=(1-(v+_))*b,S=(p+g)*b,C=(f-E)*b,L=(p-g)*x,N=(1-(d+_))*x,P=(m+y)*x,I=(f+E)*w,B=(m-y)*w,F=(1-(d+v))*w;return t[0]=M,t[1]=S,t[2]=C,t[3]=0,t[4]=L,t[5]=N,t[6]=P,t[7]=0,t[8]=I,t[9]=B,t[10]=F,t[11]=0,t[12]=n[0]+A-(M*A+L*T+I*R),t[13]=n[1]+T-(S*A+N*T+B*R),t[14]=n[2]+R-(C*A+P*T+F*R),t[15]=1,t}function B(t,e){var n=e[0],o=e[1],i=e[2],r=e[3],s=n+n,a=o+o,u=i+i,l=n*s,h=o*s,c=o*a,d=i*s,p=i*a,f=i*u,v=r*s,m=r*a,_=r*u;return t[0]=1-c-f,t[1]=h+_,t[2]=d-m,t[3]=0,t[4]=h-_,t[5]=1-l-f,t[6]=p+v,t[7]=0,t[8]=d+m,t[9]=p-v,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function F(t,e,n,o,i,r,s){var a=1/(n-e),u=1/(i-o),l=1/(r-s);return t[0]=2*r*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*r*u,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(i+o)*u,t[10]=(s+r)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*r*2*l,t[15]=0,t}function O(t,e,n,o,i){var r,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(r=1/(o-i),t[10]=(i+o)*r,t[14]=2*i*o*r):(t[10]=-1,t[14]=-2*o),t}var U=O;function V(t,e,n,o,i){var r,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(r=1/(o-i),t[10]=i*r,t[14]=i*o*r):(t[10]=-1,t[14]=-o),t}function D(t,e,n,o){var i=Math.tan(e.upDegrees*Math.PI/180),r=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),u=2/(s+a),l=2/(i+r);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(s-a)*u*.5,t[9]=(i-r)*l*.5,t[10]=o/(n-o),t[11]=-1,t[12]=0,t[13]=0,t[14]=o*n/(n-o),t[15]=0,t}function q(t,e,n,o,i,r,s){var a=1/(e-n),u=1/(o-i),l=1/(r-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(i+o)*u,t[14]=(s+r)*l,t[15]=1,t}var z=q;function k(t,e,n,o,i,r,s){var a=1/(e-n),u=1/(o-i),l=1/(r-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*a,t[13]=(i+o)*u,t[14]=r*l,t[15]=1,t}function j(t,e,n,i){var r,s,a,u,h,c,d,p,f,v,m=e[0],_=e[1],y=e[2],E=i[0],g=i[1],b=i[2],x=n[0],w=n[1],A=n[2];return Math.abs(m-x)<o.EPSILON&&Math.abs(_-w)<o.EPSILON&&Math.abs(y-A)<o.EPSILON?l(t):(d=m-x,p=_-w,f=y-A,r=g*(f*=v=1/Math.hypot(d,p,f))-b*(p*=v),s=b*(d*=v)-E*f,a=E*p-g*d,(v=Math.hypot(r,s,a))?(r*=v=1/v,s*=v,a*=v):(r=0,s=0,a=0),u=p*a-f*s,h=f*r-d*a,c=d*s-p*r,(v=Math.hypot(u,h,c))?(u*=v=1/v,h*=v,c*=v):(u=0,h=0,c=0),t[0]=r,t[1]=u,t[2]=d,t[3]=0,t[4]=s,t[5]=h,t[6]=p,t[7]=0,t[8]=a,t[9]=c,t[10]=f,t[11]=0,t[12]=-(r*m+s*_+a*y),t[13]=-(u*m+h*_+c*y),t[14]=-(d*m+p*_+f*y),t[15]=1,t)}function G(t,e,n,o){var i=e[0],r=e[1],s=e[2],a=o[0],u=o[1],l=o[2],h=i-n[0],c=r-n[1],d=s-n[2],p=h*h+c*c+d*d;p>0&&(h*=p=1/Math.sqrt(p),c*=p,d*=p);var f=u*d-l*c,v=l*h-a*d,m=a*c-u*h;return(p=f*f+v*v+m*m)>0&&(f*=p=1/Math.sqrt(p),v*=p,m*=p),t[0]=f,t[1]=v,t[2]=m,t[3]=0,t[4]=c*m-d*v,t[5]=d*f-h*m,t[6]=h*v-c*f,t[7]=0,t[8]=h,t[9]=c,t[10]=d,t[11]=0,t[12]=i,t[13]=r,t[14]=s,t[15]=1,t}function H(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function W(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function X(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Y(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function K(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Z(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t[3]=e[3]+n[3]*o,t[4]=e[4]+n[4]*o,t[5]=e[5]+n[5]*o,t[6]=e[6]+n[6]*o,t[7]=e[7]+n[7]*o,t[8]=e[8]+n[8]*o,t[9]=e[9]+n[9]*o,t[10]=e[10]+n[10]*o,t[11]=e[11]+n[11]*o,t[12]=e[12]+n[12]*o,t[13]=e[13]+n[13]*o,t[14]=e[14]+n[14]*o,t[15]=e[15]+n[15]*o,t}function Q(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function J(t,e){var n=t[0],i=t[1],r=t[2],s=t[3],a=t[4],u=t[5],l=t[6],h=t[7],c=t[8],d=t[9],p=t[10],f=t[11],v=t[12],m=t[13],_=t[14],y=t[15],E=e[0],g=e[1],b=e[2],x=e[3],w=e[4],A=e[5],T=e[6],R=e[7],M=e[8],S=e[9],C=e[10],L=e[11],N=e[12],P=e[13],I=e[14],B=e[15];return Math.abs(n-E)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(E))&&Math.abs(i-g)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(g))&&Math.abs(r-b)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(b))&&Math.abs(s-x)<=o.EPSILON*Math.max(1,Math.abs(s),Math.abs(x))&&Math.abs(a-w)<=o.EPSILON*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(u-A)<=o.EPSILON*Math.max(1,Math.abs(u),Math.abs(A))&&Math.abs(l-T)<=o.EPSILON*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(h-R)<=o.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(c-M)<=o.EPSILON*Math.max(1,Math.abs(c),Math.abs(M))&&Math.abs(d-S)<=o.EPSILON*Math.max(1,Math.abs(d),Math.abs(S))&&Math.abs(p-C)<=o.EPSILON*Math.max(1,Math.abs(p),Math.abs(C))&&Math.abs(f-L)<=o.EPSILON*Math.max(1,Math.abs(f),Math.abs(L))&&Math.abs(v-N)<=o.EPSILON*Math.max(1,Math.abs(v),Math.abs(N))&&Math.abs(m-P)<=o.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(_-I)<=o.EPSILON*Math.max(1,Math.abs(_),Math.abs(I))&&Math.abs(y-B)<=o.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))}var $=f,tt=Y},437:(t,e,n)=>{"use strict";n.r(e),n.d(e,{add:()=>l,angle:()=>O,ceil:()=>p,clone:()=>r,copy:()=>a,create:()=>i,cross:()=>S,dist:()=>W,distance:()=>g,div:()=>H,divide:()=>d,dot:()=>M,equals:()=>q,exactEquals:()=>D,floor:()=>f,forEach:()=>K,fromValues:()=>s,inverse:()=>T,len:()=>k,length:()=>x,lerp:()=>C,max:()=>m,min:()=>v,mul:()=>G,multiply:()=>c,negate:()=>A,normalize:()=>R,random:()=>L,rotate:()=>F,round:()=>_,scale:()=>y,scaleAndAdd:()=>E,set:()=>u,sqrDist:()=>X,sqrLen:()=>Y,squaredDistance:()=>b,squaredLength:()=>w,str:()=>V,sub:()=>j,subtract:()=>h,transformMat2:()=>N,transformMat2d:()=>P,transformMat3:()=>I,transformMat4:()=>B,zero:()=>U});var o=n(685);function i(){var t=new o.ARRAY_TYPE(2);return o.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function r(t){var e=new o.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e}function s(t,e){var n=new o.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n}function a(t,e){return t[0]=e[0],t[1]=e[1],t}function u(t,e,n){return t[0]=e,t[1]=n,t}function l(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function h(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function c(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function d(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function p(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t}function f(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t}function v(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function m(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}function _(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t}function y(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function E(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t}function g(t,e){var n=e[0]-t[0],o=e[1]-t[1];return Math.hypot(n,o)}function b(t,e){var n=e[0]-t[0],o=e[1]-t[1];return n*n+o*o}function x(t){var e=t[0],n=t[1];return Math.hypot(e,n)}function w(t){var e=t[0],n=t[1];return e*e+n*n}function A(t,e){return t[0]=-e[0],t[1]=-e[1],t}function T(t,e){return t[0]=1/e[0],t[1]=1/e[1],t}function R(t,e){var n=e[0],o=e[1],i=n*n+o*o;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function M(t,e){return t[0]*e[0]+t[1]*e[1]}function S(t,e,n){var o=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=o,t}function C(t,e,n,o){var i=e[0],r=e[1];return t[0]=i+o*(n[0]-i),t[1]=r+o*(n[1]-r),t}function L(t,e){e=e||1;var n=2*o.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t}function N(t,e,n){var o=e[0],i=e[1];return t[0]=n[0]*o+n[2]*i,t[1]=n[1]*o+n[3]*i,t}function P(t,e,n){var o=e[0],i=e[1];return t[0]=n[0]*o+n[2]*i+n[4],t[1]=n[1]*o+n[3]*i+n[5],t}function I(t,e,n){var o=e[0],i=e[1];return t[0]=n[0]*o+n[3]*i+n[6],t[1]=n[1]*o+n[4]*i+n[7],t}function B(t,e,n){var o=e[0],i=e[1];return t[0]=n[0]*o+n[4]*i+n[12],t[1]=n[1]*o+n[5]*i+n[13],t}function F(t,e,n,o){var i=e[0]-n[0],r=e[1]-n[1],s=Math.sin(o),a=Math.cos(o);return t[0]=i*a-r*s+n[0],t[1]=i*s+r*a+n[1],t}function O(t,e){var n=t[0],o=t[1],i=e[0],r=e[1],s=Math.sqrt(n*n+o*o)*Math.sqrt(i*i+r*r),a=s&&(n*i+o*r)/s;return Math.acos(Math.min(Math.max(a,-1),1))}function U(t){return t[0]=0,t[1]=0,t}function V(t){return"vec2("+t[0]+", "+t[1]+")"}function D(t,e){return t[0]===e[0]&&t[1]===e[1]}function q(t,e){var n=t[0],i=t[1],r=e[0],s=e[1];return Math.abs(n-r)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-s)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(s))}var z,k=x,j=h,G=c,H=d,W=g,X=b,Y=w,K=(z=i(),function(t,e,n,o,i,r){var s,a;for(e||(e=2),n||(n=0),a=o?Math.min(o*e+n,t.length):t.length,s=n;s<a;s+=e)z[0]=t[s],z[1]=t[s+1],i(z,z,r),t[s]=z[0],t[s+1]=z[1];return t})},160:(t,e,n)=>{"use strict";n.r(e),n.d(e,{add:()=>h,angle:()=>D,bezier:()=>N,ceil:()=>f,clone:()=>r,copy:()=>u,create:()=>i,cross:()=>S,dist:()=>Y,distance:()=>b,div:()=>X,divide:()=>p,dot:()=>M,equals:()=>j,exactEquals:()=>k,floor:()=>v,forEach:()=>J,fromValues:()=>a,hermite:()=>L,inverse:()=>T,len:()=>Z,length:()=>s,lerp:()=>C,max:()=>_,min:()=>m,mul:()=>W,multiply:()=>d,negate:()=>A,normalize:()=>R,random:()=>P,rotateX:()=>O,rotateY:()=>U,rotateZ:()=>V,round:()=>y,scale:()=>E,scaleAndAdd:()=>g,set:()=>l,sqrDist:()=>K,sqrLen:()=>Q,squaredDistance:()=>x,squaredLength:()=>w,str:()=>z,sub:()=>H,subtract:()=>c,transformMat3:()=>B,transformMat4:()=>I,transformQuat:()=>F,zero:()=>q});var o=n(685);function i(){var t=new o.ARRAY_TYPE(3);return o.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function r(t){var e=new o.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function s(t){var e=t[0],n=t[1],o=t[2];return Math.hypot(e,n,o)}function a(t,e,n){var i=new o.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=n,i}function u(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function l(t,e,n,o){return t[0]=e,t[1]=n,t[2]=o,t}function h(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function c(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function d(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function p(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function f(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function v(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function m(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function _(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function y(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function E(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function g(t,e,n,o){return t[0]=e[0]+n[0]*o,t[1]=e[1]+n[1]*o,t[2]=e[2]+n[2]*o,t}function b(t,e){var n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,o,i)}function x(t,e){var n=e[0]-t[0],o=e[1]-t[1],i=e[2]-t[2];return n*n+o*o+i*i}function w(t){var e=t[0],n=t[1],o=t[2];return e*e+n*n+o*o}function A(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function T(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function R(t,e){var n=e[0],o=e[1],i=e[2],r=n*n+o*o+i*i;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t}function M(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function S(t,e,n){var o=e[0],i=e[1],r=e[2],s=n[0],a=n[1],u=n[2];return t[0]=i*u-r*a,t[1]=r*s-o*u,t[2]=o*a-i*s,t}function C(t,e,n,o){var i=e[0],r=e[1],s=e[2];return t[0]=i+o*(n[0]-i),t[1]=r+o*(n[1]-r),t[2]=s+o*(n[2]-s),t}function L(t,e,n,o,i,r){var s=r*r,a=s*(2*r-3)+1,u=s*(r-2)+r,l=s*(r-1),h=s*(3-2*r);return t[0]=e[0]*a+n[0]*u+o[0]*l+i[0]*h,t[1]=e[1]*a+n[1]*u+o[1]*l+i[1]*h,t[2]=e[2]*a+n[2]*u+o[2]*l+i[2]*h,t}function N(t,e,n,o,i,r){var s=1-r,a=s*s,u=r*r,l=a*s,h=3*r*a,c=3*u*s,d=u*r;return t[0]=e[0]*l+n[0]*h+o[0]*c+i[0]*d,t[1]=e[1]*l+n[1]*h+o[1]*c+i[1]*d,t[2]=e[2]*l+n[2]*h+o[2]*c+i[2]*d,t}function P(t,e){e=e||1;var n=2*o.RANDOM()*Math.PI,i=2*o.RANDOM()-1,r=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t[2]=i*e,t}function I(t,e,n){var o=e[0],i=e[1],r=e[2],s=n[3]*o+n[7]*i+n[11]*r+n[15];return s=s||1,t[0]=(n[0]*o+n[4]*i+n[8]*r+n[12])/s,t[1]=(n[1]*o+n[5]*i+n[9]*r+n[13])/s,t[2]=(n[2]*o+n[6]*i+n[10]*r+n[14])/s,t}function B(t,e,n){var o=e[0],i=e[1],r=e[2];return t[0]=o*n[0]+i*n[3]+r*n[6],t[1]=o*n[1]+i*n[4]+r*n[7],t[2]=o*n[2]+i*n[5]+r*n[8],t}function F(t,e,n){var o=n[0],i=n[1],r=n[2],s=n[3],a=e[0],u=e[1],l=e[2],h=i*l-r*u,c=r*a-o*l,d=o*u-i*a,p=i*d-r*c,f=r*h-o*d,v=o*c-i*h,m=2*s;return h*=m,c*=m,d*=m,p*=2,f*=2,v*=2,t[0]=a+h+p,t[1]=u+c+f,t[2]=l+d+v,t}function O(t,e,n,o){var i=[],r=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],r[0]=i[0],r[1]=i[1]*Math.cos(o)-i[2]*Math.sin(o),r[2]=i[1]*Math.sin(o)+i[2]*Math.cos(o),t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t}function U(t,e,n,o){var i=[],r=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],r[0]=i[2]*Math.sin(o)+i[0]*Math.cos(o),r[1]=i[1],r[2]=i[2]*Math.cos(o)-i[0]*Math.sin(o),t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t}function V(t,e,n,o){var i=[],r=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],r[0]=i[0]*Math.cos(o)-i[1]*Math.sin(o),r[1]=i[0]*Math.sin(o)+i[1]*Math.cos(o),r[2]=i[2],t[0]=r[0]+n[0],t[1]=r[1]+n[1],t[2]=r[2]+n[2],t}function D(t,e){var n=t[0],o=t[1],i=t[2],r=e[0],s=e[1],a=e[2],u=Math.sqrt(n*n+o*o+i*i)*Math.sqrt(r*r+s*s+a*a),l=u&&M(t,e)/u;return Math.acos(Math.min(Math.max(l,-1),1))}function q(t){return t[0]=0,t[1]=0,t[2]=0,t}function z(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function k(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function j(t,e){var n=t[0],i=t[1],r=t[2],s=e[0],a=e[1],u=e[2];return Math.abs(n-s)<=o.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=o.EPSILON*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-u)<=o.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))}var G,H=c,W=d,X=p,Y=b,K=x,Z=s,Q=w,J=(G=i(),function(t,e,n,o,i,r){var s,a;for(e||(e=3),n||(n=0),a=o?Math.min(o*e+n,t.length):t.length,s=n;s<a;s+=e)G[0]=t[s],G[1]=t[s+1],G[2]=t[s+2],i(G,G,r),t[s]=G[0],t[s+1]=G[1],t[s+2]=G[2];return t})},418:t=>{"use strict";var e=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function i(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}t.exports=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},n=0;n<10;n++)e["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(e).map((function(t){return e[t]})).join(""))return!1;var o={};return"abcdefghijklmnopqrst".split("").forEach((function(t){o[t]=t})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},o)).join("")}catch(t){return!1}}()?Object.assign:function(t,r){for(var s,a,u=i(t),l=1;l<arguments.length;l++){for(var h in s=Object(arguments[l]))n.call(s,h)&&(u[h]=s[h]);if(e){a=e(s);for(var c=0;c<a.length;c++)o.call(s,a[c])&&(u[a[c]]=s[a[c]])}}return u}},129:(t,e)=>{"use strict";var n=Object.prototype.hasOwnProperty;function o(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch(t){return null}}function i(t){try{return encodeURIComponent(t)}catch(t){return null}}e.stringify=function(t,e){e=e||"";var o,r,s=[];for(r in"string"!=typeof e&&(e="?"),t)if(n.call(t,r)){if((o=t[r])||null!=o&&!isNaN(o)||(o=""),r=i(r),o=i(o),null===r||null===o)continue;s.push(r+"="+o)}return s.length?e+s.join("&"):""},e.parse=function(t){for(var e,n=/([^=?#&]+)=?([^&]*)/g,i={};e=n.exec(t);){var r=o(e[1]),s=o(e[2]);null===r||null===s||r in i||(i[r]=s)}return i}},851:t=>{"use strict";t.exports=function(t,e){if(e=e.split(":")[0],!(t=+t))return!1;switch(e){case"http":case"ws":return 80!==t;case"https":case"wss":return 443!==t;case"ftp":return 21!==t;case"gopher":return 70!==t;case"file":return!1}return 0!==t}},466:function(t){var e;t.exports=((e=function(){function t(t){return i.appendChild(t.dom),t}function n(t){for(var e=0;e<i.children.length;e++)i.children[e].style.display=e===t?"block":"none";o=t}var o=0,i=document.createElement("div");i.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",i.addEventListener("click",(function(t){t.preventDefault(),n(++o%i.children.length)}),!1);var r=(performance||Date).now(),s=r,a=0,u=t(new e.Panel("FPS","#0ff","#002")),l=t(new e.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var h=t(new e.Panel("MB","#f08","#201"));return n(0),{REVISION:16,dom:i,addPanel:t,showPanel:n,begin:function(){r=(performance||Date).now()},end:function(){a++;var t=(performance||Date).now();if(l.update(t-r,200),t>s+1e3&&(u.update(1e3*a/(t-s),100),s=t,a=0,h)){var e=performance.memory;h.update(e.usedJSHeapSize/1048576,e.jsHeapSizeLimit/1048576)}return t},update:function(){r=this.end()},domElement:i,setMode:n}}).Panel=function(t,e,n){var o=1/0,i=0,r=Math.round,s=r(window.devicePixelRatio||1),a=80*s,u=48*s,l=3*s,h=2*s,c=3*s,d=15*s,p=74*s,f=30*s,v=document.createElement("canvas");v.width=a,v.height=u,v.style.cssText="width:80px;height:48px";var m=v.getContext("2d");return m.font="bold "+9*s+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=n,m.fillRect(0,0,a,u),m.fillStyle=e,m.fillText(t,l,h),m.fillRect(c,d,p,f),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(c,d,p,f),{dom:v,update:function(u,_){o=Math.min(o,u),i=Math.max(i,u),m.fillStyle=n,m.globalAlpha=1,m.fillRect(0,0,a,d),m.fillStyle=e,m.fillText(r(u)+" "+t+" ("+r(o)+"-"+r(i)+")",l,h),m.drawImage(v,c+s,d,p-s,f,c,d,p-s,f),m.fillRect(c+p-s,d,s,f),m.fillStyle=n,m.globalAlpha=.9,m.fillRect(c+p-s,d,s,r((1-u/_)*f))}}},e)},564:(t,e,n)=>{"use strict";var o=n(851),i=n(129),r=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,s=/[\n\r\t]/g,a=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,u=/:\d+$/,l=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,h=/^[a-zA-Z]:/;function c(t){return(t||"").toString().replace(r,"")}var d=[["#","hash"],["?","query"],function(t,e){return v(e.protocol)?t.replace(/\\/g,"/"):t},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],p={hash:1,query:1};function f(t){var e,o=("undefined"!=typeof window?window:void 0!==n.g?n.g:"undefined"!=typeof self?self:{}).location||{},i={},r=typeof(t=t||o);if("blob:"===t.protocol)i=new _(unescape(t.pathname),{});else if("string"===r)for(e in i=new _(t,{}),p)delete i[e];else if("object"===r){for(e in t)e in p||(i[e]=t[e]);void 0===i.slashes&&(i.slashes=a.test(t.href))}return i}function v(t){return"file:"===t||"ftp:"===t||"http:"===t||"https:"===t||"ws:"===t||"wss:"===t}function m(t,e){t=(t=c(t)).replace(s,""),e=e||{};var n,o=l.exec(t),i=o[1]?o[1].toLowerCase():"",r=!!o[2],a=!!o[3],u=0;return r?a?(n=o[2]+o[3]+o[4],u=o[2].length+o[3].length):(n=o[2]+o[4],u=o[2].length):a?(n=o[3]+o[4],u=o[3].length):n=o[4],"file:"===i?u>=2&&(n=n.slice(2)):v(i)?n=o[4]:i?r&&(n=n.slice(2)):u>=2&&v(e.protocol)&&(n=o[4]),{protocol:i,slashes:r||v(i),slashesCount:u,rest:n}}function _(t,e,n){if(t=(t=c(t)).replace(s,""),!(this instanceof _))return new _(t,e,n);var r,a,u,l,p,y,E=d.slice(),g=typeof e,b=this,x=0;for("object"!==g&&"string"!==g&&(n=e,e=null),n&&"function"!=typeof n&&(n=i.parse),r=!(a=m(t||"",e=f(e))).protocol&&!a.slashes,b.slashes=a.slashes||r&&e.slashes,b.protocol=a.protocol||e.protocol||"",t=a.rest,("file:"===a.protocol&&(2!==a.slashesCount||h.test(t))||!a.slashes&&(a.protocol||a.slashesCount<2||!v(b.protocol)))&&(E[3]=[/(.*)/,"pathname"]);x<E.length;x++)"function"!=typeof(l=E[x])?(u=l[0],y=l[1],u!=u?b[y]=t:"string"==typeof u?~(p="@"===u?t.lastIndexOf(u):t.indexOf(u))&&("number"==typeof l[2]?(b[y]=t.slice(0,p),t=t.slice(p+l[2])):(b[y]=t.slice(p),t=t.slice(0,p))):(p=u.exec(t))&&(b[y]=p[1],t=t.slice(0,p.index)),b[y]=b[y]||r&&l[3]&&e[y]||"",l[4]&&(b[y]=b[y].toLowerCase())):t=l(t,b);n&&(b.query=n(b.query)),r&&e.slashes&&"/"!==b.pathname.charAt(0)&&(""!==b.pathname||""!==e.pathname)&&(b.pathname=function(t,e){if(""===t)return e;for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),o=n.length,i=n[o-1],r=!1,s=0;o--;)"."===n[o]?n.splice(o,1):".."===n[o]?(n.splice(o,1),s++):s&&(0===o&&(r=!0),n.splice(o,1),s--);return r&&n.unshift(""),"."!==i&&".."!==i||n.push(""),n.join("/")}(b.pathname,e.pathname)),"/"!==b.pathname.charAt(0)&&v(b.protocol)&&(b.pathname="/"+b.pathname),o(b.port,b.protocol)||(b.host=b.hostname,b.port=""),b.username=b.password="",b.auth&&(~(p=b.auth.indexOf(":"))?(b.username=b.auth.slice(0,p),b.username=encodeURIComponent(decodeURIComponent(b.username)),b.password=b.auth.slice(p+1),b.password=encodeURIComponent(decodeURIComponent(b.password))):b.username=encodeURIComponent(decodeURIComponent(b.auth)),b.auth=b.password?b.username+":"+b.password:b.username),b.origin="file:"!==b.protocol&&v(b.protocol)&&b.host?b.protocol+"//"+b.host:"null",b.href=b.toString()}_.prototype={set:function(t,e,n){var r=this;switch(t){case"query":"string"==typeof e&&e.length&&(e=(n||i.parse)(e)),r[t]=e;break;case"port":r[t]=e,o(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[t]="");break;case"hostname":r[t]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[t]=e,u.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!n;break;case"pathname":case"hash":if(e){var s="pathname"===t?"/":"#";r[t]=e.charAt(0)!==s?s+e:e}else r[t]=e;break;case"username":case"password":r[t]=encodeURIComponent(e);break;case"auth":var a=e.indexOf(":");~a?(r.username=e.slice(0,a),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(a+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var l=0;l<d.length;l++){var h=d[l];h[4]&&(r[h[1]]=r[h[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin="file:"!==r.protocol&&v(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r},toString:function(t){t&&"function"==typeof t||(t=i.stringify);var e,n=this,o=n.host,r=n.protocol;r&&":"!==r.charAt(r.length-1)&&(r+=":");var s=r+(n.protocol&&n.slashes||v(n.protocol)?"//":"");return n.username?(s+=n.username,n.password&&(s+=":"+n.password),s+="@"):n.password?(s+=":"+n.password,s+="@"):"file:"!==n.protocol&&v(n.protocol)&&!o&&"/"!==n.pathname&&(s+="@"),(":"===o[o.length-1]||u.test(n.hostname)&&!n.port)&&(o+=":"),s+=o+n.pathname,(e="object"==typeof n.query?t(n.query):n.query)&&(s+="?"!==e.charAt(0)?"?"+e:e),n.hash&&(s+=n.hash),s}},_.extractProtocol=m,_.location=f,_.trimLeft=c,_.qs=i,t.exports=_},643:()=>{Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,value:function t(){var e=isNaN(arguments[0])?1:Number(arguments[0]);return e?Array.prototype.reduce.call(this,(function(n,o){return Array.isArray(o)?n.push.apply(n,t.call(o,e-1)):n.push(o),n}),[]):Array.prototype.slice.call(this)},writable:!0})},297:()=>{let t="123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ";window.fxhash="oo"+Array(49).fill(0).map((e=>t[Math.random()*t.length|0])).join("");let e=fxhash.slice(2),n=new RegExp(".{"+(fxhash.length/4|0)+"}","g"),o=e.match(n).map((e=>{return(n=e).split("").reduce(((e,o,i)=>e+t.indexOf(o)*Math.pow(t.length,n.length-i-1)),0);var n}));window.fxrand=((t,e,n,o)=>()=>{var i=((t|=0)+(e|=0)|0)+(o|=0)|0;return o=o+1|0,t=e^e>>>9,e=(n|=0)+(n<<3)|0,n=(n=n<<21|n>>>11)+i|0,(i>>>0)/4294967296})(...o)}},e={};function n(o){var i=e[o];if(void 0!==i)return i.exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,n),r.exports}n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var o in e)n.o(e,o)&&!n.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:e[o]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{"use strict";n(297);var t=n(187),e=n.n(t),o=n(418),i=n.n(o),r=n(685);function s(t,e){const n=t.getExtension(e);if(!n)return!1;const o=e.split("_")[0],i=new RegExp(`${o}$`);for(const e in n)if("function"==typeof n[e]){const o=e.replace(i,"");e.substring&&(t[o]=n[e].bind(n))}return!0}const a=["EXT_shader_texture_lod","EXT_sRGB","EXT_frag_depth","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","OES_standard_derivatives","OES_element_index_uint","EXT_texture_filter_anisotropic","EXT_color_buffer_half_float","OES_vertex_array_object","WEBGL_depth_texture","ANGLE_instanced_arrays","WEBGL_color_buffer_float","WEBGL_draw_buffers","EXT_color_buffer_float"],u=(()=>{let t=!1;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(t=!0),t})(),l=(t,e)=>{if("number"==typeof t)return r.equals(t,e);if(t.length!==e.length)return!1;let n=!0;return t.forEach(((t,o)=>{n=r.equals(t,e[o])&&n})),n},h={ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALPHA:6406,ALPHA_BITS:3413,ALWAYS:519,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATTACHED_SHADERS:35717,BACK:1029,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BROWSER_DEFAULT_WEBGL:37444,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_BUFFER_BIT:16384,COLOR_CLEAR_VALUE:3106,COLOR_WRITEMASK:3107,COMPILE_STATUS:35713,COMPRESSED_TEXTURE_FORMATS:34467,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_LOST_WEBGL:37442,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH_ATTACHMENT:36096,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,RED:6403,DEPTH_COMPONENT16:33189,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DONT_CARE:4352,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,FASTEST:4353,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GREATER:516,GREEN_BITS:3411,HALF_FLOAT:36193,HIGH_FLOAT:36338,HIGH_INT:36341,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INT:5124,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE_ALPHA:6410,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_RENDERBUFFER_SIZE:34024,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIRRORED_REPEAT:33648,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NUM_COMPRESSED_TEXTURE_FORMATS:34466,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,RED_BITS:3410,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,REPEAT:10497,REPLACE:7681,RGB:6407,RGB5_A1:32855,RGB565:36194,RGBA:6408,RGBA4:32854,SAMPLER_2D:35678,SAMPLER_CUBE:35680,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SHADER_COMPILER:36346,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_CLEAR_VALUE:2961,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE2:33986,TEXTURE3:33987,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE30:34014,TEXTURE31:34015,TEXTURE_2D:3553,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,UNPACK_ALIGNMENT:3317,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VIEWPORT:2978,ZERO:0,R8:33321},c={0:"NONE",1:"ONE",2:"LINE_LOOP",3:"LINE_STRIP",4:"TRIANGLES",5:"TRIANGLE_STRIP",6:"TRIANGLE_FAN",256:"DEPTH_BUFFER_BIT",512:"NEVER",513:"LESS",514:"EQUAL",515:"LEQUAL",516:"GREATER",517:"NOTEQUAL",518:"GEQUAL",519:"ALWAYS",768:"SRC_COLOR",769:"ONE_MINUS_SRC_COLOR",770:"SRC_ALPHA",771:"ONE_MINUS_SRC_ALPHA",772:"DST_ALPHA",773:"ONE_MINUS_DST_ALPHA",774:"DST_COLOR",775:"ONE_MINUS_DST_COLOR",776:"SRC_ALPHA_SATURATE",1024:"STENCIL_BUFFER_BIT",1028:"FRONT",1029:"BACK",1032:"FRONT_AND_BACK",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",2304:"CW",2305:"CCW",2849:"LINE_WIDTH",2884:"CULL_FACE",2885:"CULL_FACE_MODE",2886:"FRONT_FACE",2928:"DEPTH_RANGE",2929:"DEPTH_TEST",2930:"DEPTH_WRITEMASK",2931:"DEPTH_CLEAR_VALUE",2932:"DEPTH_FUNC",2960:"STENCIL_TEST",2961:"STENCIL_CLEAR_VALUE",2962:"STENCIL_FUNC",2963:"STENCIL_VALUE_MASK",2964:"STENCIL_FAIL",2965:"STENCIL_PASS_DEPTH_FAIL",2966:"STENCIL_PASS_DEPTH_PASS",2967:"STENCIL_REF",2968:"STENCIL_WRITEMASK",2978:"VIEWPORT",3024:"DITHER",3042:"BLEND",3088:"SCISSOR_BOX",3089:"SCISSOR_TEST",3106:"COLOR_CLEAR_VALUE",3107:"COLOR_WRITEMASK",3317:"UNPACK_ALIGNMENT",3333:"PACK_ALIGNMENT",3379:"MAX_TEXTURE_SIZE",3386:"MAX_VIEWPORT_DIMS",3408:"SUBPIXEL_BITS",3410:"RED_BITS",3411:"GREEN_BITS",3412:"BLUE_BITS",3413:"ALPHA_BITS",3414:"DEPTH_BITS",3415:"STENCIL_BITS",3553:"TEXTURE_2D",4352:"DONT_CARE",4353:"FASTEST",4354:"NICEST",5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5124:"INT",5125:"UNSIGNED_INT",5126:"FLOAT",5386:"INVERT",5890:"TEXTURE",6401:"STENCIL_INDEX",6402:"DEPTH_COMPONENT",6403:"RED",6406:"ALPHA",6407:"RGB",6408:"RGBA",6409:"LUMINANCE",6410:"LUMINANCE_ALPHA",7680:"KEEP",7681:"REPLACE",7682:"INCR",7683:"DECR",7936:"VENDOR",7937:"RENDERER",7938:"VERSION",9728:"NEAREST",9729:"LINEAR",9984:"NEAREST_MIPMAP_NEAREST",9985:"LINEAR_MIPMAP_NEAREST",9986:"NEAREST_MIPMAP_LINEAR",9987:"LINEAR_MIPMAP_LINEAR",10240:"TEXTURE_MAG_FILTER",10241:"TEXTURE_MIN_FILTER",10242:"TEXTURE_WRAP_S",10243:"TEXTURE_WRAP_T",10497:"REPEAT",10752:"POLYGON_OFFSET_UNITS",16384:"COLOR_BUFFER_BIT",32769:"CONSTANT_COLOR",32770:"ONE_MINUS_CONSTANT_COLOR",32771:"CONSTANT_ALPHA",32772:"ONE_MINUS_CONSTANT_ALPHA",32773:"BLEND_COLOR",32774:"FUNC_ADD",32777:"BLEND_EQUATION_RGB",32778:"FUNC_SUBTRACT",32779:"FUNC_REVERSE_SUBTRACT",32819:"UNSIGNED_SHORT_4_4_4_4",32820:"UNSIGNED_SHORT_5_5_5_1",32823:"POLYGON_OFFSET_FILL",32824:"POLYGON_OFFSET_FACTOR",32854:"RGBA4",32855:"RGB5_A1",32873:"TEXTURE_BINDING_2D",32926:"SAMPLE_ALPHA_TO_COVERAGE",32928:"SAMPLE_COVERAGE",32936:"SAMPLE_BUFFERS",32937:"SAMPLES",32938:"SAMPLE_COVERAGE_VALUE",32939:"SAMPLE_COVERAGE_INVERT",32968:"BLEND_DST_RGB",32969:"BLEND_SRC_RGB",32970:"BLEND_DST_ALPHA",32971:"BLEND_SRC_ALPHA",33071:"CLAMP_TO_EDGE",33170:"GENERATE_MIPMAP_HINT",33189:"DEPTH_COMPONENT16",33306:"DEPTH_STENCIL_ATTACHMENT",33321:"R8",33635:"UNSIGNED_SHORT_5_6_5",33648:"MIRRORED_REPEAT",33901:"ALIASED_POINT_SIZE_RANGE",33902:"ALIASED_LINE_WIDTH_RANGE",33984:"TEXTURE0",33985:"TEXTURE1",33986:"TEXTURE2",33987:"TEXTURE3",33988:"TEXTURE4",33989:"TEXTURE5",33990:"TEXTURE6",33991:"TEXTURE7",33992:"TEXTURE8",33993:"TEXTURE9",33994:"TEXTURE10",33995:"TEXTURE11",33996:"TEXTURE12",33997:"TEXTURE13",33998:"TEXTURE14",33999:"TEXTURE15",34e3:"TEXTURE16",34001:"TEXTURE17",34002:"TEXTURE18",34003:"TEXTURE19",34004:"TEXTURE20",34005:"TEXTURE21",34006:"TEXTURE22",34007:"TEXTURE23",34008:"TEXTURE24",34009:"TEXTURE25",34010:"TEXTURE26",34011:"TEXTURE27",34012:"TEXTURE28",34013:"TEXTURE29",34014:"TEXTURE30",34015:"TEXTURE31",34016:"ACTIVE_TEXTURE",34024:"MAX_RENDERBUFFER_SIZE",34041:"DEPTH_STENCIL",34055:"INCR_WRAP",34056:"DECR_WRAP",34067:"TEXTURE_CUBE_MAP",34068:"TEXTURE_BINDING_CUBE_MAP",34069:"TEXTURE_CUBE_MAP_POSITIVE_X",34070:"TEXTURE_CUBE_MAP_NEGATIVE_X",34071:"TEXTURE_CUBE_MAP_POSITIVE_Y",34072:"TEXTURE_CUBE_MAP_NEGATIVE_Y",34073:"TEXTURE_CUBE_MAP_POSITIVE_Z",34074:"TEXTURE_CUBE_MAP_NEGATIVE_Z",34076:"MAX_CUBE_MAP_TEXTURE_SIZE",34338:"VERTEX_ATTRIB_ARRAY_ENABLED",34339:"VERTEX_ATTRIB_ARRAY_SIZE",34340:"VERTEX_ATTRIB_ARRAY_STRIDE",34341:"VERTEX_ATTRIB_ARRAY_TYPE",34342:"CURRENT_VERTEX_ATTRIB",34373:"VERTEX_ATTRIB_ARRAY_POINTER",34466:"NUM_COMPRESSED_TEXTURE_FORMATS",34467:"COMPRESSED_TEXTURE_FORMATS",34660:"BUFFER_SIZE",34661:"BUFFER_USAGE",34816:"STENCIL_BACK_FUNC",34817:"STENCIL_BACK_FAIL",34818:"STENCIL_BACK_PASS_DEPTH_FAIL",34819:"STENCIL_BACK_PASS_DEPTH_PASS",34877:"BLEND_EQUATION_ALPHA",34921:"MAX_VERTEX_ATTRIBS",34922:"VERTEX_ATTRIB_ARRAY_NORMALIZED",34930:"MAX_TEXTURE_IMAGE_UNITS",34962:"ARRAY_BUFFER",34963:"ELEMENT_ARRAY_BUFFER",34964:"ARRAY_BUFFER_BINDING",34965:"ELEMENT_ARRAY_BUFFER_BINDING",34975:"VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",35040:"STREAM_DRAW",35044:"STATIC_DRAW",35048:"DYNAMIC_DRAW",35632:"FRAGMENT_SHADER",35633:"VERTEX_SHADER",35660:"MAX_VERTEX_TEXTURE_IMAGE_UNITS",35661:"MAX_COMBINED_TEXTURE_IMAGE_UNITS",35663:"SHADER_TYPE",35664:"FLOAT_VEC2",35665:"FLOAT_VEC3",35666:"FLOAT_VEC4",35667:"INT_VEC2",35668:"INT_VEC3",35669:"INT_VEC4",35670:"BOOL",35671:"BOOL_VEC2",35672:"BOOL_VEC3",35673:"BOOL_VEC4",35674:"FLOAT_MAT2",35675:"FLOAT_MAT3",35676:"FLOAT_MAT4",35678:"SAMPLER_2D",35680:"SAMPLER_CUBE",35712:"DELETE_STATUS",35713:"COMPILE_STATUS",35714:"LINK_STATUS",35715:"VALIDATE_STATUS",35716:"INFO_LOG_LENGTH",35717:"ATTACHED_SHADERS",35718:"ACTIVE_UNIFORMS",35719:"ACTIVE_UNIFORM_MAX_LENGTH",35720:"SHADER_SOURCE_LENGTH",35721:"ACTIVE_ATTRIBUTES",35722:"ACTIVE_ATTRIBUTE_MAX_LENGTH",35724:"SHADING_LANGUAGE_VERSION",35725:"CURRENT_PROGRAM",36003:"STENCIL_BACK_REF",36004:"STENCIL_BACK_VALUE_MASK",36005:"STENCIL_BACK_WRITEMASK",36006:"FRAMEBUFFER_BINDING",36007:"RENDERBUFFER_BINDING",36048:"FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",36049:"FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",36050:"FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",36051:"FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",36053:"FRAMEBUFFER_COMPLETE",36054:"FRAMEBUFFER_INCOMPLETE_ATTACHMENT",36055:"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",36057:"FRAMEBUFFER_INCOMPLETE_DIMENSIONS",36061:"FRAMEBUFFER_UNSUPPORTED",36064:"COLOR_ATTACHMENT0",36096:"DEPTH_ATTACHMENT",36128:"STENCIL_ATTACHMENT",36160:"FRAMEBUFFER",36161:"RENDERBUFFER",36162:"RENDERBUFFER_WIDTH",36163:"RENDERBUFFER_HEIGHT",36164:"RENDERBUFFER_INTERNAL_FORMAT",36168:"STENCIL_INDEX8",36176:"RENDERBUFFER_RED_SIZE",36177:"RENDERBUFFER_GREEN_SIZE",36178:"RENDERBUFFER_BLUE_SIZE",36179:"RENDERBUFFER_ALPHA_SIZE",36180:"RENDERBUFFER_DEPTH_SIZE",36181:"RENDERBUFFER_STENCIL_SIZE",36193:"HALF_FLOAT",36194:"RGB565",36336:"LOW_FLOAT",36337:"MEDIUM_FLOAT",36338:"HIGH_FLOAT",36339:"LOW_INT",36340:"MEDIUM_INT",36341:"HIGH_INT",36346:"SHADER_COMPILER",36347:"MAX_VERTEX_UNIFORM_VECTORS",36348:"MAX_VARYING_VECTORS",36349:"MAX_FRAGMENT_UNIFORM_VECTORS",37440:"UNPACK_FLIP_Y_WEBGL",37441:"UNPACK_PREMULTIPLY_ALPHA_WEBGL",37442:"CONTEXT_LOST_WEBGL",37443:"UNPACK_COLORSPACE_CONVERSION_WEBGL",37444:"BROWSER_DEFAULT_WEBGL"},d={alpha:!1,depth:!0,premultipliedAlpha:!1};var p=n(975),f=n(600);let v=0;function m(){let t,e,n=[0,0,0,0],o=0,r=0,m=0,y=(()=>{const t=document.createElement("canvas");return!(!t.getContext("experimental-webgl2")&&!t.getContext("webgl2"))})(),E=u;const g=p.create(),b=p.create(),x=p.create(),w=f.create(),A=p.create(),T=f.create();this.id="WebGLContext"+v++,this.canvas,this.gl,this.CONTEXT_LOST="contextLost",this.CONTEXT_RESTORED="contextRestored",this.shaderCount=0,this.bufferCount=0,this.textureCount=0,this.frameBufferCount=0,this.maxAnisotropy=0,this.multiRenderTargetSupport=!1,this.maxMultiRenderTargets=0,this.init=function(t,e={}){const n=i()({},d,e);if(void 0!==t){if(t instanceof HTMLCanvasElement){this.canvas=t;let o=y?"webgl2":"webgl";e.webgl1&&(o="webgl",y=!1),this.gl=t.getContext(o,n)}else window.WebGL2RenderingContext&&t instanceof WebGL2RenderingContext?(y=!0,this.gl=t,this.canvas=t.canvas):t instanceof WebGLRenderingContext?(y=!1,this.gl=t,this.canvas=t.canvas):console.error("The source has to be one of the following : Canvas, WebGLRenderingContext or WebGL2RenderingContext");this.canvas.addEventListener("webglcontextlost",M),this.canvas.addEventListener("webglcontextrestored",S),this.extensions=(t=>{const{gl:e}=t,n=window.WebGL2RenderingContext&&e instanceof WebGL2RenderingContext,o={};a.forEach((t=>{o[t]=e.getExtension(t)})),n||(o.OES_vertex_array_object||console.error("OES_vertex_array_object extension is not supported"),s(e,"OES_vertex_array_object"),s(e,"ANGLE_instanced_arrays"),s(e,"WEBGL_draw_buffers"));const i=o.EXT_texture_filter_anisotropic;if(i&&(t.maxAnisotropy=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),t.multiRenderTargetSupport=!!t.gl.drawBuffers,t.multiRenderTargetSupport){const n=t.gl.MAX_DRAW_BUFFERS||o.WEBGL_draw_buffers.MAX_DRAW_BUFFERS_WEBGL;t.maxMultiRenderTargets=e.getParameter(n)}return o})(this),(t=>{for(const e in h)t[e]?console.log("already exist : ",e):t[e]=h[e];if(t.webgl2){const e=/^[^a-z]*$/;for(const n in t.gl)e.test(n)&&-1===n.indexOf("FLOAT")&&(t[n]=t.gl[n],h[n]=t.gl[n],c[t[n]]=n)}})(this),this.setSize(this.canvas.width,this.canvas.height),this.enable(this.BLEND),this.enableAlphaBlending(),this.enable(this.DEPTH_TEST),this.enable(this.CULL_FACE),this.cullFace(_.BACK)}else{const t=document.createElement("canvas");this.init(t,n)}},this.clear=function(t=0,e=0,n=0,o=0){const{gl:i}=this;i.clearColor(t,e,n,o),i.clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT)},this.setSize=function(t,e){r=Math.floor(t),m=Math.floor(e),this.canvas.width=r,this.canvas.height=m,o=r/m,this.viewport(0,0,r,m)},this.viewport=function(t,e,o,i){l(n,[t,e,o,i])||(n=[t,e,o,i],this.gl.viewport(t,e,o,i))},this.getViewport=function(){return n},this.getAspectRatio=function(){return o},this.enable=function(t){this.gl.enable(t)},this.disable=function(t){this.gl.disable(t)},this.cullFace=function(t){this.gl.cullFace(t)},this.enableAlphaBlending=function(){const{gl:t}=this;t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA)},this.enableAdditiveBlending=function(){const{gl:t}=this;t.blendFunc(t.ONE,t.ONE)},this.setMatrices=function(t){e=t,this.setModelMatrix(b)},this.setModelMatrix=function(t){p.copy(x,t),void 0!==e&&(p.multiply(g,e.viewMatrix,x),f.fromMat4(w,g),f.invert(w,w),f.transpose(w,w),f.fromMat4(T,g),f.invert(T,T),p.invert(A,e.viewMatrix))},this.useShader=function(e){t=e,this.shaderProgram=e.shaderProgram,this.gl.useProgram(this.shaderProgram)},this.draw=function(e){if(e.length)return void e.forEach((t=>this.draw(t)));R(),t.updateUniforms(),e.bind(this);const{drawType:n}=e,{gl:o}=this;e.isInstanced?o.drawElementsInstanced(e.drawType,e.numItems,o.UNSIGNED_INT,0,e.numInstance):n===o.POINTS?o.drawArrays(n,0,e.vertexSize):o.drawElements(n,e.numItems,o.UNSIGNED_INT,0),e.unbind()},this.getCamera=function(){return e},this.destroy=function(t=!0){this.gl.getExtension("WEBGL_lose_context").loseContext(),t&&void 0!==this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)},this.__defineGetter__("width",(function(){return r})),this.__defineGetter__("height",(function(){return m})),this.__defineGetter__("webgl2",(function(){return y})),this.__defineGetter__("isMobile",(function(){return E})),this.__defineGetter__("aspectRatio",(function(){return o}));const R=()=>{void 0!==e&&(t.uniform("uProjectionMatrix","mat4",e.projectionMatrix),t.uniform("uViewMatrix","mat4",e.viewMatrix),t.uniform("uNormalMatrix","mat3",w),t.uniform("uModelViewMatrixInverse","mat3",T)),t.uniform("uModelMatrix","mat4",x)},M=()=>{this.emit(this.CONTEXT_LOST)},S=()=>{this.emit(this.CONTEXT_RESTORED)}}m.prototype=Object.assign(Object.create(e().prototype),{constructor:m});const _=new m,y={float:"uniform1f",vec2:"uniform2fv",vec3:"uniform3fv",vec4:"uniform4fv",int:"uniform1i",ivec2:"uniform2i",ivec3:"uniform3i",ivec4:"uniform4i",mat2:"uniformMatrix2fv",mat3:"uniformMatrix3fv",mat4:"uniformMatrix4fv"},E=t=>"number"==typeof t?t:t.slice?t.slice(0):new Float32Array(t),g=t=>"object"==typeof t?function(t){return 9===t.length?"mat3":16===t.length?"mat4":`vec${t.length}`}(t):"float";function b(t,e){let n;this.vertexShader=t||"// basic.vert\n\nprecision highp float;\n#define GLSLIFY 1\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec3 aNormal;\n\nuniform mat4 uModelMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec3 vNormal;\n\nvoid main(void) {\n    gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPosition, 1.0);\n    vTextureCoord = aTextureCoord;\n    vNormal = aNormal;\n}",this.fragmentShader=e||"precision highp float;\n#define GLSLIFY 1\n// varying vec2 vTextureCoord;\n\nvoid main(void) {\n    gl_FragColor = vec4(1.0);\n}",this.shaderProgram;let o={};this.bind=function(t){if(void 0===t||void 0===n||t===n){if(n=t||_,!this.shaderProgram){const t=i(this.vertexShader,!0),e=i(this.fragmentShader,!1);r(t,e)}n.useShader(this)}else console.error("this shader has been bind to a different WebGL Rendering Context",n.id)},this.uniform=function(t,e,n){let i,r;void 0===n?(r=g(e),i=e):(r=e,i=n);const s=y[r];if(o[t]){const e=o[t];l(e.value,i)||(e.value=E(i),e.changed=!0)}else o[t]={type:r,uniformType:s,value:E(i),changed:!0};return this},this.updateUniforms=function(){if(!n)return void console.warn("No WebGL Context has been set yet, please call shader.bind() first");const{gl:t}=n;for(let e in o){const n=o[e];if(n.changed){const o=e;n.uniformLoc||(n.uniformLoc=t.getUniformLocation(this.shaderProgram,o));const{uniformLoc:i,uniformType:r,value:s}=n;null!==i&&(-1===r.indexOf("Matrix")?t[r](i,s):t[r](i,!1,s)),n.changed=!1}}},this.destroy=function(){const{gl:t}=n;t.deleteProgram(this.shaderProgram),n.shaderCount--};const i=(t,e)=>{const{gl:o}=n,i=e?n.VERTEX_SHADER:n.FRAGMENT_SHADER,r=o.createShader(i);return o.shaderSource(r,t),o.compileShader(r),o.getShaderParameter(r,o.COMPILE_STATUS)?r:(console.warn("Error in Shader : ",o.getShaderInfoLog(r)),console.log((t=>{const e=t.split("\n");for(let t=0;t<e.length;t++)e[t]=`${t+1}: ${e[t]}`;return e.join("\n")})(t)),null)},r=(t,e)=>{const{gl:o}=n;this.shaderProgram=o.createProgram(),o.attachShader(this.shaderProgram,t),o.attachShader(this.shaderProgram,e),o.deleteShader(t),o.deleteShader(e),o.linkProgram(this.shaderProgram),n.shaderCount++}}function x(t=h.TRIANGLES){this.drawType=t,this.numItems=0;let e,n,o,i,r,s=[],a=[],u=[],l=!0,c=!1,d=0;this.bufferData=function(t,e,n,o=h.STATIC_DRAW,i=!1){let r,s=[];if("number"==typeof t[0]){if(r=t,void 0===n)return console.error("Missing element size for flatten data :",e),this;for(let t=0;t<r.length;t+=n){const e=[];for(let o=0;o<n;o++)e.push(r[t+o]);s.push(e)}}else s=t,r=(t=>{if(t[0]instanceof Float32Array){const e=t.reduce(((t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n]);return t}),[]);return e}return t.flat()})(t);const a=void 0===n?t[0].length:n;return p(r,t,e,a,o,i)},this.bufferInstance=function(t,e){const n=t[0].length;return d=t.length,this.bufferData(t,e,n,h.STATIC_DRAW,!0)},this.bufferVertex=function(t,e=h.STATIC_DRAW){return this.bufferData(t,"aVertexPosition",3,e)},this.bufferTexCoord=function(t,e=h.STATIC_DRAW){return this.bufferData(t,"aTextureCoord",2,e)},this.bufferNormal=function(t,e=h.STATIC_DRAW){return this.bufferData(t,"aNormal",3,e)},this.bufferIndex=function(t,e=h.STATIC_DRAW){return n=e,o=new Uint32Array(t),this.numItems=o.length,l=!0,this},this.bind=function(t){if(void 0!==t&&void 0!==r&&t!==r)return void console.error("this mesh has been bind to a different WebGL Rendering Context");r=t||GL;const{gl:n}=r;f(),n.bindVertexArray(e),this.vertexSize=this.getSource("aVertexPosition").length},this.unbind=function(){},this.getAttribute=function(t){return s.find((e=>e.name===t))},this.getAttributes=function(){return s},this.getSource=function(t){const e=this.getAttribute(t);return e?e.source:[]},this.generateFaces=function(){let t,e,n,i,r,s;u=[];const{vertices:a}=this;for(let l=0;l<o.length;l+=3){t=o[l],e=o[l+1],n=o[l+2],i=a[t],r=a[e],s=a[n];const h={indices:[t,e,n],vertices:[i,r,s]};u.push(h)}},this.destroy=function(){const{gl:t}=r;s.forEach((e=>{t.deleteBuffer(e.buffer),e.source=[],e.dataArray=[],r.bufferCount--})),i&&(t.deleteBuffer(i),r.bufferCount--),t.deleteVertexArray(e),s=[],o=[],a=[]},this.__defineGetter__("vertices",(function(){return this.getSource("aVertexPosition")})),this.__defineGetter__("coords",(function(){return this.getSource("aTextureCoord")})),this.__defineGetter__("normal",(function(){return this.getSource("aNormal")})),this.__defineGetter__("indices",(function(){return o})),this.__defineGetter__("faces",(function(){return u})),this.__defineGetter__("isInstanced",(function(){return c})),this.__defineGetter__("numInstance",(function(){return d}));const p=(t,e,n,o,i=h.STATIC_DRAW,r=!1)=>{const u=i;c=r||c;const l=new Float32Array(t),d=this.getAttribute(n);return d?(d.itemSize=o,d.dataArray=l,d.source=e):s.push({name:n,source:e,itemSize:o,usage:u,dataArray:l,isInstanced:r}),a.push(n),this},f=()=>{const{shaderProgram:t,gl:n}=r;0!=a.length&&(e||(e=n.createVertexArray()),n.bindVertexArray(e),s.forEach((e=>{if(-1!==a.indexOf(e.name)){const o=function(t,e){let n;const{gl:o}=e;return void 0!==t.buffer?n=t.buffer:(n=o.createBuffer(),t.buffer=n,e.bufferCount++),n}(e,r);n.bindBuffer(n.ARRAY_BUFFER,o),n.bufferData(n.ARRAY_BUFFER,e.dataArray,e.usage);const i=((t,e,n)=>(void 0===e.cacheAttribLoc&&(e.cacheAttribLoc={}),void 0===e.cacheAttribLoc[n]&&(e.cacheAttribLoc[n]=t.getAttribLocation(e,n)),e.cacheAttribLoc[n]))(n,t,e.name);i>=0&&(n.enableVertexAttribArray(i),n.vertexAttribPointer(i,e.itemSize,n.FLOAT,!1,0,0)),e.attrPosition=i,e.isInstanced&&n.vertexAttribDivisor(i,1)}})),v(),n.bindVertexArray(null),l=!1,a=[])},v=()=>{const{gl:t}=r;l&&(i||(i=t.createBuffer(),r.bufferCount++),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,o,n))}}const w=t=>0!==t&&!(t&t-1);class A{constructor(t){this._value=t}set(t,e=1){this._value=this._value,this._value=0===e?this._value&0<<t:this._value|1<<t}get(t){let e=this._value&1<<t;return e>>=t,1===e}reset(t){this._value=t}get value(){return this._value}}const T="This browser doesn't support multi render targets : WEBGL_draw_buffers",R="This framebuffer has been bind to a different WebGL Rendering Context",M="This texture has been bind to a different WebGL Rendering Context",S=(t,e="")=>{console.error(t,e)};class C{constructor(t,e={},n=0,o=0){if(this._fromWebGLTexture=!1,t instanceof WebGLTexture)this._texture=t,this._fromWebGLTexture=!0;else{if(this._source=t,this._isHtmlElement=(t=>t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement)(this._source),!this._isHtmlElement&&t&&!((t,e)=>{let n=!0;return"Array"===t.constructor.name&&(console.error("Please convert texture source to Unit8Array or Float32Array"),n=!1),void 0===e.type&&"Uint8Array"!==t.constructor.name&&console.error("Using none Unit8Array, pleaes specify type in the texture parameters"),n})(t,e))return;this._getDimension(t,n,o),this._params=function(t,e,n){if(!t.minFilter){let o=h.LINEAR;e&&e&&w(e)&&w(n)&&(o=h.NEAREST_MIPMAP_LINEAR),t.minFilter=o}return t.mipmap=void 0===t.mipmap||t.mipmap,t.magFilter=t.magFilter||h.LINEAR,t.wrapS=t.wrapS||h.CLAMP_TO_EDGE,t.wrapT=t.wrapT||h.CLAMP_TO_EDGE,t.internalFormat=t.internalFormat||h.RGBA,t.format=t.format||h.RGBA,t.premultiplyAlpha=void 0!==t.premultiplyAlpha&&t.premultiplyAlpha,t.level=t.level||0,t.type=t.type||h.UNSIGNED_BYTE,t}(e,this._width,this._height),this._checkMipmap()}this._parametersState=new A(0)}bind(t,e){if(void 0!==e&&void 0!==this.GL&&e!==this.GL)return void S(M,this.GL.id);this.GL=e||_;const{gl:n}=this.GL;this._fromWebGLTexture||this.createTexture(this.GL),n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,this._texture),this._checkParameters()}createTexture(t){void 0===t||void 0===this.GL||t===this.GL?(this.GL=t||_,this._texture||(((t,e)=>{t.webgl2&&(e.type===h.HALF_FLOAT?(e.type=t.gl.HALF_FLOAT,e.internalFormat=h.RGBA16F):e.type===h.FLOAT&&(e.internalFormat=h.RGBA32F))})(this.GL,this._params),this._uploadTexture())):S(M,this.GL.id)}updateTexture(t){this._source=t,this._uploadTexture()}generateMipmap(){if(!this._generateMipmap)return;const{gl:t}=this.GL;t.bindTexture(t.TEXTURE_2D,this._texture),t.generateMipmap(t.TEXTURE_2D)}destroy(){const{gl:t}=this.GL;t.deleteTexture(this._texture),this.GL.textureCount--}showProperties(){console.log("Dimension :",this._width,this._height);for(const t in this._params)console.log(t,c[this._params[t]]||this._params[t])}_uploadTexture(){const{gl:t}=this.GL;this._texture||(this._texture=t.createTexture(),this.GL.textureCount++),t.bindTexture(t.TEXTURE_2D,this._texture),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!0),this._isHtmlElement&&!this.GL.webgl2?t.texImage2D(t.TEXTURE_2D,0,this._params.internalFormat,this._params.format,this._params.type,this._source):t.texImage2D(t.TEXTURE_2D,0,this._params.internalFormat,this._width,this._height,0,this._params.format,this._params.type,this._source),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this._params.magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._params.minFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._params.wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._params.wrapT),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha),this._generateMipmap&&t.generateMipmap(t.TEXTURE_2D)}_checkParameters(){const{gl:t}=this.GL;this._parametersState.value>0&&(this._parametersState.get(0)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._params.minFilter):this._parametersState.get(1)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this._params.magFilter):this._parametersState.get(2)?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._params.wrapS):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._params.wrapT)),this._parametersState.reset(0)}_getDimension(t,e,n){t?(this._width=t.width||t.videoWidth,this._height=t.height||t.videoWidth,this._width=this._width||e,this._height=this._height||n,this._width&&this._height||(this._width=this._height=Math.sqrt(t.length/4))):(this._width=e,this._height=n)}_checkMipmap(){this._generateMipmap=this._params.mipmap,w(this._width)&&w(this._height)||(this._generateMipmap=!1),-1===c[this._params.minFilter].indexOf("MIPMAP")&&(this._generateMipmap=!1)}get texture(){return this._texture}set minFilter(t){this._params.minFilter=t,this._parametersState.set(0,1)}get minFilter(){return this._params.minFilter}set magFilter(t){this._params.magFilter=t,this._parametersState.set(1,1)}get magFilter(){return this._params.magFilter}set wrapS(t){this._params.wrapS=t,this._parametersState.set(2,1)}get wrapS(){return this._params.wrapS}set wrapT(t){this._params.wrapT=t,this._parametersState.set(3,1)}get wrapT(){return this._params.wrapT}get width(){return this._width}get height(){return this._height}}function L(t,e,n={},o=1){let i,r;const s=t,a=e,u=n,l=o,c=[];let d;this.bind=function(t,e=!0){if(void 0!==t&&void 0!==i&&t!==i)return void S(R,i.id);i=t||_;const{gl:n}=i;l>1&&!i.multiRenderTargetSupport&&S(T,i.id),r||p(),e&&i.viewport(0,0,s,a),n.bindFramebuffer(n.FRAMEBUFFER,r)},this.unbind=function(t=!0){t&&i.viewport(0,0,i.width,i.height);const{gl:e}=i;e.bindFramebuffer(e.FRAMEBUFFER,null),c.forEach((t=>{t.generateMipmap()}))},this.getTexture=function(t=0){return c[t]},this.destroy=function(){const{gl:t}=i;c.forEach((t=>t.destroy())),d.destroy(),t.deleteFramebuffer(r),i.frameBufferCount--};const p=()=>{f();const{gl:t}=i;r=t.createFramebuffer(),t.bindFramebuffer(t.FRAMEBUFFER,r),i.frameBufferCount++;const e=i.webgl2?t.DRAW_FRAMEBUFFER:t.FRAMEBUFFER,n=[];for(let o=0;o<l;o++)t.framebufferTexture2D(e,t.COLOR_ATTACHMENT0+o,t.TEXTURE_2D,c[o].texture,0),n.push(h[`COLOR_ATTACHMENT${o}`]);i.multiRenderTargetSupport&&t.drawBuffers(n),t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,d.texture,0),t.bindTexture(t.TEXTURE_2D,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null)},f=()=>{for(let t=0;t<l;t++)c.push(v());const{gl:t}=i,e=i.webgl2?t.DEPTH_COMPONENT16:t.DEPTH_COMPONENT;d=v(e,h.UNSIGNED_INT,h.DEPTH_COMPONENT,{minFilter:h.NEAREST,magFilter:h.NEAREST,mipmap:!1})},v=(t,e,n,o={})=>{const r=Object.assign({},u);n||(n=t),r.internalFormat=t||h.RGBA,r.format=n||h.RGBA,r.type=e||r.type,Object.assign(r,o);const l=new C(null,r,s,a);return l.createTexture(i),l};this.__defineGetter__("texture",(function(){return c[0]})),this.__defineGetter__("depthTexture",(function(){return d})),this.__defineGetter__("width",(function(){return s})),this.__defineGetter__("height",(function(){return a}))}class N{constructor(t){return this._GL=t||_,this._uniforms={},this._uniformTextures=[],this._fbo,this._clearColor={r:0,g:0,b:0,a:0},this}setClearColor(t=0,e=0,n=0,o=0){return this._clearColor.r=t,this._clearColor.g=e,this._clearColor.b=n,this._clearColor.a=o,this}useProgram(t,e){return this._shader=t instanceof b?t:new b(t,e),this}setMesh(t){return this._mesh=t,this}createMesh(t){return this._mesh=new x(t),this}bufferVertex(t){return this._mesh||(this._mesh=new x),this._mesh.bufferVertex(t),this}bufferTexCoord(t){return this._mesh||(this._mesh=new x),this._mesh.bufferTexCoord(t),this}bufferNormal(t){return this._mesh||(this._mesh=new x),this._mesh.bufferNormal(t),this}bufferIndex(t){return this._mesh||(this._mesh=new x),this._mesh.bufferIndex(t),this}bufferInstance(t,e){return this._mesh?(this._mesh.bufferInstance(t,e),this):(console.warn("Need to create mesh first"),this)}bufferData(t,e){return this._mesh||(this._mesh=new x),this._mesh.bufferData(t,e),this}uniform(t,e,n){const o=t;let i,r;return void 0===n?(r=g(e),i=e):(r=e,i=n),this._uniforms[o]={type:r,value:i},this}uniformTexture(t,e,n){return this.bindTexture(t,e,n)}bindTexture(t,e,n){return void 0!==n?this._uniformTextures[n]={name:t,texture:e}:this._uniformTextures.push({name:t,texture:e}),this}bindFrameBuffer(t){return this._fbo=t,this}draw(){if(this._shader){if(this._mesh){if(this._fbo){const{r:t,g:e,b:n,a:o}=this._clearColor;this._fbo.bind(this._GL),this._GL.clear(t,e,n,o)}this._shader.bind(this._GL);for(const t in this._uniforms){const e=this._uniforms[t];this._shader.uniform(t,e.type,e.value)}return this._uniformTextures.forEach(((t,e)=>{void 0!==t&&(this._shader.uniform(t.name,"int",e),t.texture.bind(e,this._GL))})),this._GL.draw(this._mesh),this._fbo&&this._fbo.unbind(),this}console.warn("No Mesh assigned for draw call")}else console.warn("No GLShader assigned for draw call")}get shader(){return this._shader}get framebuffer(){return this._fbo}}class P extends N{constructor(t){super(t);const e=this._GL,n=1e3,o=[[-n,0,0],[n,0,0],[0,-n,0],[0,n,0],[0,0,-n],[0,0,n]];this.createMesh(e.LINES).bufferVertex(o).bufferData([[1,0,0],[1,0,0],[0,1,0],[0,1,0],[0,0,1],[0,0,1]],"aColor").bufferIndex([0,1,2,3,4,5]).useProgram("precision highp float;\n#define GLSLIFY 1\nattribute vec3 aVertexPosition;\nattribute vec3 aColor;\n\nuniform mat4 uModelMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec3 vColor;\n\nvoid main(void) {\n  gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPosition, 1.0);\n  vColor = aColor;\n}","precision highp float;\n#define GLSLIFY 1\nvarying vec3 vColor;\nuniform float uOpacity;\n\nvoid main(void) {\n    gl_FragColor = vec4(vColor, uOpacity);\n}"),this.opacity=.75}draw(){this.uniform("uOpacity",this.opacity),super.draw()}}var I=n(160);const B=(t,e,n,o="xy")=>{const i=[],r=[],s=[],a=[],u=t/n,l=e/n,h=1/n,c=.5*-t,d=.5*-e;let p=0;for(let t=0;t<n;t++)for(let e=0;e<n;e++){const f=u*t+c,v=l*e+d,m=t/n,_=e/n;"xz"===o?(i.push([f,0,v+l]),i.push([f+u,0,v+l]),i.push([f+u,0,v]),i.push([f,0,v]),r.push([m,1-(_+h)]),r.push([m+h,1-(_+h)]),r.push([m+h,1-_]),r.push([m,1-_]),a.push([0,1,0]),a.push([0,1,0]),a.push([0,1,0]),a.push([0,1,0])):"yz"===o?(i.push([0,v,f]),i.push([0,v,f+u]),i.push([0,v+l,f+u]),i.push([0,v+l,f]),r.push([m,_]),r.push([m+h,_]),r.push([m+h,_+h]),r.push([m,_+h]),a.push([1,0,0]),a.push([1,0,0]),a.push([1,0,0]),a.push([1,0,0])):(i.push([f,v,0]),i.push([f+u,v,0]),i.push([f+u,v+l,0]),i.push([f,v+l,0]),r.push([m,_]),r.push([m+h,_]),r.push([m+h,_+h]),r.push([m,_+h]),a.push([0,0,1]),a.push([0,0,1]),a.push([0,0,1]),a.push([0,0,1])),s.push(4*p+0),s.push(4*p+1),s.push(4*p+2),s.push(4*p+0),s.push(4*p+2),s.push(4*p+3),p++}return(new x).bufferVertex(i).bufferTexCoord(r).bufferIndex(s).bufferNormal(a)},F=(t,e,n=!1)=>{const o=[],i=[],r=[],s=[],a=1/e;let u=0;function l(n,o,i=!1){const r=n/e*Math.PI-.5*Math.PI,s=o/e*Math.PI*2,a=i?1:t,u=[];u[1]=Math.sin(r)*a;const l=Math.cos(r)*a;u[0]=Math.cos(s)*l,u[2]=Math.sin(s)*l;const h=1e4;return u[0]=Math.floor(u[0]*h)/h,u[1]=Math.floor(u[1]*h)/h,u[2]=Math.floor(u[2]*h)/h,u}for(let t=0;t<e;t++)for(let n=0;n<e;n++){o.push(l(t,n)),o.push(l(t+1,n)),o.push(l(t+1,n+1)),o.push(l(t,n+1)),s.push(l(t,n,!0)),s.push(l(t+1,n,!0)),s.push(l(t+1,n+1,!0)),s.push(l(t,n+1,!0));const h=n/e,c=t/e;i.push([1-h,c]),i.push([1-h,c+a]),i.push([1-h-a,c+a]),i.push([1-h-a,c]),r.push(4*u+0),r.push(4*u+1),r.push(4*u+2),r.push(4*u+0),r.push(4*u+2),r.push(4*u+3),u++}return n&&r.reverse(),(new x).bufferVertex(o).bufferTexCoord(i).bufferIndex(r).bufferNormal(s)},O=()=>(new x).bufferData([[-1,-1],[-1,4],[4,-1]],"aPosition",2).bufferIndex([2,1,0]),U="// copy.frag\n\n#define SHADER_NAME SIMPLE_TEXTURE\n\nprecision highp float;\n#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D texture;\n\nvoid main(void) {\n    gl_FragColor = texture2D(texture, vTextureCoord);\n}",V="// bigTriangle.vert\n\n#define SHADER_NAME BIG_TRIANGLE_VERTEX\n\nprecision mediump float;\n#define GLSLIFY 1\nattribute vec2 aPosition;\nvarying vec2 vTextureCoord;\n\nvoid main(void) {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n    vTextureCoord = aPosition * .5 + .5;\n}";class D extends N{constructor(t){super(t),this.setMesh(F(1,12)).useProgram("// basic.vert\n\nprecision highp float;\n#define GLSLIFY 1\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec3 aNormal;\n\nuniform mat4 uModelMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform vec3 uTranslate;\nuniform vec3 uScale;\nuniform vec3 uRotation;\n\nvarying vec2 vTextureCoord;\nvarying vec3 vNormal;\n\nvec2 rotate(vec2 v, float a) {\n\tfloat s = sin(a);\n\tfloat c = cos(a);\n\tmat2 m = mat2(c, s, -s, c);\n\treturn m * v;\n}\n\nvoid main(void) {\n  vec3 pos = aVertexPosition * uScale;\n  pos.yz = rotate(pos.yz, uRotation.x);\n  pos.xz = rotate(pos.xz, uRotation.y);\n  pos.xy = rotate(pos.xy, uRotation.z);\n  pos += uTranslate;\n\n  gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(pos, 1.0);\n  vTextureCoord = aTextureCoord;\n  vNormal = aNormal;\n}","precision highp float;\n#define GLSLIFY 1\n\nuniform vec3 uColor;\nuniform float uOpacity;\n\nvoid main(void) {\n    gl_FragColor = vec4(uColor, uOpacity);\n}").uniform("uRotation",[0,0,0])}draw(t,e=[1,1,1],n=[1,1,1],o=1){this.uniform("uTranslate",t).uniform("uScale",e).uniform("uColor",n).uniform("uOpacity",o),super.draw(0)}}class q extends N{constructor(t){super(t),this.setMesh(O()).useProgram(V,U)}draw(t){this.bindTexture("texture",t,0),super.draw(0)}}const{mat4:z,vec4:k}=n(720);let j=window,G=60,H=performance.now(),W=0,X=0,Y=H;const K=[],Z=[],Q=[],J=[];let $=[],tt=[],et=-1,nt=0;function ot(){!function(){let t,e=0,n=1e3/G,o=0;for(e=0;e<K.length;e++)t=K[e],null!=t&&t.func(t.args);for(;$.length>0;)t=$.pop(),t.func(t.args);let i=performance.now();for(X=(i-H)/1e3,W=i-Y,e=0;e<Z.length;e++)t=Z[e],i-t.time>t.delay&&(t.func(t.args),Z.splice(e,1));for(i=performance.now();Q.length>0;){if(t=Q.shift(),o=performance.now(),!(o-i<n)){Q.unshift(t);break}t.func(t.args)}for(i=performance.now();J.length>0;)t=J.shift(),o=performance.now(),o-i<n&&t.func(t.args);Y=i,$=$.concat(tt),tt=[]}(),et=j.requestAnimationFrame(ot)}ot();var it={addEF:function(t,e){const n=++nt;return K[n]={func:t,args:e},n},removeEF:function(t){return void 0!==K[t]&&(K[t]=null),-1},delay:function(t,e,n){const o=performance.now();Z.push({func:t,args:e,delay:n,time:o})},next:function(t,e){tt.push({func:t,args:e})},defer:function(t,e){Q.push({func:t,args:e})},usurp:function(t,e){J.push({func:t,args:e})},setRequestAnimationFrameSource:function(t){et>-1&&window.cancelAnimationFrame(et),j=t,ot()},setFrameRate:function(t){G=t},getElapsedTime:function(){return X},getDeltaTime:function(){return W}};const rt=it;class st{constructor(t,e=.1){this.easing=e,this._value=t,this._targetValue=t,this._efIndex=rt.addEF((()=>this._update()))}_update(){this._checkLimit(),this._value+=(this._targetValue-this._value)*this.easing,Math.abs(this._targetValue-this._value)<1e-4&&(this._value=this._targetValue)}setTo(t){this._targetValue=this._value=t}add(t){this._targetValue+=t}limit(t,e){t>e?this.limit(e,t):(this._min=t,this._max=e,this._checkLimit())}_checkLimit(){void 0!==this._min&&this._targetValue<this._min&&(this._targetValue=this._min),void 0!==this._max&&this._targetValue>this._max&&(this._targetValue=this._max)}destroy(){rt.removeEF(this._efIndex)}set value(t){this._targetValue=t}get value(){return this._value}get targetValue(){return this._targetValue}}const at=function(t,e){const n=e||{};return t.touches?(n.x=t.touches[0].pageX,n.y=t.touches[0].pageY):(n.x=t.clientX,n.y=t.clientY),n};class ut{#t=!1;#e=!1;#n=!1;#o=!1;#i;#r={};#s={};#a=p.create();#u=p.create();#l=p.create();#h=p.create();#c=I.create();#d=I.create();#p=I.fromValues(0,1,0);radius=new st(0);rx=new st(0);ry=new st(0);#f=0;#v=0;constructor(t,e=5,n=window){this.#i=t,this.radius.setTo(e),this.#d=[0,0,this.radius],this.rx.limit(-Math.PI/2+.01,Math.PI/2-.01),n.addEventListener("mousewheel",this._onWheel),n.addEventListener("DOMMouseScroll",this._onWheel),n.addEventListener("mousedown",this._onDown),n.addEventListener("mousemove",this._onMove),window.addEventListener("mouseup",this._onUp),n.addEventListener("touchstart",this._onDown),n.addEventListener("touchmove",this._onMove),window.addEventListener("touchend",this._onUp),window.addEventListener("keydown",this._onKeyDown),window.addEventListener("keyup",this._onKeyUp),this.update(),rt.addEF(this._loop)}lock(t=!0){this.#t=t,this.#e=t,this.#o=!1}lockZoom(t=!0){this.#e=t}lockRotation(t=!0){this.#t=t}update(){I.set(this.#d,0,0,this.radius.value),I.rotateX(this.#d,this.#d,[0,0,0],this.rx.value),I.rotateY(this.#d,this.#d,[0,0,0],this.ry.value),p.lookAt(this.#a,this.#d,this.#c,this.#p),p.invert(this.#u,this.#a),p.mul(this.#a,this.#a,this.#h),p.mul(this.#a,this.#a,this.#l),this.#i?.setViewMatrix(this.#a)}_onDown=t=>{this.#t||(this.#o=!0,at(t,this.#r),at(t,this.#s),this.#f=this.rx.targetValue,this.#v=this.ry.targetValue,p.identity(this.#l))};_onMove=t=>{if(this.#t)return;if(!this.#o)return;if(at(t,this.#r),t.shiftKey){const t=[this.#r.x-this.#s.x,-(this.#r.y-this.#s.y),0];return I.transformMat4(t,t,this.#u),I.scale(t,t,.01),p.identity(this.#l,this.#l),void p.translate(this.#l,this.#l,t)}const e=this.#r.x-this.#s.x;this.ry.value=.01*-e+this.#v;const n=this.#r.y-this.#s.y;this.rx.value=.01*-n+this.#f};_onUp=()=>{this.#o=!1,this.#n&&(p.mul(this.#h,this.#h,this.#l),p.identity(this.#l))};_onWheel=t=>{if(this.#e)return;const e=t.wheelDelta,n=t.detail;let o=0;o=n?e?e/n/40*n>0?1:-1:-n/3:e/120,this.radius.add(2*-o),this.radius.targetValue<0&&(this.radius.value=1e-4)};_onKeyDown=t=>{t.code.indexOf("Shift")>-1&&(this.#n=!0)};_onKeyUp=t=>{"Shift"===t.key&&(p.mul(this.#h,this.#h,this.#l),p.identity(this.#l)),this.#n=!1};_loop=()=>{this.update()}}class lt{constructor(){this._mtx=p.create(),this._mtxView=p.create(),this._mtxProj=p.create(),this._near=0,this._far=0,this._lookDir=I.create()}lookAt(t,e,n=[0,1,0]){p.lookAt(this._mtxView,t,e,n)}setFromViewProjection(t,e){p.copy(this._mtxView,t),p.copy(this._mtxProj,e)}setViewMatrix(t){p.copy(this._mtxView,t)}setProjectionMatrix(t){p.copy(this._mtxProj,t)}_updateMatrices(){}get viewMatrix(){return this._mtxView}get view(){return this._mtxView}get projectionMatrix(){return this._mtxProj}get projection(){return this._mtxProj}get matrix(){return p.mul(this._mtx,this._mtxProj,this._mtxView),this._mtx}get position(){const t=p.create();return p.invert(t,this._mtxView),[t[12],t[13],t[14]]}get direction(){const t=f.create();return f.fromMat4(t,this._mtxView),f.transpose(t,t),I.transformMat3(this._lookDir,[0,0,-1],t),I.normalize(this._lookDir,this._lookDir),this._lookDir}set near(t){this._near=t,this._updateMatrices()}get near(){return this._near}set far(t){this._far=t,this._updateMatrices()}get far(){return this._far}}function ht(t,e){this.origin=t,this.direction=e;const n=I.create(),o=I.create(),i=I.create(),r=I.create(),s=I.create(),a=I.create(),u=I.create(),l=I.create();this.at=function(t){return I.copy(r,this.direction),I.scale(r,r,t),I.add(r,r,this.origin),r},this.lookAt=function(t){I.sub(this.direction,t,this.origin),I.normalize(this.origin,this.origin)},this.closestPointToPoint=function(t){const e=I.create();I.sub(t,this.origin);const n=I.dot(e,this.direction);return n<0?I.clone(this.origin):(I.copy(e,this.direction),I.scale(e,e,n),I.add(e,e,this.origin),e)},this.distanceToPoint=function(t){return Math.sqrt(this.distanceSqToPoint(t))},this.distanceSqToPoint=function(t){const e=I.create();I.sub(e,t,this.origin);const n=I.dot(e,this.direction);return n<0?I.squaredDistance(this.origin,t):(I.copy(e,this.direction),I.scale(e,e,n),I.add(e,e,this.origin),I.squaredDistance(e,t))},this.intersectsSphere=function(t,e){return this.distanceToPoint(t)<=e},this.intersectSphere=function(t,e){const n=I.create();I.sub(n,t,this.origin);const o=I.dot(n,this.direction),i=I.dot(n,n)-o*o,r=e*e;if(i>r)return null;const s=Math.sqrt(r-i),a=o-s,u=o+s;return a<0&&u<0?null:a<0?this.at(u):this.at(a)},this.intersectTriangle=function(t,e,r,h=!0){I.copy(n,t),I.copy(o,e),I.copy(i,r),I.sub(s,o,n),I.sub(a,i,n),I.cross(u,s,a);let c,d=I.dot(this.direction,u);if(d>0){if(h)return null;c=1}else{if(!(d<0))return null;c=-1,d=-d}I.sub(l,this.origin,n),I.cross(a,l,a);const p=c*I.dot(this.direction,a);if(p<0)return null;I.cross(s,s,l);const f=c*I.dot(this.direction,s);if(f<0)return null;if(p+f>d)return null;const v=-c*I.dot(l,u);return v<0?null:this.at(v/d)}}class ct extends lt{constructor(t,e,n,o){super(),this._fov=0,this._ratio=0,this.setPerspective(t,e,n,o)}setPerspective(t,e,n,o){p.perspective(this._mtxProj,t,e,n,o),this._near=n,this._far=o,this._fov=t,this._ratio=e}setAspectRatio(t){this._ratio=t,this._updateMatrices()}generateRay(t,e){const n=p.create(),o=I.create(),i=this._mtxProj,r=this._mtxView;return p.multiply(n,i,r),p.invert(n,n),I.transformMat4(o,t,n),I.sub(o,o,this.position),I.normalize(o,o),e?(e.origin=this.position,e.direction=o):e=new ht(this.position,o),e}_updateMatrices(){this.setPerspective(this._fov,this._ratio,this._near,this._far)}}class dt{constructor(t){this._GL=t||_,this.camera=new ct,this.camera.setPerspective(45*Math.PI/180,_.aspectRatio,.1,100),this.orbitalControl=new ut(this.camera,15,window),this.orbitalControl.radius.value=10,this._isRunning=!0,this.resize(),this._initTextures(),this._initViews(),window.addEventListener("resize",(()=>this.resize())),this._efIndex=rt.addEF((()=>this._loop()))}stop(){this._isRunning=!1}resume(){this._isRunning=!0}_initTextures(){}_initViews(){}update(){}render(){}_loop(){this._isRunning&&(this.update(),this._GL.viewport(0,0,this._GL.width,this._GL.height),this._GL.setMatrices(this.camera),this.render())}resize(){this._GL.setSize(window.innerWidth,window.innerHeight),this.camera.setAspectRatio(this._GL.aspectRatio)}}n(643);let pt,ft,vt,mt,_t,yt,Et,gt,bt,xt=!1,wt=p.create();const At=t=>(ft=t,new Promise(((t,e)=>{pt.makeXRCompatible().then((()=>{ft.updateRenderState({baseLayer:new XRWebGLLayer(ft,pt)}),t()}))}))),Tt=()=>new Promise(((t,e)=>{ft.requestReferenceSpace("viewer").then((e=>{mt=e,ft.requestHitTestSource({space:mt}).then((e=>{_t=e,t()}))}))})),Rt=function(t){return pt=t,new Promise(((t,e)=>{navigator.xr.requestSession("immersive-ar",{optionalFeatures:["dom-overlay"],domOverlay:{root:document.querySelector(".container")},requiredFeatures:["local","hit-test","camera-access"]}).then(At).then(Tt).then((()=>{ft.onend=()=>{Et&&Et()},ft.requestReferenceSpace("local").then((e=>{vt=e,Mt(),rt.setRequestAnimationFrameSource(ft),t(pt)}))})).catch((t=>{e(t)}))}))};function Mt(t,e){yt=e,ft.requestAnimationFrame(((t,e)=>Mt(0,e)))}function St(){if(!yt||!_t)return null;const t=yt.getHitTestResults(_t);if(t.length>0){const e=t[0].getPose(vt);return p.copy(wt,e.transform.matrix),wt}return null}const Ct=class extends N{constructor(){super();const t=B(.1,.1,1,"xz");this.setMesh(t).useProgram("// basic.vert\n\nprecision highp float;\n#define GLSLIFY 1\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec3 aNormal;\n\nuniform mat4 uModelMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec3 vNormal;\n\nvoid main(void) {\n    gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPosition, 1.0);\n    vTextureCoord = aTextureCoord;\n    vNormal = aNormal;\n}","precision highp float;\n#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform float uOffset;\n\nvoid main(void) {\n    float d = distance(vTextureCoord, vec2(.5))/.5;\n    \n    float t = distance(d, uOffset - 0.06);\n    t = smoothstep(0.06, 0.05, t);\n    if(t <= 0.0001) {discard;}\n\n    gl_FragColor = vec4(1.0, 1.0, 1.0, t);\n}")}};let Lt;const Nt={init:t=>{Lt=t.map((({id:t,file:e,type:n})=>{const o=e;let i;switch(n){case"jpg":case"png":i=new C(e);break;case"text":i=(t=>{const e=t.split("\n"),n=[],o=[],i=[],r=[],s=[],a=[],u=[];let l,h=0;const c=/v( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,d=/vn( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,p=/vt( +[\d|\.|\+|\-|e|E]+)( +[\d|\.|\+|\-|e|E]+)/,f=/f( +-?\d+)( +-?\d+)( +-?\d+)( +-?\d+)?/,v=/f( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+))?/,m=/f( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))( +(-?\d+)\/(-?\d+)\/(-?\d+))?/,_=/f( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))( +(-?\d+)\/\/(-?\d+))?/;function y(t){const e=parseInt(t);return 3*(e>=0?e-1:e+r.length/3)}function E(t){const e=parseInt(t);return 3*(e>=0?e-1:e+s.length/3)}function g(t){const e=parseInt(t);return 2*(e>=0?e-1:e+a.length/2)}function b(t,e,o){n.push([r[t],r[t+1],r[t+2]]),n.push([r[e],r[e+1],r[e+2]]),n.push([r[o],r[o+1],r[o+2]]),u.push(3*h+0),u.push(3*h+1),u.push(3*h+2),h++}function w(t,e,n){o.push([a[t],a[t+1]]),o.push([a[e],a[e+1]]),o.push([a[n],a[n+1]])}function A(t,e,n){i.push([s[t],s[t+1],s[t+2]]),i.push([s[e],s[e+1],s[e+2]]),i.push([s[n],s[n+1],s[n+2]])}function T(t,e,n,o,i,r,s,a,u,l,h,c){let d,p=y(t),f=y(e),v=y(n);void 0===o?b(p,f,v):(d=y(o),b(p,f,d),b(f,v,d)),void 0!==i&&(p=g(i),f=g(r),v=g(s),void 0===o?w(p,f,v):(d=g(a),w(p,f,d),w(f,v,d))),void 0!==u&&(p=E(u),f=E(l),v=E(h),void 0===o?A(p,f,v):(d=E(c),A(p,f,d),A(f,v,d)))}for(let t=0;t<e.length;t++){let n=e[t];n=n.trim(),0!==n.length&&"#"!==n.charAt(0)&&(null!==(l=c.exec(n))?r.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])):null!==(l=d.exec(n))?s.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])):null!==(l=p.exec(n))?a.push(parseFloat(l[1]),parseFloat(l[2])):null!==(l=f.exec(n))?T(l[1],l[2],l[3],l[4]):null!==(l=v.exec(n))?T(l[2],l[5],l[8],l[11],l[3],l[6],l[9],l[12]):null!==(l=m.exec(n))?T(l[2],l[6],l[10],l[14],l[3],l[7],l[11],l[15],l[4],l[8],l[12],l[16]):null!==(l=_.exec(n))&&T(l[2],l[5],l[8],l[11],void 0,void 0,void 0,void 0,l[3],l[6],l[9],l[12]))}return(t=>{const e=t.normals.length>0,n=t.coords.length>0;let o;if(t.positions.length>65535){const i=[];let r=0;const s={};for(s.positions=t.positions.concat(),s.coords=t.coords.concat(),s.indices=t.indices.concat(),s.normals=t.normals.concat();t.indices.length>0;){const a=Math.min(65535,t.positions.length),u=t.indices.splice(0,a),l=[],h=[],c=[];let d,p=0;for(let t=0;t<u.length;t++)u[t]>p&&(p=u[t]),d=u[t],l.push(s.positions[d]),n&&h.push(s.coords[d]),e&&c.push(s.normals[d]),u[t]-=r;r=p+1,o=new x,o.bufferVertex(l),n&&o.bufferTexCoord(h),o.bufferIndex(u),e&&o.bufferNormal(c),i.push(o)}return i}return o=new x,o.bufferVertex(t.positions),n&&o.bufferTexCoord(t.coords),o.bufferIndex(t.indices),e&&o.bufferNormal(t.normals),o})({positions:n,coords:o,normals:i,indices:u})})(e)}return{id:t,source:o,type:n,file:i}})),console.table(Lt)},get:t=>{const e=Lt.find((e=>e.id===t));return e?e.file:null}},Pt=Nt;class It extends N{constructor(){super(),this.setMesh(F(10,24,!0)).useProgram("// skybox.vert\n\n#define SHADER_NAME SKYBOX_VERTEX\n\nprecision highp float;\n#define GLSLIFY 1\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec3 aNormal;\n\nuniform mat4 uModelMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec3 vVertex;\nvarying vec3 vNormal;\n\nvoid main(void) {\n\tmat4 matView = uViewMatrix;\n\tmatView[3][0] = 0.0;\n\tmatView[3][1] = 0.0;\n\tmatView[3][2] = 0.0;\n\t\n\tgl_Position = uProjectionMatrix * matView * uModelMatrix * vec4(aVertexPosition, 1.0);\n\tvTextureCoord = aTextureCoord;\n\t\n\tvVertex = aVertexPosition;\n\t// vVertex = normalize(aVertexPosition);\n\tvNormal = aNormal;\n}",U).bindTexture("texture",Pt.get("studio"),0)}}class Bt extends N{constructor(){super().setMesh(O()).useProgram(V,"#define LUT_FLIP_Y\n\nprecision highp float;\n#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D uMap;\nuniform sampler2D uLookupMap;\n\nvec4 lookup(in vec4 textureColor, in sampler2D lookupTable, float strength) {\n    #ifndef LUT_NO_CLAMP\n        textureColor = clamp(textureColor, 0.0, 1.0);\n    #endif\n\n    mediump float blueColor = textureColor.b * 63.0;\n\n    mediump vec2 quad1;\n    quad1.y = floor(floor(blueColor) / 8.0);\n    quad1.x = floor(blueColor) - (quad1.y * 8.0);\n\n    mediump vec2 quad2;\n    quad2.y = floor(ceil(blueColor) / 8.0);\n    quad2.x = ceil(blueColor) - (quad2.y * 8.0);\n\n    highp vec2 texPos1;\n    texPos1.x = (quad1.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n    texPos1.y = (quad1.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n    #ifdef LUT_FLIP_Y\n        texPos1.y = 1.0-texPos1.y;\n    #endif\n\n    highp vec2 texPos2;\n    texPos2.x = (quad2.x * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.r);\n    texPos2.y = (quad2.y * 0.125) + 0.5/512.0 + ((0.125 - 1.0/512.0) * textureColor.g);\n\n    #ifdef LUT_FLIP_Y\n        texPos2.y = 1.0-texPos2.y;\n    #endif\n\n    lowp vec4 newColor1 = texture2D(lookupTable, texPos1);\n    lowp vec4 newColor2 = texture2D(lookupTable, texPos2);\n\n    lowp vec4 newColor = mix(newColor1, newColor2, fract(blueColor));\n    return mix(textureColor, newColor, strength);\n}\n\nvec4 lookup(in vec4 textureColor, in sampler2D lookupTable) {\n    return lookup(textureColor, lookupTable, 0.85);\n}\n\nvoid main(void) {\n    vec4 color = texture2D(uMap, vTextureCoord);\n    vec2 uv = vTextureCoord;\n    uv.y = 1.0 - uv.y;\n\n    // color.rgb = smoothstep(vec3(0.1), vec3(1.0), color.rgb);\n    color.rgb *= 0.8;\n\n    gl_FragColor = lookup(color, uLookupMap, 1.0);\n}")}}p.fromValues(.5,0,0,0,0,.5,0,0,0,0,.5,0,.5,.5,.5,1);const Ft=(t,e)=>void 0===t?fxrand():void 0===e?fxrand()*t:t+(e-t)*fxrand();let Ot,Ut,Vt,Dt;const qt=()=>Vt.texture;var zt=n(437);const kt=(t,e)=>[t.touches[e].pageX,t.touches[e].pageY];var jt=n(125);let Gt,Ht,Wt;const Xt=({x:t,y:e,z:n})=>[t,e,n];class Yt{constructor(t,e){if(this.floorLevel=e,!Gt){Gt=(new N).setMesh(Pt.get("moon")).useProgram("// basic.vert\n\nprecision highp float;\n#define GLSLIFY 1\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec3 aNormal;\n\nuniform mat4 uModelMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform float uRadius;\n\nvarying vec2 vTextureCoord;\nvarying vec3 vNormal;\n\nvoid main(void) {\n    gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(aVertexPosition*uRadius, 1.0);\n    vTextureCoord = aTextureCoord;\n    vNormal = aNormal;\n}","// copy.frag\n\n#define SHADER_NAME SIMPLE_TEXTURE\n\nprecision highp float;\n#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform sampler2D texture;\n\nvoid main(void) {\n    gl_FragColor = texture2D(texture, vTextureCoord);\n}").bindTexture("texture",Pt.get("color"),0);const t=1;Ht=(new N).setMesh(B(t,t,1,"xz")).useProgram("// basic.vert\n\nprecision highp float;\n#define GLSLIFY 1\nattribute vec3 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat4 uModelMatrix;\nuniform mat4 uViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nuniform float uRadius;\nuniform float uLevel;\n\nvarying vec2 vTextureCoord;\nvarying vec3 vNormal;\n\nvoid main(void) {\n    vec3 pos = aVertexPosition;\n    pos.xz *= mix(1.0, uRadius, .5) * 2.0;\n    // pos.y = uLevel;\n    gl_Position = uProjectionMatrix * uViewMatrix * uModelMatrix * vec4(pos, 1.0);\n    vTextureCoord = aTextureCoord;\n}","precision highp float;\n#define GLSLIFY 1\nvarying vec2 vTextureCoord;\nuniform float uGlow;\n\nvoid main(void) {\n    float d = distance(vTextureCoord, vec2(.5));\n    d = smoothstep(0.5, 0.0, d);\n    d = pow(d, 2.0) * uGlow * 0.7;\n\n    gl_FragColor = vec4(vec3(1.0, .97, .92) * d, 1.0);\n}")}const n=Ft(.4,.2);this.body=new jt.Body({mass:2,position:new jt.Vec3(t[0],t[1],t[2]),shape:new jt.Sphere(n)});const o=new jt.Vec3(Ft(-1,1),Ft(-1,1),Ft(-1,1));o.normalize();const i=Ft(2*Math.PI);this.body.quaternion.setFromAxisAngle(o,i),this.mtx=p.create(),Wt||(Wt=p.create())}render(){const{position:t,quaternion:e}=this.body;p.identity(this.mtx),p.translate(this.mtx,this.mtx,Xt(t)),p.fromQuat(Wt,(({x:t,y:e,z:n,w:o})=>[t,e,n,o])(e)),p.mul(this.mtx,this.mtx,Wt),_.setModelMatrix(this.mtx);const{radius:n}=this.body.shapes[0];Gt.uniform("uRadius",n).draw()}renderFloor(){const{position:t}=this.body;p.identity(this.mtx);const e=Xt(t);let n=(o=this.floorLevel+1,i=this.floorLevel,r=e[1],(s=Math.max(0,Math.min(1,(r-o)/(i-o))))*s*(3-2*s));var o,i,r,s;n=Math.pow(n,2),e[1]=this.floorLevel,p.translate(this.mtx,this.mtx,e);const{radius:a}=this.body.shapes[0];_.setModelMatrix(this.mtx),Ht.uniform("uRadius",a).uniform("uGlow",n).draw()}}const Kt=class extends dt{constructor(){super(),this.orbitalControl.rx.value=-.4,this.orbitalControl.ry.value=-.4,this.mtxInit=p.create(),this.mtxHit=p.create(),this.mtxModel=p.create(),this.mtxAR=p.create();const t=.05;if(p.translate(this.mtxAR,this.mtxAR,[0,.2,0]),p.scale(this.mtxAR,this.mtxAR,[t,t,t]),this.touchScale=new class{constructor(t=1){this._isScaling=!1,this._scale=new st(t),this.limit(.01,100),this._mtx=p.create(),this._initDistance=0,this._initScale=1,window.addEventListener("touchstart",(t=>this._onTouchStart(t))),window.addEventListener("touchend",(t=>this._onTouchStart(t))),window.addEventListener("touchmove",(t=>this._onTouchMove(t)))}_onTouchStart(t){if(t.touches.length<2)return void(this._isScaling=!1);this._initScale=this._scale.value;const e=kt(t,0),n=kt(t,1);this._initDistance=zt.distance(e,n),this._isScaling=!0}_onTouchMove(t){if(t.touches.length<2)return void(this._isScaling=!1);const e=kt(t,0),n=kt(t,1),o=zt.distance(e,n)-this._initDistance;this._scale.value=this._initScale+.01*o}_onTouchEnd(){}limit(t,e){this._scale.limit(t,e)}get value(){return this._scale.value}get matrix(){return p.identity(this._mtx),p.scale(this._mtx,this._mtx,[this._scale.value,this._scale.value,this._scale.value]),this._mtx}},this.touchScale.limit(.1,5),this._offsetHit=new st(0),this._offsetOpen=new st(1),this._hasStarted=!1,this._hasPresented=!1,this._startDropping=!1,this._moons=[],!_.isMobile){this._initWorld();let t=10;for(;t--;)this._addMoon()}}present(){window.addEventListener("touchstart",this._onTouch),this._offsetOpen.setTo(0),this._hasPresented=!0}_initWorld(){const t=p.create();p.invert(t,this.mtxHit);const e=new jt.World;e.gravity.set(0,-9.82,0),this.world=e;const n=new jt.Body({mass:0});n.position.y=-t[13],this._floorLevel=-t[13],n.quaternion.setFromAxisAngle(new jt.Vec3(1,0,0),-Math.PI/2);const o=new jt.Plane;let i;n.addShape(o),e.addBody(n);const r=t=>{if(requestAnimationFrame(r),void 0!==i){var n=(t-i)/1e3;e.step(.016666666666666666,n,13)}i=t};r()}_initTextures(){this._fboBg=new L(_.width,_.height),this._textureLookup=Pt.get("lookup"),this._textureLookup.minFilter=_.NEAREST,this._textureLookup.magFilter=_.NEAREST}_initViews(){this._dAxis=new P,this._dCopy=new q,this._dBall=new D,this._dMark=new Ct,this._dEnv=(new It).setClearColor(0,0,0,0).bindFrameBuffer(this._fboBg),this._drawBg=new Bt}_onTouch=()=>{if(this._hasStarted)return void this._addMoon();const t=St();null!==t&&(p.copy(this.mtxHit,t),this._hasStarted=!0,this._offsetHit.value=0,this._offsetOpen.value=1,this._initWorld())};_addMoon=()=>{const t=I.clone(this.camera.position),e=I.clone(this.camera.direction);I.scale(e,e,Ft(2,1.5)),I.add(t,t,e);const n=new Yt(_.isMobile?t:[Ft(-1,1),Ft(1,2),Ft(-1,1)],this._floorLevel);if(this.world.addBody(n.body),this._moons.push(n),this._moons.length>30){const t=this._moons.shift();this.world.removeBody(t.body)}};_checkHit(){if(!this._hasStarted){const t=St();null!==t&&(this._offsetHit.value=1,p.copy(this.mtxHit,t))}}update(){this._hasPresented&&(()=>{if(Ot||(Ot=O(),Ut=new b(V,U),Vt=new L(_.width,_.height),Vt.bind(),_.clear(0,0,0,1),Vt.unbind()),Dt=bt,Dt){const{gl:t}=_;Vt.bind(),_.clear(0,0,0,1),Ut.bind(),t.activeTexture(t.TEXTURE0);const e=t.getUniformLocation(Ut.shaderProgram,"texture");t.uniform1i(e,0),Ut.uniform("texture","int",0),_.draw(Ot),Vt.unbind()}})(),xt&&this._hasPresented||(_.setModelMatrix(this.mtxModel),this._dEnv.draw())}render(){let t,e;xt&&this._hasPresented?(function(t,e,n=!0){if(!ft||!yt)return;const o=yt.getViewerPose(vt);if(o){gt||(gt=new XRWebGLBinding(ft,pt));const i=o.views[0],{x:r,y:s,width:a,height:u}=ft.renderState.baseLayer.getViewport(i);e.setFromViewProjection(i.transform.inverse.matrix,i.projectionMatrix),bt=gt.getCameraImage(i.camera),t.setMatrices(e),t.viewport(r,s,a,u),n&&pt.bindFramebuffer(pt.FRAMEBUFFER,ft.renderState.baseLayer.framebuffer)}}(_,this.camera),this._checkHit()):_.clear(0,0,0,1),this._hasPresented?(p.mul(this.mtxModel,this.mtxAR,this.touchScale.matrix),p.mul(this.mtxModel,this.mtxHit,this.mtxModel)):p.identity(this.mtxModel,this.mtxModel),e=this._hasPresented&&xt?qt():this._fboBg.texture,_.disable(_.DEPTH_TEST),this._drawBg.bindTexture("uMap",e,0).bindTexture("uLookupMap",this._textureLookup,1).draw(),_.enable(_.DEPTH_TEST),_.setModelMatrix(this.mtxHit),t=.005*this._offsetHit.value,this._dBall.draw([0,0,0],[t,t,t],[1,1,1]),this._dMark.uniform("uOffset",this._offsetHit.value).draw(),_.setModelMatrix(this.mtxModel),_.disable(_.DEPTH_TEST),_.enableAdditiveBlending(),this._moons.forEach((t=>{t.renderFloor()})),_.enable(_.DEPTH_TEST),_.enableAlphaBlending(),this._moons.forEach((t=>{t.render()})),xt&&this._hasPresented&&(t=1,_.viewport(0,0,t,t/_.aspectRatio),this._dCopy.draw(qt())),_.enable(_.DEPTH_TEST)}};n(564);const Zt=[{id:"color",url:"assets/color.jpg",type:"jpg"},{id:"lookup",url:"assets/lookup.png",type:"png"},{id:"moon",url:"assets/moon.obj",type:"text"},{id:"studio",url:"assets/studio.jpg",type:"jpg"}];var Qt=n(370),Jt=n.n(Qt);String.prototype.replaceAll=function(t,e){return this.replace(new RegExp(t,"g"),e)},window.addEventListener("keydown",(t=>{if(83===t.keyCode&&(t.metaKey||t.ctrlKey)){t.preventDefault();const e=(()=>{const t=new Date;return`${t.getFullYear()}.${t.getMonth()+1}.${t.getDate()}-${t.getHours()}.${t.getMinutes()}.${t.getSeconds()}`})();((t,e)=>{var n=document.createElement("a"),o=(t=>{for(var e=t.split(","),n=e[0].match(/:(.*?);/)[1],o=atob(e[1]),i=o.length,r=new Uint8Array(i);i--;)r[i]=o.charCodeAt(i);return new Blob([r],{type:n})})(t.toDataURL({format:"png",multiplier:4})),i=URL.createObjectURL(o);n.download=`${e}.png`,n.href=i,n.click()})(document.querySelector("#main-canvas"),e)}}));var $t=n(466);const te=new(n.n($t)());function ee(t,e){var n=t.__state.conversionName.toString(),o=Math.round(t.r),i=Math.round(t.g),r=Math.round(t.b),s=t.a,a=Math.round(t.h),u=t.s.toFixed(1),l=t.v.toFixed(1);if(e||"THREE_CHAR_HEX"===n||"SIX_CHAR_HEX"===n){for(var h=t.hex.toString(16);h.length<6;)h="0"+h;return"#"+h}return"CSS_RGB"===n?"rgb("+o+","+i+","+r+")":"CSS_RGBA"===n?"rgba("+o+","+i+","+r+","+s+")":"HEX"===n?"0x"+t.hex.toString(16):"RGB_ARRAY"===n?"["+o+","+i+","+r+"]":"RGBA_ARRAY"===n?"["+o+","+i+","+r+","+s+"]":"RGB_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+"}":"RGBA_OBJ"===n?"{r:"+o+",g:"+i+",b:"+r+",a:"+s+"}":"HSV_OBJ"===n?"{h:"+a+",s:"+u+",v:"+l+"}":"HSVA_OBJ"===n?"{h:"+a+",s:"+u+",v:"+l+",a:"+s+"}":"unknown format"}document.body.appendChild(te.domElement),rt.addEF((()=>{te.update()}));var ne=Array.prototype.forEach,oe=Array.prototype.slice,ie={BREAK:{},extend:function(t){return this.each(oe.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(e[n])||(t[n]=e[n])}.bind(this))}),this),t},defaults:function(t){return this.each(oe.call(arguments,1),(function(e){(this.isObject(e)?Object.keys(e):[]).forEach(function(n){this.isUndefined(t[n])&&(t[n]=e[n])}.bind(this))}),this),t},compose:function(){var t=oe.call(arguments);return function(){for(var e=oe.call(arguments),n=t.length-1;n>=0;n--)e=[t[n].apply(this,e)];return e[0]}},each:function(t,e,n){if(t)if(ne&&t.forEach&&t.forEach===ne)t.forEach(e,n);else if(t.length===t.length+0){var o,i=void 0;for(i=0,o=t.length;i<o;i++)if(i in t&&e.call(n,t[i],i)===this.BREAK)return}else for(var r in t)if(e.call(n,t[r],r)===this.BREAK)return},defer:function(t){setTimeout(t,0)},debounce:function(t,e,n){var o=void 0;return function(){var i=this,r=arguments;function s(){o=null,n||t.apply(i,r)}var a=n||!o;clearTimeout(o),o=setTimeout(s,e),a&&t.apply(i,r)}},toArray:function(t){return t.toArray?t.toArray():oe.call(t)},isUndefined:function(t){return void 0===t},isNull:function(t){return null===t},isNaN:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}((function(t){return isNaN(t)})),isArray:Array.isArray||function(t){return t.constructor===Array},isObject:function(t){return t===Object(t)},isNumber:function(t){return t===t+0},isString:function(t){return t===t+""},isBoolean:function(t){return!1===t||!0===t},isFunction:function(t){return t instanceof Function}},re=[{litmus:ie.isString,conversions:{THREE_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString()+e[1].toString()+e[2].toString()+e[2].toString()+e[3].toString()+e[3].toString(),0)}},write:ee},SIX_CHAR_HEX:{read:function(t){var e=t.match(/^#([A-F0-9]{6})$/i);return null!==e&&{space:"HEX",hex:parseInt("0x"+e[1].toString(),0)}},write:ee},CSS_RGB:{read:function(t){var e=t.match(/^rgb\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3])}},write:ee},CSS_RGBA:{read:function(t){var e=t.match(/^rgba\(\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*,\s*(\S+)\s*\)/);return null!==e&&{space:"RGB",r:parseFloat(e[1]),g:parseFloat(e[2]),b:parseFloat(e[3]),a:parseFloat(e[4])}},write:ee}}},{litmus:ie.isNumber,conversions:{HEX:{read:function(t){return{space:"HEX",hex:t,conversionName:"HEX"}},write:function(t){return t.hex}}}},{litmus:ie.isArray,conversions:{RGB_ARRAY:{read:function(t){return 3===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2]}},write:function(t){return[t.r,t.g,t.b]}},RGBA_ARRAY:{read:function(t){return 4===t.length&&{space:"RGB",r:t[0],g:t[1],b:t[2],a:t[3]}},write:function(t){return[t.r,t.g,t.b,t.a]}}}},{litmus:ie.isObject,conversions:{RGBA_OBJ:{read:function(t){return!!(ie.isNumber(t.r)&&ie.isNumber(t.g)&&ie.isNumber(t.b)&&ie.isNumber(t.a))&&{space:"RGB",r:t.r,g:t.g,b:t.b,a:t.a}},write:function(t){return{r:t.r,g:t.g,b:t.b,a:t.a}}},RGB_OBJ:{read:function(t){return!!(ie.isNumber(t.r)&&ie.isNumber(t.g)&&ie.isNumber(t.b))&&{space:"RGB",r:t.r,g:t.g,b:t.b}},write:function(t){return{r:t.r,g:t.g,b:t.b}}},HSVA_OBJ:{read:function(t){return!!(ie.isNumber(t.h)&&ie.isNumber(t.s)&&ie.isNumber(t.v)&&ie.isNumber(t.a))&&{space:"HSV",h:t.h,s:t.s,v:t.v,a:t.a}},write:function(t){return{h:t.h,s:t.s,v:t.v,a:t.a}}},HSV_OBJ:{read:function(t){return!!(ie.isNumber(t.h)&&ie.isNumber(t.s)&&ie.isNumber(t.v))&&{space:"HSV",h:t.h,s:t.s,v:t.v}},write:function(t){return{h:t.h,s:t.s,v:t.v}}}}}],se=void 0,ae=void 0,ue=function(){ae=!1;var t=arguments.length>1?ie.toArray(arguments):arguments[0];return ie.each(re,(function(e){if(e.litmus(t))return ie.each(e.conversions,(function(e,n){if(se=e.read(t),!1===ae&&!1!==se)return ae=se,se.conversionName=n,se.conversion=e,ie.BREAK})),ie.BREAK})),ae},le=void 0,he={hsv_to_rgb:function(t,e,n){var o=Math.floor(t/60)%6,i=t/60-Math.floor(t/60),r=n*(1-e),s=n*(1-i*e),a=n*(1-(1-i)*e),u=[[n,a,r],[s,n,r],[r,n,a],[r,s,n],[a,r,n],[n,r,s]][o];return{r:255*u[0],g:255*u[1],b:255*u[2]}},rgb_to_hsv:function(t,e,n){var o=Math.min(t,e,n),i=Math.max(t,e,n),r=i-o,s=void 0;return 0===i?{h:NaN,s:0,v:0}:(s=t===i?(e-n)/r:e===i?2+(n-t)/r:4+(t-e)/r,(s/=6)<0&&(s+=1),{h:360*s,s:r/i,v:i/255})},rgb_to_hex:function(t,e,n){var o=this.hex_with_component(0,2,t);return o=this.hex_with_component(o,1,e),this.hex_with_component(o,0,n)},component_from_hex:function(t,e){return t>>8*e&255},hex_with_component:function(t,e,n){return n<<(le=8*e)|t&~(255<<le)}},ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},de=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},pe=function(){function t(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),e}}(),fe=function t(e,n,o){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,n);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,o)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(o):void 0},ve=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},me=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},_e=function(){function t(){if(de(this,t),this.__state=ue.apply(this,arguments),!1===this.__state)throw new Error("Failed to interpret color arguments");this.__state.a=this.__state.a||1}return pe(t,[{key:"toString",value:function(){return ee(this)}},{key:"toHexString",value:function(){return ee(this,!0)}},{key:"toOriginal",value:function(){return this.__state.conversion.write(this)}}]),t}();function ye(t,e,n){Object.defineProperty(t,e,{get:function(){return"RGB"===this.__state.space||_e.recalculateRGB(this,e,n),this.__state[e]},set:function(t){"RGB"!==this.__state.space&&(_e.recalculateRGB(this,e,n),this.__state.space="RGB"),this.__state[e]=t}})}function Ee(t,e){Object.defineProperty(t,e,{get:function(){return"HSV"===this.__state.space||_e.recalculateHSV(this),this.__state[e]},set:function(t){"HSV"!==this.__state.space&&(_e.recalculateHSV(this),this.__state.space="HSV"),this.__state[e]=t}})}_e.recalculateRGB=function(t,e,n){if("HEX"===t.__state.space)t.__state[e]=he.component_from_hex(t.__state.hex,n);else{if("HSV"!==t.__state.space)throw new Error("Corrupted color state");ie.extend(t.__state,he.hsv_to_rgb(t.__state.h,t.__state.s,t.__state.v))}},_e.recalculateHSV=function(t){var e=he.rgb_to_hsv(t.r,t.g,t.b);ie.extend(t.__state,{s:e.s,v:e.v}),ie.isNaN(e.h)?ie.isUndefined(t.__state.h)&&(t.__state.h=0):t.__state.h=e.h},_e.COMPONENTS=["r","g","b","h","s","v","hex","a"],ye(_e.prototype,"r",2),ye(_e.prototype,"g",1),ye(_e.prototype,"b",0),Ee(_e.prototype,"h"),Ee(_e.prototype,"s"),Ee(_e.prototype,"v"),Object.defineProperty(_e.prototype,"a",{get:function(){return this.__state.a},set:function(t){this.__state.a=t}}),Object.defineProperty(_e.prototype,"hex",{get:function(){return"HEX"!==this.__state.space&&(this.__state.hex=he.rgb_to_hex(this.r,this.g,this.b),this.__state.space="HEX"),this.__state.hex},set:function(t){this.__state.space="HEX",this.__state.hex=t}});var ge=function(){function t(e,n){de(this,t),this.initialValue=e[n],this.domElement=document.createElement("div"),this.object=e,this.property=n,this.__onChange=void 0,this.__onFinishChange=void 0}return pe(t,[{key:"onChange",value:function(t){return this.__onChange=t,this}},{key:"onFinishChange",value:function(t){return this.__onFinishChange=t,this}},{key:"setValue",value:function(t){return this.object[this.property]=t,this.__onChange&&this.__onChange.call(this,t),this.updateDisplay(),this}},{key:"getValue",value:function(){return this.object[this.property]}},{key:"updateDisplay",value:function(){return this}},{key:"isModified",value:function(){return this.initialValue!==this.getValue()}}]),t}(),be={};ie.each({HTMLEvents:["change"],MouseEvents:["click","mousemove","mousedown","mouseup","mouseover"],KeyboardEvents:["keydown"]},(function(t,e){ie.each(t,(function(t){be[t]=e}))}));var xe=/(\d+(\.\d+)?)px/;function we(t){if("0"===t||ie.isUndefined(t))return 0;var e=t.match(xe);return ie.isNull(e)?0:parseFloat(e[1])}var Ae={makeSelectable:function(t,e){void 0!==t&&void 0!==t.style&&(t.onselectstart=e?function(){return!1}:function(){},t.style.MozUserSelect=e?"auto":"none",t.style.KhtmlUserSelect=e?"auto":"none",t.unselectable=e?"on":"off")},makeFullscreen:function(t,e,n){var o=n,i=e;ie.isUndefined(i)&&(i=!0),ie.isUndefined(o)&&(o=!0),t.style.position="absolute",i&&(t.style.left=0,t.style.right=0),o&&(t.style.top=0,t.style.bottom=0)},fakeEvent:function(t,e,n,o){var i=n||{},r=be[e];if(!r)throw new Error("Event type "+e+" not supported.");var s=document.createEvent(r);switch(r){case"MouseEvents":var a=i.x||i.clientX||0,u=i.y||i.clientY||0;s.initMouseEvent(e,i.bubbles||!1,i.cancelable||!0,window,i.clickCount||1,0,0,a,u,!1,!1,!1,!1,0,null);break;case"KeyboardEvents":var l=s.initKeyboardEvent||s.initKeyEvent;ie.defaults(i,{cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:void 0,charCode:void 0}),l(e,i.bubbles||!1,i.cancelable,window,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.keyCode,i.charCode);break;default:s.initEvent(e,i.bubbles||!1,i.cancelable||!0)}ie.defaults(s,o),t.dispatchEvent(s)},bind:function(t,e,n,o){var i=o||!1;return t.addEventListener?t.addEventListener(e,n,i):t.attachEvent&&t.attachEvent("on"+e,n),Ae},unbind:function(t,e,n,o){var i=o||!1;return t.removeEventListener?t.removeEventListener(e,n,i):t.detachEvent&&t.detachEvent("on"+e,n),Ae},addClass:function(t,e){if(void 0===t.className)t.className=e;else if(t.className!==e){var n=t.className.split(/ +/);-1===n.indexOf(e)&&(n.push(e),t.className=n.join(" ").replace(/^\s+/,"").replace(/\s+$/,""))}return Ae},removeClass:function(t,e){if(e)if(t.className===e)t.removeAttribute("class");else{var n=t.className.split(/ +/),o=n.indexOf(e);-1!==o&&(n.splice(o,1),t.className=n.join(" "))}else t.className=void 0;return Ae},hasClass:function(t,e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(t.className)||!1},getWidth:function(t){var e=getComputedStyle(t);return we(e["border-left-width"])+we(e["border-right-width"])+we(e["padding-left"])+we(e["padding-right"])+we(e.width)},getHeight:function(t){var e=getComputedStyle(t);return we(e["border-top-width"])+we(e["border-bottom-width"])+we(e["padding-top"])+we(e["padding-bottom"])+we(e.height)},getOffset:function(t){var e=t,n={left:0,top:0};if(e.offsetParent)do{n.left+=e.offsetLeft,n.top+=e.offsetTop,e=e.offsetParent}while(e);return n},isActive:function(t){return t===document.activeElement&&(t.type||t.href)}},Te=function(t){function e(t,n){de(this,e);var o=me(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),i=o;return o.__prev=o.getValue(),o.__checkbox=document.createElement("input"),o.__checkbox.setAttribute("type","checkbox"),Ae.bind(o.__checkbox,"change",(function(){i.setValue(!i.__prev)}),!1),o.domElement.appendChild(o.__checkbox),o.updateDisplay(),o}return ve(e,t),pe(e,[{key:"setValue",value:function(t){var n=fe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),this.__prev=this.getValue(),n}},{key:"updateDisplay",value:function(){return!0===this.getValue()?(this.__checkbox.setAttribute("checked","checked"),this.__checkbox.checked=!0,this.__prev=!0):(this.__checkbox.checked=!1,this.__prev=!1),fe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(ge),Re=function(t){function e(t,n,o){de(this,e);var i=me(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=o,s=i;if(i.__select=document.createElement("select"),ie.isArray(r)){var a={};ie.each(r,(function(t){a[t]=t})),r=a}return ie.each(r,(function(t,e){var n=document.createElement("option");n.innerHTML=e,n.setAttribute("value",t),s.__select.appendChild(n)})),i.updateDisplay(),Ae.bind(i.__select,"change",(function(){var t=this.options[this.selectedIndex].value;s.setValue(t)})),i.domElement.appendChild(i.__select),i}return ve(e,t),pe(e,[{key:"setValue",value:function(t){var n=fe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,t);return this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue()),n}},{key:"updateDisplay",value:function(){return Ae.isActive(this.__select)?this:(this.__select.value=this.getValue(),fe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this))}}]),e}(ge),Me=function(t){function e(t,n){de(this,e);var o=me(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),i=o;function r(){i.setValue(i.__input.value)}return o.__input=document.createElement("input"),o.__input.setAttribute("type","text"),Ae.bind(o.__input,"keyup",r),Ae.bind(o.__input,"change",r),Ae.bind(o.__input,"blur",(function(){i.__onFinishChange&&i.__onFinishChange.call(i,i.getValue())})),Ae.bind(o.__input,"keydown",(function(t){13===t.keyCode&&this.blur()})),o.updateDisplay(),o.domElement.appendChild(o.__input),o}return ve(e,t),pe(e,[{key:"updateDisplay",value:function(){return Ae.isActive(this.__input)||(this.__input.value=this.getValue()),fe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(ge);function Se(t){var e=t.toString();return e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0}var Ce=function(t){function e(t,n,o){de(this,e);var i=me(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=o||{};return i.__min=r.min,i.__max=r.max,i.__step=r.step,ie.isUndefined(i.__step)?0===i.initialValue?i.__impliedStep=1:i.__impliedStep=Math.pow(10,Math.floor(Math.log(Math.abs(i.initialValue))/Math.LN10))/10:i.__impliedStep=i.__step,i.__precision=Se(i.__impliedStep),i}return ve(e,t),pe(e,[{key:"setValue",value:function(t){var n=t;return void 0!==this.__min&&n<this.__min?n=this.__min:void 0!==this.__max&&n>this.__max&&(n=this.__max),void 0!==this.__step&&n%this.__step!=0&&(n=Math.round(n/this.__step)*this.__step),fe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"setValue",this).call(this,n)}},{key:"min",value:function(t){return this.__min=t,this}},{key:"max",value:function(t){return this.__max=t,this}},{key:"step",value:function(t){return this.__step=t,this.__impliedStep=t,this.__precision=Se(t),this}}]),e}(ge),Le=function(t){function e(t,n,o){de(this,e);var i=me(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,o));i.__truncationSuspended=!1;var r=i,s=void 0;function a(){r.__onFinishChange&&r.__onFinishChange.call(r,r.getValue())}function u(t){var e=s-t.clientY;r.setValue(r.getValue()+e*r.__impliedStep),s=t.clientY}function l(){Ae.unbind(window,"mousemove",u),Ae.unbind(window,"mouseup",l),a()}return i.__input=document.createElement("input"),i.__input.setAttribute("type","text"),Ae.bind(i.__input,"change",(function(){var t=parseFloat(r.__input.value);ie.isNaN(t)||r.setValue(t)})),Ae.bind(i.__input,"blur",(function(){a()})),Ae.bind(i.__input,"mousedown",(function(t){Ae.bind(window,"mousemove",u),Ae.bind(window,"mouseup",l),s=t.clientY})),Ae.bind(i.__input,"keydown",(function(t){13===t.keyCode&&(r.__truncationSuspended=!0,this.blur(),r.__truncationSuspended=!1,a())})),i.updateDisplay(),i.domElement.appendChild(i.__input),i}return ve(e,t),pe(e,[{key:"updateDisplay",value:function(){var t,n,o;return this.__input.value=this.__truncationSuspended?this.getValue():(t=this.getValue(),n=this.__precision,o=Math.pow(10,n),Math.round(t*o)/o),fe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Ce);function Ne(t,e,n,o,i){return o+(t-e)/(n-e)*(i-o)}var Pe=function(t){function e(t,n,o,i,r){de(this,e);var s=me(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,{min:o,max:i,step:r})),a=s;function u(t){t.preventDefault();var e=a.__background.getBoundingClientRect();return a.setValue(Ne(t.clientX,e.left,e.right,a.__min,a.__max)),!1}function l(){Ae.unbind(window,"mousemove",u),Ae.unbind(window,"mouseup",l),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}function h(t){var e=t.touches[0].clientX,n=a.__background.getBoundingClientRect();a.setValue(Ne(e,n.left,n.right,a.__min,a.__max))}function c(){Ae.unbind(window,"touchmove",h),Ae.unbind(window,"touchend",c),a.__onFinishChange&&a.__onFinishChange.call(a,a.getValue())}return s.__background=document.createElement("div"),s.__foreground=document.createElement("div"),Ae.bind(s.__background,"mousedown",(function(t){document.activeElement.blur(),Ae.bind(window,"mousemove",u),Ae.bind(window,"mouseup",l),u(t)})),Ae.bind(s.__background,"touchstart",(function(t){1===t.touches.length&&(Ae.bind(window,"touchmove",h),Ae.bind(window,"touchend",c),h(t))})),Ae.addClass(s.__background,"slider"),Ae.addClass(s.__foreground,"slider-fg"),s.updateDisplay(),s.__background.appendChild(s.__foreground),s.domElement.appendChild(s.__background),s}return ve(e,t),pe(e,[{key:"updateDisplay",value:function(){var t=(this.getValue()-this.__min)/(this.__max-this.__min);return this.__foreground.style.width=100*t+"%",fe(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"updateDisplay",this).call(this)}}]),e}(Ce),Ie=function(t){function e(t,n,o){de(this,e);var i=me(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n)),r=i;return i.__button=document.createElement("div"),i.__button.innerHTML=void 0===o?"Fire":o,Ae.bind(i.__button,"click",(function(t){return t.preventDefault(),r.fire(),!1})),Ae.addClass(i.__button,"button"),i.domElement.appendChild(i.__button),i}return ve(e,t),pe(e,[{key:"fire",value:function(){this.__onChange&&this.__onChange.call(this),this.getValue().call(this.object),this.__onFinishChange&&this.__onFinishChange.call(this,this.getValue())}}]),e}(ge),Be=function(t){function e(t,n){de(this,e);var o=me(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n));o.__color=new _e(o.getValue()),o.__temp=new _e(0);var i=o;o.domElement=document.createElement("div"),Ae.makeSelectable(o.domElement,!1),o.__selector=document.createElement("div"),o.__selector.className="selector",o.__saturation_field=document.createElement("div"),o.__saturation_field.className="saturation-field",o.__field_knob=document.createElement("div"),o.__field_knob.className="field-knob",o.__field_knob_border="2px solid ",o.__hue_knob=document.createElement("div"),o.__hue_knob.className="hue-knob",o.__hue_field=document.createElement("div"),o.__hue_field.className="hue-field",o.__input=document.createElement("input"),o.__input.type="text",o.__input_textShadow="0 1px 1px ",Ae.bind(o.__input,"keydown",(function(t){13===t.keyCode&&c.call(this)})),Ae.bind(o.__input,"blur",c),Ae.bind(o.__selector,"mousedown",(function(){Ae.addClass(this,"drag").bind(window,"mouseup",(function(){Ae.removeClass(i.__selector,"drag")}))})),Ae.bind(o.__selector,"touchstart",(function(){Ae.addClass(this,"drag").bind(window,"touchend",(function(){Ae.removeClass(i.__selector,"drag")}))}));var r,s=document.createElement("div");function a(t){p(t),Ae.bind(window,"mousemove",p),Ae.bind(window,"touchmove",p),Ae.bind(window,"mouseup",l),Ae.bind(window,"touchend",l)}function u(t){f(t),Ae.bind(window,"mousemove",f),Ae.bind(window,"touchmove",f),Ae.bind(window,"mouseup",h),Ae.bind(window,"touchend",h)}function l(){Ae.unbind(window,"mousemove",p),Ae.unbind(window,"touchmove",p),Ae.unbind(window,"mouseup",l),Ae.unbind(window,"touchend",l),d()}function h(){Ae.unbind(window,"mousemove",f),Ae.unbind(window,"touchmove",f),Ae.unbind(window,"mouseup",h),Ae.unbind(window,"touchend",h),d()}function c(){var t=ue(this.value);!1!==t?(i.__color.__state=t,i.setValue(i.__color.toOriginal())):this.value=i.__color.toString()}function d(){i.__onFinishChange&&i.__onFinishChange.call(i,i.__color.toOriginal())}function p(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__saturation_field.getBoundingClientRect(),n=t.touches&&t.touches[0]||t,o=n.clientX,r=n.clientY,s=(o-e.left)/(e.right-e.left),a=1-(r-e.top)/(e.bottom-e.top);return a>1?a=1:a<0&&(a=0),s>1?s=1:s<0&&(s=0),i.__color.v=a,i.__color.s=s,i.setValue(i.__color.toOriginal()),!1}function f(t){-1===t.type.indexOf("touch")&&t.preventDefault();var e=i.__hue_field.getBoundingClientRect(),n=1-((t.touches&&t.touches[0]||t).clientY-e.top)/(e.bottom-e.top);return n>1?n=1:n<0&&(n=0),i.__color.h=360*n,i.setValue(i.__color.toOriginal()),!1}return ie.extend(o.__selector.style,{width:"122px",height:"102px",padding:"3px",backgroundColor:"#222",boxShadow:"0px 1px 3px rgba(0,0,0,0.3)"}),ie.extend(o.__field_knob.style,{position:"absolute",width:"12px",height:"12px",border:o.__field_knob_border+(o.__color.v<.5?"#fff":"#000"),boxShadow:"0px 1px 3px rgba(0,0,0,0.5)",borderRadius:"12px",zIndex:1}),ie.extend(o.__hue_knob.style,{position:"absolute",width:"15px",height:"2px",borderRight:"4px solid #fff",zIndex:1}),ie.extend(o.__saturation_field.style,{width:"100px",height:"100px",border:"1px solid #555",marginRight:"3px",display:"inline-block",cursor:"pointer"}),ie.extend(s.style,{width:"100%",height:"100%",background:"none"}),Oe(s,"top","rgba(0,0,0,0)","#000"),ie.extend(o.__hue_field.style,{width:"15px",height:"100px",border:"1px solid #555",cursor:"ns-resize",position:"absolute",top:"3px",right:"3px"}),(r=o.__hue_field).style.background="",r.style.cssText+="background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);",r.style.cssText+="background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",r.style.cssText+="background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);",ie.extend(o.__input.style,{outline:"none",textAlign:"center",color:"#fff",border:0,fontWeight:"bold",textShadow:o.__input_textShadow+"rgba(0,0,0,0.7)"}),Ae.bind(o.__saturation_field,"mousedown",a),Ae.bind(o.__saturation_field,"touchstart",a),Ae.bind(o.__field_knob,"mousedown",a),Ae.bind(o.__field_knob,"touchstart",a),Ae.bind(o.__hue_field,"mousedown",u),Ae.bind(o.__hue_field,"touchstart",u),o.__saturation_field.appendChild(s),o.__selector.appendChild(o.__field_knob),o.__selector.appendChild(o.__saturation_field),o.__selector.appendChild(o.__hue_field),o.__hue_field.appendChild(o.__hue_knob),o.domElement.appendChild(o.__input),o.domElement.appendChild(o.__selector),o.updateDisplay(),o}return ve(e,t),pe(e,[{key:"updateDisplay",value:function(){var t=ue(this.getValue());if(!1!==t){var e=!1;ie.each(_e.COMPONENTS,(function(n){if(!ie.isUndefined(t[n])&&!ie.isUndefined(this.__color.__state[n])&&t[n]!==this.__color.__state[n])return e=!0,{}}),this),e&&ie.extend(this.__color.__state,t)}ie.extend(this.__temp.__state,this.__color.__state),this.__temp.a=1;var n=this.__color.v<.5||this.__color.s>.5?255:0,o=255-n;ie.extend(this.__field_knob.style,{marginLeft:100*this.__color.s-7+"px",marginTop:100*(1-this.__color.v)-7+"px",backgroundColor:this.__temp.toHexString(),border:this.__field_knob_border+"rgb("+n+","+n+","+n+")"}),this.__hue_knob.style.marginTop=100*(1-this.__color.h/360)+"px",this.__temp.s=1,this.__temp.v=1,Oe(this.__saturation_field,"left","#fff",this.__temp.toHexString()),this.__input.value=this.__color.toString(),ie.extend(this.__input.style,{backgroundColor:this.__color.toHexString(),color:"rgb("+n+","+n+","+n+")",textShadow:this.__input_textShadow+"rgba("+o+","+o+","+o+",.7)"})}}]),e}(ge),Fe=["-moz-","-o-","-webkit-","-ms-",""];function Oe(t,e,n,o){t.style.background="",ie.each(Fe,(function(i){t.style.cssText+="background: "+i+"linear-gradient("+e+", "+n+" 0%, "+o+" 100%); "}))}var Ue='<div id="dg-save" class="dg dialogue">\n\n  Here\'s the new load parameter for your <code>GUI</code>\'s constructor:\n\n  <textarea id="dg-new-constructor"></textarea>\n\n  <div id="dg-save-locally">\n\n    <input id="dg-local-storage" type="checkbox"/> Automatically save\n    values to <code>localStorage</code> on exit.\n\n    <div id="dg-local-explain">The values saved to <code>localStorage</code> will\n      override those passed to <code>dat.GUI</code>\'s constructor. This makes it\n      easier to work incrementally, but <code>localStorage</code> is fragile,\n      and your friends may not see the same values you do.\n\n    </div>\n\n  </div>\n\n</div>',Ve=function(t,e){var n=t[e];return ie.isArray(arguments[2])||ie.isObject(arguments[2])?new Re(t,e,arguments[2]):ie.isNumber(n)?ie.isNumber(arguments[2])&&ie.isNumber(arguments[3])?ie.isNumber(arguments[4])?new Pe(t,e,arguments[2],arguments[3],arguments[4]):new Pe(t,e,arguments[2],arguments[3]):ie.isNumber(arguments[4])?new Le(t,e,{min:arguments[2],max:arguments[3],step:arguments[4]}):new Le(t,e,{min:arguments[2],max:arguments[3]}):ie.isString(n)?new Me(t,e):ie.isFunction(n)?new Ie(t,e,""):ie.isBoolean(n)?new Te(t,e):null},De=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){setTimeout(t,1e3/60)},qe=function(){function t(){de(this,t),this.backgroundElement=document.createElement("div"),ie.extend(this.backgroundElement.style,{backgroundColor:"rgba(0,0,0,0.8)",top:0,left:0,display:"none",zIndex:"1000",opacity:0,WebkitTransition:"opacity 0.2s linear",transition:"opacity 0.2s linear"}),Ae.makeFullscreen(this.backgroundElement),this.backgroundElement.style.position="fixed",this.domElement=document.createElement("div"),ie.extend(this.domElement.style,{position:"fixed",display:"none",zIndex:"1001",opacity:0,WebkitTransition:"-webkit-transform 0.2s ease-out, opacity 0.2s linear",transition:"transform 0.2s ease-out, opacity 0.2s linear"}),document.body.appendChild(this.backgroundElement),document.body.appendChild(this.domElement);var e=this;Ae.bind(this.backgroundElement,"click",(function(){e.hide()}))}return pe(t,[{key:"show",value:function(){var t=this;this.backgroundElement.style.display="block",this.domElement.style.display="block",this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)",this.layout(),ie.defer((function(){t.backgroundElement.style.opacity=1,t.domElement.style.opacity=1,t.domElement.style.webkitTransform="scale(1)"}))}},{key:"hide",value:function(){var t=this,e=function e(){t.domElement.style.display="none",t.backgroundElement.style.display="none",Ae.unbind(t.domElement,"webkitTransitionEnd",e),Ae.unbind(t.domElement,"transitionend",e),Ae.unbind(t.domElement,"oTransitionEnd",e)};Ae.bind(this.domElement,"webkitTransitionEnd",e),Ae.bind(this.domElement,"transitionend",e),Ae.bind(this.domElement,"oTransitionEnd",e),this.backgroundElement.style.opacity=0,this.domElement.style.opacity=0,this.domElement.style.webkitTransform="scale(1.1)"}},{key:"layout",value:function(){this.domElement.style.left=window.innerWidth/2-Ae.getWidth(this.domElement)/2+"px",this.domElement.style.top=window.innerHeight/2-Ae.getHeight(this.domElement)/2+"px"}}]),t}();!function(t,e){var n=e||document,o=document.createElement("style");o.type="text/css",o.innerHTML=t;var i=n.getElementsByTagName("head")[0];try{i.appendChild(o)}catch(t){}}(function(t){if(t&&"undefined"!=typeof window){var e=document.createElement("style");return e.setAttribute("type","text/css"),e.innerHTML=t,document.head.appendChild(e),t}}(".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\n"));var ze="Default",ke=function(){try{return!!window.localStorage}catch(t){return!1}}(),je=void 0,Ge=!0,He=void 0,We=!1,Xe=[],Ye=function t(e){var n=this,o=e||{};this.domElement=document.createElement("div"),this.__ul=document.createElement("ul"),this.domElement.appendChild(this.__ul),Ae.addClass(this.domElement,"dg"),this.__folders={},this.__controllers=[],this.__rememberedObjects=[],this.__rememberedObjectIndecesToControllers=[],this.__listening=[],o=ie.defaults(o,{closeOnTop:!1,autoPlace:!0,width:t.DEFAULT_WIDTH}),o=ie.defaults(o,{resizable:o.autoPlace,hideable:o.autoPlace}),ie.isUndefined(o.load)?o.load={preset:ze}:o.preset&&(o.load.preset=o.preset),ie.isUndefined(o.parent)&&o.hideable&&Xe.push(this),o.resizable=ie.isUndefined(o.parent)&&o.resizable,o.autoPlace&&ie.isUndefined(o.scrollable)&&(o.scrollable=!0);var i,r=ke&&"true"===localStorage.getItem(tn(0,"isLocal")),s=void 0,a=void 0;if(Object.defineProperties(this,{parent:{get:function(){return o.parent}},scrollable:{get:function(){return o.scrollable}},autoPlace:{get:function(){return o.autoPlace}},closeOnTop:{get:function(){return o.closeOnTop}},preset:{get:function(){return n.parent?n.getRoot().preset:o.load.preset},set:function(t){n.parent?n.getRoot().preset=t:o.load.preset=t,function(t){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].value===t.preset&&(t.__preset_select.selectedIndex=e)}(this),n.revert()}},width:{get:function(){return o.width},set:function(t){o.width=t,sn(n,t)}},name:{get:function(){return o.name},set:function(t){o.name=t,a&&(a.innerHTML=o.name)}},closed:{get:function(){return o.closed},set:function(e){o.closed=e,o.closed?Ae.addClass(n.__ul,t.CLASS_CLOSED):Ae.removeClass(n.__ul,t.CLASS_CLOSED),this.onResize(),n.__closeButton&&(n.__closeButton.innerHTML=e?t.TEXT_OPEN:t.TEXT_CLOSED)}},load:{get:function(){return o.load}},useLocalStorage:{get:function(){return r},set:function(t){ke&&(r=t,t?Ae.bind(window,"unload",s):Ae.unbind(window,"unload",s),localStorage.setItem(tn(0,"isLocal"),t))}}}),ie.isUndefined(o.parent)){if(this.closed=o.closed||!1,Ae.addClass(this.domElement,t.CLASS_MAIN),Ae.makeSelectable(this.domElement,!1),ke&&r){n.useLocalStorage=!0;var u=localStorage.getItem(tn(0,"gui"));u&&(o.load=JSON.parse(u))}this.__closeButton=document.createElement("div"),this.__closeButton.innerHTML=t.TEXT_CLOSED,Ae.addClass(this.__closeButton,t.CLASS_CLOSE_BUTTON),o.closeOnTop?(Ae.addClass(this.__closeButton,t.CLASS_CLOSE_TOP),this.domElement.insertBefore(this.__closeButton,this.domElement.childNodes[0])):(Ae.addClass(this.__closeButton,t.CLASS_CLOSE_BOTTOM),this.domElement.appendChild(this.__closeButton)),Ae.bind(this.__closeButton,"click",(function(){n.closed=!n.closed}))}else{void 0===o.closed&&(o.closed=!0);var l=document.createTextNode(o.name);Ae.addClass(l,"controller-name"),a=Ke(n,l),Ae.addClass(this.__ul,t.CLASS_CLOSED),Ae.addClass(a,"title"),Ae.bind(a,"click",(function(t){return t.preventDefault(),n.closed=!n.closed,!1})),o.closed||(this.closed=!1)}o.autoPlace&&(ie.isUndefined(o.parent)&&(Ge&&(He=document.createElement("div"),Ae.addClass(He,"dg"),Ae.addClass(He,t.CLASS_AUTO_PLACE_CONTAINER),document.body.appendChild(He),Ge=!1),He.appendChild(this.domElement),Ae.addClass(this.domElement,t.CLASS_AUTO_PLACE)),this.parent||sn(n,o.width)),this.__resizeHandler=function(){n.onResizeDebounced()},Ae.bind(window,"resize",this.__resizeHandler),Ae.bind(this.__ul,"webkitTransitionEnd",this.__resizeHandler),Ae.bind(this.__ul,"transitionend",this.__resizeHandler),Ae.bind(this.__ul,"oTransitionEnd",this.__resizeHandler),this.onResize(),o.resizable&&rn(this),s=function(){ke&&"true"===localStorage.getItem(tn(0,"isLocal"))&&localStorage.setItem(tn(0,"gui"),JSON.stringify(n.getSaveObject()))},this.saveToLocalStorageIfPossible=s,o.parent||((i=n.getRoot()).width+=1,ie.defer((function(){i.width-=1})))};function Ke(t,e,n){var o=document.createElement("li");return e&&o.appendChild(e),n?t.__ul.insertBefore(o,n):t.__ul.appendChild(o),t.onResize(),o}function Ze(t){Ae.unbind(window,"resize",t.__resizeHandler),t.saveToLocalStorageIfPossible&&Ae.unbind(window,"unload",t.saveToLocalStorageIfPossible)}function Qe(t,e){var n=t.__preset_select[t.__preset_select.selectedIndex];n.innerHTML=e?n.value+"*":n.value}function Je(t,e){var n=t.getRoot(),o=n.__rememberedObjects.indexOf(e.object);if(-1!==o){var i=n.__rememberedObjectIndecesToControllers[o];if(void 0===i&&(i={},n.__rememberedObjectIndecesToControllers[o]=i),i[e.property]=e,n.load&&n.load.remembered){var r=n.load.remembered,s=void 0;if(r[t.preset])s=r[t.preset];else{if(!r[ze])return;s=r[ze]}if(s[o]&&void 0!==s[o][e.property]){var a=s[o][e.property];e.initialValue=a,e.setValue(a)}}}}function $e(t,e,n,o){if(void 0===e[n])throw new Error('Object "'+e+'" has no property "'+n+'"');var i=void 0;if(o.color)i=new Be(e,n);else{var r=[e,n].concat(o.factoryArgs);i=Ve.apply(t,r)}o.before instanceof ge&&(o.before=o.before.__li),Je(t,i),Ae.addClass(i.domElement,"c");var s=document.createElement("span");Ae.addClass(s,"property-name"),s.innerHTML=i.property;var a=document.createElement("div");a.appendChild(s),a.appendChild(i.domElement);var u=Ke(t,a,o.before);return Ae.addClass(u,Ye.CLASS_CONTROLLER_ROW),i instanceof Be?Ae.addClass(u,"color"):Ae.addClass(u,ce(i.getValue())),function(t,e,n){if(n.__li=e,n.__gui=t,ie.extend(n,{options:function(e){if(arguments.length>1){var o=n.__li.nextElementSibling;return n.remove(),$e(t,n.object,n.property,{before:o,factoryArgs:[ie.toArray(arguments)]})}if(ie.isArray(e)||ie.isObject(e)){var i=n.__li.nextElementSibling;return n.remove(),$e(t,n.object,n.property,{before:i,factoryArgs:[e]})}},name:function(t){return n.__li.firstElementChild.firstElementChild.innerHTML=t,n},listen:function(){return n.__gui.listen(n),n},remove:function(){return n.__gui.remove(n),n}}),n instanceof Pe){var o=new Le(n.object,n.property,{min:n.__min,max:n.__max,step:n.__step});ie.each(["updateDisplay","onChange","onFinishChange","step","min","max"],(function(t){var e=n[t],i=o[t];n[t]=o[t]=function(){var t=Array.prototype.slice.call(arguments);return i.apply(o,t),e.apply(n,t)}})),Ae.addClass(e,"has-slider"),n.domElement.insertBefore(o.domElement,n.domElement.firstElementChild)}else if(n instanceof Le){var i=function(e){if(ie.isNumber(n.__min)&&ie.isNumber(n.__max)){var o=n.__li.firstElementChild.firstElementChild.innerHTML,i=n.__gui.__listening.indexOf(n)>-1;n.remove();var r=$e(t,n.object,n.property,{before:n.__li.nextElementSibling,factoryArgs:[n.__min,n.__max,n.__step]});return r.name(o),i&&r.listen(),r}return e};n.min=ie.compose(i,n.min),n.max=ie.compose(i,n.max)}else n instanceof Te?(Ae.bind(e,"click",(function(){Ae.fakeEvent(n.__checkbox,"click")})),Ae.bind(n.__checkbox,"click",(function(t){t.stopPropagation()}))):n instanceof Ie?(Ae.bind(e,"click",(function(){Ae.fakeEvent(n.__button,"click")})),Ae.bind(e,"mouseover",(function(){Ae.addClass(n.__button,"hover")})),Ae.bind(e,"mouseout",(function(){Ae.removeClass(n.__button,"hover")}))):n instanceof Be&&(Ae.addClass(e,"color"),n.updateDisplay=ie.compose((function(t){return e.style.borderLeftColor=n.__color.toString(),t}),n.updateDisplay),n.updateDisplay());n.setValue=ie.compose((function(e){return t.getRoot().__preset_select&&n.isModified()&&Qe(t.getRoot(),!0),e}),n.setValue)}(t,u,i),t.__controllers.push(i),i}function tn(t,e){return document.location.href+"."+e}function en(t,e,n){var o=document.createElement("option");o.innerHTML=e,o.value=e,t.__preset_select.appendChild(o),n&&(t.__preset_select.selectedIndex=t.__preset_select.length-1)}function nn(t,e){e.style.display=t.useLocalStorage?"block":"none"}function on(t){var e=t.__save_row=document.createElement("li");Ae.addClass(t.domElement,"has-save"),t.__ul.insertBefore(e,t.__ul.firstChild),Ae.addClass(e,"save-row");var n=document.createElement("span");n.innerHTML="&nbsp;",Ae.addClass(n,"button gears");var o=document.createElement("span");o.innerHTML="Save",Ae.addClass(o,"button"),Ae.addClass(o,"save");var i=document.createElement("span");i.innerHTML="New",Ae.addClass(i,"button"),Ae.addClass(i,"save-as");var r=document.createElement("span");r.innerHTML="Revert",Ae.addClass(r,"button"),Ae.addClass(r,"revert");var s=t.__preset_select=document.createElement("select");if(t.load&&t.load.remembered?ie.each(t.load.remembered,(function(e,n){en(t,n,n===t.preset)})):en(t,ze,!1),Ae.bind(s,"change",(function(){for(var e=0;e<t.__preset_select.length;e++)t.__preset_select[e].innerHTML=t.__preset_select[e].value;t.preset=this.value})),e.appendChild(s),e.appendChild(n),e.appendChild(o),e.appendChild(i),e.appendChild(r),ke){var a=document.getElementById("dg-local-explain"),u=document.getElementById("dg-local-storage");document.getElementById("dg-save-locally").style.display="block","true"===localStorage.getItem(tn(0,"isLocal"))&&u.setAttribute("checked","checked"),nn(t,a),Ae.bind(u,"change",(function(){t.useLocalStorage=!t.useLocalStorage,nn(t,a)}))}var l=document.getElementById("dg-new-constructor");Ae.bind(l,"keydown",(function(t){!t.metaKey||67!==t.which&&67!==t.keyCode||je.hide()})),Ae.bind(n,"click",(function(){l.innerHTML=JSON.stringify(t.getSaveObject(),void 0,2),je.show(),l.focus(),l.select()})),Ae.bind(o,"click",(function(){t.save()})),Ae.bind(i,"click",(function(){var e=prompt("Enter a new preset name.");e&&t.saveAs(e)})),Ae.bind(r,"click",(function(){t.revert()}))}function rn(t){var e=void 0;function n(n){return n.preventDefault(),t.width+=e-n.clientX,t.onResize(),e=n.clientX,!1}function o(){Ae.removeClass(t.__closeButton,Ye.CLASS_DRAG),Ae.unbind(window,"mousemove",n),Ae.unbind(window,"mouseup",o)}function i(i){return i.preventDefault(),e=i.clientX,Ae.addClass(t.__closeButton,Ye.CLASS_DRAG),Ae.bind(window,"mousemove",n),Ae.bind(window,"mouseup",o),!1}t.__resize_handle=document.createElement("div"),ie.extend(t.__resize_handle.style,{width:"6px",marginLeft:"-3px",height:"200px",cursor:"ew-resize",position:"absolute"}),Ae.bind(t.__resize_handle,"mousedown",i),Ae.bind(t.__closeButton,"mousedown",i),t.domElement.insertBefore(t.__resize_handle,t.domElement.firstElementChild)}function sn(t,e){t.domElement.style.width=e+"px",t.__save_row&&t.autoPlace&&(t.__save_row.style.width=e+"px"),t.__closeButton&&(t.__closeButton.style.width=e+"px")}function an(t,e){var n={};return ie.each(t.__rememberedObjects,(function(o,i){var r={},s=t.__rememberedObjectIndecesToControllers[i];ie.each(s,(function(t,n){r[n]=e?t.initialValue:t.getValue()})),n[i]=r})),n}function un(t){0!==t.length&&De.call(window,(function(){un(t)})),ie.each(t,(function(t){t.updateDisplay()}))}let ln,hn;Ye.toggleHide=function(){We=!We,ie.each(Xe,(function(t){t.domElement.style.display=We?"none":""}))},Ye.CLASS_AUTO_PLACE="a",Ye.CLASS_AUTO_PLACE_CONTAINER="ac",Ye.CLASS_MAIN="main",Ye.CLASS_CONTROLLER_ROW="cr",Ye.CLASS_TOO_TALL="taller-than-window",Ye.CLASS_CLOSED="closed",Ye.CLASS_CLOSE_BUTTON="close-button",Ye.CLASS_CLOSE_TOP="close-top",Ye.CLASS_CLOSE_BOTTOM="close-bottom",Ye.CLASS_DRAG="drag",Ye.DEFAULT_WIDTH=245,Ye.TEXT_CLOSED="Close Controls",Ye.TEXT_OPEN="Open Controls",Ye._keydownHandler=function(t){"text"===document.activeElement.type||72!==t.which&&72!==t.keyCode||Ye.toggleHide()},Ae.bind(window,"keydown",Ye._keydownHandler,!1),ie.extend(Ye.prototype,{add:function(t,e){return $e(this,t,e,{factoryArgs:Array.prototype.slice.call(arguments,2)})},addColor:function(t,e){return $e(this,t,e,{color:!0})},remove:function(t){this.__ul.removeChild(t.__li),this.__controllers.splice(this.__controllers.indexOf(t),1);var e=this;ie.defer((function(){e.onResize()}))},destroy:function(){if(this.parent)throw new Error("Only the root GUI should be removed with .destroy(). For subfolders, use gui.removeFolder(folder) instead.");this.autoPlace&&He.removeChild(this.domElement);var t=this;ie.each(this.__folders,(function(e){t.removeFolder(e)})),Ae.unbind(window,"keydown",Ye._keydownHandler,!1),Ze(this)},addFolder:function(t){if(void 0!==this.__folders[t])throw new Error('You already have a folder in this GUI by the name "'+t+'"');var e={name:t,parent:this};e.autoPlace=this.autoPlace,this.load&&this.load.folders&&this.load.folders[t]&&(e.closed=this.load.folders[t].closed,e.load=this.load.folders[t]);var n=new Ye(e);this.__folders[t]=n;var o=Ke(this,n.domElement);return Ae.addClass(o,"folder"),n},removeFolder:function(t){this.__ul.removeChild(t.domElement.parentElement),delete this.__folders[t.name],this.load&&this.load.folders&&this.load.folders[t.name]&&delete this.load.folders[t.name],Ze(t);var e=this;ie.each(t.__folders,(function(e){t.removeFolder(e)})),ie.defer((function(){e.onResize()}))},open:function(){this.closed=!1},close:function(){this.closed=!0},hide:function(){this.domElement.style.display="none"},show:function(){this.domElement.style.display=""},onResize:function(){var t=this.getRoot();if(t.scrollable){var e=Ae.getOffset(t.__ul).top,n=0;ie.each(t.__ul.childNodes,(function(e){t.autoPlace&&e===t.__save_row||(n+=Ae.getHeight(e))})),window.innerHeight-e-20<n?(Ae.addClass(t.domElement,Ye.CLASS_TOO_TALL),t.__ul.style.height=window.innerHeight-e-20+"px"):(Ae.removeClass(t.domElement,Ye.CLASS_TOO_TALL),t.__ul.style.height="auto")}t.__resize_handle&&ie.defer((function(){t.__resize_handle.style.height=t.__ul.offsetHeight+"px"})),t.__closeButton&&(t.__closeButton.style.width=t.width+"px")},onResizeDebounced:ie.debounce((function(){this.onResize()}),50),remember:function(){if(ie.isUndefined(je)&&((je=new qe).domElement.innerHTML=Ue),this.parent)throw new Error("You can only call remember on a top level GUI.");var t=this;ie.each(Array.prototype.slice.call(arguments),(function(e){0===t.__rememberedObjects.length&&on(t),-1===t.__rememberedObjects.indexOf(e)&&t.__rememberedObjects.push(e)})),this.autoPlace&&sn(this,this.width)},getRoot:function(){for(var t=this;t.parent;)t=t.parent;return t},getSaveObject:function(){var t=this.load;return t.closed=this.closed,this.__rememberedObjects.length>0&&(t.preset=this.preset,t.remembered||(t.remembered={}),t.remembered[this.preset]=an(this)),t.folders={},ie.each(this.__folders,(function(e,n){t.folders[n]=e.getSaveObject()})),t},save:function(){this.load.remembered||(this.load.remembered={}),this.load.remembered[this.preset]=an(this),Qe(this,!1),this.saveToLocalStorageIfPossible()},saveAs:function(t){this.load.remembered||(this.load.remembered={},this.load.remembered[ze]=an(this,!0)),this.load.remembered[t]=an(this),this.preset=t,en(this,t,!0),this.saveToLocalStorageIfPossible()},revert:function(t){ie.each(this.__controllers,(function(e){this.getRoot().load.remembered?Je(t||this.getRoot(),e):e.setValue(e.initialValue),e.__onFinishChange&&e.__onFinishChange.call(e,e.getValue())}),this),ie.each(this.__folders,(function(t){t.revert(t)})),t||Qe(this.getRoot(),!1)},listen:function(t){var e=0===this.__listening.length;this.__listening.push(t),e&&un(this.__listening)},updateDisplay:function(){ie.each(this.__controllers,(function(t){t.updateDisplay()})),ie.each(this.__folders,(function(t){t.updateDisplay()}))}}),(t=>new Promise(((e,n)=>{const o=document.body.querySelector(".Loading-Bar");console.log("Load Assets",Zt),Zt.length>0?(document.body.classList.add("isLoading"),new(Jt())({assets:Zt}).on("error",(t=>{console.log("Error :",t)})).on("progress",(t=>{o&&(o.style.width=100*t+"%")})).on("complete",(n=>{o&&(o.style.width="100%"),Pt.init(n),setTimeout((()=>{document.body.classList.remove("isLoading"),e(t)}),500)})).start()):e(t)})))().then((function(){hn=document.createElement("canvas"),hn.id="main-canvas",document.body.appendChild(hn),_.init(hn,{alpha:!1,preserveDrawingBuffer:!_.isMobile&&!1}),ln=new Kt,new Promise(((t,e)=>{navigator.xr?navigator.xr.isSessionSupported("immersive-ar").then((e=>{xt=e,t(e)})):t(!1)})).then((t=>{t?(document.body.classList.add("has-xr"),document.body.querySelector(".btnAR").addEventListener("click",(()=>{Rt(_.gl).then((t=>{document.body.removeChild(hn),ln.present(),Et=()=>{console.log("session end"),window.location.reload()}}))}))):document.body.classList.add("no-xr")})),setTimeout((()=>{document.body.classList.add("hide-messages")}),5e3)}),(t=>{console.error(t)}))})()})();